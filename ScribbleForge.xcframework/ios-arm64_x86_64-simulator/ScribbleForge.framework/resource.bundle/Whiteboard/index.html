<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Rtr-Whiteboard-Bridge</title>
    
  <script type="module">var t,n,i=Object.defineProperty,__publicField=(t,n,r)=>((t,n,r)=>n in t?i(t,n,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[n]=r)(t,"symbol"!=typeof n?n+"":n,r);!function polyfill(){const t=document.createElement("link").relList;if(!(t&&t.supports&&t.supports("modulepreload"))){for(const t of document.querySelectorAll('link[rel="modulepreload"]'))processPreload(t);new MutationObserver((t=>{for(const n of t)if("childList"===n.type)for(const t of n.addedNodes)"LINK"===t.tagName&&"modulepreload"===t.rel&&processPreload(t)})).observe(document,{childList:!0,subtree:!0})}function processPreload(t){if(t.ep)return;t.ep=!0;const n=function getFetchOpts(t){const n={};return t.integrity&&(n.integrity=t.integrity),t.referrerPolicy&&(n.referrerPolicy=t.referrerPolicy),"use-credentials"===t.crossOrigin?n.credentials="include":"anonymous"===t.crossOrigin?n.credentials="omit":n.credentials="same-origin",n}(t);fetch(t.href,n)}}();const create$5=()=>new Map,copy=t=>{const n=create$5();return t.forEach(((t,i)=>{n.set(i,t)})),n},setIfUndefined=(t,n,i)=>{let r=t.get(n);return void 0===r&&t.set(n,r=i()),r},create$4=()=>new Set,last=t=>t[t.length-1],appendTo=(t,n)=>{for(let i=0;i<n.length;i++)t.push(n[i])},r=Array.from,o=Array.isArray;class ObservableV2{constructor(){this._observers=create$5()}on(t,n){return setIfUndefined(this._observers,t,create$4).add(n),n}once(t,n){const _f=(...i)=>{this.off(t,_f),n(...i)};this.on(t,_f)}off(t,n){const i=this._observers.get(t);void 0!==i&&(i.delete(n),0===i.size&&this._observers.delete(t))}emit(t,n){return r((this._observers.get(t)||create$5()).values()).forEach((t=>t(...n)))}destroy(){this._observers=create$5()}}const h=Math.floor,c=Math.abs,min=(t,n)=>t<n?t:n,max$1=(t,n)=>t>n?t:n,isNegativeZero=t=>0!==t?t<0:1/t<0,u=64,d=128,p=127,g=Number.MAX_SAFE_INTEGER,m=Number.isInteger||(t=>"number"==typeof t&&isFinite(t)&&h(t)===t),v=/^\s*/g,_=/([A-Z])/g,fromCamelCase=(t,n)=>(t=>t.replace(v,""))(t.replace(_,(t=>`${n}${(t=>t.toLowerCase())(t)}`))),y="undefined"!=typeof TextEncoder?new TextEncoder:null,w=y?t=>y.encode(t):t=>{const n=unescape(encodeURIComponent(t)),i=n.length,r=new Uint8Array(i);for(let o=0;o<i;o++)r[o]=n.codePointAt(o);return r};let x="undefined"==typeof TextDecoder?null:new TextDecoder("utf-8",{fatal:!0,ignoreBOM:!0});x&&1===x.decode(new Uint8Array).length&&(x=null);class Encoder{constructor(){this.cpos=0,this.cbuf=new Uint8Array(100),this.bufs=[]}}const createEncoder=()=>new Encoder,toUint8Array=t=>{const n=new Uint8Array((t=>{let n=t.cpos;for(let i=0;i<t.bufs.length;i++)n+=t.bufs[i].length;return n})(t));let i=0;for(let r=0;r<t.bufs.length;r++){const o=t.bufs[r];n.set(o,i),i+=o.length}return n.set(new Uint8Array(t.cbuf.buffer,0,t.cpos),i),n},write=(t,n)=>{const i=t.cbuf.length;t.cpos===i&&(t.bufs.push(t.cbuf),t.cbuf=new Uint8Array(2*i),t.cpos=0),t.cbuf[t.cpos++]=n},S=write,writeVarUint=(t,n)=>{for(;n>p;)write(t,d|p&n),n=h(n/128);write(t,p&n)},writeVarInt=(t,n)=>{const i=isNegativeZero(n);for(i&&(n=-n),write(t,(n>63?d:0)|(i?u:0)|63&n),n=h(n/64);n>0;)write(t,(n>p?d:0)|p&n),n=h(n/128)},C=new Uint8Array(3e4),k=C.length/3,P=y&&y.encodeInto?(t,n)=>{if(n.length<k){const i=y.encodeInto(n,C).written||0;writeVarUint(t,i);for(let n=0;n<i;n++)write(t,C[n])}else writeVarUint8Array(t,w(n))}:(t,n)=>{const i=unescape(encodeURIComponent(n)),r=i.length;writeVarUint(t,r);for(let o=0;o<r;o++)write(t,i.codePointAt(o))},writeUint8Array=(t,n)=>{const i=t.cbuf.length,r=t.cpos,o=min(i-r,n.length),h=n.length-o;t.cbuf.set(n.subarray(0,o),r),t.cpos+=o,h>0&&(t.bufs.push(t.cbuf),t.cbuf=new Uint8Array(max$1(2*i,h)),t.cbuf.set(n.subarray(o)),t.cpos=h)},writeVarUint8Array=(t,n)=>{writeVarUint(t,n.byteLength),writeUint8Array(t,n)},writeOnDataView=(t,n)=>{((t,n)=>{const i=t.cbuf.length;i-t.cpos<n&&(t.bufs.push(new Uint8Array(t.cbuf.buffer,0,t.cpos)),t.cbuf=new Uint8Array(2*max$1(i,n)),t.cpos=0)})(t,n);const i=new DataView(t.cbuf.buffer,t.cpos,n);return t.cpos+=n,i},I=new DataView(new ArrayBuffer(4)),writeAny=(t,n)=>{switch(typeof n){case"string":write(t,119),P(t,n);break;case"number":m(n)&&c(n)<=2147483647?(write(t,125),writeVarInt(t,n)):(i=n,I.setFloat32(0,i),I.getFloat32(0)===i?(write(t,124),((t,n)=>{writeOnDataView(t,4).setFloat32(0,n,!1)})(t,n)):(write(t,123),((t,n)=>{writeOnDataView(t,8).setFloat64(0,n,!1)})(t,n)));break;case"bigint":write(t,122),((t,n)=>{writeOnDataView(t,8).setBigInt64(0,n,!1)})(t,n);break;case"object":if(null===n)write(t,126);else if(o(n)){write(t,117),writeVarUint(t,n.length);for(let i=0;i<n.length;i++)writeAny(t,n[i])}else if(n instanceof Uint8Array)write(t,116),writeVarUint8Array(t,n);else{write(t,118);const i=Object.keys(n);writeVarUint(t,i.length);for(let r=0;r<i.length;r++){const o=i[r];P(t,o),writeAny(t,n[o])}}break;case"boolean":write(t,n?120:121);break;default:write(t,127)}var i};class RleEncoder extends Encoder{constructor(t){super(),this.w=t,this.s=null,this.count=0}write(t){this.s===t?this.count++:(this.count>0&&writeVarUint(this,this.count-1),this.count=1,this.w(this,t),this.s=t)}}const flushUintOptRleEncoder=t=>{t.count>0&&(writeVarInt(t.encoder,1===t.count?t.s:-t.s),t.count>1&&writeVarUint(t.encoder,t.count-2))};class UintOptRleEncoder{constructor(){this.encoder=new Encoder,this.s=0,this.count=0}write(t){this.s===t?this.count++:(flushUintOptRleEncoder(this),this.count=1,this.s=t)}toUint8Array(){return flushUintOptRleEncoder(this),toUint8Array(this.encoder)}}const flushIntDiffOptRleEncoder=t=>{if(t.count>0){const n=2*t.diff+(1===t.count?0:1);writeVarInt(t.encoder,n),t.count>1&&writeVarUint(t.encoder,t.count-2)}};class IntDiffOptRleEncoder{constructor(){this.encoder=new Encoder,this.s=0,this.count=0,this.diff=0}write(t){this.diff===t-this.s?(this.s=t,this.count++):(flushIntDiffOptRleEncoder(this),this.count=1,this.diff=t-this.s,this.s=t)}toUint8Array(){return flushIntDiffOptRleEncoder(this),toUint8Array(this.encoder)}}class StringEncoder{constructor(){this.sarr=[],this.s="",this.lensE=new UintOptRleEncoder}write(t){this.s+=t,this.s.length>19&&(this.sarr.push(this.s),this.s=""),this.lensE.write(t.length)}toUint8Array(){const t=new Encoder;return this.sarr.push(this.s),this.s="",P(t,this.sarr.join("")),writeUint8Array(t,this.lensE.toUint8Array()),toUint8Array(t)}}const create$3=t=>new Error(t),methodUnimplemented=()=>{throw create$3("Method unimplemented")},unexpectedCase=()=>{throw create$3("Unexpected case")},M=create$3("Unexpected end of array"),E=create$3("Integer out of Range");class Decoder{constructor(t){this.arr=t,this.pos=0}}const createDecoder=t=>new Decoder(t),readVarUint8Array=t=>((t,n)=>{const i=new Uint8Array(t.arr.buffer,t.pos+t.arr.byteOffset,n);return t.pos+=n,i})(t,readVarUint(t)),readUint8=t=>t.arr[t.pos++],readVarUint=t=>{let n=0,i=1;const r=t.arr.length;for(;t.pos<r;){const r=t.arr[t.pos++];if(n+=(r&p)*i,i*=128,r<d)return n;if(n>g)throw E}throw M},readVarInt=t=>{let n=t.arr[t.pos++],i=63&n,r=64;const o=(n&u)>0?-1:1;if(!(n&d))return o*i;const h=t.arr.length;for(;t.pos<h;){if(n=t.arr[t.pos++],i+=(n&p)*r,r*=128,n<d)return o*i;if(i>g)throw E}throw M},T=x?t=>x.decode(readVarUint8Array(t)):t=>{let n=readVarUint(t);if(0===n)return"";{let i=String.fromCodePoint(readUint8(t));if(--n<100)for(;n--;)i+=String.fromCodePoint(readUint8(t));else for(;n>0;){const r=n<1e4?n:1e4,o=t.arr.subarray(t.pos,t.pos+r);t.pos+=r,i+=String.fromCodePoint.apply(null,o),n-=r}return decodeURIComponent(escape(i))}},readFromDataView=(t,n)=>{const i=new DataView(t.arr.buffer,t.arr.byteOffset+t.pos,n);return t.pos+=n,i},O=[t=>{},t=>null,readVarInt,t=>readFromDataView(t,4).getFloat32(0,!1),t=>readFromDataView(t,8).getFloat64(0,!1),t=>readFromDataView(t,8).getBigInt64(0,!1),t=>!1,t=>!0,T,t=>{const n=readVarUint(t),i={};for(let r=0;r<n;r++){i[T(t)]=readAny(t)}return i},t=>{const n=readVarUint(t),i=[];for(let r=0;r<n;r++)i.push(readAny(t));return i},readVarUint8Array],readAny=t=>O[127-readUint8(t)](t);class RleDecoder extends Decoder{constructor(t,n){super(t),this.reader=n,this.s=null,this.count=0}read(){var t;return 0===this.count&&(this.s=this.reader(this),(t=this).pos!==t.arr.length?this.count=readVarUint(this)+1:this.count=-1),this.count--,this.s}}class UintOptRleDecoder extends Decoder{constructor(t){super(t),this.s=0,this.count=0}read(){if(0===this.count){this.s=readVarInt(this);const t=isNegativeZero(this.s);this.count=1,t&&(this.s=-this.s,this.count=readVarUint(this)+2)}return this.count--,this.s}}class IntDiffOptRleDecoder extends Decoder{constructor(t){super(t),this.s=0,this.count=0,this.diff=0}read(){if(0===this.count){const t=readVarInt(this),n=1&t;this.diff=h(t/2),this.count=1,n&&(this.count=readVarUint(this)+2)}return this.s+=this.diff,this.count--,this.s}}class StringDecoder{constructor(t){this.decoder=new UintOptRleDecoder(t),this.str=T(this.decoder),this.spos=0}read(){const t=this.spos+this.decoder.read(),n=this.str.slice(this.spos,t);return this.spos=t,n}}const D=crypto.getRandomValues.bind(crypto),uint32=()=>D(new Uint32Array(1))[0],N="10000000-1000-4000-8000-100000000000",uuidv4=()=>N.replace(/[018]/g,(t=>(t^uint32()&15>>t/4).toString(16))),j=Date.now,create$2=t=>new Promise(t);Promise.all.bind(Promise);const undefinedToNull=t=>void 0===t?null:t;let V=new class VarStoragePolyfill{constructor(){this.map=new Map}setItem(t,n){this.map.set(t,n)}getItem(t){return this.map.get(t)}},U=!0;try{"undefined"!=typeof localStorage&&localStorage&&(V=localStorage,U=!1)}catch(dr){}const z=V,F=Object.assign,q=Object.keys,size=t=>q(t).length,equalFlat=(t,n)=>t===n||size(t)===size(n)&&((t,n)=>{for(const i in t)if(!n(t[i],i))return!1;return!0})(t,((t,i)=>(void 0!==t||((t,n)=>Object.prototype.hasOwnProperty.call(t,n))(n,i))&&n[i]===t)),callAll=(t,n,i=0)=>{try{for(;i<t.length;i++)t[i](...n)}finally{i<t.length&&callAll(t,n,i+1)}},id=t=>t;var W={};const Y="undefined"!=typeof process&&process.release&&/node|io\.js/.test(process.release.name)&&"[object process]"===Object.prototype.toString.call("undefined"!=typeof process?process:0);let H;const hasParam=t=>(()=>{if(void 0===H)if(Y){H=create$5();const t=process.argv;let n=null;for(let i=0;i<t.length;i++){const r=t[i];"-"===r[0]?(null!==n&&H.set(n,""),n=r):null!==n&&(H.set(n,r),n=null)}null!==n&&H.set(n,"")}else"object"==typeof location?(H=create$5(),(location.search||"?").slice(1).split("&").forEach((t=>{if(0!==t.length){const[n,i]=t.split("=");H.set(`--${fromCamelCase(n,"-")}`,i),H.set(`-${fromCamelCase(n,"-")}`,i)}}))):H=create$5();return H})().has(t),getVariable=t=>undefinedToNull(Y?W[t.toUpperCase().replaceAll("-","_")]:z.getItem(t)),hasConf=t=>hasParam("--"+t)||null!==getVariable(t);hasConf("production");const X=Y&&["true","1","2"].includes(W.FORCE_COLOR)||!hasParam("--no-colors")&&!hasConf("no-color")&&(!Y||process.stdout.isTTY)&&(!Y||hasParam("--color")||null!==getVariable("COLORTERM")||(getVariable("TERM")||"").includes("color")),copyUint8Array=t=>{const n=(i=t.byteLength,new Uint8Array(i));var i;return n.set(t),n};class Pair{constructor(t,n){this.left=t,this.right=n}}const create$1=(t,n)=>new Pair(t,n);"undefined"!=typeof DOMParser&&new DOMParser;const J=Symbol,Z=J(),Q=J(),tt=J(),et=J(),nt=J(),it=J(),rt=J(),st=J(),ot=J(),ht={[Z]:create$1("font-weight","bold"),[Q]:create$1("font-weight","normal"),[tt]:create$1("color","blue"),[nt]:create$1("color","green"),[et]:create$1("color","grey"),[it]:create$1("color","red"),[rt]:create$1("color","purple"),[st]:create$1("color","orange"),[ot]:create$1("color","black")},lt=X?t=>{var n;1===t.length&&(null==(n=t[0])?void 0:n.constructor)===Function&&(t=t[0]());const i=[],r=[],o=create$5();let h=[],c=0;for(;c<t.length;c++){const n=t[c],h=ht[n];if(void 0!==h)o.set(h.left,h.right);else{if(void 0===n)break;if(n.constructor!==String&&n.constructor!==Number)break;{const t=((t,n)=>{const i=[];for(const[r,o]of t)i.push(n(o,r));return i})(o,((t,n)=>`${n}:${t};`)).join("");c>0||t.length>0?(i.push("%c"+n),r.push(t)):i.push(n)}}}for(c>0&&(h=r,h.unshift(i.join("")));c<t.length;c++){const n=t[c];n instanceof Symbol||h.push(n)}return h}:t=>{var n;1===t.length&&(null==(n=t[0])?void 0:n.constructor)===Function&&(t=t[0]());const i=[],r=[];let o=0;for(;o<t.length;o++){const n=t[o];if(void 0===n)break;if(n.constructor===String||n.constructor===Number)i.push(n);else if(n.constructor===Object)break}for(o>0&&r.push(i.join(""));o<t.length;o++){const n=t[o];n instanceof Symbol||r.push(n)}return r},ct=create$4(),createIterator=t=>({[Symbol.iterator](){return this},next:t}),iteratorMap=(t,n)=>createIterator((()=>{const{done:i,value:r}=t.next();return{done:i,value:i?void 0:n(r)}}));class DeleteItem{constructor(t,n){this.clock=t,this.len=n}}class DeleteSet{constructor(){this.clients=new Map}}const iterateDeletedStructs=(t,n,i)=>n.clients.forEach(((n,r)=>{const o=t.doc.store.clients.get(r);for(let h=0;h<n.length;h++){const r=n[h];iterateStructs(t,o,r.clock,r.len,i)}})),isDeleted=(t,n)=>{const i=t.clients.get(n.client);return void 0!==i&&null!==((t,n)=>{let i=0,r=t.length-1;for(;i<=r;){const o=h((i+r)/2),c=t[o],u=c.clock;if(u<=n){if(n<u+c.len)return o;i=o+1}else r=o-1}return null})(i,n.clock)},sortAndMergeDeleteSet=t=>{t.clients.forEach((t=>{let n,i;for(t.sort(((t,n)=>t.clock-n.clock)),n=1,i=1;n<t.length;n++){const r=t[i-1],o=t[n];r.clock+r.len>=o.clock?r.len=max$1(r.len,o.clock+o.len-r.clock):(i<n&&(t[i]=o),i++)}t.length=i}))},mergeDeleteSets=t=>{const n=new DeleteSet;for(let i=0;i<t.length;i++)t[i].clients.forEach(((r,o)=>{if(!n.clients.has(o)){const h=r.slice();for(let n=i+1;n<t.length;n++)appendTo(h,t[n].clients.get(o)||[]);n.clients.set(o,h)}}));return sortAndMergeDeleteSet(n),n},addToDeleteSet=(t,n,i,r)=>{setIfUndefined(t.clients,n,(()=>[])).push(new DeleteItem(i,r))},createDeleteSetFromStructStore=t=>{const n=new DeleteSet;return t.clients.forEach(((t,i)=>{const r=[];for(let n=0;n<t.length;n++){const i=t[n];if(i.deleted){const o=i.id.clock;let h=i.length;if(n+1<t.length)for(let i=t[n+1];n+1<t.length&&i.deleted;i=t[1+ ++n])h+=i.length;r.push(new DeleteItem(o,h))}}r.length>0&&n.clients.set(i,r)})),n},writeDeleteSet=(t,n)=>{writeVarUint(t.restEncoder,n.clients.size),r(n.clients.entries()).sort(((t,n)=>n[0]-t[0])).forEach((([n,i])=>{t.resetDsCurVal(),writeVarUint(t.restEncoder,n);const r=i.length;writeVarUint(t.restEncoder,r);for(let o=0;o<r;o++){const n=i[o];t.writeDsClock(n.clock),t.writeDsLen(n.len)}}))},readDeleteSet=t=>{const n=new DeleteSet,i=readVarUint(t.restDecoder);for(let r=0;r<i;r++){t.resetDsCurVal();const i=readVarUint(t.restDecoder),r=readVarUint(t.restDecoder);if(r>0){const o=setIfUndefined(n.clients,i,(()=>[]));for(let n=0;n<r;n++)o.push(new DeleteItem(t.readDsClock(),t.readDsLen()))}}return n},readAndApplyDeleteSet=(t,n,i)=>{const r=new DeleteSet,o=readVarUint(t.restDecoder);for(let h=0;h<o;h++){t.resetDsCurVal();const o=readVarUint(t.restDecoder),h=readVarUint(t.restDecoder),c=i.clients.get(o)||[],u=getState(i,o);for(let i=0;i<h;i++){const i=t.readDsClock(),h=i+t.readDsLen();if(i<u){u<h&&addToDeleteSet(r,o,u,h-u);let t=findIndexSS(c,i),d=c[t];for(!d.deleted&&d.id.clock<i&&(c.splice(t+1,0,splitItem(n,d,i-d.id.clock)),t++);t<c.length&&(d=c[t++],d.id.clock<h);)d.deleted||(h<d.id.clock+d.length&&c.splice(t,0,splitItem(n,d,h-d.id.clock)),d.delete(n))}else addToDeleteSet(r,o,i,h-i)}}if(r.clients.size>0){const t=new UpdateEncoderV2;return writeVarUint(t.restEncoder,0),writeDeleteSet(t,r),t.toUint8Array()}return null},ut=uint32;class Doc extends ObservableV2{constructor({guid:t=uuidv4(),collectionid:n=null,gc:i=!0,gcFilter:r=()=>!0,meta:o=null,autoLoad:h=!1,shouldLoad:c=!0}={}){super(),this.gc=i,this.gcFilter=r,this.clientID=ut(),this.guid=t,this.collectionid=n,this.share=new Map,this.store=new StructStore,this._transaction=null,this._transactionCleanups=[],this.subdocs=new Set,this._item=null,this.shouldLoad=c,this.autoLoad=h,this.meta=o,this.isLoaded=!1,this.isSynced=!1,this.whenLoaded=create$2((t=>{this.on("load",(()=>{this.isLoaded=!0,t(this)}))}));const provideSyncedPromise=()=>create$2((t=>{const eventHandler=n=>{void 0!==n&&!0!==n||(this.off("sync",eventHandler),t())};this.on("sync",eventHandler)}));this.on("sync",(t=>{!1===t&&this.isSynced&&(this.whenSynced=provideSyncedPromise()),this.isSynced=void 0===t||!0===t,this.isSynced&&!this.isLoaded&&this.emit("load",[this])})),this.whenSynced=provideSyncedPromise()}load(){const t=this._item;null===t||this.shouldLoad||transact(t.parent.doc,(t=>{t.subdocsLoaded.add(this)}),null,!0),this.shouldLoad=!0}getSubdocs(){return this.subdocs}getSubdocGuids(){return new Set(r(this.subdocs).map((t=>t.guid)))}transact(t,n=null){return transact(this,t,n)}get(t,n=AbstractType){const i=setIfUndefined(this.share,t,(()=>{const t=new n;return t._integrate(this,null),t})),r=i.constructor;if(n!==AbstractType&&r!==n){if(r===AbstractType){const r=new n;r._map=i._map,i._map.forEach((t=>{for(;null!==t;t=t.left)t.parent=r})),r._start=i._start;for(let t=r._start;null!==t;t=t.right)t.parent=r;return r._length=i._length,this.share.set(t,r),r._integrate(this,null),r}throw new Error(`Type with the name ${t} has already been defined with a different constructor`)}return i}getArray(t=""){return this.get(t,YArray)}getText(t=""){return this.get(t,YText)}getMap(t=""){return this.get(t,YMap)}getXmlElement(t=""){return this.get(t,YXmlElement)}getXmlFragment(t=""){return this.get(t,YXmlFragment)}toJSON(){const t={};return this.share.forEach(((n,i)=>{t[i]=n.toJSON()})),t}destroy(){r(this.subdocs).forEach((t=>t.destroy()));const t=this._item;if(null!==t){this._item=null;const n=t.content;n.doc=new Doc({guid:this.guid,...n.opts,shouldLoad:!1}),n.doc._item=t,transact(t.parent.doc,(i=>{const r=n.doc;t.deleted||i.subdocsAdded.add(r),i.subdocsRemoved.add(this)}),null,!0)}this.emit("destroyed",[!0]),this.emit("destroy",[this]),super.destroy()}}class DSDecoderV1{constructor(t){this.restDecoder=t}resetDsCurVal(){}readDsClock(){return readVarUint(this.restDecoder)}readDsLen(){return readVarUint(this.restDecoder)}}class UpdateDecoderV1 extends DSDecoderV1{readLeftID(){return createID(readVarUint(this.restDecoder),readVarUint(this.restDecoder))}readRightID(){return createID(readVarUint(this.restDecoder),readVarUint(this.restDecoder))}readClient(){return readVarUint(this.restDecoder)}readInfo(){return readUint8(this.restDecoder)}readString(){return T(this.restDecoder)}readParentInfo(){return 1===readVarUint(this.restDecoder)}readTypeRef(){return readVarUint(this.restDecoder)}readLen(){return readVarUint(this.restDecoder)}readAny(){return readAny(this.restDecoder)}readBuf(){return copyUint8Array(readVarUint8Array(this.restDecoder))}readJSON(){return JSON.parse(T(this.restDecoder))}readKey(){return T(this.restDecoder)}}class DSDecoderV2{constructor(t){this.dsCurrVal=0,this.restDecoder=t}resetDsCurVal(){this.dsCurrVal=0}readDsClock(){return this.dsCurrVal+=readVarUint(this.restDecoder),this.dsCurrVal}readDsLen(){const t=readVarUint(this.restDecoder)+1;return this.dsCurrVal+=t,t}}class UpdateDecoderV2 extends DSDecoderV2{constructor(t){super(t),this.keys=[],readVarUint(t),this.keyClockDecoder=new IntDiffOptRleDecoder(readVarUint8Array(t)),this.clientDecoder=new UintOptRleDecoder(readVarUint8Array(t)),this.leftClockDecoder=new IntDiffOptRleDecoder(readVarUint8Array(t)),this.rightClockDecoder=new IntDiffOptRleDecoder(readVarUint8Array(t)),this.infoDecoder=new RleDecoder(readVarUint8Array(t),readUint8),this.stringDecoder=new StringDecoder(readVarUint8Array(t)),this.parentInfoDecoder=new RleDecoder(readVarUint8Array(t),readUint8),this.typeRefDecoder=new UintOptRleDecoder(readVarUint8Array(t)),this.lenDecoder=new UintOptRleDecoder(readVarUint8Array(t))}readLeftID(){return new ID(this.clientDecoder.read(),this.leftClockDecoder.read())}readRightID(){return new ID(this.clientDecoder.read(),this.rightClockDecoder.read())}readClient(){return this.clientDecoder.read()}readInfo(){return this.infoDecoder.read()}readString(){return this.stringDecoder.read()}readParentInfo(){return 1===this.parentInfoDecoder.read()}readTypeRef(){return this.typeRefDecoder.read()}readLen(){return this.lenDecoder.read()}readAny(){return readAny(this.restDecoder)}readBuf(){return readVarUint8Array(this.restDecoder)}readJSON(){return readAny(this.restDecoder)}readKey(){const t=this.keyClockDecoder.read();if(t<this.keys.length)return this.keys[t];{const t=this.stringDecoder.read();return this.keys.push(t),t}}}class DSEncoderV1{constructor(){this.restEncoder=createEncoder()}toUint8Array(){return toUint8Array(this.restEncoder)}resetDsCurVal(){}writeDsClock(t){writeVarUint(this.restEncoder,t)}writeDsLen(t){writeVarUint(this.restEncoder,t)}}class UpdateEncoderV1 extends DSEncoderV1{writeLeftID(t){writeVarUint(this.restEncoder,t.client),writeVarUint(this.restEncoder,t.clock)}writeRightID(t){writeVarUint(this.restEncoder,t.client),writeVarUint(this.restEncoder,t.clock)}writeClient(t){writeVarUint(this.restEncoder,t)}writeInfo(t){S(this.restEncoder,t)}writeString(t){P(this.restEncoder,t)}writeParentInfo(t){writeVarUint(this.restEncoder,t?1:0)}writeTypeRef(t){writeVarUint(this.restEncoder,t)}writeLen(t){writeVarUint(this.restEncoder,t)}writeAny(t){writeAny(this.restEncoder,t)}writeBuf(t){writeVarUint8Array(this.restEncoder,t)}writeJSON(t){P(this.restEncoder,JSON.stringify(t))}writeKey(t){P(this.restEncoder,t)}}class DSEncoderV2{constructor(){this.restEncoder=createEncoder(),this.dsCurrVal=0}toUint8Array(){return toUint8Array(this.restEncoder)}resetDsCurVal(){this.dsCurrVal=0}writeDsClock(t){const n=t-this.dsCurrVal;this.dsCurrVal=t,writeVarUint(this.restEncoder,n)}writeDsLen(t){0===t&&unexpectedCase(),writeVarUint(this.restEncoder,t-1),this.dsCurrVal+=t}}class UpdateEncoderV2 extends DSEncoderV2{constructor(){super(),this.keyMap=new Map,this.keyClock=0,this.keyClockEncoder=new IntDiffOptRleEncoder,this.clientEncoder=new UintOptRleEncoder,this.leftClockEncoder=new IntDiffOptRleEncoder,this.rightClockEncoder=new IntDiffOptRleEncoder,this.infoEncoder=new RleEncoder(S),this.stringEncoder=new StringEncoder,this.parentInfoEncoder=new RleEncoder(S),this.typeRefEncoder=new UintOptRleEncoder,this.lenEncoder=new UintOptRleEncoder}toUint8Array(){const t=createEncoder();return writeVarUint(t,0),writeVarUint8Array(t,this.keyClockEncoder.toUint8Array()),writeVarUint8Array(t,this.clientEncoder.toUint8Array()),writeVarUint8Array(t,this.leftClockEncoder.toUint8Array()),writeVarUint8Array(t,this.rightClockEncoder.toUint8Array()),writeVarUint8Array(t,toUint8Array(this.infoEncoder)),writeVarUint8Array(t,this.stringEncoder.toUint8Array()),writeVarUint8Array(t,toUint8Array(this.parentInfoEncoder)),writeVarUint8Array(t,this.typeRefEncoder.toUint8Array()),writeVarUint8Array(t,this.lenEncoder.toUint8Array()),writeUint8Array(t,toUint8Array(this.restEncoder)),toUint8Array(t)}writeLeftID(t){this.clientEncoder.write(t.client),this.leftClockEncoder.write(t.clock)}writeRightID(t){this.clientEncoder.write(t.client),this.rightClockEncoder.write(t.clock)}writeClient(t){this.clientEncoder.write(t)}writeInfo(t){this.infoEncoder.write(t)}writeString(t){this.stringEncoder.write(t)}writeParentInfo(t){this.parentInfoEncoder.write(t?1:0)}writeTypeRef(t){this.typeRefEncoder.write(t)}writeLen(t){this.lenEncoder.write(t)}writeAny(t){writeAny(this.restEncoder,t)}writeBuf(t){writeVarUint8Array(this.restEncoder,t)}writeJSON(t){writeAny(this.restEncoder,t)}writeKey(t){const n=this.keyMap.get(t);void 0===n?(this.keyClockEncoder.write(this.keyClock++),this.stringEncoder.write(t)):this.keyClockEncoder.write(n)}}const writeClientsStructs=(t,n,i)=>{const o=new Map;i.forEach(((t,i)=>{getState(n,i)>t&&o.set(i,t)})),getStateVector(n).forEach(((t,n)=>{i.has(n)||o.set(n,0)})),writeVarUint(t.restEncoder,o.size),r(o.entries()).sort(((t,n)=>n[0]-t[0])).forEach((([i,r])=>{((t,n,i,r)=>{r=max$1(r,n[0].id.clock);const o=findIndexSS(n,r);writeVarUint(t.restEncoder,n.length-o),t.writeClient(i),writeVarUint(t.restEncoder,r);const h=n[o];h.write(t,r-h.id.clock);for(let c=o+1;c<n.length;c++)n[c].write(t,0)})(t,n.clients.get(i),i,r)}))},readUpdateV2=(t,n,i,o=new UpdateDecoderV2(t))=>transact(n,(t=>{t.local=!1;let n=!1;const i=t.doc,h=i.store,c=((t,n)=>{const i=create$5(),r=readVarUint(t.restDecoder);for(let o=0;o<r;o++){const r=readVarUint(t.restDecoder),o=new Array(r),h=t.readClient();let c=readVarUint(t.restDecoder);i.set(h,{i:0,refs:o});for(let i=0;i<r;i++){const r=t.readInfo();switch(31&r){case 0:{const n=t.readLen();o[i]=new GC(createID(h,c),n),c+=n;break}case 10:{const n=readVarUint(t.restDecoder);o[i]=new Skip(createID(h,c),n),c+=n;break}default:{const p=!(192&r),g=new Item(createID(h,c),null,(r&d)===d?t.readLeftID():null,null,(r&u)===u?t.readRightID():null,p?t.readParentInfo()?n.get(t.readString()):t.readLeftID():null,!p||32&~r?null:t.readString(),readItemContent(t,r));o[i]=g,c+=g.length}}}}return i})(o,i),p=((t,n,i)=>{const o=[];let h=r(i.keys()).sort(((t,n)=>t-n));if(0===h.length)return null;const getNextStructTarget=()=>{if(0===h.length)return null;let t=i.get(h[h.length-1]);for(;t.refs.length===t.i;){if(h.pop(),!(h.length>0))return null;t=i.get(h[h.length-1])}return t};let c=getNextStructTarget();if(null===c)return null;const u=new StructStore,d=new Map,updateMissingSv=(t,n)=>{const i=d.get(t);(null==i||i>n)&&d.set(t,n)};let p=c.refs[c.i++];const g=new Map,addStackToRestSS=()=>{for(const t of o){const n=t.id.client,r=i.get(n);r?(r.i--,u.clients.set(n,r.refs.slice(r.i)),i.delete(n),r.i=0,r.refs=[]):u.clients.set(n,[t]),h=h.filter((t=>t!==n))}o.length=0};for(;;){if(p.constructor!==Skip){const r=setIfUndefined(g,p.id.client,(()=>getState(n,p.id.client)))-p.id.clock;if(r<0)o.push(p),updateMissingSv(p.id.client,p.id.clock-1),addStackToRestSS();else{const h=p.getMissing(t,n);if(null!==h){o.push(p);const t=i.get(h)||{refs:[],i:0};if(t.refs.length!==t.i){p=t.refs[t.i++];continue}updateMissingSv(h,getState(n,h)),addStackToRestSS()}else(0===r||r<p.length)&&(p.integrate(t,r),g.set(p.id.client,p.id.clock+p.length))}}if(o.length>0)p=o.pop();else if(null!==c&&c.i<c.refs.length)p=c.refs[c.i++];else{if(c=getNextStructTarget(),null===c)break;p=c.refs[c.i++]}}if(u.clients.size>0){const t=new UpdateEncoderV2;return writeClientsStructs(t,u,new Map),writeVarUint(t.restEncoder,0),{missing:d,update:t.toUint8Array()}}return null})(t,h,c),g=h.pendingStructs;if(g){for(const[t,i]of g.missing)if(i<getState(h,t)){n=!0;break}if(p){for(const[t,n]of p.missing){const i=g.missing.get(t);(null==i||i>n)&&g.missing.set(t,n)}g.update=mergeUpdatesV2([g.update,p.update])}}else h.pendingStructs=p;const m=readAndApplyDeleteSet(o,t,h);if(h.pendingDs){const n=new UpdateDecoderV2(createDecoder(h.pendingDs));readVarUint(n.restDecoder);const i=readAndApplyDeleteSet(n,t,h);h.pendingDs=m&&i?mergeUpdatesV2([m,i]):m||i}else h.pendingDs=m;if(n){const n=h.pendingStructs.update;h.pendingStructs=null,applyUpdateV2(t.doc,n)}}),i,!1),applyUpdateV2=(t,n,i,r=UpdateDecoderV2)=>{const o=createDecoder(n);readUpdateV2(o,t,i,new r(o))},applyUpdate=(t,n,i)=>applyUpdateV2(t,n,i,UpdateDecoderV1),encodeStateAsUpdateV2=(t,n=new Uint8Array([0]),i=new UpdateEncoderV2)=>{((t,n,i=new Map)=>{writeClientsStructs(t,n.store,i),writeDeleteSet(t,createDeleteSetFromStructStore(n.store))})(i,t,decodeStateVector(n));const r=[i.toUint8Array()];if(t.store.pendingDs&&r.push(t.store.pendingDs),t.store.pendingStructs&&r.push(diffUpdateV2(t.store.pendingStructs.update,n)),r.length>1){if(i.constructor===UpdateEncoderV1)return mergeUpdates(r.map(((t,n)=>0===n?t:convertUpdateFormatV2ToV1(t))));if(i.constructor===UpdateEncoderV2)return mergeUpdatesV2(r)}return r[0]},encodeStateAsUpdate=(t,n)=>encodeStateAsUpdateV2(t,n,new UpdateEncoderV1),decodeStateVector=t=>(t=>{const n=new Map,i=readVarUint(t.restDecoder);for(let r=0;r<i;r++){const i=readVarUint(t.restDecoder),r=readVarUint(t.restDecoder);n.set(i,r)}return n})(new DSDecoderV1(createDecoder(t))),writeStateVector=(t,n)=>(writeVarUint(t.restEncoder,n.size),r(n.entries()).sort(((t,n)=>n[0]-t[0])).forEach((([n,i])=>{writeVarUint(t.restEncoder,n),writeVarUint(t.restEncoder,i)})),t),encodeStateVectorV2=(t,n=new DSEncoderV2)=>(t instanceof Map?writeStateVector(n,t):((t,n)=>{writeStateVector(t,getStateVector(n.store))})(n,t),n.toUint8Array()),encodeStateVector=t=>encodeStateVectorV2(t,new DSEncoderV1);class EventHandler{constructor(){this.l=[]}}const createEventHandler=()=>new EventHandler,addEventHandlerListener=(t,n)=>t.l.push(n),removeEventHandlerListener=(t,n)=>{const i=t.l,r=i.length;t.l=i.filter((t=>n!==t)),r===t.l.length&&console.error("[yjs] Tried to remove event handler that doesn't exist.")},callEventHandlerListeners=(t,n,i)=>callAll(t.l,[n,i]);class ID{constructor(t,n){this.client=t,this.clock=n}}const compareIDs=(t,n)=>t===n||null!==t&&null!==n&&t.client===n.client&&t.clock===n.clock,createID=(t,n)=>new ID(t,n),isParentOf=(t,n)=>{for(;null!==n;){if(n.parent===t)return!0;n=n.parent._item}return!1},isVisible=(t,n)=>void 0===n?!t.deleted:n.sv.has(t.id.client)&&(n.sv.get(t.id.client)||0)>t.id.clock&&!isDeleted(n.ds,t.id),splitSnapshotAffectedStructs=(t,n)=>{const i=setIfUndefined(t.meta,splitSnapshotAffectedStructs,create$4),r=t.doc.store;i.has(n)||(n.sv.forEach(((n,i)=>{n<getState(r,i)&&getItemCleanStart(t,createID(i,n))})),iterateDeletedStructs(t,n.ds,(t=>{})),i.add(n))};class StructStore{constructor(){this.clients=new Map,this.pendingStructs=null,this.pendingDs=null}}const getStateVector=t=>{const n=new Map;return t.clients.forEach(((t,i)=>{const r=t[t.length-1];n.set(i,r.id.clock+r.length)})),n},getState=(t,n)=>{const i=t.clients.get(n);if(void 0===i)return 0;const r=i[i.length-1];return r.id.clock+r.length},addStruct=(t,n)=>{let i=t.clients.get(n.id.client);if(void 0===i)i=[],t.clients.set(n.id.client,i);else{const t=i[i.length-1];if(t.id.clock+t.length!==n.id.clock)throw unexpectedCase()}i.push(n)},findIndexSS=(t,n)=>{let i=0,r=t.length-1,o=t[r],c=o.id.clock;if(c===n)return r;let u=h(n/(c+o.length-1)*r);for(;i<=r;){if(o=t[u],c=o.id.clock,c<=n){if(n<c+o.length)return u;i=u+1}else r=u-1;u=h((i+r)/2)}throw unexpectedCase()},getItem=(t,n)=>{const i=t.clients.get(n.client);return i[findIndexSS(i,n.clock)]},findIndexCleanStart=(t,n,i)=>{const r=findIndexSS(n,i),o=n[r];return o.id.clock<i&&o instanceof Item?(n.splice(r+1,0,splitItem(t,o,i-o.id.clock)),r+1):r},getItemCleanStart=(t,n)=>{const i=t.doc.store.clients.get(n.client);return i[findIndexCleanStart(t,i,n.clock)]},getItemCleanEnd=(t,n,i)=>{const r=n.clients.get(i.client),o=findIndexSS(r,i.clock),h=r[o];return i.clock!==h.id.clock+h.length-1&&h.constructor!==GC&&r.splice(o+1,0,splitItem(t,h,i.clock-h.id.clock+1)),h},iterateStructs=(t,n,i,r,o)=>{if(0===r)return;const h=i+r;let c,u=findIndexCleanStart(t,n,i);do{c=n[u++],h<c.id.clock+c.length&&findIndexCleanStart(t,n,h),o(c)}while(u<n.length&&n[u].id.clock<h)};class Transaction{constructor(t,n,i){this.doc=t,this.deleteSet=new DeleteSet,this.beforeState=getStateVector(t.store),this.afterState=new Map,this.changed=new Map,this.changedParentTypes=new Map,this._mergeStructs=[],this.origin=n,this.meta=new Map,this.local=i,this.subdocsAdded=new Set,this.subdocsRemoved=new Set,this.subdocsLoaded=new Set,this._needFormattingCleanup=!1}}const writeUpdateMessageFromTransaction=(t,n)=>!(0===n.deleteSet.clients.size&&!((t,n)=>{for(const[i,r]of t)if(n(r,i))return!0;return!1})(n.afterState,((t,i)=>n.beforeState.get(i)!==t)))&&(sortAndMergeDeleteSet(n.deleteSet),((t,n)=>{writeClientsStructs(t,n.doc.store,n.beforeState)})(t,n),writeDeleteSet(t,n.deleteSet),!0),addChangedTypeToTransaction=(t,n,i)=>{const r=n._item;(null===r||r.id.clock<(t.beforeState.get(r.id.client)||0)&&!r.deleted)&&setIfUndefined(t.changed,n,create$4).add(i)},tryToMergeWithLefts=(t,n)=>{let i=t[n],r=t[n-1],o=n;for(;o>0&&(r.deleted===i.deleted&&r.constructor===i.constructor&&r.mergeWith(i));i=r,r=t[--o-1])i instanceof Item&&null!==i.parentSub&&i.parent._map.get(i.parentSub)===i&&i.parent._map.set(i.parentSub,r);const h=n-o;return h&&t.splice(n+1-h,h),h},cleanupTransactions=(t,n)=>{if(n<t.length){const i=t[n],r=i.doc,o=r.store,h=i.deleteSet,c=i._mergeStructs;try{sortAndMergeDeleteSet(h),i.afterState=getStateVector(i.doc.store),r.emit("beforeObserverCalls",[i,r]);const t=[];i.changed.forEach(((n,r)=>t.push((()=>{null!==r._item&&r._item.deleted||r._callObserver(i,n)})))),t.push((()=>{i.changedParentTypes.forEach(((t,n)=>{n._dEH.l.length>0&&(null===n._item||!n._item.deleted)&&((t=t.filter((t=>null===t.target._item||!t.target._item.deleted))).forEach((t=>{t.currentTarget=n,t._path=null})),t.sort(((t,n)=>t.path.length-n.path.length)),callEventHandlerListeners(n._dEH,t,i))}))})),t.push((()=>r.emit("afterTransaction",[i,r]))),callAll(t,[]),i._needFormattingCleanup&&cleanupYTextAfterTransaction(i)}finally{r.gc&&((t,n,i)=>{for(const[r,o]of t.clients.entries()){const t=n.clients.get(r);for(let r=o.length-1;r>=0;r--){const h=o[r],c=h.clock+h.len;for(let r=findIndexSS(t,h.clock),o=t[r];r<t.length&&o.id.clock<c;o=t[++r]){const o=t[r];if(h.clock+h.len<=o.id.clock)break;o instanceof Item&&o.deleted&&!o.keep&&i(o)&&o.gc(n,!1)}}}})(h,o,r.gcFilter),((t,n)=>{t.clients.forEach(((t,i)=>{const r=n.clients.get(i);for(let n=t.length-1;n>=0;n--){const i=t[n];for(let t=min(r.length-1,1+findIndexSS(r,i.clock+i.len-1)),n=r[t];t>0&&n.id.clock>=i.clock;n=r[t])t-=1+tryToMergeWithLefts(r,t)}}))})(h,o),i.afterState.forEach(((t,n)=>{const r=i.beforeState.get(n)||0;if(r!==t){const t=o.clients.get(n),i=max$1(findIndexSS(t,r),1);for(let n=t.length-1;n>=i;)n-=1+tryToMergeWithLefts(t,n)}}));for(let t=c.length-1;t>=0;t--){const{client:n,clock:i}=c[t].id,r=o.clients.get(n),h=findIndexSS(r,i);h+1<r.length&&tryToMergeWithLefts(r,h+1)>1||h>0&&tryToMergeWithLefts(r,h)}if(i.local||i.afterState.get(r.clientID)===i.beforeState.get(r.clientID)||(((...t)=>{console.log(...lt(t)),ct.forEach((n=>n.print(t)))})(st,Z,"[yjs] ",Q,it,"Changed the client-id because another client seems to be using it."),r.clientID=ut()),r.emit("afterTransactionCleanup",[i,r]),r._observers.has("update")){const t=new UpdateEncoderV1;writeUpdateMessageFromTransaction(t,i)&&r.emit("update",[t.toUint8Array(),i.origin,r,i])}if(r._observers.has("updateV2")){const t=new UpdateEncoderV2;writeUpdateMessageFromTransaction(t,i)&&r.emit("updateV2",[t.toUint8Array(),i.origin,r,i])}const{subdocsAdded:u,subdocsLoaded:d,subdocsRemoved:p}=i;(u.size>0||p.size>0||d.size>0)&&(u.forEach((t=>{t.clientID=r.clientID,null==t.collectionid&&(t.collectionid=r.collectionid),r.subdocs.add(t)})),p.forEach((t=>r.subdocs.delete(t))),r.emit("subdocs",[{loaded:d,added:u,removed:p},r,i]),p.forEach((t=>t.destroy()))),t.length<=n+1?(r._transactionCleanups=[],r.emit("afterAllTransactions",[r,t])):cleanupTransactions(t,n+1)}}},transact=(t,n,i=null,r=!0)=>{const o=t._transactionCleanups;let h=!1,c=null;null===t._transaction&&(h=!0,t._transaction=new Transaction(t,i,r),o.push(t._transaction),1===o.length&&t.emit("beforeAllTransactions",[t]),t.emit("beforeTransaction",[t._transaction,t]));try{c=n(t._transaction)}finally{if(h){const n=t._transaction===o[0];t._transaction=null,n&&cleanupTransactions(o,0)}}return c};class StackItem{constructor(t,n){this.insertions=n,this.deletions=t,this.meta=new Map}}const clearUndoManagerStackItem=(t,n,i)=>{iterateDeletedStructs(t,i.deletions,(t=>{t instanceof Item&&n.scope.some((n=>isParentOf(n,t)))&&keepItem(t,!1)}))},popStackItem=(t,n,i)=>{let r=null;const o=t.doc,h=t.scope;transact(o,(i=>{for(;n.length>0&&null===t.currStackItem;){const r=o.store,c=n.pop(),u=new Set,d=[];let p=!1;iterateDeletedStructs(i,c.insertions,(t=>{if(t instanceof Item){if(null!==t.redone){let{item:n,diff:o}=followRedone(r,t.id);o>0&&(n=getItemCleanStart(i,createID(n.id.client,n.id.clock+o))),t=n}!t.deleted&&h.some((n=>isParentOf(n,t)))&&d.push(t)}})),iterateDeletedStructs(i,c.deletions,(t=>{t instanceof Item&&h.some((n=>isParentOf(n,t)))&&!isDeleted(c.insertions,t.id)&&u.add(t)})),u.forEach((n=>{p=null!==redoItem(i,n,u,c.insertions,t.ignoreRemoteMapChanges,t)||p}));for(let n=d.length-1;n>=0;n--){const r=d[n];t.deleteFilter(r)&&(r.delete(i),p=!0)}t.currStackItem=p?c:null}i.changed.forEach(((t,n)=>{t.has(null)&&n._searchMarker&&(n._searchMarker.length=0)})),r=i}),t);const c=t.currStackItem;if(null!=c){const n=r.changedParentTypes;t.emit("stack-item-popped",[{stackItem:c,type:i,changedParentTypes:n,origin:t},t]),t.currStackItem=null}return c};class UndoManager extends ObservableV2{constructor(t,{captureTimeout:n=500,captureTransaction:i=t=>!0,deleteFilter:r=()=>!0,trackedOrigins:h=new Set([null]),ignoreRemoteMapChanges:c=!1,doc:u=(o(t)?t[0].doc:t.doc)}={}){super(),this.scope=[],this.doc=u,this.addToScope(t),this.deleteFilter=r,h.add(this),this.trackedOrigins=h,this.captureTransaction=i,this.undoStack=[],this.redoStack=[],this.undoing=!1,this.redoing=!1,this.currStackItem=null,this.lastChange=0,this.ignoreRemoteMapChanges=c,this.captureTimeout=n,this.afterTransactionHandler=t=>{if(!(this.captureTransaction(t)&&this.scope.some((n=>t.changedParentTypes.has(n)))&&(this.trackedOrigins.has(t.origin)||t.origin&&this.trackedOrigins.has(t.origin.constructor))))return;const n=this.undoing,i=this.redoing,r=n?this.redoStack:this.undoStack;n?this.stopCapturing():i||this.clear(!1,!0);const o=new DeleteSet;t.afterState.forEach(((n,i)=>{const r=t.beforeState.get(i)||0,h=n-r;h>0&&addToDeleteSet(o,i,r,h)}));const h=j();let c=!1;if(this.lastChange>0&&h-this.lastChange<this.captureTimeout&&r.length>0&&!n&&!i){const n=r[r.length-1];n.deletions=mergeDeleteSets([n.deletions,t.deleteSet]),n.insertions=mergeDeleteSets([n.insertions,o])}else r.push(new StackItem(t.deleteSet,o)),c=!0;n||i||(this.lastChange=h),iterateDeletedStructs(t,t.deleteSet,(t=>{t instanceof Item&&this.scope.some((n=>isParentOf(n,t)))&&keepItem(t,!0)}));const u=[{stackItem:r[r.length-1],origin:t.origin,type:n?"redo":"undo",changedParentTypes:t.changedParentTypes},this];c?this.emit("stack-item-added",u):this.emit("stack-item-updated",u)},this.doc.on("afterTransaction",this.afterTransactionHandler),this.doc.on("destroy",(()=>{this.destroy()}))}addToScope(t){(t=o(t)?t:[t]).forEach((t=>{this.scope.every((n=>n!==t))&&(t.doc!==this.doc&&((...t)=>{console.warn(...lt(t)),t.unshift(st),ct.forEach((n=>n.print(t)))})("[yjs#509] Not same Y.Doc"),this.scope.push(t))}))}addTrackedOrigin(t){this.trackedOrigins.add(t)}removeTrackedOrigin(t){this.trackedOrigins.delete(t)}clear(t=!0,n=!0){(t&&this.canUndo()||n&&this.canRedo())&&this.doc.transact((i=>{t&&(this.undoStack.forEach((t=>clearUndoManagerStackItem(i,this,t))),this.undoStack=[]),n&&(this.redoStack.forEach((t=>clearUndoManagerStackItem(i,this,t))),this.redoStack=[]),this.emit("stack-cleared",[{undoStackCleared:t,redoStackCleared:n}])}))}stopCapturing(){this.lastChange=0}undo(){let t;this.undoing=!0;try{t=popStackItem(this,this.undoStack,"undo")}finally{this.undoing=!1}return t}redo(){let t;this.redoing=!0;try{t=popStackItem(this,this.redoStack,"redo")}finally{this.redoing=!1}return t}canUndo(){return this.undoStack.length>0}canRedo(){return this.redoStack.length>0}destroy(){this.trackedOrigins.delete(this),this.doc.off("afterTransaction",this.afterTransactionHandler),super.destroy()}}class LazyStructReader{constructor(t,n){this.gen=function*lazyStructReaderGenerator(t){const n=readVarUint(t.restDecoder);for(let i=0;i<n;i++){const n=readVarUint(t.restDecoder),i=t.readClient();let r=readVarUint(t.restDecoder);for(let o=0;o<n;o++){const n=t.readInfo();if(10===n){const n=readVarUint(t.restDecoder);yield new Skip(createID(i,r),n),r+=n}else if(31&n){const o=!(192&n),h=new Item(createID(i,r),null,(n&d)===d?t.readLeftID():null,null,(n&u)===u?t.readRightID():null,o?t.readParentInfo()?t.readString():t.readLeftID():null,!o||32&~n?null:t.readString(),readItemContent(t,n));yield h,r+=h.length}else{const n=t.readLen();yield new GC(createID(i,r),n),r+=n}}}}(t),this.curr=null,this.done=!1,this.filterSkips=n,this.next()}next(){do{this.curr=this.gen.next().value||null}while(this.filterSkips&&null!==this.curr&&this.curr.constructor===Skip);return this.curr}}class LazyStructWriter{constructor(t){this.currClient=0,this.startClock=0,this.written=0,this.encoder=t,this.clientStructs=[]}}const mergeUpdates=t=>mergeUpdatesV2(t,UpdateDecoderV1,UpdateEncoderV1),sliceStruct=(t,n)=>{if(t.constructor===GC){const{client:i,clock:r}=t.id;return new GC(createID(i,r+n),t.length-n)}if(t.constructor===Skip){const{client:i,clock:r}=t.id;return new Skip(createID(i,r+n),t.length-n)}{const i=t,{client:r,clock:o}=i.id;return new Item(createID(r,o+n),null,createID(r,o+n-1),null,i.rightOrigin,i.parent,i.parentSub,i.content.splice(n))}},mergeUpdatesV2=(t,n=UpdateDecoderV2,i=UpdateEncoderV2)=>{if(1===t.length)return t[0];const r=t.map((t=>new n(createDecoder(t))));let o=r.map((t=>new LazyStructReader(t,!0))),h=null;const c=new i,u=new LazyStructWriter(c);for(;o=o.filter((t=>null!==t.curr)),o.sort(((t,n)=>{if(t.curr.id.client===n.curr.id.client){const i=t.curr.id.clock-n.curr.id.clock;return 0===i?t.curr.constructor===n.curr.constructor?0:t.curr.constructor===Skip?1:-1:i}return n.curr.id.client-t.curr.id.client})),0!==o.length;){const t=o[0],n=t.curr.id.client;if(null!==h){let i=t.curr,r=!1;for(;null!==i&&i.id.clock+i.length<=h.struct.id.clock+h.struct.length&&i.id.client>=h.struct.id.client;)i=t.next(),r=!0;if(null===i||i.id.client!==n||r&&i.id.clock>h.struct.id.clock+h.struct.length)continue;if(n!==h.struct.id.client)writeStructToLazyStructWriter(u,h.struct,h.offset),h={struct:i,offset:0},t.next();else if(h.struct.id.clock+h.struct.length<i.id.clock)if(h.struct.constructor===Skip)h.struct.length=i.id.clock+i.length-h.struct.id.clock;else{writeStructToLazyStructWriter(u,h.struct,h.offset);const t=i.id.clock-h.struct.id.clock-h.struct.length;h={struct:new Skip(createID(n,h.struct.id.clock+h.struct.length),t),offset:0}}else{const n=h.struct.id.clock+h.struct.length-i.id.clock;n>0&&(h.struct.constructor===Skip?h.struct.length-=n:i=sliceStruct(i,n)),h.struct.mergeWith(i)||(writeStructToLazyStructWriter(u,h.struct,h.offset),h={struct:i,offset:0},t.next())}}else h={struct:t.curr,offset:0},t.next();for(let i=t.curr;null!==i&&i.id.client===n&&i.id.clock===h.struct.id.clock+h.struct.length&&i.constructor!==Skip;i=t.next())writeStructToLazyStructWriter(u,h.struct,h.offset),h={struct:i,offset:0}}null!==h&&(writeStructToLazyStructWriter(u,h.struct,h.offset),h=null),finishLazyStructWriting(u);const d=r.map((t=>readDeleteSet(t))),p=mergeDeleteSets(d);return writeDeleteSet(c,p),c.toUint8Array()},diffUpdateV2=(t,n,i=UpdateDecoderV2,r=UpdateEncoderV2)=>{const o=decodeStateVector(n),h=new r,c=new LazyStructWriter(h),u=new i(createDecoder(t)),d=new LazyStructReader(u,!1);for(;d.curr;){const t=d.curr,n=t.id.client,i=o.get(n)||0;if(d.curr.constructor!==Skip)if(t.id.clock+t.length>i)for(writeStructToLazyStructWriter(c,t,max$1(i-t.id.clock,0)),d.next();d.curr&&d.curr.id.client===n;)writeStructToLazyStructWriter(c,d.curr,0),d.next();else for(;d.curr&&d.curr.id.client===n&&d.curr.id.clock+d.curr.length<=i;)d.next();else d.next()}finishLazyStructWriting(c);const p=readDeleteSet(u);return writeDeleteSet(h,p),h.toUint8Array()},flushLazyStructWriter=t=>{t.written>0&&(t.clientStructs.push({written:t.written,restEncoder:toUint8Array(t.encoder.restEncoder)}),t.encoder.restEncoder=createEncoder(),t.written=0)},writeStructToLazyStructWriter=(t,n,i)=>{t.written>0&&t.currClient!==n.id.client&&flushLazyStructWriter(t),0===t.written&&(t.currClient=n.id.client,t.encoder.writeClient(n.id.client),writeVarUint(t.encoder.restEncoder,n.id.clock+i)),n.write(t.encoder,i),t.written++},finishLazyStructWriting=t=>{flushLazyStructWriter(t);const n=t.encoder.restEncoder;writeVarUint(n,t.clientStructs.length);for(let i=0;i<t.clientStructs.length;i++){const r=t.clientStructs[i];writeVarUint(n,r.written),writeUint8Array(n,r.restEncoder)}},convertUpdateFormatV2ToV1=t=>((t,n,i,r)=>{const o=new i(createDecoder(t)),h=new LazyStructReader(o,!1),c=new r,u=new LazyStructWriter(c);for(let p=h.curr;null!==p;p=h.next())writeStructToLazyStructWriter(u,n(p),0);finishLazyStructWriting(u);const d=readDeleteSet(o);return writeDeleteSet(c,d),c.toUint8Array()})(t,id,UpdateDecoderV2,UpdateEncoderV1),dt="You must not compute changes after the event-handler fired.";class YEvent{constructor(t,n){this.target=t,this.currentTarget=t,this.transaction=n,this._changes=null,this._keys=null,this._delta=null,this._path=null}get path(){return this._path||(this._path=getPathTo(this.currentTarget,this.target))}deletes(t){return isDeleted(this.transaction.deleteSet,t.id)}get keys(){if(null===this._keys){if(0===this.transaction.doc._transactionCleanups.length)throw create$3(dt);const t=new Map,n=this.target;this.transaction.changed.get(n).forEach((i=>{if(null!==i){const r=n._map.get(i);let o,h;if(this.adds(r)){let t=r.left;for(;null!==t&&this.adds(t);)t=t.left;if(this.deletes(r)){if(null===t||!this.deletes(t))return;o="delete",h=last(t.content.getContent())}else null!==t&&this.deletes(t)?(o="update",h=last(t.content.getContent())):(o="add",h=void 0)}else{if(!this.deletes(r))return;o="delete",h=last(r.content.getContent())}t.set(i,{action:o,oldValue:h})}})),this._keys=t}return this._keys}get delta(){return this.changes.delta}adds(t){return t.id.clock>=(this.transaction.beforeState.get(t.id.client)||0)}get changes(){let t=this._changes;if(null===t){if(0===this.transaction.doc._transactionCleanups.length)throw create$3(dt);const n=this.target,i=create$4(),r=create$4(),o=[];t={added:i,deleted:r,delta:o,keys:this.keys};if(this.transaction.changed.get(n).has(null)){let t=null;const packOp=()=>{t&&o.push(t)};for(let o=n._start;null!==o;o=o.right)o.deleted?this.deletes(o)&&!this.adds(o)&&(null!==t&&void 0!==t.delete||(packOp(),t={delete:0}),t.delete+=o.length,r.add(o)):this.adds(o)?(null!==t&&void 0!==t.insert||(packOp(),t={insert:[]}),t.insert=t.insert.concat(o.content.getContent()),i.add(o)):(null!==t&&void 0!==t.retain||(packOp(),t={retain:0}),t.retain+=o.length);null!==t&&void 0===t.retain&&packOp()}this._changes=t}return t}}const getPathTo=(t,n)=>{const i=[];for(;null!==n._item&&n!==t;){if(null!==n._item.parentSub)i.unshift(n._item.parentSub);else{let t=0,r=n._item.parent._start;for(;r!==n._item&&null!==r;)!r.deleted&&r.countable&&(t+=r.length),r=r.right;i.unshift(t)}n=n._item.parent}return i};let pt=0;class ArraySearchMarker{constructor(t,n){t.marker=!0,this.p=t,this.index=n,this.timestamp=pt++}}const overwriteMarker=(t,n,i)=>{t.p.marker=!1,t.p=n,n.marker=!0,t.index=i,t.timestamp=pt++},findMarker=(t,n)=>{if(null===t._start||0===n||null===t._searchMarker)return null;const i=0===t._searchMarker.length?null:t._searchMarker.reduce(((t,i)=>c(n-t.index)<c(n-i.index)?t:i));let r=t._start,o=0;for(null!==i&&(r=i.p,o=i.index,(t=>{t.timestamp=pt++})(i));null!==r.right&&o<n;){if(!r.deleted&&r.countable){if(n<o+r.length)break;o+=r.length}r=r.right}for(;null!==r.left&&o>n;)r=r.left,!r.deleted&&r.countable&&(o-=r.length);for(;null!==r.left&&r.left.id.client===r.id.client&&r.left.id.clock+r.left.length===r.id.clock;)r=r.left,!r.deleted&&r.countable&&(o-=r.length);return null!==i&&c(i.index-o)<r.parent.length/80?(overwriteMarker(i,r,o),i):((t,n,i)=>{if(t.length>=80){const r=t.reduce(((t,n)=>t.timestamp<n.timestamp?t:n));return overwriteMarker(r,n,i),r}{const r=new ArraySearchMarker(n,i);return t.push(r),r}})(t._searchMarker,r,o)},updateMarkerChanges=(t,n,i)=>{for(let r=t.length-1;r>=0;r--){const o=t[r];if(i>0){let n=o.p;for(n.marker=!1;n&&(n.deleted||!n.countable);)n=n.left,n&&!n.deleted&&n.countable&&(o.index-=n.length);if(null===n||!0===n.marker){t.splice(r,1);continue}o.p=n,n.marker=!0}(n<o.index||i>0&&n===o.index)&&(o.index=max$1(n,o.index+i))}},callTypeObservers=(t,n,i)=>{const r=t,o=n.changedParentTypes;for(;setIfUndefined(o,t,(()=>[])).push(i),null!==t._item;)t=t._item.parent;callEventHandlerListeners(r._eH,i,n)};class AbstractType{constructor(){this._item=null,this._map=new Map,this._start=null,this.doc=null,this._length=0,this._eH=createEventHandler(),this._dEH=createEventHandler(),this._searchMarker=null}get parent(){return this._item?this._item.parent:null}_integrate(t,n){this.doc=t,this._item=n}_copy(){throw methodUnimplemented()}clone(){throw methodUnimplemented()}_write(t){}get _first(){let t=this._start;for(;null!==t&&t.deleted;)t=t.right;return t}_callObserver(t,n){!t.local&&this._searchMarker&&(this._searchMarker.length=0)}observe(t){addEventHandlerListener(this._eH,t)}observeDeep(t){addEventHandlerListener(this._dEH,t)}unobserve(t){removeEventHandlerListener(this._eH,t)}unobserveDeep(t){removeEventHandlerListener(this._dEH,t)}toJSON(){}}const typeListSlice=(t,n,i)=>{n<0&&(n=t._length+n),i<0&&(i=t._length+i);let r=i-n;const o=[];let h=t._start;for(;null!==h&&r>0;){if(h.countable&&!h.deleted){const t=h.content.getContent();if(t.length<=n)n-=t.length;else{for(let i=n;i<t.length&&r>0;i++)o.push(t[i]),r--;n=0}}h=h.right}return o},typeListToArray=t=>{const n=[];let i=t._start;for(;null!==i;){if(i.countable&&!i.deleted){const t=i.content.getContent();for(let i=0;i<t.length;i++)n.push(t[i])}i=i.right}return n},typeListForEach=(t,n)=>{let i=0,r=t._start;for(;null!==r;){if(r.countable&&!r.deleted){const o=r.content.getContent();for(let r=0;r<o.length;r++)n(o[r],i++,t)}r=r.right}},typeListMap=(t,n)=>{const i=[];return typeListForEach(t,((r,o)=>{i.push(n(r,o,t))})),i},typeListCreateIterator=t=>{let n=t._start,i=null,r=0;return{[Symbol.iterator](){return this},next:()=>{if(null===i){for(;null!==n&&n.deleted;)n=n.right;if(null===n)return{done:!0,value:void 0};i=n.content.getContent(),r=0,n=n.right}const t=i[r++];return i.length<=r&&(i=null),{done:!1,value:t}}}},typeListGet=(t,n)=>{const i=findMarker(t,n);let r=t._start;for(null!==i&&(r=i.p,n-=i.index);null!==r;r=r.right)if(!r.deleted&&r.countable){if(n<r.length)return r.content.getContent()[n];n-=r.length}},typeListInsertGenericsAfter=(t,n,i,r)=>{let o=i;const h=t.doc,c=h.clientID,u=h.store,d=null===i?n._start:i.right;let p=[];const packJsonContent=()=>{p.length>0&&(o=new Item(createID(c,getState(u,c)),o,o&&o.lastId,d,d&&d.id,n,null,new ContentAny(p)),o.integrate(t,0),p=[])};r.forEach((i=>{if(null===i)p.push(i);else switch(i.constructor){case Number:case Object:case Boolean:case Array:case String:p.push(i);break;default:switch(packJsonContent(),i.constructor){case Uint8Array:case ArrayBuffer:o=new Item(createID(c,getState(u,c)),o,o&&o.lastId,d,d&&d.id,n,null,new ContentBinary(new Uint8Array(i))),o.integrate(t,0);break;case Doc:o=new Item(createID(c,getState(u,c)),o,o&&o.lastId,d,d&&d.id,n,null,new ContentDoc(i)),o.integrate(t,0);break;default:if(!(i instanceof AbstractType))throw new Error("Unexpected content type in insert operation");o=new Item(createID(c,getState(u,c)),o,o&&o.lastId,d,d&&d.id,n,null,new ContentType(i)),o.integrate(t,0)}}})),packJsonContent()},lengthExceeded=()=>create$3("Length exceeded!"),typeListInsertGenerics=(t,n,i,r)=>{if(i>n._length)throw lengthExceeded();if(0===i)return n._searchMarker&&updateMarkerChanges(n._searchMarker,i,r.length),typeListInsertGenericsAfter(t,n,null,r);const o=i,h=findMarker(n,i);let c=n._start;for(null!==h&&(c=h.p,0===(i-=h.index)&&(c=c.prev,i+=c&&c.countable&&!c.deleted?c.length:0));null!==c;c=c.right)if(!c.deleted&&c.countable){if(i<=c.length){i<c.length&&getItemCleanStart(t,createID(c.id.client,c.id.clock+i));break}i-=c.length}return n._searchMarker&&updateMarkerChanges(n._searchMarker,o,r.length),typeListInsertGenericsAfter(t,n,c,r)},typeListDelete=(t,n,i,r)=>{if(0===r)return;const o=i,h=r,c=findMarker(n,i);let u=n._start;for(null!==c&&(u=c.p,i-=c.index);null!==u&&i>0;u=u.right)!u.deleted&&u.countable&&(i<u.length&&getItemCleanStart(t,createID(u.id.client,u.id.clock+i)),i-=u.length);for(;r>0&&null!==u;)u.deleted||(r<u.length&&getItemCleanStart(t,createID(u.id.client,u.id.clock+r)),u.delete(t),r-=u.length),u=u.right;if(r>0)throw lengthExceeded();n._searchMarker&&updateMarkerChanges(n._searchMarker,o,-h+r)},typeMapDelete=(t,n,i)=>{const r=n._map.get(i);void 0!==r&&r.delete(t)},typeMapSet=(t,n,i,r)=>{const o=n._map.get(i)||null,h=t.doc,c=h.clientID;let u;if(null==r)u=new ContentAny([r]);else switch(r.constructor){case Number:case Object:case Boolean:case Array:case String:u=new ContentAny([r]);break;case Uint8Array:u=new ContentBinary(r);break;case Doc:u=new ContentDoc(r);break;default:if(!(r instanceof AbstractType))throw new Error("Unexpected content type");u=new ContentType(r)}new Item(createID(c,getState(h.store,c)),o,o&&o.lastId,null,null,n,i,u).integrate(t,0)},typeMapGet=(t,n)=>{const i=t._map.get(n);return void 0===i||i.deleted?void 0:i.content.getContent()[i.length-1]},typeMapGetAll=t=>{const n={};return t._map.forEach(((t,i)=>{t.deleted||(n[i]=t.content.getContent()[t.length-1])})),n},typeMapHas=(t,n)=>{const i=t._map.get(n);return void 0!==i&&!i.deleted},createMapIterator=t=>{return n=t.entries(),i=t=>!t[1].deleted,createIterator((()=>{let t;do{t=n.next()}while(!t.done&&!i(t.value));return t}));var n,i};class YArrayEvent extends YEvent{}class YArray extends AbstractType{constructor(){super(),this._prelimContent=[],this._searchMarker=[]}static from(t){const n=new YArray;return n.push(t),n}_integrate(t,n){super._integrate(t,n),this.insert(0,this._prelimContent),this._prelimContent=null}_copy(){return new YArray}clone(){const t=new YArray;return t.insert(0,this.toArray().map((t=>t instanceof AbstractType?t.clone():t))),t}get length(){return null===this._prelimContent?this._length:this._prelimContent.length}_callObserver(t,n){super._callObserver(t,n),callTypeObservers(this,t,new YArrayEvent(this,t))}insert(t,n){null!==this.doc?transact(this.doc,(i=>{typeListInsertGenerics(i,this,t,n)})):this._prelimContent.splice(t,0,...n)}push(t){null!==this.doc?transact(this.doc,(n=>{((t,n,i)=>{let r=(n._searchMarker||[]).reduce(((t,n)=>n.index>t.index?n:t),{index:0,p:n._start}).p;if(r)for(;r.right;)r=r.right;typeListInsertGenericsAfter(t,n,r,i)})(n,this,t)})):this._prelimContent.push(...t)}unshift(t){this.insert(0,t)}delete(t,n=1){null!==this.doc?transact(this.doc,(i=>{typeListDelete(i,this,t,n)})):this._prelimContent.splice(t,n)}get(t){return typeListGet(this,t)}toArray(){return typeListToArray(this)}slice(t=0,n=this.length){return typeListSlice(this,t,n)}toJSON(){return this.map((t=>t instanceof AbstractType?t.toJSON():t))}map(t){return typeListMap(this,t)}forEach(t){typeListForEach(this,t)}[Symbol.iterator](){return typeListCreateIterator(this)}_write(t){t.writeTypeRef(gt)}}class YMapEvent extends YEvent{constructor(t,n,i){super(t,n),this.keysChanged=i}}class YMap extends AbstractType{constructor(t){super(),this._prelimContent=null,this._prelimContent=void 0===t?new Map:new Map(t)}_integrate(t,n){super._integrate(t,n),this._prelimContent.forEach(((t,n)=>{this.set(n,t)})),this._prelimContent=null}_copy(){return new YMap}clone(){const t=new YMap;return this.forEach(((n,i)=>{t.set(i,n instanceof AbstractType?n.clone():n)})),t}_callObserver(t,n){callTypeObservers(this,t,new YMapEvent(this,t,n))}toJSON(){const t={};return this._map.forEach(((n,i)=>{if(!n.deleted){const r=n.content.getContent()[n.length-1];t[i]=r instanceof AbstractType?r.toJSON():r}})),t}get size(){return[...createMapIterator(this._map)].length}keys(){return iteratorMap(createMapIterator(this._map),(t=>t[0]))}values(){return iteratorMap(createMapIterator(this._map),(t=>t[1].content.getContent()[t[1].length-1]))}entries(){return iteratorMap(createMapIterator(this._map),(t=>[t[0],t[1].content.getContent()[t[1].length-1]]))}forEach(t){this._map.forEach(((n,i)=>{n.deleted||t(n.content.getContent()[n.length-1],i,this)}))}[Symbol.iterator](){return this.entries()}delete(t){null!==this.doc?transact(this.doc,(n=>{typeMapDelete(n,this,t)})):this._prelimContent.delete(t)}set(t,n){return null!==this.doc?transact(this.doc,(i=>{typeMapSet(i,this,t,n)})):this._prelimContent.set(t,n),n}get(t){return typeMapGet(this,t)}has(t){return typeMapHas(this,t)}clear(){null!==this.doc?transact(this.doc,(t=>{this.forEach((function(n,i,r){typeMapDelete(t,r,i)}))})):this._prelimContent.clear()}_write(t){t.writeTypeRef(mt)}}const equalAttrs=(t,n)=>t===n||"object"==typeof t&&"object"==typeof n&&t&&n&&equalFlat(t,n);class ItemTextListPosition{constructor(t,n,i,r){this.left=t,this.right=n,this.index=i,this.currentAttributes=r}forward(){if(null===this.right&&unexpectedCase(),this.right.content.constructor===ContentFormat)this.right.deleted||updateCurrentAttributes(this.currentAttributes,this.right.content);else this.right.deleted||(this.index+=this.right.length);this.left=this.right,this.right=this.right.right}}const findNextPosition=(t,n,i)=>{for(;null!==n.right&&i>0;){if(n.right.content.constructor===ContentFormat)n.right.deleted||updateCurrentAttributes(n.currentAttributes,n.right.content);else n.right.deleted||(i<n.right.length&&getItemCleanStart(t,createID(n.right.id.client,n.right.id.clock+i)),n.index+=n.right.length,i-=n.right.length);n.left=n.right,n.right=n.right.right}return n},findPosition=(t,n,i,r)=>{const o=new Map,h=r?findMarker(n,i):null;if(h){const n=new ItemTextListPosition(h.p.left,h.p,h.index,o);return findNextPosition(t,n,i-h.index)}{const r=new ItemTextListPosition(null,n._start,0,o);return findNextPosition(t,r,i)}},insertNegatedAttributes=(t,n,i,r)=>{for(;null!==i.right&&(!0===i.right.deleted||i.right.content.constructor===ContentFormat&&equalAttrs(r.get(i.right.content.key),i.right.content.value));)i.right.deleted||r.delete(i.right.content.key),i.forward();const o=t.doc,h=o.clientID;r.forEach(((r,c)=>{const u=i.left,d=i.right,p=new Item(createID(h,getState(o.store,h)),u,u&&u.lastId,d,d&&d.id,n,null,new ContentFormat(c,r));p.integrate(t,0),i.right=p,i.forward()}))},updateCurrentAttributes=(t,n)=>{const{key:i,value:r}=n;null===r?t.delete(i):t.set(i,r)},minimizeAttributeChanges=(t,n)=>{for(var i;null!==t.right&&(t.right.deleted||t.right.content.constructor===ContentFormat&&equalAttrs(null!=(i=n[t.right.content.key])?i:null,t.right.content.value));)t.forward()},insertAttributes=(t,n,i,r)=>{var o;const h=t.doc,c=h.clientID,u=new Map;for(const d in r){const p=r[d],g=null!=(o=i.currentAttributes.get(d))?o:null;if(!equalAttrs(g,p)){u.set(d,g);const{left:r,right:o}=i;i.right=new Item(createID(c,getState(h.store,c)),r,r&&r.lastId,o,o&&o.id,n,null,new ContentFormat(d,p)),i.right.integrate(t,0),i.forward()}}return u},insertText=(t,n,i,r,o)=>{i.currentAttributes.forEach(((t,n)=>{void 0===o[n]&&(o[n]=null)}));const h=t.doc,c=h.clientID;minimizeAttributeChanges(i,o);const u=insertAttributes(t,n,i,o),d=r.constructor===String?new ContentString(r):r instanceof AbstractType?new ContentType(r):new ContentEmbed(r);let{left:p,right:g,index:m}=i;n._searchMarker&&updateMarkerChanges(n._searchMarker,i.index,d.getLength()),g=new Item(createID(c,getState(h.store,c)),p,p&&p.lastId,g,g&&g.id,n,null,d),g.integrate(t,0),i.right=g,i.index=m,i.forward(),insertNegatedAttributes(t,n,i,u)},formatText=(t,n,i,r,o)=>{const h=t.doc,c=h.clientID;minimizeAttributeChanges(i,o);const u=insertAttributes(t,n,i,o);t:for(;null!==i.right&&(r>0||u.size>0&&(i.right.deleted||i.right.content.constructor===ContentFormat));){if(!i.right.deleted)switch(i.right.content.constructor){case ContentFormat:{const{key:n,value:h}=i.right.content,c=o[n];if(void 0!==c){if(equalAttrs(c,h))u.delete(n);else{if(0===r)break t;u.set(n,h)}i.right.delete(t)}else i.currentAttributes.set(n,h);break}default:r<i.right.length&&getItemCleanStart(t,createID(i.right.id.client,i.right.id.clock+r)),r-=i.right.length}i.forward()}if(r>0){let o="";for(;r>0;r--)o+="\n";i.right=new Item(createID(c,getState(h.store,c)),i.left,i.left&&i.left.lastId,i.right,i.right&&i.right.id,n,null,new ContentString(o)),i.right.integrate(t,0),i.forward()}insertNegatedAttributes(t,n,i,u)},cleanupFormattingGap=(t,n,i,r,o)=>{var h,c;let u=n;const d=create$5();for(;u&&(!u.countable||u.deleted);){if(!u.deleted&&u.content.constructor===ContentFormat){const t=u.content;d.set(t.key,t)}u=u.right}let p=0,g=!1;for(;n!==u;){if(i===n&&(g=!0),!n.deleted){const i=n.content;switch(i.constructor){case ContentFormat:{const{key:u,value:m}=i,v=null!=(h=r.get(u))?h:null;d.get(u)===i&&v!==m||(n.delete(t),p++,g||(null!=(c=o.get(u))?c:null)!==m||v===m||(null===v?o.delete(u):o.set(u,v))),g||n.deleted||updateCurrentAttributes(o,i);break}}}n=n.right}return p},cleanupYTextFormatting=t=>{let n=0;return transact(t.doc,(i=>{let r=t._start,o=t._start,h=create$5();const c=copy(h);for(;o;){if(!1===o.deleted)if(o.content.constructor===ContentFormat)updateCurrentAttributes(c,o.content);else n+=cleanupFormattingGap(i,r,o,h,c),h=copy(c),r=o;o=o.right}})),n},cleanupYTextAfterTransaction=t=>{const n=new Set,i=t.doc;for(const[r,o]of t.afterState.entries()){const h=t.beforeState.get(r)||0;o!==h&&iterateStructs(t,i.store.clients.get(r),h,o,(t=>{t.deleted||t.content.constructor!==ContentFormat||t.constructor===GC||n.add(t.parent)}))}transact(i,(i=>{iterateDeletedStructs(t,t.deleteSet,(t=>{if(t instanceof GC||!t.parent._hasFormatting||n.has(t.parent))return;const r=t.parent;t.content.constructor===ContentFormat?n.add(r):((t,n)=>{for(;n&&n.right&&(n.right.deleted||!n.right.countable);)n=n.right;const i=new Set;for(;n&&(n.deleted||!n.countable);){if(!n.deleted&&n.content.constructor===ContentFormat){const r=n.content.key;i.has(r)?n.delete(t):i.add(r)}n=n.left}})(i,t)}));for(const t of n)cleanupYTextFormatting(t)}))},deleteText=(t,n,i)=>{const r=i,o=copy(n.currentAttributes),h=n.right;for(;i>0&&null!==n.right;){if(!1===n.right.deleted)switch(n.right.content.constructor){case ContentType:case ContentEmbed:case ContentString:i<n.right.length&&getItemCleanStart(t,createID(n.right.id.client,n.right.id.clock+i)),i-=n.right.length,n.right.delete(t)}n.forward()}h&&cleanupFormattingGap(t,h,n.right,o,n.currentAttributes);const c=(n.left||n.right).parent;return c._searchMarker&&updateMarkerChanges(c._searchMarker,n.index,-r+i),n};class YTextEvent extends YEvent{constructor(t,n,i){super(t,n),this.childListChanged=!1,this.keysChanged=new Set,i.forEach((t=>{null===t?this.childListChanged=!0:this.keysChanged.add(t)}))}get changes(){if(null===this._changes){const t={keys:this.keys,delta:this.delta,added:new Set,deleted:new Set};this._changes=t}return this._changes}get delta(){if(null===this._delta){const t=this.target.doc,n=[];transact(t,(t=>{var i,r,o;const h=new Map,c=new Map;let u=this.target._start,d=null;const p={};let g="",m=0,v=0;const addOp=()=>{if(null!==d){let t=null;switch(d){case"delete":v>0&&(t={delete:v}),v=0;break;case"insert":("object"==typeof g||g.length>0)&&(t={insert:g},h.size>0&&(t.attributes={},h.forEach(((n,i)=>{null!==n&&(t.attributes[i]=n)})))),g="";break;case"retain":m>0&&(t={retain:m},(t=>{for(const n in t)return!1;return!0})(p)||(t.attributes=F({},p))),m=0}t&&n.push(t),d=null}};for(;null!==u;){switch(u.content.constructor){case ContentType:case ContentEmbed:this.adds(u)?this.deletes(u)||(addOp(),d="insert",g=u.content.getContent()[0],addOp()):this.deletes(u)?("delete"!==d&&(addOp(),d="delete"),v+=1):u.deleted||("retain"!==d&&(addOp(),d="retain"),m+=1);break;case ContentString:this.adds(u)?this.deletes(u)||("insert"!==d&&(addOp(),d="insert"),g+=u.content.str):this.deletes(u)?("delete"!==d&&(addOp(),d="delete"),v+=u.length):u.deleted||("retain"!==d&&(addOp(),d="retain"),m+=u.length);break;case ContentFormat:{const{key:n,value:g}=u.content;if(this.adds(u)){if(!this.deletes(u)){const o=null!=(i=h.get(n))?i:null;equalAttrs(o,g)?null!==g&&u.delete(t):("retain"===d&&addOp(),equalAttrs(g,null!=(r=c.get(n))?r:null)?delete p[n]:p[n]=g)}}else if(this.deletes(u)){c.set(n,g);const t=null!=(o=h.get(n))?o:null;equalAttrs(t,g)||("retain"===d&&addOp(),p[n]=t)}else if(!u.deleted){c.set(n,g);const i=p[n];void 0!==i&&(equalAttrs(i,g)?null!==i&&u.delete(t):("retain"===d&&addOp(),null===g?delete p[n]:p[n]=g))}u.deleted||("insert"===d&&addOp(),updateCurrentAttributes(h,u.content));break}}u=u.right}for(addOp();n.length>0;){const t=n[n.length-1];if(void 0===t.retain||void 0!==t.attributes)break;n.pop()}})),this._delta=n}return this._delta}}class YText extends AbstractType{constructor(t){super(),this._pending=void 0!==t?[()=>this.insert(0,t)]:[],this._searchMarker=[],this._hasFormatting=!1}get length(){return this._length}_integrate(t,n){super._integrate(t,n);try{this._pending.forEach((t=>t()))}catch(dr){console.error(dr)}this._pending=null}_copy(){return new YText}clone(){const t=new YText;return t.applyDelta(this.toDelta()),t}_callObserver(t,n){super._callObserver(t,n);const i=new YTextEvent(this,t,n);callTypeObservers(this,t,i),!t.local&&this._hasFormatting&&(t._needFormattingCleanup=!0)}toString(){let t="",n=this._start;for(;null!==n;)!n.deleted&&n.countable&&n.content.constructor===ContentString&&(t+=n.content.str),n=n.right;return t}toJSON(){return this.toString()}applyDelta(t,{sanitize:n=!0}={}){null!==this.doc?transact(this.doc,(i=>{const r=new ItemTextListPosition(null,this._start,0,new Map);for(let o=0;o<t.length;o++){const h=t[o];if(void 0!==h.insert){const c=n||"string"!=typeof h.insert||o!==t.length-1||null!==r.right||"\n"!==h.insert.slice(-1)?h.insert:h.insert.slice(0,-1);("string"!=typeof c||c.length>0)&&insertText(i,this,r,c,h.attributes||{})}else void 0!==h.retain?formatText(i,this,r,h.retain,h.attributes||{}):void 0!==h.delete&&deleteText(i,r,h.delete)}})):this._pending.push((()=>this.applyDelta(t)))}toDelta(t,n,i){const r=[],o=new Map,h=this.doc;let c="",u=this._start;function packStr(){if(c.length>0){const t={};let n=!1;o.forEach(((i,r)=>{n=!0,t[r]=i}));const i={insert:c};n&&(i.attributes=t),r.push(i),c=""}}const computeDelta=()=>{for(;null!==u;){if(isVisible(u,t)||void 0!==n&&isVisible(u,n))switch(u.content.constructor){case ContentString:{const r=o.get("ychange");void 0===t||isVisible(u,t)?void 0===n||isVisible(u,n)?void 0!==r&&(packStr(),o.delete("ychange")):void 0!==r&&r.user===u.id.client&&"added"===r.type||(packStr(),o.set("ychange",i?i("added",u.id):{type:"added"})):void 0!==r&&r.user===u.id.client&&"removed"===r.type||(packStr(),o.set("ychange",i?i("removed",u.id):{type:"removed"})),c+=u.content.str;break}case ContentType:case ContentEmbed:{packStr();const t={insert:u.content.getContent()[0]};if(o.size>0){const n={};t.attributes=n,o.forEach(((t,i)=>{n[i]=t}))}r.push(t);break}case ContentFormat:isVisible(u,t)&&(packStr(),updateCurrentAttributes(o,u.content))}u=u.right}packStr()};return t||n?transact(h,(i=>{t&&splitSnapshotAffectedStructs(i,t),n&&splitSnapshotAffectedStructs(i,n),computeDelta()}),"cleanup"):computeDelta(),r}insert(t,n,i){if(n.length<=0)return;const r=this.doc;null!==r?transact(r,(r=>{const o=findPosition(r,this,t,!i);i||(i={},o.currentAttributes.forEach(((t,n)=>{i[n]=t}))),insertText(r,this,o,n,i)})):this._pending.push((()=>this.insert(t,n,i)))}insertEmbed(t,n,i){const r=this.doc;null!==r?transact(r,(r=>{const o=findPosition(r,this,t,!i);insertText(r,this,o,n,i||{})})):this._pending.push((()=>this.insertEmbed(t,n,i||{})))}delete(t,n){if(0===n)return;const i=this.doc;null!==i?transact(i,(i=>{deleteText(i,findPosition(i,this,t,!0),n)})):this._pending.push((()=>this.delete(t,n)))}format(t,n,i){if(0===n)return;const r=this.doc;null!==r?transact(r,(r=>{const o=findPosition(r,this,t,!1);null!==o.right&&formatText(r,this,o,n,i)})):this._pending.push((()=>this.format(t,n,i)))}removeAttribute(t){null!==this.doc?transact(this.doc,(n=>{typeMapDelete(n,this,t)})):this._pending.push((()=>this.removeAttribute(t)))}setAttribute(t,n){null!==this.doc?transact(this.doc,(i=>{typeMapSet(i,this,t,n)})):this._pending.push((()=>this.setAttribute(t,n)))}getAttribute(t){return typeMapGet(this,t)}getAttributes(){return typeMapGetAll(this)}_write(t){t.writeTypeRef(vt)}}class YXmlTreeWalker{constructor(t,n=()=>!0){this._filter=n,this._root=t,this._currentNode=t._start,this._firstCall=!0}[Symbol.iterator](){return this}next(){let t=this._currentNode,n=t&&t.content&&t.content.type;if(null!==t&&(!this._firstCall||t.deleted||!this._filter(n)))do{if(n=t.content.type,t.deleted||n.constructor!==YXmlElement&&n.constructor!==YXmlFragment||null===n._start)for(;null!==t;){if(null!==t.right){t=t.right;break}t=t.parent===this._root?null:t.parent._item}else t=n._start}while(null!==t&&(t.deleted||!this._filter(t.content.type)));return this._firstCall=!1,null===t?{value:void 0,done:!0}:(this._currentNode=t,{value:t.content.type,done:!1})}}class YXmlFragment extends AbstractType{constructor(){super(),this._prelimContent=[]}get firstChild(){const t=this._first;return t?t.content.getContent()[0]:null}_integrate(t,n){super._integrate(t,n),this.insert(0,this._prelimContent),this._prelimContent=null}_copy(){return new YXmlFragment}clone(){const t=new YXmlFragment;return t.insert(0,this.toArray().map((t=>t instanceof AbstractType?t.clone():t))),t}get length(){return null===this._prelimContent?this._length:this._prelimContent.length}createTreeWalker(t){return new YXmlTreeWalker(this,t)}querySelector(t){t=t.toUpperCase();const n=new YXmlTreeWalker(this,(n=>n.nodeName&&n.nodeName.toUpperCase()===t)).next();return n.done?null:n.value}querySelectorAll(t){return t=t.toUpperCase(),r(new YXmlTreeWalker(this,(n=>n.nodeName&&n.nodeName.toUpperCase()===t)))}_callObserver(t,n){callTypeObservers(this,t,new YXmlEvent(this,n,t))}toString(){return typeListMap(this,(t=>t.toString())).join("")}toJSON(){return this.toString()}toDOM(t=document,n={},i){const r=t.createDocumentFragment();return void 0!==i&&i._createAssociation(r,this),typeListForEach(this,(o=>{r.insertBefore(o.toDOM(t,n,i),null)})),r}insert(t,n){null!==this.doc?transact(this.doc,(i=>{typeListInsertGenerics(i,this,t,n)})):this._prelimContent.splice(t,0,...n)}insertAfter(t,n){if(null!==this.doc)transact(this.doc,(i=>{const r=t&&t instanceof AbstractType?t._item:t;typeListInsertGenericsAfter(i,this,r,n)}));else{const i=this._prelimContent,r=null===t?0:i.findIndex((n=>n===t))+1;if(0===r&&null!==t)throw create$3("Reference item not found");i.splice(r,0,...n)}}delete(t,n=1){null!==this.doc?transact(this.doc,(i=>{typeListDelete(i,this,t,n)})):this._prelimContent.splice(t,n)}toArray(){return typeListToArray(this)}push(t){this.insert(this.length,t)}unshift(t){this.insert(0,t)}get(t){return typeListGet(this,t)}slice(t=0,n=this.length){return typeListSlice(this,t,n)}forEach(t){typeListForEach(this,t)}_write(t){t.writeTypeRef(yt)}}class YXmlElement extends YXmlFragment{constructor(t="UNDEFINED"){super(),this.nodeName=t,this._prelimAttrs=new Map}get nextSibling(){const t=this._item?this._item.next:null;return t?t.content.type:null}get prevSibling(){const t=this._item?this._item.prev:null;return t?t.content.type:null}_integrate(t,n){super._integrate(t,n),this._prelimAttrs.forEach(((t,n)=>{this.setAttribute(n,t)})),this._prelimAttrs=null}_copy(){return new YXmlElement(this.nodeName)}clone(){const t=new YXmlElement(this.nodeName);return((t,n)=>{for(const i in t)n(t[i],i)})(this.getAttributes(),((n,i)=>{"string"==typeof n&&t.setAttribute(i,n)})),t.insert(0,this.toArray().map((t=>t instanceof AbstractType?t.clone():t))),t}toString(){const t=this.getAttributes(),n=[],i=[];for(const h in t)i.push(h);i.sort();const r=i.length;for(let h=0;h<r;h++){const r=i[h];n.push(r+'="'+t[r]+'"')}const o=this.nodeName.toLocaleLowerCase();return`<${o}${n.length>0?" "+n.join(" "):""}>${super.toString()}</${o}>`}removeAttribute(t){null!==this.doc?transact(this.doc,(n=>{typeMapDelete(n,this,t)})):this._prelimAttrs.delete(t)}setAttribute(t,n){null!==this.doc?transact(this.doc,(i=>{typeMapSet(i,this,t,n)})):this._prelimAttrs.set(t,n)}getAttribute(t){return typeMapGet(this,t)}hasAttribute(t){return typeMapHas(this,t)}getAttributes(t){return t?((t,n)=>{const i={};return t._map.forEach(((t,r)=>{let o=t;for(;null!==o&&(!n.sv.has(o.id.client)||o.id.clock>=(n.sv.get(o.id.client)||0));)o=o.left;null!==o&&isVisible(o,n)&&(i[r]=o.content.getContent()[o.length-1])})),i})(this,t):typeMapGetAll(this)}toDOM(t=document,n={},i){const r=t.createElement(this.nodeName),o=this.getAttributes();for(const h in o){const t=o[h];"string"==typeof t&&r.setAttribute(h,t)}return typeListForEach(this,(o=>{r.appendChild(o.toDOM(t,n,i))})),void 0!==i&&i._createAssociation(r,this),r}_write(t){t.writeTypeRef(_t),t.writeKey(this.nodeName)}}class YXmlEvent extends YEvent{constructor(t,n,i){super(t,i),this.childListChanged=!1,this.attributesChanged=new Set,n.forEach((t=>{null===t?this.childListChanged=!0:this.attributesChanged.add(t)}))}}class YXmlHook extends YMap{constructor(t){super(),this.hookName=t}_copy(){return new YXmlHook(this.hookName)}clone(){const t=new YXmlHook(this.hookName);return this.forEach(((n,i)=>{t.set(i,n)})),t}toDOM(t=document,n={},i){const r=n[this.hookName];let o;return o=void 0!==r?r.createDom(this):document.createElement(this.hookName),o.setAttribute("data-yjs-hook",this.hookName),void 0!==i&&i._createAssociation(o,this),o}_write(t){t.writeTypeRef(wt),t.writeKey(this.hookName)}}class YXmlText extends YText{get nextSibling(){const t=this._item?this._item.next:null;return t?t.content.type:null}get prevSibling(){const t=this._item?this._item.prev:null;return t?t.content.type:null}_copy(){return new YXmlText}clone(){const t=new YXmlText;return t.applyDelta(this.toDelta()),t}toDOM(t=document,n,i){const r=t.createTextNode(this.toString());return void 0!==i&&i._createAssociation(r,this),r}toString(){return this.toDelta().map((t=>{const n=[];for(const r in t.attributes){const i=[];for(const n in t.attributes[r])i.push({key:n,value:t.attributes[r][n]});i.sort(((t,n)=>t.key<n.key?-1:1)),n.push({nodeName:r,attrs:i})}n.sort(((t,n)=>t.nodeName<n.nodeName?-1:1));let i="";for(let r=0;r<n.length;r++){const t=n[r];i+=`<${t.nodeName}`;for(let n=0;n<t.attrs.length;n++){const r=t.attrs[n];i+=` ${r.key}="${r.value}"`}i+=">"}i+=t.insert;for(let r=n.length-1;r>=0;r--)i+=`</${n[r].nodeName}>`;return i})).join("")}toJSON(){return this.toString()}_write(t){t.writeTypeRef(bt)}}class AbstractStruct{constructor(t,n){this.id=t,this.length=n}get deleted(){throw methodUnimplemented()}mergeWith(t){return!1}write(t,n,i){throw methodUnimplemented()}integrate(t,n){throw methodUnimplemented()}}class GC extends AbstractStruct{get deleted(){return!0}delete(){}mergeWith(t){return this.constructor===t.constructor&&(this.length+=t.length,!0)}integrate(t,n){n>0&&(this.id.clock+=n,this.length-=n),addStruct(t.doc.store,this)}write(t,n){t.writeInfo(0),t.writeLen(this.length-n)}getMissing(t,n){return null}}class ContentBinary{constructor(t){this.content=t}getLength(){return 1}getContent(){return[this.content]}isCountable(){return!0}copy(){return new ContentBinary(this.content)}splice(t){throw methodUnimplemented()}mergeWith(t){return!1}integrate(t,n){}delete(t){}gc(t){}write(t,n){t.writeBuf(this.content)}getRef(){return 3}}class ContentDeleted{constructor(t){this.len=t}getLength(){return this.len}getContent(){return[]}isCountable(){return!1}copy(){return new ContentDeleted(this.len)}splice(t){const n=new ContentDeleted(this.len-t);return this.len=t,n}mergeWith(t){return this.len+=t.len,!0}integrate(t,n){addToDeleteSet(t.deleteSet,n.id.client,n.id.clock,this.len),n.markDeleted()}delete(t){}gc(t){}write(t,n){t.writeLen(this.len-n)}getRef(){return 1}}const createDocFromOpts=(t,n)=>new Doc({guid:t,...n,shouldLoad:n.shouldLoad||n.autoLoad||!1});class ContentDoc{constructor(t){t._item&&console.error("This document was already integrated as a sub-document. You should create a second instance instead with the same guid."),this.doc=t;const n={};this.opts=n,t.gc||(n.gc=!1),t.autoLoad&&(n.autoLoad=!0),null!==t.meta&&(n.meta=t.meta)}getLength(){return 1}getContent(){return[this.doc]}isCountable(){return!0}copy(){return new ContentDoc(createDocFromOpts(this.doc.guid,this.opts))}splice(t){throw methodUnimplemented()}mergeWith(t){return!1}integrate(t,n){this.doc._item=n,t.subdocsAdded.add(this.doc),this.doc.shouldLoad&&t.subdocsLoaded.add(this.doc)}delete(t){t.subdocsAdded.has(this.doc)?t.subdocsAdded.delete(this.doc):t.subdocsRemoved.add(this.doc)}gc(t){}write(t,n){t.writeString(this.doc.guid),t.writeAny(this.opts)}getRef(){return 9}}class ContentEmbed{constructor(t){this.embed=t}getLength(){return 1}getContent(){return[this.embed]}isCountable(){return!0}copy(){return new ContentEmbed(this.embed)}splice(t){throw methodUnimplemented()}mergeWith(t){return!1}integrate(t,n){}delete(t){}gc(t){}write(t,n){t.writeJSON(this.embed)}getRef(){return 5}}class ContentFormat{constructor(t,n){this.key=t,this.value=n}getLength(){return 1}getContent(){return[]}isCountable(){return!1}copy(){return new ContentFormat(this.key,this.value)}splice(t){throw methodUnimplemented()}mergeWith(t){return!1}integrate(t,n){const i=n.parent;i._searchMarker=null,i._hasFormatting=!0}delete(t){}gc(t){}write(t,n){t.writeKey(this.key),t.writeJSON(this.value)}getRef(){return 6}}class ContentJSON{constructor(t){this.arr=t}getLength(){return this.arr.length}getContent(){return this.arr}isCountable(){return!0}copy(){return new ContentJSON(this.arr)}splice(t){const n=new ContentJSON(this.arr.slice(t));return this.arr=this.arr.slice(0,t),n}mergeWith(t){return this.arr=this.arr.concat(t.arr),!0}integrate(t,n){}delete(t){}gc(t){}write(t,n){const i=this.arr.length;t.writeLen(i-n);for(let r=n;r<i;r++){const n=this.arr[r];t.writeString(void 0===n?"undefined":JSON.stringify(n))}}getRef(){return 2}}class ContentAny{constructor(t){this.arr=t}getLength(){return this.arr.length}getContent(){return this.arr}isCountable(){return!0}copy(){return new ContentAny(this.arr)}splice(t){const n=new ContentAny(this.arr.slice(t));return this.arr=this.arr.slice(0,t),n}mergeWith(t){return this.arr=this.arr.concat(t.arr),!0}integrate(t,n){}delete(t){}gc(t){}write(t,n){const i=this.arr.length;t.writeLen(i-n);for(let r=n;r<i;r++){const n=this.arr[r];t.writeAny(n)}}getRef(){return 8}}class ContentString{constructor(t){this.str=t}getLength(){return this.str.length}getContent(){return this.str.split("")}isCountable(){return!0}copy(){return new ContentString(this.str)}splice(t){const n=new ContentString(this.str.slice(t));this.str=this.str.slice(0,t);const i=this.str.charCodeAt(t-1);return i>=55296&&i<=56319&&(this.str=this.str.slice(0,t-1)+"�",n.str="�"+n.str.slice(1)),n}mergeWith(t){return this.str+=t.str,!0}integrate(t,n){}delete(t){}gc(t){}write(t,n){t.writeString(0===n?this.str:this.str.slice(n))}getRef(){return 4}}const ft=[t=>new YArray,t=>new YMap,t=>new YText,t=>new YXmlElement(t.readKey()),t=>new YXmlFragment,t=>new YXmlHook(t.readKey()),t=>new YXmlText],gt=0,mt=1,vt=2,_t=3,yt=4,wt=5,bt=6;class ContentType{constructor(t){this.type=t}getLength(){return 1}getContent(){return[this.type]}isCountable(){return!0}copy(){return new ContentType(this.type._copy())}splice(t){throw methodUnimplemented()}mergeWith(t){return!1}integrate(t,n){this.type._integrate(t.doc,n)}delete(t){let n=this.type._start;for(;null!==n;)n.deleted?n.id.clock<(t.beforeState.get(n.id.client)||0)&&t._mergeStructs.push(n):n.delete(t),n=n.right;this.type._map.forEach((n=>{n.deleted?n.id.clock<(t.beforeState.get(n.id.client)||0)&&t._mergeStructs.push(n):n.delete(t)})),t.changed.delete(this.type)}gc(t){let n=this.type._start;for(;null!==n;)n.gc(t,!0),n=n.right;this.type._start=null,this.type._map.forEach((n=>{for(;null!==n;)n.gc(t,!0),n=n.left})),this.type._map=new Map}write(t,n){this.type._write(t)}getRef(){return 7}}const followRedone=(t,n)=>{let i,r=n,o=0;do{o>0&&(r=createID(r.client,r.clock+o)),i=getItem(t,r),o=r.clock-i.id.clock,r=i.redone}while(null!==r&&i instanceof Item);return{item:i,diff:o}},keepItem=(t,n)=>{for(;null!==t&&t.keep!==n;)t.keep=n,t=t.parent._item},splitItem=(t,n,i)=>{const{client:r,clock:o}=n.id,h=new Item(createID(r,o+i),n,createID(r,o+i-1),n.right,n.rightOrigin,n.parent,n.parentSub,n.content.splice(i));return n.deleted&&h.markDeleted(),n.keep&&(h.keep=!0),null!==n.redone&&(h.redone=createID(n.redone.client,n.redone.clock+i)),n.right=h,null!==h.right&&(h.right.left=h),t._mergeStructs.push(h),null!==h.parentSub&&null===h.right&&h.parent._map.set(h.parentSub,h),n.length=i,h},isDeletedByUndoStack=(t,n)=>((t,n)=>{for(let i=0;i<t.length;i++)if(n(t[i],i,t))return!0;return!1})(t,(t=>isDeleted(t.deletions,n))),redoItem=(t,n,i,r,o,h)=>{const c=t.doc,u=c.store,d=c.clientID,p=n.redone;if(null!==p)return getItemCleanStart(t,p);let g,m=n.parent._item,v=null;if(null!==m&&!0===m.deleted){if(null===m.redone&&(!i.has(m)||null===redoItem(t,m,i,r,o,h)))return null;for(;null!==m.redone;)m=getItemCleanStart(t,m.redone)}const _=null===m?n.parent:m.content.type;if(null===n.parentSub){for(v=n.left,g=n;null!==v;){let n=v;for(;null!==n&&n.parent._item!==m;)n=null===n.redone?null:getItemCleanStart(t,n.redone);if(null!==n&&n.parent._item===m){v=n;break}v=v.left}for(;null!==g;){let n=g;for(;null!==n&&n.parent._item!==m;)n=null===n.redone?null:getItemCleanStart(t,n.redone);if(null!==n&&n.parent._item===m){g=n;break}g=g.right}}else if(g=null,n.right&&!o){for(v=n;null!==v&&null!==v.right&&(v.right.redone||isDeleted(r,v.right.id)||isDeletedByUndoStack(h.undoStack,v.right.id)||isDeletedByUndoStack(h.redoStack,v.right.id));)for(v=v.right;v.redone;)v=getItemCleanStart(t,v.redone);if(v&&null!==v.right)return null}else v=_._map.get(n.parentSub)||null;const y=getState(u,d),w=createID(d,y),x=new Item(w,v,v&&v.lastId,g,g&&g.id,_,n.parentSub,n.content.copy());return n.redone=w,keepItem(x,!0),x.integrate(t,0),x};class Item extends AbstractStruct{constructor(t,n,i,r,o,h,c,u){super(t,u.getLength()),this.origin=i,this.left=n,this.right=r,this.rightOrigin=o,this.parent=h,this.parentSub=c,this.redone=null,this.content=u,this.info=this.content.isCountable()?2:0}set marker(t){(8&this.info)>0!==t&&(this.info^=8)}get marker(){return(8&this.info)>0}get keep(){return(1&this.info)>0}set keep(t){this.keep!==t&&(this.info^=1)}get countable(){return(2&this.info)>0}get deleted(){return(4&this.info)>0}set deleted(t){this.deleted!==t&&(this.info^=4)}markDeleted(){this.info|=4}getMissing(t,n){if(this.origin&&this.origin.client!==this.id.client&&this.origin.clock>=getState(n,this.origin.client))return this.origin.client;if(this.rightOrigin&&this.rightOrigin.client!==this.id.client&&this.rightOrigin.clock>=getState(n,this.rightOrigin.client))return this.rightOrigin.client;if(this.parent&&this.parent.constructor===ID&&this.id.client!==this.parent.client&&this.parent.clock>=getState(n,this.parent.client))return this.parent.client;if(this.origin&&(this.left=getItemCleanEnd(t,n,this.origin),this.origin=this.left.lastId),this.rightOrigin&&(this.right=getItemCleanStart(t,this.rightOrigin),this.rightOrigin=this.right.id),this.left&&this.left.constructor===GC||this.right&&this.right.constructor===GC)this.parent=null;else if(this.parent){if(this.parent.constructor===ID){const t=getItem(n,this.parent);t.constructor===GC?this.parent=null:this.parent=t.content.type}}else this.left&&this.left.constructor===Item&&(this.parent=this.left.parent,this.parentSub=this.left.parentSub),this.right&&this.right.constructor===Item&&(this.parent=this.right.parent,this.parentSub=this.right.parentSub);return null}integrate(t,n){if(n>0&&(this.id.clock+=n,this.left=getItemCleanEnd(t,t.doc.store,createID(this.id.client,this.id.clock-1)),this.origin=this.left.lastId,this.content=this.content.splice(n),this.length-=n),this.parent){if(!this.left&&(!this.right||null!==this.right.left)||this.left&&this.left.right!==this.right){let n,i=this.left;if(null!==i)n=i.right;else if(null!==this.parentSub)for(n=this.parent._map.get(this.parentSub)||null;null!==n&&null!==n.left;)n=n.left;else n=this.parent._start;const r=new Set,o=new Set;for(;null!==n&&n!==this.right;){if(o.add(n),r.add(n),compareIDs(this.origin,n.origin)){if(n.id.client<this.id.client)i=n,r.clear();else if(compareIDs(this.rightOrigin,n.rightOrigin))break}else{if(null===n.origin||!o.has(getItem(t.doc.store,n.origin)))break;r.has(getItem(t.doc.store,n.origin))||(i=n,r.clear())}n=n.right}this.left=i}if(null!==this.left){const t=this.left.right;this.right=t,this.left.right=this}else{let t;if(null!==this.parentSub)for(t=this.parent._map.get(this.parentSub)||null;null!==t&&null!==t.left;)t=t.left;else t=this.parent._start,this.parent._start=this;this.right=t}null!==this.right?this.right.left=this:null!==this.parentSub&&(this.parent._map.set(this.parentSub,this),null!==this.left&&this.left.delete(t)),null===this.parentSub&&this.countable&&!this.deleted&&(this.parent._length+=this.length),addStruct(t.doc.store,this),this.content.integrate(t,this),addChangedTypeToTransaction(t,this.parent,this.parentSub),(null!==this.parent._item&&this.parent._item.deleted||null!==this.parentSub&&null!==this.right)&&this.delete(t)}else new GC(this.id,this.length).integrate(t,0)}get next(){let t=this.right;for(;null!==t&&t.deleted;)t=t.right;return t}get prev(){let t=this.left;for(;null!==t&&t.deleted;)t=t.left;return t}get lastId(){return 1===this.length?this.id:createID(this.id.client,this.id.clock+this.length-1)}mergeWith(t){if(this.constructor===t.constructor&&compareIDs(t.origin,this.lastId)&&this.right===t&&compareIDs(this.rightOrigin,t.rightOrigin)&&this.id.client===t.id.client&&this.id.clock+this.length===t.id.clock&&this.deleted===t.deleted&&null===this.redone&&null===t.redone&&this.content.constructor===t.content.constructor&&this.content.mergeWith(t.content)){const n=this.parent._searchMarker;return n&&n.forEach((n=>{n.p===t&&(n.p=this,!this.deleted&&this.countable&&(n.index-=this.length))})),t.keep&&(this.keep=!0),this.right=t.right,null!==this.right&&(this.right.left=this),this.length+=t.length,!0}return!1}delete(t){if(!this.deleted){const n=this.parent;this.countable&&null===this.parentSub&&(n._length-=this.length),this.markDeleted(),addToDeleteSet(t.deleteSet,this.id.client,this.id.clock,this.length),addChangedTypeToTransaction(t,n,this.parentSub),this.content.delete(t)}}gc(t,n){if(!this.deleted)throw unexpectedCase();this.content.gc(t),n?((t,n,i)=>{const r=t.clients.get(n.id.client);r[findIndexSS(r,n.id.clock)]=i})(t,this,new GC(this.id,this.length)):this.content=new ContentDeleted(this.length)}write(t,n){const i=n>0?createID(this.id.client,this.id.clock+n-1):this.origin,r=this.rightOrigin,o=this.parentSub,h=31&this.content.getRef()|(null===i?0:d)|(null===r?0:u)|(null===o?0:32);if(t.writeInfo(h),null!==i&&t.writeLeftID(i),null!==r&&t.writeRightID(r),null===i&&null===r){const n=this.parent;if(void 0!==n._item){const i=n._item;if(null===i){const i=(t=>{for(const[n,i]of t.doc.share.entries())if(i===t)return n;throw unexpectedCase()})(n);t.writeParentInfo(!0),t.writeString(i)}else t.writeParentInfo(!1),t.writeLeftID(i.id)}else n.constructor===String?(t.writeParentInfo(!0),t.writeString(n)):n.constructor===ID?(t.writeParentInfo(!1),t.writeLeftID(n)):unexpectedCase();null!==o&&t.writeString(o)}this.content.write(t,n)}}const readItemContent=(t,n)=>xt[31&n](t),xt=[()=>{unexpectedCase()},t=>new ContentDeleted(t.readLen()),t=>{const n=t.readLen(),i=[];for(let r=0;r<n;r++){const n=t.readString();"undefined"===n?i.push(void 0):i.push(JSON.parse(n))}return new ContentJSON(i)},t=>new ContentBinary(t.readBuf()),t=>new ContentString(t.readString()),t=>new ContentEmbed(t.readJSON()),t=>new ContentFormat(t.readKey(),t.readJSON()),t=>new ContentType(ft[t.readTypeRef()](t)),t=>{const n=t.readLen(),i=[];for(let r=0;r<n;r++)i.push(t.readAny());return new ContentAny(i)},t=>new ContentDoc(createDocFromOpts(t.readString(),t.readAny())),()=>{unexpectedCase()}];class Skip extends AbstractStruct{get deleted(){return!0}delete(){}mergeWith(t){return this.constructor===t.constructor&&(this.length+=t.length,!0)}integrate(t,n){unexpectedCase()}write(t,n){t.writeInfo(10),writeVarUint(t.restEncoder,this.length-n)}getMissing(t,n){return null}}const St="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:{},Ct="__ $YJS$ __";!0===St[Ct]&&console.error("Yjs was already imported. This breaks constructor checks and will lead to issues! - https://github.com/yjs/yjs/issues/438"),St[Ct]=!0;var kt="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};function getDefaultExportFromCjs(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}var Pt={exports:{}};!function(t){var n=Object.prototype.hasOwnProperty,i="~";function Events(){}function EE(t,n,i){this.fn=t,this.context=n,this.once=i||!1}function addListener(t,n,r,o,h){if("function"!=typeof r)throw new TypeError("The listener must be a function");var c=new EE(r,o||t,h),u=i?i+n:n;return t._events[u]?t._events[u].fn?t._events[u]=[t._events[u],c]:t._events[u].push(c):(t._events[u]=c,t._eventsCount++),t}function clearEvent(t,n){0==--t._eventsCount?t._events=new Events:delete t._events[n]}function EventEmitter(){this._events=new Events,this._eventsCount=0}Object.create&&(Events.prototype=Object.create(null),(new Events).__proto__||(i=!1)),EventEmitter.prototype.eventNames=function eventNames(){var t,r,o=[];if(0===this._eventsCount)return o;for(r in t=this._events)n.call(t,r)&&o.push(i?r.slice(1):r);return Object.getOwnPropertySymbols?o.concat(Object.getOwnPropertySymbols(t)):o},EventEmitter.prototype.listeners=function listeners(t){var n=i?i+t:t,r=this._events[n];if(!r)return[];if(r.fn)return[r.fn];for(var o=0,h=r.length,c=new Array(h);o<h;o++)c[o]=r[o].fn;return c},EventEmitter.prototype.listenerCount=function listenerCount(t){var n=i?i+t:t,r=this._events[n];return r?r.fn?1:r.length:0},EventEmitter.prototype.emit=function emit(t,n,r,o,h,c){var u=i?i+t:t;if(!this._events[u])return!1;var d,p,g=this._events[u],m=arguments.length;if(g.fn){switch(g.once&&this.removeListener(t,g.fn,void 0,!0),m){case 1:return g.fn.call(g.context),!0;case 2:return g.fn.call(g.context,n),!0;case 3:return g.fn.call(g.context,n,r),!0;case 4:return g.fn.call(g.context,n,r,o),!0;case 5:return g.fn.call(g.context,n,r,o,h),!0;case 6:return g.fn.call(g.context,n,r,o,h,c),!0}for(p=1,d=new Array(m-1);p<m;p++)d[p-1]=arguments[p];g.fn.apply(g.context,d)}else{var v,_=g.length;for(p=0;p<_;p++)switch(g[p].once&&this.removeListener(t,g[p].fn,void 0,!0),m){case 1:g[p].fn.call(g[p].context);break;case 2:g[p].fn.call(g[p].context,n);break;case 3:g[p].fn.call(g[p].context,n,r);break;case 4:g[p].fn.call(g[p].context,n,r,o);break;default:if(!d)for(v=1,d=new Array(m-1);v<m;v++)d[v-1]=arguments[v];g[p].fn.apply(g[p].context,d)}}return!0},EventEmitter.prototype.on=function on(t,n,i){return addListener(this,t,n,i,!1)},EventEmitter.prototype.once=function once(t,n,i){return addListener(this,t,n,i,!0)},EventEmitter.prototype.removeListener=function removeListener(t,n,r,o){var h=i?i+t:t;if(!this._events[h])return this;if(!n)return clearEvent(this,h),this;var c=this._events[h];if(c.fn)c.fn!==n||o&&!c.once||r&&c.context!==r||clearEvent(this,h);else{for(var u=0,d=[],p=c.length;u<p;u++)(c[u].fn!==n||o&&!c[u].once||r&&c[u].context!==r)&&d.push(c[u]);d.length?this._events[h]=1===d.length?d[0]:d:clearEvent(this,h)}return this},EventEmitter.prototype.removeAllListeners=function removeAllListeners(t){var n;return t?(n=i?i+t:t,this._events[n]&&clearEvent(this,n)):(this._events=new Events,this._eventsCount=0),this},EventEmitter.prototype.off=EventEmitter.prototype.removeListener,EventEmitter.prototype.addListener=EventEmitter.prototype.on,EventEmitter.prefixed=i,EventEmitter.EventEmitter=EventEmitter,t.exports=EventEmitter}(Pt);const It=getDefaultExportFromCjs(Pt.exports);for(var Mt,Et=[],At=0;At<256;++At)Et.push((At+256).toString(16).slice(1));var Tt=new Uint8Array(16);function rng$2(){if(!Mt&&!(Mt="undefined"!=typeof crypto&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto)))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return Mt(Tt)}const Ot={randomUUID:"undefined"!=typeof crypto&&crypto.randomUUID&&crypto.randomUUID.bind(crypto)};function v4$2(t,n,i){if(Ot.randomUUID&&!n&&!t)return Ot.randomUUID();var r=(t=t||{}).random||(t.rng||rng$2)();return r[6]=15&r[6]|64,r[8]=63&r[8]|128,function unsafeStringify$1(t,n=0){return(Et[t[n+0]]+Et[t[n+1]]+Et[t[n+2]]+Et[t[n+3]]+"-"+Et[t[n+4]]+Et[t[n+5]]+"-"+Et[t[n+6]]+Et[t[n+7]]+"-"+Et[t[n+8]]+Et[t[n+9]]+"-"+Et[t[n+10]]+Et[t[n+11]]+Et[t[n+12]]+Et[t[n+13]]+Et[t[n+14]]+Et[t[n+15]]).toLowerCase()}(r)}var Lt,Dt,Nt=Object.create,Rt=Object.defineProperty,jt=Object.getOwnPropertyDescriptor,Vt=Object.getOwnPropertyNames,Ut=Object.getPrototypeOf,zt=Object.prototype.hasOwnProperty,Bt=(t=>"undefined"!=typeof require?require:"undefined"!=typeof Proxy?new Proxy(t,{get:(t,n)=>("undefined"!=typeof require?require:t)[n]}):t)((function(t){if("undefined"!=typeof require)return require.apply(this,arguments);throw Error('Dynamic require of "'+t+'" is not supported')})),__toESM$1=(t,n,i)=>(i=null!=t?Nt(Ut(t)):{},((t,n,i,r)=>{if(n&&"object"==typeof n||"function"==typeof n)for(let o of Vt(n))zt.call(t,o)||o===i||Rt(t,o,{get:()=>n[o],enumerable:!(r=jt(n,o))||r.enumerable});return t})(Rt(i,"default",{value:t,enumerable:!0}),t)),Ft=(Lt={"../../node_modules/.pnpm/localforage@1.10.0/node_modules/localforage/dist/localforage.js"(t,n){!function(i){"object"==typeof t&&void 0!==n?n.exports=i():"function"==typeof define&&define.amd?define([],i):("undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this).localforage=i()}((function(){return function e(t,n,i){function s(o,h){if(!n[o]){if(!t[o]){var c="function"==typeof Bt&&Bt;if(!h&&c)return c(o,!0);if(r)return r(o,!0);var u=new Error("Cannot find module '"+o+"'");throw u.code="MODULE_NOT_FOUND",u}var d=n[o]={exports:{}};t[o][0].call(d.exports,(function(n){var i=t[o][1][n];return s(i||n)}),d,d.exports,e,t,n,i)}return n[o].exports}for(var r="function"==typeof Bt&&Bt,o=0;o<i.length;o++)s(i[o]);return s}({1:[function(t,n,i){(function(t){var i,r,o=t.MutationObserver||t.WebKitMutationObserver;if(o){var h=0,c=new o(nextTick),u=t.document.createTextNode("");c.observe(u,{characterData:!0}),i=function(){u.data=h=++h%2}}else if(t.setImmediate||void 0===t.MessageChannel)i="document"in t&&"onreadystatechange"in t.document.createElement("script")?function(){var n=t.document.createElement("script");n.onreadystatechange=function(){nextTick(),n.onreadystatechange=null,n.parentNode.removeChild(n),n=null},t.document.documentElement.appendChild(n)}:function(){setTimeout(nextTick,0)};else{var d=new t.MessageChannel;d.port1.onmessage=nextTick,i=function(){d.port2.postMessage(0)}}var p=[];function nextTick(){var t,n;r=!0;for(var i=p.length;i;){for(n=p,p=[],t=-1;++t<i;)n[t]();i=p.length}r=!1}n.exports=function immediate(t){1!==p.push(t)||r||i()}}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],2:[function(t,n,i){var r=t(1);function INTERNAL(){}var o={},h=["REJECTED"],c=["FULFILLED"],u=["PENDING"];function Promise2(t){if("function"!=typeof t)throw new TypeError("resolver must be a function");this.state=u,this.queue=[],this.outcome=void 0,t!==INTERNAL&&safelyResolveThenable(this,t)}function QueueItem(t,n,i){this.promise=t,"function"==typeof n&&(this.onFulfilled=n,this.callFulfilled=this.otherCallFulfilled),"function"==typeof i&&(this.onRejected=i,this.callRejected=this.otherCallRejected)}function unwrap(t,n,i){r((function(){var r;try{r=n(i)}catch(dr){return o.reject(t,dr)}r===t?o.reject(t,new TypeError("Cannot resolve promise with itself")):o.resolve(t,r)}))}function getThen(t){var n=t&&t.then;if(t&&("object"==typeof t||"function"==typeof t)&&"function"==typeof n)return function appyThen(){n.apply(t,arguments)}}function safelyResolveThenable(t,n){var i=!1;function onError(n){i||(i=!0,o.reject(t,n))}function onSuccess(n){i||(i=!0,o.resolve(t,n))}var r=tryCatch((function tryToUnwrap(){n(onSuccess,onError)}));"error"===r.status&&onError(r.value)}function tryCatch(t,n){var i={};try{i.value=t(n),i.status="success"}catch(dr){i.status="error",i.value=dr}return i}n.exports=Promise2,Promise2.prototype.catch=function(t){return this.then(null,t)},Promise2.prototype.then=function(t,n){if("function"!=typeof t&&this.state===c||"function"!=typeof n&&this.state===h)return this;var i=new this.constructor(INTERNAL);return this.state!==u?unwrap(i,this.state===c?t:n,this.outcome):this.queue.push(new QueueItem(i,t,n)),i},QueueItem.prototype.callFulfilled=function(t){o.resolve(this.promise,t)},QueueItem.prototype.otherCallFulfilled=function(t){unwrap(this.promise,this.onFulfilled,t)},QueueItem.prototype.callRejected=function(t){o.reject(this.promise,t)},QueueItem.prototype.otherCallRejected=function(t){unwrap(this.promise,this.onRejected,t)},o.resolve=function(t,n){var i=tryCatch(getThen,n);if("error"===i.status)return o.reject(t,i.value);var r=i.value;if(r)safelyResolveThenable(t,r);else{t.state=c,t.outcome=n;for(var h=-1,u=t.queue.length;++h<u;)t.queue[h].callFulfilled(n)}return t},o.reject=function(t,n){t.state=h,t.outcome=n;for(var i=-1,r=t.queue.length;++i<r;)t.queue[i].callRejected(n);return t},Promise2.resolve=function resolve(t){return t instanceof this?t:o.resolve(new this(INTERNAL),t)},Promise2.reject=function reject(t){var n=new this(INTERNAL);return o.reject(n,t)},Promise2.all=function all(t){var n=this;if("[object Array]"!==Object.prototype.toString.call(t))return this.reject(new TypeError("must be an array"));var i=t.length,r=!1;if(!i)return this.resolve([]);for(var h=new Array(i),c=0,u=-1,d=new this(INTERNAL);++u<i;)allResolver(t[u],u);return d;function allResolver(t,u){n.resolve(t).then((function resolveFromAll(t){h[u]=t,++c!==i||r||(r=!0,o.resolve(d,h))}),(function(t){r||(r=!0,o.reject(d,t))}))}},Promise2.race=function race(t){var n=this;if("[object Array]"!==Object.prototype.toString.call(t))return this.reject(new TypeError("must be an array"));var i=t.length,r=!1;if(!i)return this.resolve([]);for(var h=-1,c=new this(INTERNAL);++h<i;)resolver(t[h]);return c;function resolver(t){n.resolve(t).then((function(t){r||(r=!0,o.resolve(c,t))}),(function(t){r||(r=!0,o.reject(c,t))}))}}},{1:1}],3:[function(t,n,i){(function(n){"function"!=typeof n.Promise&&(n.Promise=t(2))}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{2:2}],4:[function(t,n,i){var r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},o=function getIDB(){try{if("undefined"!=typeof indexedDB)return indexedDB;if("undefined"!=typeof webkitIndexedDB)return webkitIndexedDB;if("undefined"!=typeof mozIndexedDB)return mozIndexedDB;if("undefined"!=typeof OIndexedDB)return OIndexedDB;if("undefined"!=typeof msIndexedDB)return msIndexedDB}catch(dr){return}}();function createBlob(t,n){t=t||[],n=n||{};try{return new Blob(t,n)}catch(dr){if("TypeError"!==dr.name)throw dr;for(var i=new("undefined"!=typeof BlobBuilder?BlobBuilder:"undefined"!=typeof MSBlobBuilder?MSBlobBuilder:"undefined"!=typeof MozBlobBuilder?MozBlobBuilder:WebKitBlobBuilder),r=0;r<t.length;r+=1)i.append(t[r]);return i.getBlob(n.type)}}"undefined"==typeof Promise&&t(3);var h=Promise;function executeCallback(t,n){n&&t.then((function(t){n(null,t)}),(function(t){n(t)}))}function executeTwoCallbacks(t,n,i){"function"==typeof n&&t.then(n),"function"==typeof i&&t.catch(i)}function normalizeKey(t){return"string"!=typeof t&&(console.warn(t+" used as a key, but it is not a string."),t=String(t)),t}function getCallback(){if(arguments.length&&"function"==typeof arguments[arguments.length-1])return arguments[arguments.length-1]}var c="local-forage-detect-blob-support",u=void 0,d={},p=Object.prototype.toString,g="readonly",m="readwrite";function _checkBlobSupport(t){return"boolean"==typeof u?h.resolve(u):function _checkBlobSupportWithoutCaching(t){return new h((function(n){var i=t.transaction(c,m),r=createBlob([""]);i.objectStore(c).put(r,"key"),i.onabort=function(t){t.preventDefault(),t.stopPropagation(),n(!1)},i.oncomplete=function(){var t=navigator.userAgent.match(/Chrome\/(\d+)/),i=navigator.userAgent.match(/Edge\//);n(i||!t||parseInt(t[1],10)>=43)}})).catch((function(){return!1}))}(t).then((function(t){return u=t}))}function _deferReadiness(t){var n=d[t.name],i={};i.promise=new h((function(t,n){i.resolve=t,i.reject=n})),n.deferredOperations.push(i),n.dbReady?n.dbReady=n.dbReady.then((function(){return i.promise})):n.dbReady=i.promise}function _advanceReadiness(t){var n=d[t.name].deferredOperations.pop();if(n)return n.resolve(),n.promise}function _rejectReadiness(t,n){var i=d[t.name].deferredOperations.pop();if(i)return i.reject(n),i.promise}function _getConnection(t,n){return new h((function(i,r){if(d[t.name]=d[t.name]||{forages:[],db:null,dbReady:null,deferredOperations:[]},t.db){if(!n)return i(t.db);_deferReadiness(t),t.db.close()}var h=[t.name];n&&h.push(t.version);var u=o.open.apply(o,h);n&&(u.onupgradeneeded=function(n){var i=u.result;try{i.createObjectStore(t.storeName),n.oldVersion<=1&&i.createObjectStore(c)}catch(r){if("ConstraintError"!==r.name)throw r;console.warn('The database "'+t.name+'" has been upgraded from version '+n.oldVersion+" to version "+n.newVersion+', but the storage "'+t.storeName+'" already exists.')}}),u.onerror=function(t){t.preventDefault(),r(u.error)},u.onsuccess=function(){var n=u.result;n.onversionchange=function(t){t.target.close()},i(n),_advanceReadiness(t)}}))}function _getOriginalConnection(t){return _getConnection(t,!1)}function _getUpgradedConnection(t){return _getConnection(t,!0)}function _isUpgradeNeeded(t,n){if(!t.db)return!0;var i=!t.db.objectStoreNames.contains(t.storeName),r=t.version<t.db.version,o=t.version>t.db.version;if(r&&(t.version!==n&&console.warn('The database "'+t.name+"\" can't be downgraded from version "+t.db.version+" to version "+t.version+"."),t.version=t.db.version),o||i){if(i){var h=t.db.version+1;h>t.version&&(t.version=h)}return!0}return!1}function _decodeBlob(t){var n=function _binStringToArrayBuffer(t){for(var n=t.length,i=new ArrayBuffer(n),r=new Uint8Array(i),o=0;o<n;o++)r[o]=t.charCodeAt(o);return i}(atob(t.data));return createBlob([n],{type:t.type})}function _isEncodedBlob(t){return t&&t.__local_forage_encoded_blob}function _fullyReady(t){var n=this,i=n._initReady().then((function(){var t=d[n._dbInfo.name];if(t&&t.dbReady)return t.dbReady}));return executeTwoCallbacks(i,t,t),i}function createTransaction(t,n,i,r){void 0===r&&(r=1);try{var o=t.db.transaction(t.storeName,n);i(null,o)}catch(c){if(r>0&&(!t.db||"InvalidStateError"===c.name||"NotFoundError"===c.name))return h.resolve().then((function(){if(!t.db||"NotFoundError"===c.name&&!t.db.objectStoreNames.contains(t.storeName)&&t.version<=t.db.version)return t.db&&(t.version=t.db.version+1),_getUpgradedConnection(t)})).then((function(){return function _tryReconnect(t){_deferReadiness(t);for(var n=d[t.name],i=n.forages,r=0;r<i.length;r++){var o=i[r];o._dbInfo.db&&(o._dbInfo.db.close(),o._dbInfo.db=null)}return t.db=null,_getOriginalConnection(t).then((function(n){return t.db=n,_isUpgradeNeeded(t)?_getUpgradedConnection(t):n})).then((function(r){t.db=n.db=r;for(var o=0;o<i.length;o++)i[o]._dbInfo.db=r})).catch((function(n){throw _rejectReadiness(t,n),n}))}(t).then((function(){createTransaction(t,n,i,r-1)}))})).catch(i);i(c)}}var v={_driver:"asyncStorage",_initStorage:function _initStorage(t){var n=this,i={db:null};if(t)for(var r in t)i[r]=t[r];var o=d[i.name];o||(o={forages:[],db:null,dbReady:null,deferredOperations:[]},d[i.name]=o),o.forages.push(n),n._initReady||(n._initReady=n.ready,n.ready=_fullyReady);var c=[];function ignoreErrors(){return h.resolve()}for(var u=0;u<o.forages.length;u++){var p=o.forages[u];p!==n&&c.push(p._initReady().catch(ignoreErrors))}var g=o.forages.slice(0);return h.all(c).then((function(){return i.db=o.db,_getOriginalConnection(i)})).then((function(t){return i.db=t,_isUpgradeNeeded(i,n._defaultConfig.version)?_getUpgradedConnection(i):t})).then((function(t){i.db=o.db=t,n._dbInfo=i;for(var r=0;r<g.length;r++){var h=g[r];h!==n&&(h._dbInfo.db=i.db,h._dbInfo.version=i.version)}}))},_support:function isIndexedDBValid(){try{if(!o||!o.open)return!1;var t="undefined"!=typeof openDatabase&&/(Safari|iPhone|iPad|iPod)/.test(navigator.userAgent)&&!/Chrome/.test(navigator.userAgent)&&!/BlackBerry/.test(navigator.platform),n="function"==typeof fetch&&-1!==fetch.toString().indexOf("[native code");return(!t||n)&&"undefined"!=typeof indexedDB&&"undefined"!=typeof IDBKeyRange}catch(dr){return!1}}(),iterate:function iterate(t,n){var i=this,r=new h((function(n,r){i.ready().then((function(){createTransaction(i._dbInfo,g,(function(o,h){if(o)return r(o);try{var c=h.objectStore(i._dbInfo.storeName).openCursor(),u=1;c.onsuccess=function(){var i=c.result;if(i){var r=i.value;_isEncodedBlob(r)&&(r=_decodeBlob(r));var o=t(r,i.key,u++);void 0!==o?n(o):i.continue()}else n()},c.onerror=function(){r(c.error)}}catch(dr){r(dr)}}))})).catch(r)}));return executeCallback(r,n),r},getItem:function getItem2(t,n){var i=this;t=normalizeKey(t);var r=new h((function(n,r){i.ready().then((function(){createTransaction(i._dbInfo,g,(function(o,h){if(o)return r(o);try{var c=h.objectStore(i._dbInfo.storeName).get(t);c.onsuccess=function(){var t=c.result;void 0===t&&(t=null),_isEncodedBlob(t)&&(t=_decodeBlob(t)),n(t)},c.onerror=function(){r(c.error)}}catch(dr){r(dr)}}))})).catch(r)}));return executeCallback(r,n),r},setItem:function setItem(t,n,i){var r=this;t=normalizeKey(t);var o=new h((function(i,o){var c;r.ready().then((function(){return c=r._dbInfo,"[object Blob]"===p.call(n)?_checkBlobSupport(c.db).then((function(t){return t?n:function _encodeBlob(t){return new h((function(n,i){var r=new FileReader;r.onerror=i,r.onloadend=function(i){var r=btoa(i.target.result||"");n({__local_forage_encoded_blob:!0,data:r,type:t.type})},r.readAsBinaryString(t)}))}(n)})):n})).then((function(n){createTransaction(r._dbInfo,m,(function(h,c){if(h)return o(h);try{var u=c.objectStore(r._dbInfo.storeName);null===n&&(n=void 0);var d=u.put(n,t);c.oncomplete=function(){void 0===n&&(n=null),i(n)},c.onabort=c.onerror=function(){var t=d.error?d.error:d.transaction.error;o(t)}}catch(dr){o(dr)}}))})).catch(o)}));return executeCallback(o,i),o},removeItem:function removeItem(t,n){var i=this;t=normalizeKey(t);var r=new h((function(n,r){i.ready().then((function(){createTransaction(i._dbInfo,m,(function(o,h){if(o)return r(o);try{var c=h.objectStore(i._dbInfo.storeName).delete(t);h.oncomplete=function(){n()},h.onerror=function(){r(c.error)},h.onabort=function(){var t=c.error?c.error:c.transaction.error;r(t)}}catch(dr){r(dr)}}))})).catch(r)}));return executeCallback(r,n),r},clear:function clear(t){var n=this,i=new h((function(t,i){n.ready().then((function(){createTransaction(n._dbInfo,m,(function(r,o){if(r)return i(r);try{var h=o.objectStore(n._dbInfo.storeName).clear();o.oncomplete=function(){t()},o.onabort=o.onerror=function(){var t=h.error?h.error:h.transaction.error;i(t)}}catch(dr){i(dr)}}))})).catch(i)}));return executeCallback(i,t),i},length:function length2(t){var n=this,i=new h((function(t,i){n.ready().then((function(){createTransaction(n._dbInfo,g,(function(r,o){if(r)return i(r);try{var h=o.objectStore(n._dbInfo.storeName).count();h.onsuccess=function(){t(h.result)},h.onerror=function(){i(h.error)}}catch(dr){i(dr)}}))})).catch(i)}));return executeCallback(i,t),i},key:function key(t,n){var i=this,r=new h((function(n,r){t<0?n(null):i.ready().then((function(){createTransaction(i._dbInfo,g,(function(o,h){if(o)return r(o);try{var c=h.objectStore(i._dbInfo.storeName),u=!1,d=c.openKeyCursor();d.onsuccess=function(){var i=d.result;i?0===t||u?n(i.key):(u=!0,i.advance(t)):n(null)},d.onerror=function(){r(d.error)}}catch(dr){r(dr)}}))})).catch(r)}));return executeCallback(r,n),r},keys:function keys2(t){var n=this,i=new h((function(t,i){n.ready().then((function(){createTransaction(n._dbInfo,g,(function(r,o){if(r)return i(r);try{var h=o.objectStore(n._dbInfo.storeName).openKeyCursor(),c=[];h.onsuccess=function(){var n=h.result;n?(c.push(n.key),n.continue()):t(c)},h.onerror=function(){i(h.error)}}catch(dr){i(dr)}}))})).catch(i)}));return executeCallback(i,t),i},dropInstance:function dropInstance(t,n){n=getCallback.apply(this,arguments);var i,r=this.config();if((t="function"!=typeof t&&t||{}).name||(t.name=t.name||r.name,t.storeName=t.storeName||r.storeName),t.name){var c=t.name===r.name&&this._dbInfo.db?h.resolve(this._dbInfo.db):_getOriginalConnection(t).then((function(n){var i=d[t.name],r=i.forages;i.db=n;for(var o=0;o<r.length;o++)r[o]._dbInfo.db=n;return n}));i=t.storeName?c.then((function(n){if(n.objectStoreNames.contains(t.storeName)){var i=n.version+1;_deferReadiness(t);var r=d[t.name],c=r.forages;n.close();for(var u=0;u<c.length;u++){var p=c[u];p._dbInfo.db=null,p._dbInfo.version=i}return new h((function(n,r){var h=o.open(t.name,i);h.onerror=function(t){h.result.close(),r(t)},h.onupgradeneeded=function(){h.result.deleteObjectStore(t.storeName)},h.onsuccess=function(){var t=h.result;t.close(),n(t)}})).then((function(t){r.db=t;for(var n=0;n<c.length;n++){var i=c[n];i._dbInfo.db=t,_advanceReadiness(i._dbInfo)}})).catch((function(n){throw(_rejectReadiness(t,n)||h.resolve()).catch((function(){})),n}))}})):c.then((function(n){_deferReadiness(t);var i=d[t.name],r=i.forages;n.close();for(var c=0;c<r.length;c++)r[c]._dbInfo.db=null;return new h((function(n,i){var r=o.deleteDatabase(t.name);r.onerror=function(){var t=r.result;t&&t.close(),i(r.error)},r.onblocked=function(){console.warn('dropInstance blocked for database "'+t.name+'" until all open connections are closed')},r.onsuccess=function(){var t=r.result;t&&t.close(),n(t)}})).then((function(t){i.db=t;for(var n=0;n<r.length;n++)_advanceReadiness(r[n]._dbInfo)})).catch((function(n){throw(_rejectReadiness(t,n)||h.resolve()).catch((function(){})),n}))}))}else i=h.reject("Invalid arguments");return executeCallback(i,n),i}},_="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",y=/^~~local_forage_type~([^~]+)~/,w="__lfsc__:",x="arbf",S="blob",C="si08",k="ui08",P="uic8",I="si16",M="si32",E="ur16",T="ui32",O="fl32",D="fl64",N=Object.prototype.toString;function stringToBuffer(t){var n,i,r,o,h,c=.75*t.length,u=t.length,d=0;"="===t[t.length-1]&&(c--,"="===t[t.length-2]&&c--);var p=new ArrayBuffer(c),g=new Uint8Array(p);for(n=0;n<u;n+=4)i=_.indexOf(t[n]),r=_.indexOf(t[n+1]),o=_.indexOf(t[n+2]),h=_.indexOf(t[n+3]),g[d++]=i<<2|r>>4,g[d++]=(15&r)<<4|o>>2,g[d++]=(3&o)<<6|63&h;return p}function bufferToString(t){var n,i=new Uint8Array(t),r="";for(n=0;n<i.length;n+=3)r+=_[i[n]>>2],r+=_[(3&i[n])<<4|i[n+1]>>4],r+=_[(15&i[n+1])<<2|i[n+2]>>6],r+=_[63&i[n+2]];return i.length%3==2?r=r.substring(0,r.length-1)+"=":i.length%3==1&&(r=r.substring(0,r.length-2)+"=="),r}var j={serialize:function serialize(t,n){var i="";if(t&&(i=N.call(t)),t&&("[object ArrayBuffer]"===i||t.buffer&&"[object ArrayBuffer]"===N.call(t.buffer))){var r,o=w;t instanceof ArrayBuffer?(r=t,o+=x):(r=t.buffer,"[object Int8Array]"===i?o+=C:"[object Uint8Array]"===i?o+=k:"[object Uint8ClampedArray]"===i?o+=P:"[object Int16Array]"===i?o+=I:"[object Uint16Array]"===i?o+=E:"[object Int32Array]"===i?o+=M:"[object Uint32Array]"===i?o+=T:"[object Float32Array]"===i?o+=O:"[object Float64Array]"===i?o+=D:n(new Error("Failed to get type for BinaryArray"))),n(o+bufferToString(r))}else if("[object Blob]"===i){var h=new FileReader;h.onload=function(){var i="~~local_forage_type~"+t.type+"~"+bufferToString(this.result);n(w+S+i)},h.readAsArrayBuffer(t)}else try{n(JSON.stringify(t))}catch(dr){console.error("Couldn't convert value into a JSON string: ",t),n(null,dr)}},deserialize:function deserialize(t){if(t.substring(0,9)!==w)return JSON.parse(t);var n,i=t.substring(13),r=t.substring(9,13);if(r===S&&y.test(i)){var o=i.match(y);n=o[1],i=i.substring(o[0].length)}var h=stringToBuffer(i);switch(r){case x:return h;case S:return createBlob([h],{type:n});case C:return new Int8Array(h);case k:return new Uint8Array(h);case P:return new Uint8ClampedArray(h);case I:return new Int16Array(h);case E:return new Uint16Array(h);case M:return new Int32Array(h);case T:return new Uint32Array(h);case O:return new Float32Array(h);case D:return new Float64Array(h);default:throw new Error("Unkown type: "+r)}},stringToBuffer:stringToBuffer,bufferToString:bufferToString};function createDbTable(t,n,i,r){t.executeSql("CREATE TABLE IF NOT EXISTS "+n.storeName+" (id INTEGER PRIMARY KEY, key unique, value)",[],i,r)}function tryExecuteSql(t,n,i,r,o,h){t.executeSql(i,r,o,(function(t,c){c.code===c.SYNTAX_ERR?t.executeSql("SELECT name FROM sqlite_master WHERE type='table' AND name = ?",[n.storeName],(function(t,u){u.rows.length?h(t,c):createDbTable(t,n,(function(){t.executeSql(i,r,o,h)}),h)}),h):h(t,c)}),h)}function _setItem(t,n,i,r){var o=this;t=normalizeKey(t);var c=new h((function(h,c){o.ready().then((function(){void 0===n&&(n=null);var u=n,d=o._dbInfo;d.serializer.serialize(n,(function(n,p){p?c(p):d.db.transaction((function(i){tryExecuteSql(i,d,"INSERT OR REPLACE INTO "+d.storeName+" (key, value) VALUES (?, ?)",[t,n],(function(){h(u)}),(function(t,n){c(n)}))}),(function(n){if(n.code===n.QUOTA_ERR){if(r>0)return void h(_setItem.apply(o,[t,u,i,r-1]));c(n)}}))}))})).catch(c)}));return executeCallback(c,i),c}var V={_driver:"webSQLStorage",_initStorage:function _initStorage$1(t){var n=this,i={db:null};if(t)for(var r in t)i[r]="string"!=typeof t[r]?t[r].toString():t[r];var o=new h((function(t,r){try{i.db=openDatabase(i.name,String(i.version),i.description,i.size)}catch(dr){return r(dr)}i.db.transaction((function(o){createDbTable(o,i,(function(){n._dbInfo=i,t()}),(function(t,n){r(n)}))}),r)}));return i.serializer=j,o},_support:function isWebSQLValid(){return"function"==typeof openDatabase}(),iterate:function iterate$1(t,n){var i=this,r=new h((function(n,r){i.ready().then((function(){var o=i._dbInfo;o.db.transaction((function(i){tryExecuteSql(i,o,"SELECT * FROM "+o.storeName,[],(function(i,r){for(var h=r.rows,c=h.length,u=0;u<c;u++){var d=h.item(u),p=d.value;if(p&&(p=o.serializer.deserialize(p)),void 0!==(p=t(p,d.key,u+1)))return void n(p)}n()}),(function(t,n){r(n)}))}))})).catch(r)}));return executeCallback(r,n),r},getItem:function getItem$1(t,n){var i=this;t=normalizeKey(t);var r=new h((function(n,r){i.ready().then((function(){var o=i._dbInfo;o.db.transaction((function(i){tryExecuteSql(i,o,"SELECT * FROM "+o.storeName+" WHERE key = ? LIMIT 1",[t],(function(t,i){var r=i.rows.length?i.rows.item(0).value:null;r&&(r=o.serializer.deserialize(r)),n(r)}),(function(t,n){r(n)}))}))})).catch(r)}));return executeCallback(r,n),r},setItem:function setItem$1(t,n,i){return _setItem.apply(this,[t,n,i,1])},removeItem:function removeItem$1(t,n){var i=this;t=normalizeKey(t);var r=new h((function(n,r){i.ready().then((function(){var o=i._dbInfo;o.db.transaction((function(i){tryExecuteSql(i,o,"DELETE FROM "+o.storeName+" WHERE key = ?",[t],(function(){n()}),(function(t,n){r(n)}))}))})).catch(r)}));return executeCallback(r,n),r},clear:function clear$1(t){var n=this,i=new h((function(t,i){n.ready().then((function(){var r=n._dbInfo;r.db.transaction((function(n){tryExecuteSql(n,r,"DELETE FROM "+r.storeName,[],(function(){t()}),(function(t,n){i(n)}))}))})).catch(i)}));return executeCallback(i,t),i},length:function length$1(t){var n=this,i=new h((function(t,i){n.ready().then((function(){var r=n._dbInfo;r.db.transaction((function(n){tryExecuteSql(n,r,"SELECT COUNT(key) as c FROM "+r.storeName,[],(function(n,i){var r=i.rows.item(0).c;t(r)}),(function(t,n){i(n)}))}))})).catch(i)}));return executeCallback(i,t),i},key:function key$1(t,n){var i=this,r=new h((function(n,r){i.ready().then((function(){var o=i._dbInfo;o.db.transaction((function(i){tryExecuteSql(i,o,"SELECT key FROM "+o.storeName+" WHERE id = ? LIMIT 1",[t+1],(function(t,i){var r=i.rows.length?i.rows.item(0).key:null;n(r)}),(function(t,n){r(n)}))}))})).catch(r)}));return executeCallback(r,n),r},keys:function keys$1(t){var n=this,i=new h((function(t,i){n.ready().then((function(){var r=n._dbInfo;r.db.transaction((function(n){tryExecuteSql(n,r,"SELECT key FROM "+r.storeName,[],(function(n,i){for(var r=[],o=0;o<i.rows.length;o++)r.push(i.rows.item(o).key);t(r)}),(function(t,n){i(n)}))}))})).catch(i)}));return executeCallback(i,t),i},dropInstance:function dropInstance$1(t,n){n=getCallback.apply(this,arguments);var i=this.config();(t="function"!=typeof t&&t||{}).name||(t.name=t.name||i.name,t.storeName=t.storeName||i.storeName);var r,o=this;return r=t.name?new h((function(n){var r;r=t.name===i.name?o._dbInfo.db:openDatabase(t.name,"","",0),t.storeName?n({db:r,storeNames:[t.storeName]}):n(function getAllStoreNames(t){return new h((function(n,i){t.transaction((function(r){r.executeSql("SELECT name FROM sqlite_master WHERE type='table' AND name <> '__WebKitDatabaseInfoTable__'",[],(function(i,r){for(var o=[],h=0;h<r.rows.length;h++)o.push(r.rows.item(h).name);n({db:t,storeNames:o})}),(function(t,n){i(n)}))}),(function(t){i(t)}))}))}(r))})).then((function(t){return new h((function(n,i){t.db.transaction((function(r){function dropTable(t){return new h((function(n,i){r.executeSql("DROP TABLE IF EXISTS "+t,[],(function(){n()}),(function(t,n){i(n)}))}))}for(var o=[],c=0,u=t.storeNames.length;c<u;c++)o.push(dropTable(t.storeNames[c]));h.all(o).then((function(){n()})).catch((function(t){i(t)}))}),(function(t){i(t)}))}))})):h.reject("Invalid arguments"),executeCallback(r,n),r}};function _getKeyPrefix(t,n){var i=t.name+"/";return t.storeName!==n.storeName&&(i+=t.storeName+"/"),i}function _isLocalStorageUsable(){return!function checkIfLocalStorageThrows(){var t="_localforage_support_test";try{return localStorage.setItem(t,!0),localStorage.removeItem(t),!1}catch(dr){return!0}}()||localStorage.length>0}var U={_driver:"localStorageWrapper",_initStorage:function _initStorage$2(t){var n={};if(t)for(var i in t)n[i]=t[i];return n.keyPrefix=_getKeyPrefix(t,this._defaultConfig),_isLocalStorageUsable()?(this._dbInfo=n,n.serializer=j,h.resolve()):h.reject()},_support:function isLocalStorageValid(){try{return"undefined"!=typeof localStorage&&"setItem"in localStorage&&!!localStorage.setItem}catch(dr){return!1}}(),iterate:function iterate$2(t,n){var i=this,r=i.ready().then((function(){for(var n=i._dbInfo,r=n.keyPrefix,o=r.length,h=localStorage.length,c=1,u=0;u<h;u++){var d=localStorage.key(u);if(0===d.indexOf(r)){var p=localStorage.getItem(d);if(p&&(p=n.serializer.deserialize(p)),void 0!==(p=t(p,d.substring(o),c++)))return p}}}));return executeCallback(r,n),r},getItem:function getItem$2(t,n){var i=this;t=normalizeKey(t);var r=i.ready().then((function(){var n=i._dbInfo,r=localStorage.getItem(n.keyPrefix+t);return r&&(r=n.serializer.deserialize(r)),r}));return executeCallback(r,n),r},setItem:function setItem$2(t,n,i){var r=this;t=normalizeKey(t);var o=r.ready().then((function(){void 0===n&&(n=null);var i=n;return new h((function(o,h){var c=r._dbInfo;c.serializer.serialize(n,(function(n,r){if(r)h(r);else try{localStorage.setItem(c.keyPrefix+t,n),o(i)}catch(dr){"QuotaExceededError"!==dr.name&&"NS_ERROR_DOM_QUOTA_REACHED"!==dr.name||h(dr),h(dr)}}))}))}));return executeCallback(o,i),o},removeItem:function removeItem$2(t,n){var i=this;t=normalizeKey(t);var r=i.ready().then((function(){var n=i._dbInfo;localStorage.removeItem(n.keyPrefix+t)}));return executeCallback(r,n),r},clear:function clear$2(t){var n=this,i=n.ready().then((function(){for(var t=n._dbInfo.keyPrefix,i=localStorage.length-1;i>=0;i--){var r=localStorage.key(i);0===r.indexOf(t)&&localStorage.removeItem(r)}}));return executeCallback(i,t),i},length:function length$2(t){var n=this.keys().then((function(t){return t.length}));return executeCallback(n,t),n},key:function key$2(t,n){var i=this,r=i.ready().then((function(){var n,r=i._dbInfo;try{n=localStorage.key(t)}catch(o){n=null}return n&&(n=n.substring(r.keyPrefix.length)),n}));return executeCallback(r,n),r},keys:function keys$2(t){var n=this,i=n.ready().then((function(){for(var t=n._dbInfo,i=localStorage.length,r=[],o=0;o<i;o++){var h=localStorage.key(o);0===h.indexOf(t.keyPrefix)&&r.push(h.substring(t.keyPrefix.length))}return r}));return executeCallback(i,t),i},dropInstance:function dropInstance$2(t,n){if(n=getCallback.apply(this,arguments),!(t="function"!=typeof t&&t||{}).name){var i=this.config();t.name=t.name||i.name,t.storeName=t.storeName||i.storeName}var r,o=this;return r=t.name?new h((function(n){t.storeName?n(_getKeyPrefix(t,o._defaultConfig)):n(t.name+"/")})).then((function(t){for(var n=localStorage.length-1;n>=0;n--){var i=localStorage.key(n);0===i.indexOf(t)&&localStorage.removeItem(i)}})):h.reject("Invalid arguments"),executeCallback(r,n),r}},z=function sameValue2(t,n){return t===n||"number"==typeof t&&"number"==typeof n&&isNaN(t)&&isNaN(n)},F=function includes2(t,n){for(var i=t.length,r=0;r<i;){if(z(t[r],n))return!0;r++}return!1},q=Array.isArray||function(t){return"[object Array]"===Object.prototype.toString.call(t)},W={},Y={},H={INDEXEDDB:v,WEBSQL:V,LOCALSTORAGE:U},X=[H.INDEXEDDB._driver,H.WEBSQL._driver,H.LOCALSTORAGE._driver],J=["dropInstance"],Z=["clear","getItem","iterate","key","keys","length","removeItem","setItem"].concat(J),Q={description:"",driver:X.slice(),name:"localforage",size:4980736,storeName:"keyvaluepairs",version:1};function callWhenReady(t,n){t[n]=function(){var i=arguments;return t.ready().then((function(){return t[n].apply(t,i)}))}}function extend(){for(var t=1;t<arguments.length;t++){var n=arguments[t];if(n)for(var i in n)n.hasOwnProperty(i)&&(q(n[i])?arguments[0][i]=n[i].slice():arguments[0][i]=n[i])}return arguments[0]}var tt=function(){function LocalForage2(t){for(var n in function _classCallCheck(t,n){if(!(t instanceof n))throw new TypeError("Cannot call a class as a function")}(this,LocalForage2),H)if(H.hasOwnProperty(n)){var i=H[n],r=i._driver;this[n]=r,W[r]||this.defineDriver(i)}this._defaultConfig=extend({},Q),this._config=extend({},this._defaultConfig,t),this._driverSet=null,this._initDriver=null,this._ready=!1,this._dbInfo=null,this._wrapLibraryMethodsWithReady(),this.setDriver(this._config.driver).catch((function(){}))}return LocalForage2.prototype.config=function config(t){if("object"===(void 0===t?"undefined":r(t))){if(this._ready)return new Error("Can't call config() after localforage has been used.");for(var n in t){if("storeName"===n&&(t[n]=t[n].replace(/\W/g,"_")),"version"===n&&"number"!=typeof t[n])return new Error("Database version must be a number.");this._config[n]=t[n]}return!("driver"in t)||!t.driver||this.setDriver(this._config.driver)}return"string"==typeof t?this._config[t]:this._config},LocalForage2.prototype.defineDriver=function defineDriver(t,n,i){var r=new h((function(n,i){try{var r=t._driver,o=new Error("Custom driver not compliant; see https://mozilla.github.io/localForage/#definedriver");if(!t._driver)return void i(o);for(var c=Z.concat("_initStorage"),u=0,d=c.length;u<d;u++){var p=c[u];if((!F(J,p)||t[p])&&"function"!=typeof t[p])return void i(o)}!function configureMissingMethods2(){for(var n=function methodNotImplementedFactory2(t){return function(){var n=new Error("Method "+t+" is not implemented by the current driver"),i=h.reject(n);return executeCallback(i,arguments[arguments.length-1]),i}},i=0,r=J.length;i<r;i++){var o=J[i];t[o]||(t[o]=n(o))}}();var g=function setDriverSupport2(i){W[r]&&console.info("Redefining LocalForage driver: "+r),W[r]=t,Y[r]=i,n()};"_support"in t?t._support&&"function"==typeof t._support?t._support().then(g,i):g(!!t._support):g(!0)}catch(dr){i(dr)}}));return executeTwoCallbacks(r,n,i),r},LocalForage2.prototype.driver=function driver(){return this._driver||null},LocalForage2.prototype.getDriver=function getDriver(t,n,i){var r=W[t]?h.resolve(W[t]):h.reject(new Error("Driver not found."));return executeTwoCallbacks(r,n,i),r},LocalForage2.prototype.getSerializer=function getSerializer(t){var n=h.resolve(j);return executeTwoCallbacks(n,t),n},LocalForage2.prototype.ready=function ready(t){var n=this,i=n._driverSet.then((function(){return null===n._ready&&(n._ready=n._initDriver()),n._ready}));return executeTwoCallbacks(i,t,t),i},LocalForage2.prototype.setDriver=function setDriver(t,n,i){var r=this;q(t)||(t=[t]);var o=this._getSupportedDrivers(t);function setDriverToConfig(){r._config.driver=r.driver()}function extendSelfWithDriver(t){return r._extend(t),setDriverToConfig(),r._ready=r._initStorage(r._config),r._ready}var c=null!==this._driverSet?this._driverSet.catch((function(){return h.resolve()})):h.resolve();return this._driverSet=c.then((function(){var t=o[0];return r._dbInfo=null,r._ready=null,r.getDriver(t).then((function(t){r._driver=t._driver,setDriverToConfig(),r._wrapLibraryMethodsWithReady(),r._initDriver=function initDriver(t){return function(){var n=0;return function driverPromiseLoop(){for(;n<t.length;){var i=t[n];return n++,r._dbInfo=null,r._ready=null,r.getDriver(i).then(extendSelfWithDriver).catch(driverPromiseLoop)}setDriverToConfig();var o=new Error("No available storage method found.");return r._driverSet=h.reject(o),r._driverSet}()}}(o)}))})).catch((function(){setDriverToConfig();var t=new Error("No available storage method found.");return r._driverSet=h.reject(t),r._driverSet})),executeTwoCallbacks(this._driverSet,n,i),this._driverSet},LocalForage2.prototype.supports=function supports(t){return!!Y[t]},LocalForage2.prototype._extend=function _extend(t){extend(this,t)},LocalForage2.prototype._getSupportedDrivers=function _getSupportedDrivers(t){for(var n=[],i=0,r=t.length;i<r;i++){var o=t[i];this.supports(o)&&n.push(o)}return n},LocalForage2.prototype._wrapLibraryMethodsWithReady=function _wrapLibraryMethodsWithReady(){for(var t=0,n=Z.length;t<n;t++)callWhenReady(this,Z[t])},LocalForage2.prototype.createInstance=function createInstance(t){return new LocalForage2(t)},LocalForage2}(),et=new tt;n.exports=et},{3:3}]},{},[4])(4)}))}},function __require2(){return Dt||(0,Lt[Vt(Lt)[0]])((Dt={exports:{}}).exports,Dt),Dt.exports}),qt=class{constructor(){__publicField(this,"appId"),__publicField(this,"userId"),__publicField(this,"userManager"),__publicField(this,"roomDoc")}getMap(t){return this.roomDoc.getMap(`@app/${this.name}/${this.appId}/${t}`)}getArray(t){return this.roomDoc.getArray(`@app/${this.name}/${this.appId}/${t}`)}async terminal(){try{await this.dispose()}catch{}}},delay$1=t=>new Promise((n=>setTimeout(n,t))),Wt=class extends It{constructor(t,n){super(),__publicField(this,"selfId"),__publicField(this,"usersMap"),__publicField(this,"socketUsers",new Set),__publicField(this,"onUsersUpdate",(t=>{var n;for(const i of t)if(i.target===this.usersMap){for(const[t,n]of i.changes.keys.entries())if("add"===n.action||"update"===n.action){const n=this.getUser(t);n&&this.emit("join",n)}}else if(i.target.parent===this.usersMap)for(const[t]of i.changes.keys.entries())if("online"===t){const t=this.getUser(i.target.get("userId"));if(t){(null==(n=this.getUser(i.target.get("userId")))?void 0:n.online)?this.emit("join",t):this.emit("leave",t)}}})),this.selfId=t,this.usersMap=n,this.usersMap.observeDeep(this.onUsersUpdate)}addSocketUserId(t){this.socketUsers.add(t);this.getUser(t)&&this.usersMap.get(t).set("online",!0)}deleteSocketUserId(t){this.socketUsers.delete(t);this.getUser(t)&&this.usersMap.get(t).set("online",!1)}getUser(t){const n=this.usersMap.get(t);return n?{id:n.get("userId"),nickName:n.get("nickName"),online:n.get("online")}:null}userIdList(){return this.socketUsers.size>0?Array.from(this.socketUsers):Array.from(this.usersMap.keys()).filter((t=>!0===this.usersMap.get(t).get("online")))}};var Yt=__toESM$1(Ft()),Ht=class{constructor(){__publicField(this,"logs",[]),__publicField(this,"endpoint"),__publicField(this,"roomId"),__publicField(this,"userId"),__publicField(this,"roomToken")}get persistenceKey(){return`forge_logs_${this.roomId}_${this.userId}`}get isInit(){return!!(this.endpoint&&this.userId&&this.roomId&&this.roomToken)}init(t,n,i,r){this.endpoint=t,this.roomId=n,this.userId=i,this.roomToken=r,setInterval((()=>{this.flush().catch((t=>{console.log(t)}))}),5e3)}detectFlush(){this.logs.length>300&&this.flush().catch((t=>{console.log(t)}))}async flush(){var t;if(!this.isInit)return;const n=(null!=(t=await Yt.default.getItem(this.persistenceKey))?t:[]).concat(this.logs);if(this.logs=[],n.length>0){await Yt.default.setItem(this.persistenceKey,n);(await fetch(`${this.endpoint}/client/logs`,{method:"PUT",headers:{token:this.roomToken,"Content-Type":"application/json"},body:JSON.stringify({logs:n,roomId:this.roomId,userId:this.userId})})).ok&&await Yt.default.removeItem(this.persistenceKey)}}log(t,n,i="info"){this.logs.push({...n,message:t,timestamp:Date.now(),level:i}),this.detectFlush()}};function check(t){return t&&t.Math===Math&&t}var Kt=check("object"==typeof window&&window)||check("object"==typeof self&&self)||check("object"==typeof global&&global)||function(){return this}()||Function("return this")(),logger=()=>(Kt.__forge_logger__||(Kt.__forge_logger__=new Ht),Kt.__forge_logger__);function log(t,n,i="info"){logger().logs.push({...n,message:t,timestamp:Date.now(),level:i}),logger().detectFlush()}var $t=class extends It{constructor(t,n){super(),__publicField(this,"applications",new Map),__publicField(this,"appsMap"),__publicField(this,"instances",new Map),__publicField(this,"applicationInit"),__publicField(this,"launchCallbacks",new Map),__publicField(this,"onAppUpdate",(t=>{for(const[n,i]of t.changes.keys.entries())if("add"===i.action)this.handleAddApplication(n);else if("delete"===i.action){const t=this.instances.get(n);t&&t.terminal().then((()=>{this.emit("terminal",n)}))}})),this.applicationInit=n,this.appsMap=t,this.appsMap.observe(this.onAppUpdate)}handleAddApplication(t){if(this.instances.has(t))return;const n=this.appsMap.get(t);if(n){const i=this.applications.get(n.type);if(!i)throw log("application not registered",{type:n.type,appId:t},"error"),new Error(`[@netless/forge-room] application(${n.type}) not registered`);{const r=new i;r.appId=t,this.applicationInit(r),log(`launch application: ${n.type}`,{type:n.type,appId:t});const o=Date.now();r.initialize(n.option).then((()=>{this.instances.set(t,r);const i=this.launchCallbacks.get(t);i&&(i(null,r),this.launchCallbacks.delete(t)),this.emit("launch",t,r.emitter),log("initialize application done",{type:n.type,appId:t,duration:Date.now()-o})})).catch((i=>{log("initialize application error",{type:n.type,appId:t,error:i.message},"error");const r=this.launchCallbacks.get(t);if(!r)throw new Error(`[@netless/forge-room] application initialize failed, type: ${n.type}, appId: ${n.type}, error: ${i} `);r(i,null),this.launchCallbacks.delete(t)}))}}}registerApplication(t){this.applications.has(t.applicationName)||(this.applications.set(t.applicationName,t),this.applications.set(t,t.applicationName))}validateAppId(t){if(!/^[a-zA-Z\d]+$/.test(t))throw new Error(`[Whiteboard Room] Invalid appId: ${t}, expected [a-zA-Z-]`)}async launchApplication(t,n,i){return new Promise(((r,o)=>{const h=this.applications.get(t);let c=i||v4$2().replace(/-/g,"");this.instances.has(c)?r(this.instances.get(c).emitter):(this.validateAppId(c),this.launchCallbacks.set(c,((t,n)=>{t?o(t):r(n.emitter)})),this.appsMap.set(c,{type:h,uuid:c,option:n}))}))}terminateApplication(t){var n,i;log("application terminated",{appId:t,type:null!=(i=null==(n=this.appsMap.get(t))?void 0:n.type)?i:""}),this.appsMap.delete(t)}},Gt=class extends It{constructor(t){super(),__publicField(this,"lastBeatTime",new Map),__publicField(this,"doc"),this.doc=t}beat(t,n){if(this.lastBeatTime.has(t)||this.lastBeatTime.set(t,Date.now()),Date.now()-this.lastBeatTime.get(t)>500){this.lastBeatTime.set(t,Date.now());const i=Array.from(encodeStateVector(this.doc)).join("");n();i===Array.from(encodeStateVector(this.doc)).join("")&&(console.log("conflict"),this.emit("conflict",t))}else n()}},Xt=class extends It{constructor(){super(),__publicField(this,"updates",[]),setInterval((()=>{if(this.updates.length>0){const t=mergeUpdates(this.updates);this.emit("emitterUpdate",t),this.updates=[]}}),32)}appendUpdate(t){this.updates.push(t)}},Jt=class{constructor(t,n){__publicField(this,"metaBuffer"),__publicField(this,"buffer",new Uint8Array(0));const i=new TextEncoder,r=i.encode(t),o=i.encode(n),h=new ArrayBuffer(8),c=new DataView(h);c.setUint32(0,r.length,!1),c.setUint32(4,o.length,!1),this.metaBuffer=new Uint8Array(h.byteLength+r.length+o.length),this.metaBuffer.set(new Uint8Array(h),0),this.metaBuffer.set(r,h.byteLength),this.metaBuffer.set(o,h.byteLength+r.length)}getBuffer(){const t=this.buffer;return this.buffer=new Uint8Array(0),t}addItem(t,n){const i=new ArrayBuffer(12),r=new DataView(i),o=new TextEncoder,h=o.encode(`${Date.now()}`),c=o.encode(n);r.setUint32(0,h.length,!1),r.setUint32(4,c.length,!1),r.setUint32(8,t.length,!1);var u=r.buffer.byteLength+h.length+c.length+t.length;u+=u%4==0?0:4-u%4;const d=new Uint8Array(u);let p=0;d.set(new Uint8Array(i),p),p+=i.byteLength,d.set(h,p),p+=h.length,d.set(c,p),p+=c.length,d.set(t,p);const g=new Uint8Array(this.buffer.length+d.length);g.set(this.buffer,0),g.set(d,this.buffer.length),this.buffer=g}decode(t){const n=[];let i=0;const r=t.slice(0,8),o=new DataView(r.buffer),h=o.getUint32(0,!1),c=o.getUint32(4,!1),u=new TextDecoder,d=u.decode(t.slice(8,h)),p=u.decode(t.slice(8+h,c));let g=t.slice(8+h+c);for(;i<g.length;){const t=new DataView(g.slice(i,i+8).buffer);i+=8;const r=t.getUint32(0),o=t.getUint32(4),h=g.slice(i,i+r);i+=r;const c=parseInt((new TextDecoder).decode(h)),u=g.slice(i);i+=o,n.push({timestamp:c,update:u})}return{roomId:d,userId:p,updates:n}}},Zt=__toESM$1(Ft()),Qt=class{constructor(t,n,i,r,o){__publicField(this,"endpoint"),__publicField(this,"roomId"),__publicField(this,"roomToken"),__publicField(this,"docHistory"),__publicField(this,"roomDoc"),__publicField(this,"snapshotBackupInterval"),__publicField(this,"historyBackupInterval"),__publicField(this,"snapshotBackupIntervalStep",3e3),__publicField(this,"historyBackupIntervalStep",5e3),__publicField(this,"lastBackupSnapshotVector"),this.endpoint=t,this.roomToken=n,this.roomId=i,this.docHistory=r,this.roomDoc=o}setSnapshotIntervalStep(t){this.snapshotBackupIntervalStep=t}setHistoryIntervalStep(t){this.historyBackupIntervalStep=t}active(){this.destroy(),this.historyBackupInterval=setTimeout(this.backupHistory.bind(this),this.historyBackupIntervalStep),this.snapshotBackupInterval=setTimeout(this.backupSnapshot.bind(this),this.snapshotBackupIntervalStep)}async backupSnapshot(){const t=this.getDocSnapshot();t&&await this.backupSnapshotAsync(t),this.snapshotBackupInterval=setTimeout(this.backupSnapshot.bind(this),this.snapshotBackupIntervalStep)}async backupHistory(){const t=this.docHistory.getBuffer();if(t.length){let n=t;const i=await Zt.default.getItem(`backup-history-${this.roomId}`);i&&(n=new Uint8Array(t.length+i.length),n.set(i,0),n.set(t,i.length)),await this.backupHistoryAsync(n)}this.historyBackupInterval=setTimeout(this.backupHistory.bind(this),this.historyBackupIntervalStep)}destroy(){this.snapshotBackupInterval&&clearTimeout(this.snapshotBackupInterval),this.historyBackupInterval&&clearTimeout(this.historyBackupInterval),this.lastBackupSnapshotVector=void 0}getDocSnapshot(){const t=encodeStateVector(this.roomDoc);return this.lastBackupSnapshotVector&&this.isEqual(t,this.lastBackupSnapshotVector)?null:(this.lastBackupSnapshotVector=t,encodeStateAsUpdate(this.roomDoc))}isEqual(t,n){return t.length===n.length&&t.every(((t,i)=>t===n[i]))}mergeMetaBuffer(t){const n=this.docHistory.metaBuffer.length,i=new Uint8Array(t.length+n);return i.set(this.docHistory.metaBuffer,0),i.set(t,n),i}async backupSnapshotAsync(t,n=1){try{const n=this.mergeMetaBuffer(t);await fetch(`${this.endpoint}/snapshot`,{method:"PUT",body:n,headers:{"Content-Type":"application/octet-stream",Token:this.roomToken}})}catch(i){n>0?await this.backupSnapshotAsync(t,--n):console.warn("backupSnapshot failed",i)}}async backupHistoryAsync(t,n=3){await Zt.default.setItem(`backup-history-${this.roomId}`,t);try{const n=this.mergeMetaBuffer(t);await fetch(`${this.endpoint}/history`,{method:"PUT",body:n,headers:{"Content-Type":"application/octet-stream",Token:this.roomToken}}),await Zt.default.removeItem(`backup-history-${this.roomId}`)}catch(i){n>0?await this.backupHistoryAsync(t,--n):console.warn("backupHistory failed",i)}}async getSnapshot(){try{const t=await fetch(`${this.endpoint}/snapshot/${this.roomId}`,{method:"GET",headers:{Token:this.roomToken}});if(401===t.status)return{status:401,buf:null};let{url:n}=await t.json();"https:"===location.protocol&&/^http:/.test(n)&&(n=n.replace("http:","https:"));const i=await fetch(n);if(i.status>=200&&i.status<300){const t=await i.arrayBuffer();return{status:200,buf:new Uint8Array(t)}}return{status:i.status,buf:null}}catch(dr){return console.log(dr),{status:404,buf:null}}}},te={dev:"https://forge-persistence.netless.group","cn-hz":"https://forge-persistence.whiteboard.sd-rtn.com"};((t,n,i)=>{for(var r,o=jt(n,i),h=t.length-1;h>=0;h--)(r=t[h])&&(o=r(n,i,o)||o);o&&Rt(n,i,o)})([function logHookAsync(t){return function(n,i,r){const o=r.value;return r.value=function(...n){return new Promise(((i,r)=>{const h=Date.now(),c=o.apply(this,n);return c.then((n=>{log(`${t}`,{duration:Date.now()-h,result:"success"}),i(n)})).catch((n=>{log(`${t}`,{error:`${n}`,result:"fail"}),r(n)})),log(`${t}`,{duration:Date.now()-h,result:"success"}),c}))},r}}("joinRoom")],class extends It{constructor(t,n){super(),__publicField(this,"roomDoc"),__publicField(this,"socketProvider"),__publicField(this,"roomId"),__publicField(this,"userId"),__publicField(this,"nickName"),__publicField(this,"versionDetector"),__publicField(this,"docEmitter"),__publicField(this,"backupInstance"),__publicField(this,"history"),__publicField(this,"applicationManager"),__publicField(this,"userManager"),__publicField(this,"handleYDocConflict",(t=>{this.socketProvider.publish(encodeStateVector(this.roomDoc),"conflict",t)})),this.socketProvider=n,this.roomId=t,this.roomDoc=new Doc,this.docEmitter=new Xt,this.versionDetector=new Gt(this.roomDoc),this.applicationManager=new $t(this.roomDoc.getMap("@room/applications"),(t=>{t.userId=this.userId,t.userManager=this.userManager,t.roomDoc=this.roomDoc})),this.roomDoc.on("update",((t,n)=>{(!n||"remote"!==n&&"snapshot"!==n)&&this.docEmitter.appendUpdate(t)})),this.versionDetector.on("conflict",this.handleYDocConflict),this.docEmitter.on("emitterUpdate",(t=>{this.emit("docSend",t.length/1024),this.history.addItem(t,this.userId),this.socketProvider.publish(t,"diff")}))}async initByVector(){const t=this.userManager.userIdList().filter((t=>t!==this.userId)).map((t=>new Promise((n=>{this.socketProvider.publish(encodeStateVector(this.roomDoc),"initVectorReq",t),this.socketProvider.on("message",((i,r,o)=>{"initVectorRes"===o&&r===t&&(applyUpdate(this.roomDoc,i),n())}))}))));return 0===t.length?Promise.resolve():Promise.race([delay$1(3e3),Promise.all(t)])}async joinRoom(t){this.userId=t.userId,this.nickName=t.nickName,this.history=new Jt(this.roomId,t.userId);const n=t.endpoint||te[t.sdkConfig.region];if(!n)throw new Error(`[forge-room] invalid endpoint ${t.sdkConfig.region}`);logger().init(n,this.roomId,t.userId,t.roomToken),log("join room",{userId:t.userId,roomId:this.roomId,region:t.sdkConfig.region}),this.backupInstance=new Qt(n,t.roomToken,this.roomId,this.history,this.roomDoc);const i=await this.backupInstance.getSnapshot();if(401===i.status)throw new Error("[forge-room] invalid room token");this.userManager=new Wt(this.userId,this.roomDoc.getMap("@room/users")),this.socketProvider.on("userJoin",(t=>this.userManager.addSocketUserId(t))),this.socketProvider.on("userLeave",(t=>this.userManager.deleteSocketUserId(t))),await this.socketProvider.initialize(this.roomId,t.userId),(await this.socketProvider.userList()).forEach((t=>this.userManager.addSocketUserId(t))),i.buf&&this.applyDocSnapshot(i.buf),await this.initByVector(),function addUser(t,n,i){let r=new YMap;t.transact((()=>{r.set("userId",n),r.set("nickName",i),r.set("online",!0),t.getMap("@room/users").set(n,r)}))}(this.roomDoc,this.userId,this.nickName),this.socketProvider.on("message",((t,n,i)=>{if("diff"===i&&n!==this.userId)this.versionDetector.beat(n,(()=>{this.emit("docReceive",t.length/1024),this.history.addItem(t,n),applyUpdate(this.roomDoc,t,"remote")}));else if("conflict"===i){const i=encodeStateAsUpdate(this.roomDoc,t);this.socketProvider.publish(i,"diff",n)}else if("initVectorReq"===i){const i=encodeStateAsUpdate(this.roomDoc,t);this.socketProvider.publish(i,"initVectorRes",n)}})),setTimeout((()=>{this.backupInstance.active()}),1e3)}applyDocSnapshot(t){applyUpdate(this.roomDoc,t,"snapshot")}getDocSnapshot(){const t=encodeStateAsUpdate(this.roomDoc),n=new Uint8Array(t.length+this.history.metaBuffer.length);return n.set(this.history.metaBuffer,0),n.set(t,this.history.metaBuffer.length),n}}.prototype,"joinRoom");
/*! Bundled license information:

localforage/dist/localforage.js:
  (*!
      localForage -- Offline Storage, Improved
      Version 1.10.0
      https://localforage.github.io/localForage
      (c) 2013-2017 Mozilla, Apache License 2.0
  *)
*/
var ne=Object.create,re=Object.defineProperty,oe=Object.getOwnPropertyDescriptor,le=Object.getOwnPropertyNames,pe=Object.getPrototypeOf,fe=Object.prototype.hasOwnProperty,ve=(t=>"undefined"!=typeof require?require:"undefined"!=typeof Proxy?new Proxy(t,{get:(t,n)=>("undefined"!=typeof require?require:t)[n]}):t)((function(t){if("undefined"!=typeof require)return require.apply(this,arguments);throw Error('Dynamic require of "'+t+'" is not supported')})),__commonJS=(t,n)=>function __require2(){return n||(0,t[le(t)[0]])((n={exports:{}}).exports,n),n.exports},__toESM=(t,n,i)=>(i=null!=t?ne(pe(t)):{},((t,n,i,r)=>{if(n&&"object"==typeof n||"function"==typeof n)for(let o of le(n))fe.call(t,o)||o===i||re(t,o,{get:()=>n[o],enumerable:!(r=oe(n,o))||r.enumerable});return t})(re(i,"default",{value:t,enumerable:!0}),t)),_e=__commonJS({"(disabled):../../node_modules/.pnpm/paper@0.12.17/node_modules/paper/dist/node/self.js"(){}}),ye=__commonJS({"../../node_modules/.pnpm/acorn@8.11.3/node_modules/acorn/dist/acorn.js"(t,n){var i,r;i=t,r=function(t){var n=[509,0,227,0,150,4,294,9,1368,2,2,1,6,3,41,2,5,0,166,1,574,3,9,9,370,1,81,2,71,10,50,3,123,2,54,14,32,10,3,1,11,3,46,10,8,0,46,9,7,2,37,13,2,9,6,1,45,0,13,2,49,13,9,3,2,11,83,11,7,0,3,0,158,11,6,9,7,3,56,1,2,6,3,1,3,2,10,0,11,1,3,6,4,4,193,17,10,9,5,0,82,19,13,9,214,6,3,8,28,1,83,16,16,9,82,12,9,9,84,14,5,9,243,14,166,9,71,5,2,1,3,3,2,0,2,1,13,9,120,6,3,6,4,0,29,9,41,6,2,3,9,0,10,10,47,15,406,7,2,7,17,9,57,21,2,13,123,5,4,0,2,1,2,6,2,0,9,9,49,4,2,1,2,4,9,9,330,3,10,1,2,0,49,6,4,4,14,9,5351,0,7,14,13835,9,87,9,39,4,60,6,26,9,1014,0,2,54,8,3,82,0,12,1,19628,1,4706,45,3,22,543,4,4,5,9,7,3,6,31,3,149,2,1418,49,513,54,5,49,9,0,15,0,23,4,2,14,1361,6,2,16,3,6,2,1,2,4,101,0,161,6,10,9,357,0,62,13,499,13,983,6,110,6,6,9,4759,9,787719,239],i=[0,11,2,25,2,18,2,1,2,14,3,13,35,122,70,52,268,28,4,48,48,31,14,29,6,37,11,29,3,35,5,7,2,4,43,157,19,35,5,35,5,39,9,51,13,10,2,14,2,6,2,1,2,10,2,14,2,6,2,1,68,310,10,21,11,7,25,5,2,41,2,8,70,5,3,0,2,43,2,1,4,0,3,22,11,22,10,30,66,18,2,1,11,21,11,25,71,55,7,1,65,0,16,3,2,2,2,28,43,28,4,28,36,7,2,27,28,53,11,21,11,18,14,17,111,72,56,50,14,50,14,35,349,41,7,1,79,28,11,0,9,21,43,17,47,20,28,22,13,52,58,1,3,0,14,44,33,24,27,35,30,0,3,0,9,34,4,0,13,47,15,3,22,0,2,0,36,17,2,24,20,1,64,6,2,0,2,3,2,14,2,9,8,46,39,7,3,1,3,21,2,6,2,1,2,4,4,0,19,0,13,4,159,52,19,3,21,2,31,47,21,1,2,0,185,46,42,3,37,47,21,0,60,42,14,0,72,26,38,6,186,43,117,63,32,7,3,0,3,7,2,1,2,23,16,0,2,0,95,7,3,38,17,0,2,0,29,0,11,39,8,0,22,0,12,45,20,0,19,72,264,8,2,36,18,0,50,29,113,6,2,1,2,37,22,0,26,5,2,1,2,31,15,0,328,18,16,0,2,12,2,33,125,0,80,921,103,110,18,195,2637,96,16,1071,18,5,4026,582,8634,568,8,30,18,78,18,29,19,47,17,3,32,20,6,18,689,63,129,74,6,0,67,12,65,1,2,0,29,6135,9,1237,43,8,8936,3,2,6,2,1,2,290,16,0,30,2,3,0,15,3,9,395,2309,106,6,12,4,8,8,9,5991,84,2,70,2,1,3,0,3,1,3,3,2,11,2,0,2,6,2,64,2,3,3,7,2,6,2,27,2,3,2,4,2,0,4,6,2,339,3,24,2,24,2,30,2,24,2,30,2,24,2,30,2,24,2,30,2,24,2,7,1845,30,7,5,262,61,147,44,11,6,17,0,322,29,19,43,485,27,757,6,2,3,2,1,2,14,2,196,60,67,8,0,1205,3,2,26,2,1,2,0,3,0,2,9,2,3,2,0,2,0,7,0,5,0,2,0,2,0,2,2,2,1,2,0,3,0,2,0,2,0,2,0,2,0,2,1,2,0,3,3,2,6,2,3,2,3,2,0,2,9,2,16,6,2,2,4,2,16,4421,42719,33,4153,7,221,3,5761,15,7472,16,621,2467,541,1507,4938,6,4191],r="ªµºÀ-ÖØ-öø-ˁˆ-ˑˠ-ˤˬˮͰ-ʹͶͷͺ-ͽͿΆΈ-ΊΌΎ-ΡΣ-ϵϷ-ҁҊ-ԯԱ-Ֆՙՠ-ֈא-תׯ-ײؠ-يٮٯٱ-ۓەۥۦۮۯۺ-ۼۿܐܒ-ܯݍ-ޥޱߊ-ߪߴߵߺࠀ-ࠕࠚࠤࠨࡀ-ࡘࡠ-ࡪࡰ-ࢇࢉ-ࢎࢠ-ࣉऄ-हऽॐक़-ॡॱ-ঀঅ-ঌএঐও-নপ-রলশ-হঽৎড়ঢ়য়-ৡৰৱৼਅ-ਊਏਐਓ-ਨਪ-ਰਲਲ਼ਵਸ਼ਸਹਖ਼-ੜਫ਼ੲ-ੴઅ-ઍએ-ઑઓ-નપ-રલળવ-હઽૐૠૡૹଅ-ଌଏଐଓ-ନପ-ରଲଳଵ-ହଽଡ଼ଢ଼ୟ-ୡୱஃஅ-ஊஎ-ஐஒ-கஙசஜஞடணதந-பம-ஹௐఅ-ఌఎ-ఐఒ-నప-హఽౘ-ౚౝౠౡಀಅ-ಌಎ-ಐಒ-ನಪ-ಳವ-ಹಽೝೞೠೡೱೲഄ-ഌഎ-ഐഒ-ഺഽൎൔ-ൖൟ-ൡൺ-ൿඅ-ඖක-නඳ-රලව-ෆก-ะาำเ-ๆກຂຄຆ-ຊຌ-ຣລວ-ະາຳຽເ-ໄໆໜ-ໟༀཀ-ཇཉ-ཬྈ-ྌက-ဪဿၐ-ၕၚ-ၝၡၥၦၮ-ၰၵ-ႁႎႠ-ჅჇჍა-ჺჼ-ቈቊ-ቍቐ-ቖቘቚ-ቝበ-ኈኊ-ኍነ-ኰኲ-ኵኸ-ኾዀዂ-ዅወ-ዖዘ-ጐጒ-ጕጘ-ፚᎀ-ᎏᎠ-Ᏽᏸ-ᏽᐁ-ᙬᙯ-ᙿᚁ-ᚚᚠ-ᛪᛮ-ᛸᜀ-ᜑᜟ-ᜱᝀ-ᝑᝠ-ᝬᝮ-ᝰក-ឳៗៜᠠ-ᡸᢀ-ᢨᢪᢰ-ᣵᤀ-ᤞᥐ-ᥭᥰ-ᥴᦀ-ᦫᦰ-ᧉᨀ-ᨖᨠ-ᩔᪧᬅ-ᬳᭅ-ᭌᮃ-ᮠᮮᮯᮺ-ᯥᰀ-ᰣᱍ-ᱏᱚ-ᱽᲀ-ᲈᲐ-ᲺᲽ-Ჿᳩ-ᳬᳮ-ᳳᳵᳶᳺᴀ-ᶿḀ-ἕἘ-Ἕἠ-ὅὈ-Ὅὐ-ὗὙὛὝὟ-ώᾀ-ᾴᾶ-ᾼιῂ-ῄῆ-ῌῐ-ΐῖ-Ίῠ-Ῥῲ-ῴῶ-ῼⁱⁿₐ-ₜℂℇℊ-ℓℕ℘-ℝℤΩℨK-ℹℼ-ℿⅅ-ⅉⅎⅠ-ↈⰀ-ⳤⳫ-ⳮⳲⳳⴀ-ⴥⴧⴭⴰ-ⵧⵯⶀ-ⶖⶠ-ⶦⶨ-ⶮⶰ-ⶶⶸ-ⶾⷀ-ⷆⷈ-ⷎⷐ-ⷖⷘ-ⷞ々-〇〡-〩〱-〵〸-〼ぁ-ゖ゛-ゟァ-ヺー-ヿㄅ-ㄯㄱ-ㆎㆠ-ㆿㇰ-ㇿ㐀-䶿一-ꒌꓐ-ꓽꔀ-ꘌꘐ-ꘟꘪꘫꙀ-ꙮꙿ-ꚝꚠ-ꛯꜗ-ꜟꜢ-ꞈꞋ-ꟊꟐꟑꟓꟕ-ꟙꟲ-ꠁꠃ-ꠅꠇ-ꠊꠌ-ꠢꡀ-ꡳꢂ-ꢳꣲ-ꣷꣻꣽꣾꤊ-ꤥꤰ-ꥆꥠ-ꥼꦄ-ꦲꧏꧠ-ꧤꧦ-ꧯꧺ-ꧾꨀ-ꨨꩀ-ꩂꩄ-ꩋꩠ-ꩶꩺꩾ-ꪯꪱꪵꪶꪹ-ꪽꫀꫂꫛ-ꫝꫠ-ꫪꫲ-ꫴꬁ-ꬆꬉ-ꬎꬑ-ꬖꬠ-ꬦꬨ-ꬮꬰ-ꭚꭜ-ꭩꭰ-ꯢ가-힣ힰ-ퟆퟋ-ퟻ豈-舘並-龎ﬀ-ﬆﬓ-ﬗיִײַ-ﬨשׁ-זּטּ-לּמּנּסּףּפּצּ-ﮱﯓ-ﴽﵐ-ﶏﶒ-ﷇﷰ-ﷻﹰ-ﹴﹶ-ﻼＡ-Ｚａ-ｚｦ-ﾾￂ-ￇￊ-ￏￒ-ￗￚ-ￜ",o={3:"abstract boolean byte char class double enum export extends final float goto implements import int interface long native package private protected public short static super synchronized throws transient volatile",5:"class enum extends super const export import",6:"enum",strict:"implements interface let package private protected public static yield",strictBind:"eval arguments"},h="break case catch continue debugger default do else finally for function if return switch throw try var while with null true false instanceof typeof void delete new in this",c={5:h,"5module":h+" export import",6:h+" const class extends export import super"},u=/^in(stanceof)?$/,d=new RegExp("["+r+"]"),p=new RegExp("["+r+"‌‍·̀-ͯ·҃-֑҇-ׇֽֿׁׂׅׄؐ-ًؚ-٩ٰۖ-ۜ۟-۪ۤۧۨ-ۭ۰-۹ܑܰ-݊ަ-ް߀-߉߫-߽߳ࠖ-࠙ࠛ-ࠣࠥ-ࠧࠩ-࡙࠭-࡛࢘-࢟࣊-ࣣ࣡-ःऺ-़ा-ॏ॑-ॗॢॣ०-९ঁ-ঃ়া-ৄেৈো-্ৗৢৣ০-৯৾ਁ-ਃ਼ਾ-ੂੇੈੋ-੍ੑ੦-ੱੵઁ-ઃ઼ા-ૅે-ૉો-્ૢૣ૦-૯ૺ-૿ଁ-ଃ଼ା-ୄେୈୋ-୍୕-ୗୢୣ୦-୯ஂா-ூெ-ைொ-்ௗ௦-௯ఀ-ఄ఼ా-ౄె-ైొ-్ౕౖౢౣ౦-౯ಁ-ಃ಼ಾ-ೄೆ-ೈೊ-್ೕೖೢೣ೦-೯ೳഀ-ഃ഻഼ാ-ൄെ-ൈൊ-്ൗൢൣ൦-൯ඁ-ඃ්ා-ුූෘ-ෟ෦-෯ෲෳัิ-ฺ็-๎๐-๙ັິ-ຼ່-໎໐-໙༘༙༠-༩༹༵༷༾༿ཱ-྄྆྇ྍ-ྗྙ-ྼ࿆ါ-ှ၀-၉ၖ-ၙၞ-ၠၢ-ၤၧ-ၭၱ-ၴႂ-ႍႏ-ႝ፝-፟፩-፱ᜒ-᜕ᜲ-᜴ᝒᝓᝲᝳ឴-៓៝០-៩᠋-᠍᠏-᠙ᢩᤠ-ᤫᤰ-᤻᥆-᥏᧐-᧚ᨗ-ᨛᩕ-ᩞ᩠-᩿᩼-᪉᪐-᪙᪰-᪽ᪿ-ᫎᬀ-ᬄ᬴-᭄᭐-᭙᭫-᭳ᮀ-ᮂᮡ-ᮭ᮰-᮹᯦-᯳ᰤ-᰷᱀-᱉᱐-᱙᳐-᳔᳒-᳨᳭᳴᳷-᳹᷀-᷿‌‍‿⁀⁔⃐-⃥⃜⃡-⃰⳯-⵿⳱ⷠ-〪ⷿ-゙゚〯・꘠-꘩꙯ꙴ-꙽ꚞꚟ꛰꛱ꠂ꠆ꠋꠣ-ꠧ꠬ꢀꢁꢴ-ꣅ꣐-꣙꣠-꣱ꣿ-꤉ꤦ-꤭ꥇ-꥓ꦀ-ꦃ꦳-꧀꧐-꧙ꧥ꧰-꧹ꨩ-ꨶꩃꩌꩍ꩐-꩙ꩻ-ꩽꪰꪲ-ꪴꪷꪸꪾ꪿꫁ꫫ-ꫯꫵ꫶ꯣ-ꯪ꯬꯭꯰-꯹ﬞ︀-️︠-︯︳︴﹍-﹏０-９＿･]");function isInAstralSet(t,n){for(var i=65536,r=0;r<n.length;r+=2){if((i+=n[r])>t)return!1;if((i+=n[r+1])>=t)return!0}return!1}function isIdentifierStart(t,n){return t<65?36===t:t<91||(t<97?95===t:t<123||(t<=65535?t>=170&&d.test(String.fromCharCode(t)):!1!==n&&isInAstralSet(t,i)))}function isIdentifierChar(t,r){return t<48?36===t:t<58||!(t<65)&&(t<91||(t<97?95===t:t<123||(t<=65535?t>=170&&p.test(String.fromCharCode(t)):!1!==r&&(isInAstralSet(t,i)||isInAstralSet(t,n)))))}var g=function TokenType2(t,n){void 0===n&&(n={}),this.label=t,this.keyword=n.keyword,this.beforeExpr=!!n.beforeExpr,this.startsExpr=!!n.startsExpr,this.isLoop=!!n.isLoop,this.isAssign=!!n.isAssign,this.prefix=!!n.prefix,this.postfix=!!n.postfix,this.binop=n.binop||null,this.updateContext=null};function binop(t,n){return new g(t,{beforeExpr:!0,binop:n})}var m={beforeExpr:!0},v={startsExpr:!0},_={};function kw(t,n){return void 0===n&&(n={}),n.keyword=t,_[t]=new g(t,n)}var y={num:new g("num",v),regexp:new g("regexp",v),string:new g("string",v),name:new g("name",v),privateId:new g("privateId",v),eof:new g("eof"),bracketL:new g("[",{beforeExpr:!0,startsExpr:!0}),bracketR:new g("]"),braceL:new g("{",{beforeExpr:!0,startsExpr:!0}),braceR:new g("}"),parenL:new g("(",{beforeExpr:!0,startsExpr:!0}),parenR:new g(")"),comma:new g(",",m),semi:new g(";",m),colon:new g(":",m),dot:new g("."),question:new g("?",m),questionDot:new g("?."),arrow:new g("=>",m),template:new g("template"),invalidTemplate:new g("invalidTemplate"),ellipsis:new g("...",m),backQuote:new g("`",v),dollarBraceL:new g("${",{beforeExpr:!0,startsExpr:!0}),eq:new g("=",{beforeExpr:!0,isAssign:!0}),assign:new g("_=",{beforeExpr:!0,isAssign:!0}),incDec:new g("++/--",{prefix:!0,postfix:!0,startsExpr:!0}),prefix:new g("!/~",{beforeExpr:!0,prefix:!0,startsExpr:!0}),logicalOR:binop("||",1),logicalAND:binop("&&",2),bitwiseOR:binop("|",3),bitwiseXOR:binop("^",4),bitwiseAND:binop("&",5),equality:binop("==/!=/===/!==",6),relational:binop("</>/<=/>=",7),bitShift:binop("<</>>/>>>",8),plusMin:new g("+/-",{beforeExpr:!0,binop:9,prefix:!0,startsExpr:!0}),modulo:binop("%",10),star:binop("*",10),slash:binop("/",10),starstar:new g("**",{beforeExpr:!0}),coalesce:binop("??",1),_break:kw("break"),_case:kw("case",m),_catch:kw("catch"),_continue:kw("continue"),_debugger:kw("debugger"),_default:kw("default",m),_do:kw("do",{isLoop:!0,beforeExpr:!0}),_else:kw("else",m),_finally:kw("finally"),_for:kw("for",{isLoop:!0}),_function:kw("function",v),_if:kw("if"),_return:kw("return",m),_switch:kw("switch"),_throw:kw("throw",m),_try:kw("try"),_var:kw("var"),_const:kw("const"),_while:kw("while",{isLoop:!0}),_with:kw("with"),_new:kw("new",{beforeExpr:!0,startsExpr:!0}),_this:kw("this",v),_super:kw("super",v),_class:kw("class",v),_extends:kw("extends",m),_export:kw("export"),_import:kw("import",v),_null:kw("null",v),_true:kw("true",v),_false:kw("false",v),_in:kw("in",{beforeExpr:!0,binop:7}),_instanceof:kw("instanceof",{beforeExpr:!0,binop:7}),_typeof:kw("typeof",{beforeExpr:!0,prefix:!0,startsExpr:!0}),_void:kw("void",{beforeExpr:!0,prefix:!0,startsExpr:!0}),_delete:kw("delete",{beforeExpr:!0,prefix:!0,startsExpr:!0})},w=/\r\n?|\n|\u2028|\u2029/,x=new RegExp(w.source,"g");function isNewLine(t){return 10===t||13===t||8232===t||8233===t}function nextLineBreak(t,n,i){void 0===i&&(i=t.length);for(var r=n;r<i;r++){var o=t.charCodeAt(r);if(isNewLine(o))return r<i-1&&13===o&&10===t.charCodeAt(r+1)?r+2:r+1}return-1}var S=/[\u1680\u2000-\u200a\u202f\u205f\u3000\ufeff]/,C=/(?:\s|\/\/.*|\/\*[^]*?\*\/)*/g,k=Object.prototype,P=k.hasOwnProperty,I=k.toString,M=Object.hasOwn||function(t,n){return P.call(t,n)},E=Array.isArray||function(t){return"[object Array]"===I.call(t)},T=Object.create(null);function wordsRegexp(t){return T[t]||(T[t]=new RegExp("^(?:"+t.replace(/ /g,"|")+")$"))}function codePointToString(t){return t<=65535?String.fromCharCode(t):(t-=65536,String.fromCharCode(55296+(t>>10),56320+(1023&t)))}var O=/(?:[\uD800-\uDBFF](?![\uDC00-\uDFFF])|(?:[^\uD800-\uDBFF]|^)[\uDC00-\uDFFF])/,D=function Position2(t,n){this.line=t,this.column=n};D.prototype.offset=function offset(t){return new D(this.line,this.column+t)};var N=function SourceLocation2(t,n,i){this.start=n,this.end=i,null!==t.sourceFile&&(this.source=t.sourceFile)};function getLineInfo(t,n){for(var i=1,r=0;;){var o=nextLineBreak(t,r,n);if(o<0)return new D(i,n-r);++i,r=o}}var j={ecmaVersion:null,sourceType:"script",onInsertedSemicolon:null,onTrailingComma:null,allowReserved:null,allowReturnOutsideFunction:!1,allowImportExportEverywhere:!1,allowAwaitOutsideFunction:null,allowSuperOutsideMethod:null,allowHashBang:!1,checkPrivateFields:!0,locations:!1,onToken:null,onComment:null,ranges:!1,program:null,sourceFile:null,directSourceFile:null,preserveParens:!1},V=!1;function getOptions(t){var n={};for(var i in j)n[i]=t&&M(t,i)?t[i]:j[i];if("latest"===n.ecmaVersion?n.ecmaVersion=1e8:null==n.ecmaVersion?(!V&&"object"==typeof console&&console.warn&&(V=!0,console.warn("Since Acorn 8.0.0, options.ecmaVersion is required.\nDefaulting to 2020, but this will stop working in the future.")),n.ecmaVersion=11):n.ecmaVersion>=2015&&(n.ecmaVersion-=2009),null==n.allowReserved&&(n.allowReserved=n.ecmaVersion<5),t&&null!=t.allowHashBang||(n.allowHashBang=n.ecmaVersion>=14),E(n.onToken)){var r=n.onToken;n.onToken=function(t){return r.push(t)}}return E(n.onComment)&&(n.onComment=function pushComment(t,n){return function(i,r,o,h,c,u){var d={type:i?"Block":"Line",value:r,start:o,end:h};t.locations&&(d.loc=new N(this,c,u)),t.ranges&&(d.range=[o,h]),n.push(d)}}(n,n.onComment)),n}var U=256;function functionFlags(t,n){return 2|(t?4:0)|(n?8:0)}var z=function Parser2(t,n,i){this.options=t=getOptions(t),this.sourceFile=t.sourceFile,this.keywords=wordsRegexp(c[t.ecmaVersion>=6?6:"module"===t.sourceType?"5module":5]);var r="";!0!==t.allowReserved&&(r=o[t.ecmaVersion>=6?6:5===t.ecmaVersion?5:3],"module"===t.sourceType&&(r+=" await")),this.reservedWords=wordsRegexp(r);var h=(r?r+" ":"")+o.strict;this.reservedWordsStrict=wordsRegexp(h),this.reservedWordsStrictBind=wordsRegexp(h+" "+o.strictBind),this.input=String(n),this.containsEsc=!1,i?(this.pos=i,this.lineStart=this.input.lastIndexOf("\n",i-1)+1,this.curLine=this.input.slice(0,this.lineStart).split(w).length):(this.pos=this.lineStart=0,this.curLine=1),this.type=y.eof,this.value=null,this.start=this.end=this.pos,this.startLoc=this.endLoc=this.curPosition(),this.lastTokEndLoc=this.lastTokStartLoc=null,this.lastTokStart=this.lastTokEnd=this.pos,this.context=this.initialContext(),this.exprAllowed=!0,this.inModule="module"===t.sourceType,this.strict=this.inModule||this.strictDirective(this.pos),this.potentialArrowAt=-1,this.potentialArrowInForAwait=!1,this.yieldPos=this.awaitPos=this.awaitIdentPos=0,this.labels=[],this.undefinedExports=Object.create(null),0===this.pos&&t.allowHashBang&&"#!"===this.input.slice(0,2)&&this.skipLineComment(2),this.scopeStack=[],this.enterScope(1),this.regexpState=null,this.privateNameStack=[]},F={inFunction:{configurable:!0},inGenerator:{configurable:!0},inAsync:{configurable:!0},canAwait:{configurable:!0},allowSuper:{configurable:!0},allowDirectSuper:{configurable:!0},treatFunctionsAsVar:{configurable:!0},allowNewDotTarget:{configurable:!0},inClassStaticBlock:{configurable:!0}};z.prototype.parse=function parse22(){var t=this.options.program||this.startNode();return this.nextToken(),this.parseTopLevel(t)},F.inFunction.get=function(){return(2&this.currentVarScope().flags)>0},F.inGenerator.get=function(){return(8&this.currentVarScope().flags)>0&&!this.currentVarScope().inClassFieldInit},F.inAsync.get=function(){return(4&this.currentVarScope().flags)>0&&!this.currentVarScope().inClassFieldInit},F.canAwait.get=function(){for(var t=this.scopeStack.length-1;t>=0;t--){var n=this.scopeStack[t];if(n.inClassFieldInit||n.flags&U)return!1;if(2&n.flags)return(4&n.flags)>0}return this.inModule&&this.options.ecmaVersion>=13||this.options.allowAwaitOutsideFunction},F.allowSuper.get=function(){var t=this.currentThisScope(),n=t.flags,i=t.inClassFieldInit;return(64&n)>0||i||this.options.allowSuperOutsideMethod},F.allowDirectSuper.get=function(){return(128&this.currentThisScope().flags)>0},F.treatFunctionsAsVar.get=function(){return this.treatFunctionsAsVarInScope(this.currentScope())},F.allowNewDotTarget.get=function(){var t=this.currentThisScope(),n=t.flags,i=t.inClassFieldInit;return(258&n)>0||i},F.inClassStaticBlock.get=function(){return(this.currentVarScope().flags&U)>0},z.extend=function extend(){for(var t=[],n=arguments.length;n--;)t[n]=arguments[n];for(var i=this,r=0;r<t.length;r++)i=t[r](i);return i},z.parse=function parse22(t,n){return new this(n,t).parse()},z.parseExpressionAt=function parseExpressionAt2(t,n,i){var r=new this(i,t,n);return r.nextToken(),r.parseExpression()},z.tokenizer=function tokenizer2(t,n){return new this(n,t)},Object.defineProperties(z.prototype,F);var q=z.prototype,W=/^(?:'((?:\\.|[^'\\])*?)'|"((?:\\.|[^"\\])*?)")/;q.strictDirective=function(t){if(this.options.ecmaVersion<5)return!1;for(;;){C.lastIndex=t,t+=C.exec(this.input)[0].length;var n=W.exec(this.input.slice(t));if(!n)return!1;if("use strict"===(n[1]||n[2])){C.lastIndex=t+n[0].length;var i=C.exec(this.input),r=i.index+i[0].length,o=this.input.charAt(r);return";"===o||"}"===o||w.test(i[0])&&!(/[(`.[+\-/*%<>=,?^&]/.test(o)||"!"===o&&"="===this.input.charAt(r+1))}t+=n[0].length,C.lastIndex=t,t+=C.exec(this.input)[0].length,";"===this.input[t]&&t++}},q.eat=function(t){return this.type===t&&(this.next(),!0)},q.isContextual=function(t){return this.type===y.name&&this.value===t&&!this.containsEsc},q.eatContextual=function(t){return!!this.isContextual(t)&&(this.next(),!0)},q.expectContextual=function(t){this.eatContextual(t)||this.unexpected()},q.canInsertSemicolon=function(){return this.type===y.eof||this.type===y.braceR||w.test(this.input.slice(this.lastTokEnd,this.start))},q.insertSemicolon=function(){if(this.canInsertSemicolon())return this.options.onInsertedSemicolon&&this.options.onInsertedSemicolon(this.lastTokEnd,this.lastTokEndLoc),!0},q.semicolon=function(){this.eat(y.semi)||this.insertSemicolon()||this.unexpected()},q.afterTrailingComma=function(t,n){if(this.type===t)return this.options.onTrailingComma&&this.options.onTrailingComma(this.lastTokStart,this.lastTokStartLoc),n||this.next(),!0},q.expect=function(t){this.eat(t)||this.unexpected()},q.unexpected=function(t){this.raise(null!=t?t:this.start,"Unexpected token")};var Y=function DestructuringErrors2(){this.shorthandAssign=this.trailingComma=this.parenthesizedAssign=this.parenthesizedBind=this.doubleProto=-1};q.checkPatternErrors=function(t,n){if(t){t.trailingComma>-1&&this.raiseRecoverable(t.trailingComma,"Comma is not permitted after the rest element");var i=n?t.parenthesizedAssign:t.parenthesizedBind;i>-1&&this.raiseRecoverable(i,n?"Assigning to rvalue":"Parenthesized pattern")}},q.checkExpressionErrors=function(t,n){if(!t)return!1;var i=t.shorthandAssign,r=t.doubleProto;if(!n)return i>=0||r>=0;i>=0&&this.raise(i,"Shorthand property assignments are valid only in destructuring patterns"),r>=0&&this.raiseRecoverable(r,"Redefinition of __proto__ property")},q.checkYieldAwaitInDefaultParams=function(){this.yieldPos&&(!this.awaitPos||this.yieldPos<this.awaitPos)&&this.raise(this.yieldPos,"Yield expression cannot be a default value"),this.awaitPos&&this.raise(this.awaitPos,"Await expression cannot be a default value")},q.isSimpleAssignTarget=function(t){return"ParenthesizedExpression"===t.type?this.isSimpleAssignTarget(t.expression):"Identifier"===t.type||"MemberExpression"===t.type};var H=z.prototype;H.parseTopLevel=function(t){var n=Object.create(null);for(t.body||(t.body=[]);this.type!==y.eof;){var i=this.parseStatement(null,!0,n);t.body.push(i)}if(this.inModule)for(var r=0,o=Object.keys(this.undefinedExports);r<o.length;r+=1){var h=o[r];this.raiseRecoverable(this.undefinedExports[h].start,"Export '"+h+"' is not defined")}return this.adaptDirectivePrologue(t.body),this.next(),t.sourceType=this.options.sourceType,this.finishNode(t,"Program")};var X={kind:"loop"},J={kind:"switch"};H.isLet=function(t){if(this.options.ecmaVersion<6||!this.isContextual("let"))return!1;C.lastIndex=this.pos;var n=C.exec(this.input),i=this.pos+n[0].length,r=this.input.charCodeAt(i);if(91===r||92===r)return!0;if(t)return!1;if(123===r||r>55295&&r<56320)return!0;if(isIdentifierStart(r,!0)){for(var o=i+1;isIdentifierChar(r=this.input.charCodeAt(o),!0);)++o;if(92===r||r>55295&&r<56320)return!0;var h=this.input.slice(i,o);if(!u.test(h))return!0}return!1},H.isAsyncFunction=function(){if(this.options.ecmaVersion<8||!this.isContextual("async"))return!1;C.lastIndex=this.pos;var t,n=C.exec(this.input),i=this.pos+n[0].length;return!(w.test(this.input.slice(this.pos,i))||"function"!==this.input.slice(i,i+8)||i+8!==this.input.length&&(isIdentifierChar(t=this.input.charCodeAt(i+8))||t>55295&&t<56320))},H.parseStatement=function(t,n,i){var r,o=this.type,h=this.startNode();switch(this.isLet(t)&&(o=y._var,r="let"),o){case y._break:case y._continue:return this.parseBreakContinueStatement(h,o.keyword);case y._debugger:return this.parseDebuggerStatement(h);case y._do:return this.parseDoStatement(h);case y._for:return this.parseForStatement(h);case y._function:return t&&(this.strict||"if"!==t&&"label"!==t)&&this.options.ecmaVersion>=6&&this.unexpected(),this.parseFunctionStatement(h,!1,!t);case y._class:return t&&this.unexpected(),this.parseClass(h,!0);case y._if:return this.parseIfStatement(h);case y._return:return this.parseReturnStatement(h);case y._switch:return this.parseSwitchStatement(h);case y._throw:return this.parseThrowStatement(h);case y._try:return this.parseTryStatement(h);case y._const:case y._var:return r=r||this.value,t&&"var"!==r&&this.unexpected(),this.parseVarStatement(h,r);case y._while:return this.parseWhileStatement(h);case y._with:return this.parseWithStatement(h);case y.braceL:return this.parseBlock(!0,h);case y.semi:return this.parseEmptyStatement(h);case y._export:case y._import:if(this.options.ecmaVersion>10&&o===y._import){C.lastIndex=this.pos;var c=C.exec(this.input),u=this.pos+c[0].length,d=this.input.charCodeAt(u);if(40===d||46===d)return this.parseExpressionStatement(h,this.parseExpression())}return this.options.allowImportExportEverywhere||(n||this.raise(this.start,"'import' and 'export' may only appear at the top level"),this.inModule||this.raise(this.start,"'import' and 'export' may appear only with 'sourceType: module'")),o===y._import?this.parseImport(h):this.parseExport(h,i);default:if(this.isAsyncFunction())return t&&this.unexpected(),this.next(),this.parseFunctionStatement(h,!0,!t);var p=this.value,g=this.parseExpression();return o===y.name&&"Identifier"===g.type&&this.eat(y.colon)?this.parseLabeledStatement(h,p,g,t):this.parseExpressionStatement(h,g)}},H.parseBreakContinueStatement=function(t,n){var i="break"===n;this.next(),this.eat(y.semi)||this.insertSemicolon()?t.label=null:this.type!==y.name?this.unexpected():(t.label=this.parseIdent(),this.semicolon());for(var r=0;r<this.labels.length;++r){var o=this.labels[r];if(null==t.label||o.name===t.label.name){if(null!=o.kind&&(i||"loop"===o.kind))break;if(t.label&&i)break}}return r===this.labels.length&&this.raise(t.start,"Unsyntactic "+n),this.finishNode(t,i?"BreakStatement":"ContinueStatement")},H.parseDebuggerStatement=function(t){return this.next(),this.semicolon(),this.finishNode(t,"DebuggerStatement")},H.parseDoStatement=function(t){return this.next(),this.labels.push(X),t.body=this.parseStatement("do"),this.labels.pop(),this.expect(y._while),t.test=this.parseParenExpression(),this.options.ecmaVersion>=6?this.eat(y.semi):this.semicolon(),this.finishNode(t,"DoWhileStatement")},H.parseForStatement=function(t){this.next();var n=this.options.ecmaVersion>=9&&this.canAwait&&this.eatContextual("await")?this.lastTokStart:-1;if(this.labels.push(X),this.enterScope(0),this.expect(y.parenL),this.type===y.semi)return n>-1&&this.unexpected(n),this.parseFor(t,null);var i=this.isLet();if(this.type===y._var||this.type===y._const||i){var r=this.startNode(),o=i?"let":this.value;return this.next(),this.parseVar(r,!0,o),this.finishNode(r,"VariableDeclaration"),(this.type===y._in||this.options.ecmaVersion>=6&&this.isContextual("of"))&&1===r.declarations.length?(this.options.ecmaVersion>=9&&(this.type===y._in?n>-1&&this.unexpected(n):t.await=n>-1),this.parseForIn(t,r)):(n>-1&&this.unexpected(n),this.parseFor(t,r))}var h=this.isContextual("let"),c=!1,u=new Y,d=this.parseExpression(!(n>-1)||"await",u);return this.type===y._in||(c=this.options.ecmaVersion>=6&&this.isContextual("of"))?(this.options.ecmaVersion>=9&&(this.type===y._in?n>-1&&this.unexpected(n):t.await=n>-1),h&&c&&this.raise(d.start,"The left-hand side of a for-of loop may not start with 'let'."),this.toAssignable(d,!1,u),this.checkLValPattern(d),this.parseForIn(t,d)):(this.checkExpressionErrors(u,!0),n>-1&&this.unexpected(n),this.parseFor(t,d))},H.parseFunctionStatement=function(t,n,i){return this.next(),this.parseFunction(t,Q|(i?0:tt),!1,n)},H.parseIfStatement=function(t){return this.next(),t.test=this.parseParenExpression(),t.consequent=this.parseStatement("if"),t.alternate=this.eat(y._else)?this.parseStatement("if"):null,this.finishNode(t,"IfStatement")},H.parseReturnStatement=function(t){return this.inFunction||this.options.allowReturnOutsideFunction||this.raise(this.start,"'return' outside of function"),this.next(),this.eat(y.semi)||this.insertSemicolon()?t.argument=null:(t.argument=this.parseExpression(),this.semicolon()),this.finishNode(t,"ReturnStatement")},H.parseSwitchStatement=function(t){var n;this.next(),t.discriminant=this.parseParenExpression(),t.cases=[],this.expect(y.braceL),this.labels.push(J),this.enterScope(0);for(var i=!1;this.type!==y.braceR;)if(this.type===y._case||this.type===y._default){var r=this.type===y._case;n&&this.finishNode(n,"SwitchCase"),t.cases.push(n=this.startNode()),n.consequent=[],this.next(),r?n.test=this.parseExpression():(i&&this.raiseRecoverable(this.lastTokStart,"Multiple default clauses"),i=!0,n.test=null),this.expect(y.colon)}else n||this.unexpected(),n.consequent.push(this.parseStatement(null));return this.exitScope(),n&&this.finishNode(n,"SwitchCase"),this.next(),this.labels.pop(),this.finishNode(t,"SwitchStatement")},H.parseThrowStatement=function(t){return this.next(),w.test(this.input.slice(this.lastTokEnd,this.start))&&this.raise(this.lastTokEnd,"Illegal newline after throw"),t.argument=this.parseExpression(),this.semicolon(),this.finishNode(t,"ThrowStatement")};var Z=[];H.parseCatchClauseParam=function(){var t=this.parseBindingAtom(),n="Identifier"===t.type;return this.enterScope(n?32:0),this.checkLValPattern(t,n?4:2),this.expect(y.parenR),t},H.parseTryStatement=function(t){if(this.next(),t.block=this.parseBlock(),t.handler=null,this.type===y._catch){var n=this.startNode();this.next(),this.eat(y.parenL)?n.param=this.parseCatchClauseParam():(this.options.ecmaVersion<10&&this.unexpected(),n.param=null,this.enterScope(0)),n.body=this.parseBlock(!1),this.exitScope(),t.handler=this.finishNode(n,"CatchClause")}return t.finalizer=this.eat(y._finally)?this.parseBlock():null,t.handler||t.finalizer||this.raise(t.start,"Missing catch or finally clause"),this.finishNode(t,"TryStatement")},H.parseVarStatement=function(t,n,i){return this.next(),this.parseVar(t,!1,n,i),this.semicolon(),this.finishNode(t,"VariableDeclaration")},H.parseWhileStatement=function(t){return this.next(),t.test=this.parseParenExpression(),this.labels.push(X),t.body=this.parseStatement("while"),this.labels.pop(),this.finishNode(t,"WhileStatement")},H.parseWithStatement=function(t){return this.strict&&this.raise(this.start,"'with' in strict mode"),this.next(),t.object=this.parseParenExpression(),t.body=this.parseStatement("with"),this.finishNode(t,"WithStatement")},H.parseEmptyStatement=function(t){return this.next(),this.finishNode(t,"EmptyStatement")},H.parseLabeledStatement=function(t,n,i,r){for(var o=0,h=this.labels;o<h.length;o+=1)h[o].name===n&&this.raise(i.start,"Label '"+n+"' is already declared");for(var c=this.type.isLoop?"loop":this.type===y._switch?"switch":null,u=this.labels.length-1;u>=0;u--){var d=this.labels[u];if(d.statementStart!==t.start)break;d.statementStart=this.start,d.kind=c}return this.labels.push({name:n,kind:c,statementStart:this.start}),t.body=this.parseStatement(r?-1===r.indexOf("label")?r+"label":r:"label"),this.labels.pop(),t.label=i,this.finishNode(t,"LabeledStatement")},H.parseExpressionStatement=function(t,n){return t.expression=n,this.semicolon(),this.finishNode(t,"ExpressionStatement")},H.parseBlock=function(t,n,i){for(void 0===t&&(t=!0),void 0===n&&(n=this.startNode()),n.body=[],this.expect(y.braceL),t&&this.enterScope(0);this.type!==y.braceR;){var r=this.parseStatement(null);n.body.push(r)}return i&&(this.strict=!1),this.next(),t&&this.exitScope(),this.finishNode(n,"BlockStatement")},H.parseFor=function(t,n){return t.init=n,this.expect(y.semi),t.test=this.type===y.semi?null:this.parseExpression(),this.expect(y.semi),t.update=this.type===y.parenR?null:this.parseExpression(),this.expect(y.parenR),t.body=this.parseStatement("for"),this.exitScope(),this.labels.pop(),this.finishNode(t,"ForStatement")},H.parseForIn=function(t,n){var i=this.type===y._in;return this.next(),"VariableDeclaration"===n.type&&null!=n.declarations[0].init&&(!i||this.options.ecmaVersion<8||this.strict||"var"!==n.kind||"Identifier"!==n.declarations[0].id.type)&&this.raise(n.start,(i?"for-in":"for-of")+" loop variable declaration may not have an initializer"),t.left=n,t.right=i?this.parseExpression():this.parseMaybeAssign(),this.expect(y.parenR),t.body=this.parseStatement("for"),this.exitScope(),this.labels.pop(),this.finishNode(t,i?"ForInStatement":"ForOfStatement")},H.parseVar=function(t,n,i,r){for(t.declarations=[],t.kind=i;;){var o=this.startNode();if(this.parseVarId(o,i),this.eat(y.eq)?o.init=this.parseMaybeAssign(n):r||"const"!==i||this.type===y._in||this.options.ecmaVersion>=6&&this.isContextual("of")?r||"Identifier"===o.id.type||n&&(this.type===y._in||this.isContextual("of"))?o.init=null:this.raise(this.lastTokEnd,"Complex binding patterns require an initialization value"):this.unexpected(),t.declarations.push(this.finishNode(o,"VariableDeclarator")),!this.eat(y.comma))break}return t},H.parseVarId=function(t,n){t.id=this.parseBindingAtom(),this.checkLValPattern(t.id,"var"===n?1:2,!1)};var Q=1,tt=2;function isPrivateNameConflicted(t,n){var i=n.key.name,r=t[i],o="true";return"MethodDefinition"!==n.type||"get"!==n.kind&&"set"!==n.kind||(o=(n.static?"s":"i")+n.kind),"iget"===r&&"iset"===o||"iset"===r&&"iget"===o||"sget"===r&&"sset"===o||"sset"===r&&"sget"===o?(t[i]="true",!1):!!r||(t[i]=o,!1)}function checkKeyName(t,n){var i=t.computed,r=t.key;return!i&&("Identifier"===r.type&&r.name===n||"Literal"===r.type&&r.value===n)}H.parseFunction=function(t,n,i,r,o){this.initFunction(t),(this.options.ecmaVersion>=9||this.options.ecmaVersion>=6&&!r)&&(this.type===y.star&&n&tt&&this.unexpected(),t.generator=this.eat(y.star)),this.options.ecmaVersion>=8&&(t.async=!!r),n&Q&&(t.id=4&n&&this.type!==y.name?null:this.parseIdent(),!t.id||n&tt||this.checkLValSimple(t.id,this.strict||t.generator||t.async?this.treatFunctionsAsVar?1:2:3));var h=this.yieldPos,c=this.awaitPos,u=this.awaitIdentPos;return this.yieldPos=0,this.awaitPos=0,this.awaitIdentPos=0,this.enterScope(functionFlags(t.async,t.generator)),n&Q||(t.id=this.type===y.name?this.parseIdent():null),this.parseFunctionParams(t),this.parseFunctionBody(t,i,!1,o),this.yieldPos=h,this.awaitPos=c,this.awaitIdentPos=u,this.finishNode(t,n&Q?"FunctionDeclaration":"FunctionExpression")},H.parseFunctionParams=function(t){this.expect(y.parenL),t.params=this.parseBindingList(y.parenR,!1,this.options.ecmaVersion>=8),this.checkYieldAwaitInDefaultParams()},H.parseClass=function(t,n){this.next();var i=this.strict;this.strict=!0,this.parseClassId(t,n),this.parseClassSuper(t);var r=this.enterClassBody(),o=this.startNode(),h=!1;for(o.body=[],this.expect(y.braceL);this.type!==y.braceR;){var c=this.parseClassElement(null!==t.superClass);c&&(o.body.push(c),"MethodDefinition"===c.type&&"constructor"===c.kind?(h&&this.raiseRecoverable(c.start,"Duplicate constructor in the same class"),h=!0):c.key&&"PrivateIdentifier"===c.key.type&&isPrivateNameConflicted(r,c)&&this.raiseRecoverable(c.key.start,"Identifier '#"+c.key.name+"' has already been declared"))}return this.strict=i,this.next(),t.body=this.finishNode(o,"ClassBody"),this.exitClassBody(),this.finishNode(t,n?"ClassDeclaration":"ClassExpression")},H.parseClassElement=function(t){if(this.eat(y.semi))return null;var n=this.options.ecmaVersion,i=this.startNode(),r="",o=!1,h=!1,c="method",u=!1;if(this.eatContextual("static")){if(n>=13&&this.eat(y.braceL))return this.parseClassStaticBlock(i),i;this.isClassElementNameStart()||this.type===y.star?u=!0:r="static"}if(i.static=u,!r&&n>=8&&this.eatContextual("async")&&(!this.isClassElementNameStart()&&this.type!==y.star||this.canInsertSemicolon()?r="async":h=!0),!r&&(n>=9||!h)&&this.eat(y.star)&&(o=!0),!r&&!h&&!o){var d=this.value;(this.eatContextual("get")||this.eatContextual("set"))&&(this.isClassElementNameStart()?c=d:r=d)}if(r?(i.computed=!1,i.key=this.startNodeAt(this.lastTokStart,this.lastTokStartLoc),i.key.name=r,this.finishNode(i.key,"Identifier")):this.parseClassElementName(i),n<13||this.type===y.parenL||"method"!==c||o||h){var p=!i.static&&checkKeyName(i,"constructor"),g=p&&t;p&&"method"!==c&&this.raise(i.key.start,"Constructor can't have get/set modifier"),i.kind=p?"constructor":c,this.parseClassMethod(i,o,h,g)}else this.parseClassField(i);return i},H.isClassElementNameStart=function(){return this.type===y.name||this.type===y.privateId||this.type===y.num||this.type===y.string||this.type===y.bracketL||this.type.keyword},H.parseClassElementName=function(t){this.type===y.privateId?("constructor"===this.value&&this.raise(this.start,"Classes can't have an element named '#constructor'"),t.computed=!1,t.key=this.parsePrivateIdent()):this.parsePropertyName(t)},H.parseClassMethod=function(t,n,i,r){var o=t.key;"constructor"===t.kind?(n&&this.raise(o.start,"Constructor can't be a generator"),i&&this.raise(o.start,"Constructor can't be an async method")):t.static&&checkKeyName(t,"prototype")&&this.raise(o.start,"Classes may not have a static property named prototype");var h=t.value=this.parseMethod(n,i,r);return"get"===t.kind&&0!==h.params.length&&this.raiseRecoverable(h.start,"getter should have no params"),"set"===t.kind&&1!==h.params.length&&this.raiseRecoverable(h.start,"setter should have exactly one param"),"set"===t.kind&&"RestElement"===h.params[0].type&&this.raiseRecoverable(h.params[0].start,"Setter cannot use rest params"),this.finishNode(t,"MethodDefinition")},H.parseClassField=function(t){if(checkKeyName(t,"constructor")?this.raise(t.key.start,"Classes can't have a field named 'constructor'"):t.static&&checkKeyName(t,"prototype")&&this.raise(t.key.start,"Classes can't have a static field named 'prototype'"),this.eat(y.eq)){var n=this.currentThisScope(),i=n.inClassFieldInit;n.inClassFieldInit=!0,t.value=this.parseMaybeAssign(),n.inClassFieldInit=i}else t.value=null;return this.semicolon(),this.finishNode(t,"PropertyDefinition")},H.parseClassStaticBlock=function(t){t.body=[];var n=this.labels;for(this.labels=[],this.enterScope(320);this.type!==y.braceR;){var i=this.parseStatement(null);t.body.push(i)}return this.next(),this.exitScope(),this.labels=n,this.finishNode(t,"StaticBlock")},H.parseClassId=function(t,n){this.type===y.name?(t.id=this.parseIdent(),n&&this.checkLValSimple(t.id,2,!1)):(!0===n&&this.unexpected(),t.id=null)},H.parseClassSuper=function(t){t.superClass=this.eat(y._extends)?this.parseExprSubscripts(null,!1):null},H.enterClassBody=function(){var t={declared:Object.create(null),used:[]};return this.privateNameStack.push(t),t.declared},H.exitClassBody=function(){var t=this.privateNameStack.pop(),n=t.declared,i=t.used;if(this.options.checkPrivateFields)for(var r=this.privateNameStack.length,o=0===r?null:this.privateNameStack[r-1],h=0;h<i.length;++h){var c=i[h];M(n,c.name)||(o?o.used.push(c):this.raiseRecoverable(c.start,"Private field '#"+c.name+"' must be declared in an enclosing class"))}},H.parseExportAllDeclaration=function(t,n){return this.options.ecmaVersion>=11&&(this.eatContextual("as")?(t.exported=this.parseModuleExportName(),this.checkExport(n,t.exported,this.lastTokStart)):t.exported=null),this.expectContextual("from"),this.type!==y.string&&this.unexpected(),t.source=this.parseExprAtom(),this.semicolon(),this.finishNode(t,"ExportAllDeclaration")},H.parseExport=function(t,n){if(this.next(),this.eat(y.star))return this.parseExportAllDeclaration(t,n);if(this.eat(y._default))return this.checkExport(n,"default",this.lastTokStart),t.declaration=this.parseExportDefaultDeclaration(),this.finishNode(t,"ExportDefaultDeclaration");if(this.shouldParseExportStatement())t.declaration=this.parseExportDeclaration(t),"VariableDeclaration"===t.declaration.type?this.checkVariableExport(n,t.declaration.declarations):this.checkExport(n,t.declaration.id,t.declaration.id.start),t.specifiers=[],t.source=null;else{if(t.declaration=null,t.specifiers=this.parseExportSpecifiers(n),this.eatContextual("from"))this.type!==y.string&&this.unexpected(),t.source=this.parseExprAtom();else{for(var i=0,r=t.specifiers;i<r.length;i+=1){var o=r[i];this.checkUnreserved(o.local),this.checkLocalExport(o.local),"Literal"===o.local.type&&this.raise(o.local.start,"A string literal cannot be used as an exported binding without `from`.")}t.source=null}this.semicolon()}return this.finishNode(t,"ExportNamedDeclaration")},H.parseExportDeclaration=function(t){return this.parseStatement(null)},H.parseExportDefaultDeclaration=function(){var t;if(this.type===y._function||(t=this.isAsyncFunction())){var n=this.startNode();return this.next(),t&&this.next(),this.parseFunction(n,4|Q,!1,t)}if(this.type===y._class){var i=this.startNode();return this.parseClass(i,"nullableID")}var r=this.parseMaybeAssign();return this.semicolon(),r},H.checkExport=function(t,n,i){t&&("string"!=typeof n&&(n="Identifier"===n.type?n.name:n.value),M(t,n)&&this.raiseRecoverable(i,"Duplicate export '"+n+"'"),t[n]=!0)},H.checkPatternExport=function(t,n){var i=n.type;if("Identifier"===i)this.checkExport(t,n,n.start);else if("ObjectPattern"===i)for(var r=0,o=n.properties;r<o.length;r+=1){var h=o[r];this.checkPatternExport(t,h)}else if("ArrayPattern"===i)for(var c=0,u=n.elements;c<u.length;c+=1){var d=u[c];d&&this.checkPatternExport(t,d)}else"Property"===i?this.checkPatternExport(t,n.value):"AssignmentPattern"===i?this.checkPatternExport(t,n.left):"RestElement"===i&&this.checkPatternExport(t,n.argument)},H.checkVariableExport=function(t,n){if(t)for(var i=0,r=n;i<r.length;i+=1){var o=r[i];this.checkPatternExport(t,o.id)}},H.shouldParseExportStatement=function(){return"var"===this.type.keyword||"const"===this.type.keyword||"class"===this.type.keyword||"function"===this.type.keyword||this.isLet()||this.isAsyncFunction()},H.parseExportSpecifier=function(t){var n=this.startNode();return n.local=this.parseModuleExportName(),n.exported=this.eatContextual("as")?this.parseModuleExportName():n.local,this.checkExport(t,n.exported,n.exported.start),this.finishNode(n,"ExportSpecifier")},H.parseExportSpecifiers=function(t){var n=[],i=!0;for(this.expect(y.braceL);!this.eat(y.braceR);){if(i)i=!1;else if(this.expect(y.comma),this.afterTrailingComma(y.braceR))break;n.push(this.parseExportSpecifier(t))}return n},H.parseImport=function(t){return this.next(),this.type===y.string?(t.specifiers=Z,t.source=this.parseExprAtom()):(t.specifiers=this.parseImportSpecifiers(),this.expectContextual("from"),t.source=this.type===y.string?this.parseExprAtom():this.unexpected()),this.semicolon(),this.finishNode(t,"ImportDeclaration")},H.parseImportSpecifier=function(){var t=this.startNode();return t.imported=this.parseModuleExportName(),this.eatContextual("as")?t.local=this.parseIdent():(this.checkUnreserved(t.imported),t.local=t.imported),this.checkLValSimple(t.local,2),this.finishNode(t,"ImportSpecifier")},H.parseImportDefaultSpecifier=function(){var t=this.startNode();return t.local=this.parseIdent(),this.checkLValSimple(t.local,2),this.finishNode(t,"ImportDefaultSpecifier")},H.parseImportNamespaceSpecifier=function(){var t=this.startNode();return this.next(),this.expectContextual("as"),t.local=this.parseIdent(),this.checkLValSimple(t.local,2),this.finishNode(t,"ImportNamespaceSpecifier")},H.parseImportSpecifiers=function(){var t=[],n=!0;if(this.type===y.name&&(t.push(this.parseImportDefaultSpecifier()),!this.eat(y.comma)))return t;if(this.type===y.star)return t.push(this.parseImportNamespaceSpecifier()),t;for(this.expect(y.braceL);!this.eat(y.braceR);){if(n)n=!1;else if(this.expect(y.comma),this.afterTrailingComma(y.braceR))break;t.push(this.parseImportSpecifier())}return t},H.parseModuleExportName=function(){if(this.options.ecmaVersion>=13&&this.type===y.string){var t=this.parseLiteral(this.value);return O.test(t.value)&&this.raise(t.start,"An export name cannot include a lone surrogate."),t}return this.parseIdent(!0)},H.adaptDirectivePrologue=function(t){for(var n=0;n<t.length&&this.isDirectiveCandidate(t[n]);++n)t[n].directive=t[n].expression.raw.slice(1,-1)},H.isDirectiveCandidate=function(t){return this.options.ecmaVersion>=5&&"ExpressionStatement"===t.type&&"Literal"===t.expression.type&&"string"==typeof t.expression.value&&('"'===this.input[t.start]||"'"===this.input[t.start])};var et=z.prototype;et.toAssignable=function(t,n,i){if(this.options.ecmaVersion>=6&&t)switch(t.type){case"Identifier":this.inAsync&&"await"===t.name&&this.raise(t.start,"Cannot use 'await' as identifier inside an async function");break;case"ObjectPattern":case"ArrayPattern":case"AssignmentPattern":case"RestElement":break;case"ObjectExpression":t.type="ObjectPattern",i&&this.checkPatternErrors(i,!0);for(var r=0,o=t.properties;r<o.length;r+=1){var h=o[r];this.toAssignable(h,n),"RestElement"!==h.type||"ArrayPattern"!==h.argument.type&&"ObjectPattern"!==h.argument.type||this.raise(h.argument.start,"Unexpected token")}break;case"Property":"init"!==t.kind&&this.raise(t.key.start,"Object pattern can't contain getter or setter"),this.toAssignable(t.value,n);break;case"ArrayExpression":t.type="ArrayPattern",i&&this.checkPatternErrors(i,!0),this.toAssignableList(t.elements,n);break;case"SpreadElement":t.type="RestElement",this.toAssignable(t.argument,n),"AssignmentPattern"===t.argument.type&&this.raise(t.argument.start,"Rest elements cannot have a default value");break;case"AssignmentExpression":"="!==t.operator&&this.raise(t.left.end,"Only '=' operator can be used for specifying default value."),t.type="AssignmentPattern",delete t.operator,this.toAssignable(t.left,n);break;case"ParenthesizedExpression":this.toAssignable(t.expression,n,i);break;case"ChainExpression":this.raiseRecoverable(t.start,"Optional chaining cannot appear in left-hand side");break;case"MemberExpression":if(!n)break;default:this.raise(t.start,"Assigning to rvalue")}else i&&this.checkPatternErrors(i,!0);return t},et.toAssignableList=function(t,n){for(var i=t.length,r=0;r<i;r++){var o=t[r];o&&this.toAssignable(o,n)}if(i){var h=t[i-1];6===this.options.ecmaVersion&&n&&h&&"RestElement"===h.type&&"Identifier"!==h.argument.type&&this.unexpected(h.argument.start)}return t},et.parseSpread=function(t){var n=this.startNode();return this.next(),n.argument=this.parseMaybeAssign(!1,t),this.finishNode(n,"SpreadElement")},et.parseRestBinding=function(){var t=this.startNode();return this.next(),6===this.options.ecmaVersion&&this.type!==y.name&&this.unexpected(),t.argument=this.parseBindingAtom(),this.finishNode(t,"RestElement")},et.parseBindingAtom=function(){if(this.options.ecmaVersion>=6)switch(this.type){case y.bracketL:var t=this.startNode();return this.next(),t.elements=this.parseBindingList(y.bracketR,!0,!0),this.finishNode(t,"ArrayPattern");case y.braceL:return this.parseObj(!0)}return this.parseIdent()},et.parseBindingList=function(t,n,i,r){for(var o=[],h=!0;!this.eat(t);)if(h?h=!1:this.expect(y.comma),n&&this.type===y.comma)o.push(null);else{if(i&&this.afterTrailingComma(t))break;if(this.type===y.ellipsis){var c=this.parseRestBinding();this.parseBindingListItem(c),o.push(c),this.type===y.comma&&this.raiseRecoverable(this.start,"Comma is not permitted after the rest element"),this.expect(t);break}o.push(this.parseAssignableListItem(r))}return o},et.parseAssignableListItem=function(t){var n=this.parseMaybeDefault(this.start,this.startLoc);return this.parseBindingListItem(n),n},et.parseBindingListItem=function(t){return t},et.parseMaybeDefault=function(t,n,i){if(i=i||this.parseBindingAtom(),this.options.ecmaVersion<6||!this.eat(y.eq))return i;var r=this.startNodeAt(t,n);return r.left=i,r.right=this.parseMaybeAssign(),this.finishNode(r,"AssignmentPattern")},et.checkLValSimple=function(t,n,i){void 0===n&&(n=0);var r=0!==n;switch(t.type){case"Identifier":this.strict&&this.reservedWordsStrictBind.test(t.name)&&this.raiseRecoverable(t.start,(r?"Binding ":"Assigning to ")+t.name+" in strict mode"),r&&(2===n&&"let"===t.name&&this.raiseRecoverable(t.start,"let is disallowed as a lexically bound name"),i&&(M(i,t.name)&&this.raiseRecoverable(t.start,"Argument name clash"),i[t.name]=!0),5!==n&&this.declareName(t.name,n,t.start));break;case"ChainExpression":this.raiseRecoverable(t.start,"Optional chaining cannot appear in left-hand side");break;case"MemberExpression":r&&this.raiseRecoverable(t.start,"Binding member expression");break;case"ParenthesizedExpression":return r&&this.raiseRecoverable(t.start,"Binding parenthesized expression"),this.checkLValSimple(t.expression,n,i);default:this.raise(t.start,(r?"Binding":"Assigning to")+" rvalue")}},et.checkLValPattern=function(t,n,i){switch(void 0===n&&(n=0),t.type){case"ObjectPattern":for(var r=0,o=t.properties;r<o.length;r+=1){var h=o[r];this.checkLValInnerPattern(h,n,i)}break;case"ArrayPattern":for(var c=0,u=t.elements;c<u.length;c+=1){var d=u[c];d&&this.checkLValInnerPattern(d,n,i)}break;default:this.checkLValSimple(t,n,i)}},et.checkLValInnerPattern=function(t,n,i){switch(void 0===n&&(n=0),t.type){case"Property":this.checkLValInnerPattern(t.value,n,i);break;case"AssignmentPattern":this.checkLValPattern(t.left,n,i);break;case"RestElement":this.checkLValPattern(t.argument,n,i);break;default:this.checkLValPattern(t,n,i)}};var nt=function TokContext2(t,n,i,r,o){this.token=t,this.isExpr=!!n,this.preserveSpace=!!i,this.override=r,this.generator=!!o},it={b_stat:new nt("{",!1),b_expr:new nt("{",!0),b_tmpl:new nt("${",!1),p_stat:new nt("(",!1),p_expr:new nt("(",!0),q_tmpl:new nt("`",!0,!0,(function(t){return t.tryReadTemplateToken()})),f_stat:new nt("function",!1),f_expr:new nt("function",!0),f_expr_gen:new nt("function",!0,!1,null,!0),f_gen:new nt("function",!1,!1,null,!0)},rt=z.prototype;rt.initialContext=function(){return[it.b_stat]},rt.curContext=function(){return this.context[this.context.length-1]},rt.braceIsBlock=function(t){var n=this.curContext();return n===it.f_expr||n===it.f_stat||(t!==y.colon||n!==it.b_stat&&n!==it.b_expr?t===y._return||t===y.name&&this.exprAllowed?w.test(this.input.slice(this.lastTokEnd,this.start)):t===y._else||t===y.semi||t===y.eof||t===y.parenR||t===y.arrow||(t===y.braceL?n===it.b_stat:t!==y._var&&t!==y._const&&t!==y.name&&!this.exprAllowed):!n.isExpr)},rt.inGeneratorContext=function(){for(var t=this.context.length-1;t>=1;t--){var n=this.context[t];if("function"===n.token)return n.generator}return!1},rt.updateContext=function(t){var n,i=this.type;i.keyword&&t===y.dot?this.exprAllowed=!1:(n=i.updateContext)?n.call(this,t):this.exprAllowed=i.beforeExpr},rt.overrideContext=function(t){this.curContext()!==t&&(this.context[this.context.length-1]=t)},y.parenR.updateContext=y.braceR.updateContext=function(){if(1!==this.context.length){var t=this.context.pop();t===it.b_stat&&"function"===this.curContext().token&&(t=this.context.pop()),this.exprAllowed=!t.isExpr}else this.exprAllowed=!0},y.braceL.updateContext=function(t){this.context.push(this.braceIsBlock(t)?it.b_stat:it.b_expr),this.exprAllowed=!0},y.dollarBraceL.updateContext=function(){this.context.push(it.b_tmpl),this.exprAllowed=!0},y.parenL.updateContext=function(t){var n=t===y._if||t===y._for||t===y._with||t===y._while;this.context.push(n?it.p_stat:it.p_expr),this.exprAllowed=!0},y.incDec.updateContext=function(){},y._function.updateContext=y._class.updateContext=function(t){!t.beforeExpr||t===y._else||t===y.semi&&this.curContext()!==it.p_stat||t===y._return&&w.test(this.input.slice(this.lastTokEnd,this.start))||(t===y.colon||t===y.braceL)&&this.curContext()===it.b_stat?this.context.push(it.f_stat):this.context.push(it.f_expr),this.exprAllowed=!1},y.colon.updateContext=function(){"function"===this.curContext().token&&this.context.pop(),this.exprAllowed=!0},y.backQuote.updateContext=function(){this.curContext()===it.q_tmpl?this.context.pop():this.context.push(it.q_tmpl),this.exprAllowed=!1},y.star.updateContext=function(t){if(t===y._function){var n=this.context.length-1;this.context[n]===it.f_expr?this.context[n]=it.f_expr_gen:this.context[n]=it.f_gen}this.exprAllowed=!0},y.name.updateContext=function(t){var n=!1;this.options.ecmaVersion>=6&&t!==y.dot&&("of"===this.value&&!this.exprAllowed||"yield"===this.value&&this.inGeneratorContext())&&(n=!0),this.exprAllowed=n};var st=z.prototype;function isPrivateFieldAccess(t){return"MemberExpression"===t.type&&"PrivateIdentifier"===t.property.type||"ChainExpression"===t.type&&isPrivateFieldAccess(t.expression)}st.checkPropClash=function(t,n,i){if(!(this.options.ecmaVersion>=9&&"SpreadElement"===t.type||this.options.ecmaVersion>=6&&(t.computed||t.method||t.shorthand))){var r,o=t.key;switch(o.type){case"Identifier":r=o.name;break;case"Literal":r=String(o.value);break;default:return}var h=t.kind;if(this.options.ecmaVersion>=6)"__proto__"===r&&"init"===h&&(n.proto&&(i?i.doubleProto<0&&(i.doubleProto=o.start):this.raiseRecoverable(o.start,"Redefinition of __proto__ property")),n.proto=!0);else{var c=n[r="$"+r];c?("init"===h?this.strict&&c.init||c.get||c.set:c.init||c[h])&&this.raiseRecoverable(o.start,"Redefinition of property"):c=n[r]={init:!1,get:!1,set:!1},c[h]=!0}}},st.parseExpression=function(t,n){var i=this.start,r=this.startLoc,o=this.parseMaybeAssign(t,n);if(this.type===y.comma){var h=this.startNodeAt(i,r);for(h.expressions=[o];this.eat(y.comma);)h.expressions.push(this.parseMaybeAssign(t,n));return this.finishNode(h,"SequenceExpression")}return o},st.parseMaybeAssign=function(t,n,i){if(this.isContextual("yield")){if(this.inGenerator)return this.parseYield(t);this.exprAllowed=!1}var r=!1,o=-1,h=-1,c=-1;n?(o=n.parenthesizedAssign,h=n.trailingComma,c=n.doubleProto,n.parenthesizedAssign=n.trailingComma=-1):(n=new Y,r=!0);var u=this.start,d=this.startLoc;this.type!==y.parenL&&this.type!==y.name||(this.potentialArrowAt=this.start,this.potentialArrowInForAwait="await"===t);var p=this.parseMaybeConditional(t,n);if(i&&(p=i.call(this,p,u,d)),this.type.isAssign){var g=this.startNodeAt(u,d);return g.operator=this.value,this.type===y.eq&&(p=this.toAssignable(p,!1,n)),r||(n.parenthesizedAssign=n.trailingComma=n.doubleProto=-1),n.shorthandAssign>=p.start&&(n.shorthandAssign=-1),this.type===y.eq?this.checkLValPattern(p):this.checkLValSimple(p),g.left=p,this.next(),g.right=this.parseMaybeAssign(t),c>-1&&(n.doubleProto=c),this.finishNode(g,"AssignmentExpression")}return r&&this.checkExpressionErrors(n,!0),o>-1&&(n.parenthesizedAssign=o),h>-1&&(n.trailingComma=h),p},st.parseMaybeConditional=function(t,n){var i=this.start,r=this.startLoc,o=this.parseExprOps(t,n);if(this.checkExpressionErrors(n))return o;if(this.eat(y.question)){var h=this.startNodeAt(i,r);return h.test=o,h.consequent=this.parseMaybeAssign(),this.expect(y.colon),h.alternate=this.parseMaybeAssign(t),this.finishNode(h,"ConditionalExpression")}return o},st.parseExprOps=function(t,n){var i=this.start,r=this.startLoc,o=this.parseMaybeUnary(n,!1,!1,t);return this.checkExpressionErrors(n)||o.start===i&&"ArrowFunctionExpression"===o.type?o:this.parseExprOp(o,i,r,-1,t)},st.parseExprOp=function(t,n,i,r,o){var h=this.type.binop;if(null!=h&&(!o||this.type!==y._in)&&h>r){var c=this.type===y.logicalOR||this.type===y.logicalAND,u=this.type===y.coalesce;u&&(h=y.logicalAND.binop);var d=this.value;this.next();var p=this.start,g=this.startLoc,m=this.parseExprOp(this.parseMaybeUnary(null,!1,!1,o),p,g,h,o),v=this.buildBinary(n,i,t,m,d,c||u);return(c&&this.type===y.coalesce||u&&(this.type===y.logicalOR||this.type===y.logicalAND))&&this.raiseRecoverable(this.start,"Logical expressions and coalesce expressions cannot be mixed. Wrap either by parentheses"),this.parseExprOp(v,n,i,r,o)}return t},st.buildBinary=function(t,n,i,r,o,h){"PrivateIdentifier"===r.type&&this.raise(r.start,"Private identifier can only be left side of binary expression");var c=this.startNodeAt(t,n);return c.left=i,c.operator=o,c.right=r,this.finishNode(c,h?"LogicalExpression":"BinaryExpression")},st.parseMaybeUnary=function(t,n,i,r){var o,h=this.start,c=this.startLoc;if(this.isContextual("await")&&this.canAwait)o=this.parseAwait(r),n=!0;else if(this.type.prefix){var u=this.startNode(),d=this.type===y.incDec;u.operator=this.value,u.prefix=!0,this.next(),u.argument=this.parseMaybeUnary(null,!0,d,r),this.checkExpressionErrors(t,!0),d?this.checkLValSimple(u.argument):this.strict&&"delete"===u.operator&&"Identifier"===u.argument.type?this.raiseRecoverable(u.start,"Deleting local variable in strict mode"):"delete"===u.operator&&isPrivateFieldAccess(u.argument)?this.raiseRecoverable(u.start,"Private fields can not be deleted"):n=!0,o=this.finishNode(u,d?"UpdateExpression":"UnaryExpression")}else if(n||this.type!==y.privateId){if(o=this.parseExprSubscripts(t,r),this.checkExpressionErrors(t))return o;for(;this.type.postfix&&!this.canInsertSemicolon();){var p=this.startNodeAt(h,c);p.operator=this.value,p.prefix=!1,p.argument=o,this.checkLValSimple(o),this.next(),o=this.finishNode(p,"UpdateExpression")}}else(r||0===this.privateNameStack.length)&&this.options.checkPrivateFields&&this.unexpected(),o=this.parsePrivateIdent(),this.type!==y._in&&this.unexpected();return i||!this.eat(y.starstar)?o:n?void this.unexpected(this.lastTokStart):this.buildBinary(h,c,o,this.parseMaybeUnary(null,!1,!1,r),"**",!1)},st.parseExprSubscripts=function(t,n){var i=this.start,r=this.startLoc,o=this.parseExprAtom(t,n);if("ArrowFunctionExpression"===o.type&&")"!==this.input.slice(this.lastTokStart,this.lastTokEnd))return o;var h=this.parseSubscripts(o,i,r,!1,n);return t&&"MemberExpression"===h.type&&(t.parenthesizedAssign>=h.start&&(t.parenthesizedAssign=-1),t.parenthesizedBind>=h.start&&(t.parenthesizedBind=-1),t.trailingComma>=h.start&&(t.trailingComma=-1)),h},st.parseSubscripts=function(t,n,i,r,o){for(var h=this.options.ecmaVersion>=8&&"Identifier"===t.type&&"async"===t.name&&this.lastTokEnd===t.end&&!this.canInsertSemicolon()&&t.end-t.start==5&&this.potentialArrowAt===t.start,c=!1;;){var u=this.parseSubscript(t,n,i,r,h,c,o);if(u.optional&&(c=!0),u===t||"ArrowFunctionExpression"===u.type){if(c){var d=this.startNodeAt(n,i);d.expression=u,u=this.finishNode(d,"ChainExpression")}return u}t=u}},st.shouldParseAsyncArrow=function(){return!this.canInsertSemicolon()&&this.eat(y.arrow)},st.parseSubscriptAsyncArrow=function(t,n,i,r){return this.parseArrowExpression(this.startNodeAt(t,n),i,!0,r)},st.parseSubscript=function(t,n,i,r,o,h,c){var u=this.options.ecmaVersion>=11,d=u&&this.eat(y.questionDot);r&&d&&this.raise(this.lastTokStart,"Optional chaining cannot appear in the callee of new expressions");var p=this.eat(y.bracketL);if(p||d&&this.type!==y.parenL&&this.type!==y.backQuote||this.eat(y.dot)){var g=this.startNodeAt(n,i);g.object=t,p?(g.property=this.parseExpression(),this.expect(y.bracketR)):this.type===y.privateId&&"Super"!==t.type?g.property=this.parsePrivateIdent():g.property=this.parseIdent("never"!==this.options.allowReserved),g.computed=!!p,u&&(g.optional=d),t=this.finishNode(g,"MemberExpression")}else if(!r&&this.eat(y.parenL)){var m=new Y,v=this.yieldPos,_=this.awaitPos,w=this.awaitIdentPos;this.yieldPos=0,this.awaitPos=0,this.awaitIdentPos=0;var x=this.parseExprList(y.parenR,this.options.ecmaVersion>=8,!1,m);if(o&&!d&&this.shouldParseAsyncArrow())return this.checkPatternErrors(m,!1),this.checkYieldAwaitInDefaultParams(),this.awaitIdentPos>0&&this.raise(this.awaitIdentPos,"Cannot use 'await' as identifier inside an async function"),this.yieldPos=v,this.awaitPos=_,this.awaitIdentPos=w,this.parseSubscriptAsyncArrow(n,i,x,c);this.checkExpressionErrors(m,!0),this.yieldPos=v||this.yieldPos,this.awaitPos=_||this.awaitPos,this.awaitIdentPos=w||this.awaitIdentPos;var S=this.startNodeAt(n,i);S.callee=t,S.arguments=x,u&&(S.optional=d),t=this.finishNode(S,"CallExpression")}else if(this.type===y.backQuote){(d||h)&&this.raise(this.start,"Optional chaining cannot appear in the tag of tagged template expressions");var C=this.startNodeAt(n,i);C.tag=t,C.quasi=this.parseTemplate({isTagged:!0}),t=this.finishNode(C,"TaggedTemplateExpression")}return t},st.parseExprAtom=function(t,n,i){this.type===y.slash&&this.readRegexp();var r,o=this.potentialArrowAt===this.start;switch(this.type){case y._super:return this.allowSuper||this.raise(this.start,"'super' keyword outside a method"),r=this.startNode(),this.next(),this.type!==y.parenL||this.allowDirectSuper||this.raise(r.start,"super() call outside constructor of a subclass"),this.type!==y.dot&&this.type!==y.bracketL&&this.type!==y.parenL&&this.unexpected(),this.finishNode(r,"Super");case y._this:return r=this.startNode(),this.next(),this.finishNode(r,"ThisExpression");case y.name:var h=this.start,c=this.startLoc,u=this.containsEsc,d=this.parseIdent(!1);if(this.options.ecmaVersion>=8&&!u&&"async"===d.name&&!this.canInsertSemicolon()&&this.eat(y._function))return this.overrideContext(it.f_expr),this.parseFunction(this.startNodeAt(h,c),0,!1,!0,n);if(o&&!this.canInsertSemicolon()){if(this.eat(y.arrow))return this.parseArrowExpression(this.startNodeAt(h,c),[d],!1,n);if(this.options.ecmaVersion>=8&&"async"===d.name&&this.type===y.name&&!u&&(!this.potentialArrowInForAwait||"of"!==this.value||this.containsEsc))return d=this.parseIdent(!1),!this.canInsertSemicolon()&&this.eat(y.arrow)||this.unexpected(),this.parseArrowExpression(this.startNodeAt(h,c),[d],!0,n)}return d;case y.regexp:var p=this.value;return(r=this.parseLiteral(p.value)).regex={pattern:p.pattern,flags:p.flags},r;case y.num:case y.string:return this.parseLiteral(this.value);case y._null:case y._true:case y._false:return(r=this.startNode()).value=this.type===y._null?null:this.type===y._true,r.raw=this.type.keyword,this.next(),this.finishNode(r,"Literal");case y.parenL:var g=this.start,m=this.parseParenAndDistinguishExpression(o,n);return t&&(t.parenthesizedAssign<0&&!this.isSimpleAssignTarget(m)&&(t.parenthesizedAssign=g),t.parenthesizedBind<0&&(t.parenthesizedBind=g)),m;case y.bracketL:return r=this.startNode(),this.next(),r.elements=this.parseExprList(y.bracketR,!0,!0,t),this.finishNode(r,"ArrayExpression");case y.braceL:return this.overrideContext(it.b_expr),this.parseObj(!1,t);case y._function:return r=this.startNode(),this.next(),this.parseFunction(r,0);case y._class:return this.parseClass(this.startNode(),!1);case y._new:return this.parseNew();case y.backQuote:return this.parseTemplate();case y._import:return this.options.ecmaVersion>=11?this.parseExprImport(i):this.unexpected();default:return this.parseExprAtomDefault()}},st.parseExprAtomDefault=function(){this.unexpected()},st.parseExprImport=function(t){var n=this.startNode();if(this.containsEsc&&this.raiseRecoverable(this.start,"Escape sequence in keyword import"),this.next(),this.type===y.parenL&&!t)return this.parseDynamicImport(n);if(this.type===y.dot){var i=this.startNodeAt(n.start,n.loc&&n.loc.start);return i.name="import",n.meta=this.finishNode(i,"Identifier"),this.parseImportMeta(n)}this.unexpected()},st.parseDynamicImport=function(t){if(this.next(),t.source=this.parseMaybeAssign(),!this.eat(y.parenR)){var n=this.start;this.eat(y.comma)&&this.eat(y.parenR)?this.raiseRecoverable(n,"Trailing comma is not allowed in import()"):this.unexpected(n)}return this.finishNode(t,"ImportExpression")},st.parseImportMeta=function(t){this.next();var n=this.containsEsc;return t.property=this.parseIdent(!0),"meta"!==t.property.name&&this.raiseRecoverable(t.property.start,"The only valid meta property for import is 'import.meta'"),n&&this.raiseRecoverable(t.start,"'import.meta' must not contain escaped characters"),"module"===this.options.sourceType||this.options.allowImportExportEverywhere||this.raiseRecoverable(t.start,"Cannot use 'import.meta' outside a module"),this.finishNode(t,"MetaProperty")},st.parseLiteral=function(t){var n=this.startNode();return n.value=t,n.raw=this.input.slice(this.start,this.end),110===n.raw.charCodeAt(n.raw.length-1)&&(n.bigint=n.raw.slice(0,-1).replace(/_/g,"")),this.next(),this.finishNode(n,"Literal")},st.parseParenExpression=function(){this.expect(y.parenL);var t=this.parseExpression();return this.expect(y.parenR),t},st.shouldParseArrow=function(t){return!this.canInsertSemicolon()},st.parseParenAndDistinguishExpression=function(t,n){var i,r=this.start,o=this.startLoc,h=this.options.ecmaVersion>=8;if(this.options.ecmaVersion>=6){this.next();var c,u=this.start,d=this.startLoc,p=[],g=!0,m=!1,v=new Y,_=this.yieldPos,w=this.awaitPos;for(this.yieldPos=0,this.awaitPos=0;this.type!==y.parenR;){if(g?g=!1:this.expect(y.comma),h&&this.afterTrailingComma(y.parenR,!0)){m=!0;break}if(this.type===y.ellipsis){c=this.start,p.push(this.parseParenItem(this.parseRestBinding())),this.type===y.comma&&this.raiseRecoverable(this.start,"Comma is not permitted after the rest element");break}p.push(this.parseMaybeAssign(!1,v,this.parseParenItem))}var x=this.lastTokEnd,S=this.lastTokEndLoc;if(this.expect(y.parenR),t&&this.shouldParseArrow(p)&&this.eat(y.arrow))return this.checkPatternErrors(v,!1),this.checkYieldAwaitInDefaultParams(),this.yieldPos=_,this.awaitPos=w,this.parseParenArrowList(r,o,p,n);p.length&&!m||this.unexpected(this.lastTokStart),c&&this.unexpected(c),this.checkExpressionErrors(v,!0),this.yieldPos=_||this.yieldPos,this.awaitPos=w||this.awaitPos,p.length>1?((i=this.startNodeAt(u,d)).expressions=p,this.finishNodeAt(i,"SequenceExpression",x,S)):i=p[0]}else i=this.parseParenExpression();if(this.options.preserveParens){var C=this.startNodeAt(r,o);return C.expression=i,this.finishNode(C,"ParenthesizedExpression")}return i},st.parseParenItem=function(t){return t},st.parseParenArrowList=function(t,n,i,r){return this.parseArrowExpression(this.startNodeAt(t,n),i,!1,r)};var ot=[];st.parseNew=function(){this.containsEsc&&this.raiseRecoverable(this.start,"Escape sequence in keyword new");var t=this.startNode();if(this.next(),this.options.ecmaVersion>=6&&this.type===y.dot){var n=this.startNodeAt(t.start,t.loc&&t.loc.start);n.name="new",t.meta=this.finishNode(n,"Identifier"),this.next();var i=this.containsEsc;return t.property=this.parseIdent(!0),"target"!==t.property.name&&this.raiseRecoverable(t.property.start,"The only valid meta property for new is 'new.target'"),i&&this.raiseRecoverable(t.start,"'new.target' must not contain escaped characters"),this.allowNewDotTarget||this.raiseRecoverable(t.start,"'new.target' can only be used in functions and class static block"),this.finishNode(t,"MetaProperty")}var r=this.start,o=this.startLoc;return t.callee=this.parseSubscripts(this.parseExprAtom(null,!1,!0),r,o,!0,!1),this.eat(y.parenL)?t.arguments=this.parseExprList(y.parenR,this.options.ecmaVersion>=8,!1):t.arguments=ot,this.finishNode(t,"NewExpression")},st.parseTemplateElement=function(t){var n=t.isTagged,i=this.startNode();return this.type===y.invalidTemplate?(n||this.raiseRecoverable(this.start,"Bad escape sequence in untagged template literal"),i.value={raw:this.value,cooked:null}):i.value={raw:this.input.slice(this.start,this.end).replace(/\r\n?/g,"\n"),cooked:this.value},this.next(),i.tail=this.type===y.backQuote,this.finishNode(i,"TemplateElement")},st.parseTemplate=function(t){void 0===t&&(t={});var n=t.isTagged;void 0===n&&(n=!1);var i=this.startNode();this.next(),i.expressions=[];var r=this.parseTemplateElement({isTagged:n});for(i.quasis=[r];!r.tail;)this.type===y.eof&&this.raise(this.pos,"Unterminated template literal"),this.expect(y.dollarBraceL),i.expressions.push(this.parseExpression()),this.expect(y.braceR),i.quasis.push(r=this.parseTemplateElement({isTagged:n}));return this.next(),this.finishNode(i,"TemplateLiteral")},st.isAsyncProp=function(t){return!t.computed&&"Identifier"===t.key.type&&"async"===t.key.name&&(this.type===y.name||this.type===y.num||this.type===y.string||this.type===y.bracketL||this.type.keyword||this.options.ecmaVersion>=9&&this.type===y.star)&&!w.test(this.input.slice(this.lastTokEnd,this.start))},st.parseObj=function(t,n){var i=this.startNode(),r=!0,o={};for(i.properties=[],this.next();!this.eat(y.braceR);){if(r)r=!1;else if(this.expect(y.comma),this.options.ecmaVersion>=5&&this.afterTrailingComma(y.braceR))break;var h=this.parseProperty(t,n);t||this.checkPropClash(h,o,n),i.properties.push(h)}return this.finishNode(i,t?"ObjectPattern":"ObjectExpression")},st.parseProperty=function(t,n){var i,r,o,h,c=this.startNode();if(this.options.ecmaVersion>=9&&this.eat(y.ellipsis))return t?(c.argument=this.parseIdent(!1),this.type===y.comma&&this.raiseRecoverable(this.start,"Comma is not permitted after the rest element"),this.finishNode(c,"RestElement")):(c.argument=this.parseMaybeAssign(!1,n),this.type===y.comma&&n&&n.trailingComma<0&&(n.trailingComma=this.start),this.finishNode(c,"SpreadElement"));this.options.ecmaVersion>=6&&(c.method=!1,c.shorthand=!1,(t||n)&&(o=this.start,h=this.startLoc),t||(i=this.eat(y.star)));var u=this.containsEsc;return this.parsePropertyName(c),!t&&!u&&this.options.ecmaVersion>=8&&!i&&this.isAsyncProp(c)?(r=!0,i=this.options.ecmaVersion>=9&&this.eat(y.star),this.parsePropertyName(c)):r=!1,this.parsePropertyValue(c,t,i,r,o,h,n,u),this.finishNode(c,"Property")},st.parseGetterSetter=function(t){t.kind=t.key.name,this.parsePropertyName(t),t.value=this.parseMethod(!1);var n="get"===t.kind?0:1;if(t.value.params.length!==n){var i=t.value.start;"get"===t.kind?this.raiseRecoverable(i,"getter should have no params"):this.raiseRecoverable(i,"setter should have exactly one param")}else"set"===t.kind&&"RestElement"===t.value.params[0].type&&this.raiseRecoverable(t.value.params[0].start,"Setter cannot use rest params")},st.parsePropertyValue=function(t,n,i,r,o,h,c,u){(i||r)&&this.type===y.colon&&this.unexpected(),this.eat(y.colon)?(t.value=n?this.parseMaybeDefault(this.start,this.startLoc):this.parseMaybeAssign(!1,c),t.kind="init"):this.options.ecmaVersion>=6&&this.type===y.parenL?(n&&this.unexpected(),t.kind="init",t.method=!0,t.value=this.parseMethod(i,r)):n||u||!(this.options.ecmaVersion>=5)||t.computed||"Identifier"!==t.key.type||"get"!==t.key.name&&"set"!==t.key.name||this.type===y.comma||this.type===y.braceR||this.type===y.eq?this.options.ecmaVersion>=6&&!t.computed&&"Identifier"===t.key.type?((i||r)&&this.unexpected(),this.checkUnreserved(t.key),"await"!==t.key.name||this.awaitIdentPos||(this.awaitIdentPos=o),t.kind="init",n?t.value=this.parseMaybeDefault(o,h,this.copyNode(t.key)):this.type===y.eq&&c?(c.shorthandAssign<0&&(c.shorthandAssign=this.start),t.value=this.parseMaybeDefault(o,h,this.copyNode(t.key))):t.value=this.copyNode(t.key),t.shorthand=!0):this.unexpected():((i||r)&&this.unexpected(),this.parseGetterSetter(t))},st.parsePropertyName=function(t){if(this.options.ecmaVersion>=6){if(this.eat(y.bracketL))return t.computed=!0,t.key=this.parseMaybeAssign(),this.expect(y.bracketR),t.key;t.computed=!1}return t.key=this.type===y.num||this.type===y.string?this.parseExprAtom():this.parseIdent("never"!==this.options.allowReserved)},st.initFunction=function(t){t.id=null,this.options.ecmaVersion>=6&&(t.generator=t.expression=!1),this.options.ecmaVersion>=8&&(t.async=!1)},st.parseMethod=function(t,n,i){var r=this.startNode(),o=this.yieldPos,h=this.awaitPos,c=this.awaitIdentPos;return this.initFunction(r),this.options.ecmaVersion>=6&&(r.generator=t),this.options.ecmaVersion>=8&&(r.async=!!n),this.yieldPos=0,this.awaitPos=0,this.awaitIdentPos=0,this.enterScope(64|functionFlags(n,r.generator)|(i?128:0)),this.expect(y.parenL),r.params=this.parseBindingList(y.parenR,!1,this.options.ecmaVersion>=8),this.checkYieldAwaitInDefaultParams(),this.parseFunctionBody(r,!1,!0,!1),this.yieldPos=o,this.awaitPos=h,this.awaitIdentPos=c,this.finishNode(r,"FunctionExpression")},st.parseArrowExpression=function(t,n,i,r){var o=this.yieldPos,h=this.awaitPos,c=this.awaitIdentPos;return this.enterScope(16|functionFlags(i,!1)),this.initFunction(t),this.options.ecmaVersion>=8&&(t.async=!!i),this.yieldPos=0,this.awaitPos=0,this.awaitIdentPos=0,t.params=this.toAssignableList(n,!0),this.parseFunctionBody(t,!0,!1,r),this.yieldPos=o,this.awaitPos=h,this.awaitIdentPos=c,this.finishNode(t,"ArrowFunctionExpression")},st.parseFunctionBody=function(t,n,i,r){var o=n&&this.type!==y.braceL,h=this.strict,c=!1;if(o)t.body=this.parseMaybeAssign(r),t.expression=!0,this.checkParams(t,!1);else{var u=this.options.ecmaVersion>=7&&!this.isSimpleParamList(t.params);h&&!u||(c=this.strictDirective(this.end))&&u&&this.raiseRecoverable(t.start,"Illegal 'use strict' directive in function with non-simple parameter list");var d=this.labels;this.labels=[],c&&(this.strict=!0),this.checkParams(t,!h&&!c&&!n&&!i&&this.isSimpleParamList(t.params)),this.strict&&t.id&&this.checkLValSimple(t.id,5),t.body=this.parseBlock(!1,void 0,c&&!h),t.expression=!1,this.adaptDirectivePrologue(t.body.body),this.labels=d}this.exitScope()},st.isSimpleParamList=function(t){for(var n=0,i=t;n<i.length;n+=1)if("Identifier"!==i[n].type)return!1;return!0},st.checkParams=function(t,n){for(var i=Object.create(null),r=0,o=t.params;r<o.length;r+=1){var h=o[r];this.checkLValInnerPattern(h,1,n?null:i)}},st.parseExprList=function(t,n,i,r){for(var o=[],h=!0;!this.eat(t);){if(h)h=!1;else if(this.expect(y.comma),n&&this.afterTrailingComma(t))break;var c=void 0;i&&this.type===y.comma?c=null:this.type===y.ellipsis?(c=this.parseSpread(r),r&&this.type===y.comma&&r.trailingComma<0&&(r.trailingComma=this.start)):c=this.parseMaybeAssign(!1,r),o.push(c)}return o},st.checkUnreserved=function(t){var n=t.start,i=t.end,r=t.name;this.inGenerator&&"yield"===r&&this.raiseRecoverable(n,"Cannot use 'yield' as identifier inside a generator"),this.inAsync&&"await"===r&&this.raiseRecoverable(n,"Cannot use 'await' as identifier inside an async function"),this.currentThisScope().inClassFieldInit&&"arguments"===r&&this.raiseRecoverable(n,"Cannot use 'arguments' in class field initializer"),!this.inClassStaticBlock||"arguments"!==r&&"await"!==r||this.raise(n,"Cannot use "+r+" in class static initialization block"),this.keywords.test(r)&&this.raise(n,"Unexpected keyword '"+r+"'"),this.options.ecmaVersion<6&&-1!==this.input.slice(n,i).indexOf("\\")||(this.strict?this.reservedWordsStrict:this.reservedWords).test(r)&&(this.inAsync||"await"!==r||this.raiseRecoverable(n,"Cannot use keyword 'await' outside an async function"),this.raiseRecoverable(n,"The keyword '"+r+"' is reserved"))},st.parseIdent=function(t){var n=this.parseIdentNode();return this.next(!!t),this.finishNode(n,"Identifier"),t||(this.checkUnreserved(n),"await"!==n.name||this.awaitIdentPos||(this.awaitIdentPos=n.start)),n},st.parseIdentNode=function(){var t=this.startNode();return this.type===y.name?t.name=this.value:this.type.keyword?(t.name=this.type.keyword,"class"!==t.name&&"function"!==t.name||this.lastTokEnd===this.lastTokStart+1&&46===this.input.charCodeAt(this.lastTokStart)||this.context.pop(),this.type=y.name):this.unexpected(),t},st.parsePrivateIdent=function(){var t=this.startNode();return this.type===y.privateId?t.name=this.value:this.unexpected(),this.next(),this.finishNode(t,"PrivateIdentifier"),this.options.checkPrivateFields&&(0===this.privateNameStack.length?this.raise(t.start,"Private field '#"+t.name+"' must be declared in an enclosing class"):this.privateNameStack[this.privateNameStack.length-1].used.push(t)),t},st.parseYield=function(t){this.yieldPos||(this.yieldPos=this.start);var n=this.startNode();return this.next(),this.type===y.semi||this.canInsertSemicolon()||this.type!==y.star&&!this.type.startsExpr?(n.delegate=!1,n.argument=null):(n.delegate=this.eat(y.star),n.argument=this.parseMaybeAssign(t)),this.finishNode(n,"YieldExpression")},st.parseAwait=function(t){this.awaitPos||(this.awaitPos=this.start);var n=this.startNode();return this.next(),n.argument=this.parseMaybeUnary(null,!0,!1,t),this.finishNode(n,"AwaitExpression")};var ht=z.prototype;ht.raise=function(t,n){var i=getLineInfo(this.input,t);n+=" ("+i.line+":"+i.column+")";var r=new SyntaxError(n);throw r.pos=t,r.loc=i,r.raisedAt=this.pos,r},ht.raiseRecoverable=ht.raise,ht.curPosition=function(){if(this.options.locations)return new D(this.curLine,this.pos-this.lineStart)};var lt=z.prototype,ct=function Scope2(t){this.flags=t,this.var=[],this.lexical=[],this.functions=[],this.inClassFieldInit=!1};lt.enterScope=function(t){this.scopeStack.push(new ct(t))},lt.exitScope=function(){this.scopeStack.pop()},lt.treatFunctionsAsVarInScope=function(t){return 2&t.flags||!this.inModule&&1&t.flags},lt.declareName=function(t,n,i){var r=!1;if(2===n){var o=this.currentScope();r=o.lexical.indexOf(t)>-1||o.functions.indexOf(t)>-1||o.var.indexOf(t)>-1,o.lexical.push(t),this.inModule&&1&o.flags&&delete this.undefinedExports[t]}else if(4===n)this.currentScope().lexical.push(t);else if(3===n){var h=this.currentScope();r=this.treatFunctionsAsVar?h.lexical.indexOf(t)>-1:h.lexical.indexOf(t)>-1||h.var.indexOf(t)>-1,h.functions.push(t)}else for(var c=this.scopeStack.length-1;c>=0;--c){var u=this.scopeStack[c];if(u.lexical.indexOf(t)>-1&&!(32&u.flags&&u.lexical[0]===t)||!this.treatFunctionsAsVarInScope(u)&&u.functions.indexOf(t)>-1){r=!0;break}if(u.var.push(t),this.inModule&&1&u.flags&&delete this.undefinedExports[t],259&u.flags)break}r&&this.raiseRecoverable(i,"Identifier '"+t+"' has already been declared")},lt.checkLocalExport=function(t){-1===this.scopeStack[0].lexical.indexOf(t.name)&&-1===this.scopeStack[0].var.indexOf(t.name)&&(this.undefinedExports[t.name]=t)},lt.currentScope=function(){return this.scopeStack[this.scopeStack.length-1]},lt.currentVarScope=function(){for(var t=this.scopeStack.length-1;;t--){var n=this.scopeStack[t];if(259&n.flags)return n}},lt.currentThisScope=function(){for(var t=this.scopeStack.length-1;;t--){var n=this.scopeStack[t];if(259&n.flags&&!(16&n.flags))return n}};var ut=function Node2(t,n,i){this.type="",this.start=n,this.end=0,t.options.locations&&(this.loc=new N(t,i)),t.options.directSourceFile&&(this.sourceFile=t.options.directSourceFile),t.options.ranges&&(this.range=[n,0])},dt=z.prototype;function finishNodeAt(t,n,i,r){return t.type=n,t.end=i,this.options.locations&&(t.loc.end=r),this.options.ranges&&(t.range[1]=i),t}dt.startNode=function(){return new ut(this,this.start,this.startLoc)},dt.startNodeAt=function(t,n){return new ut(this,t,n)},dt.finishNode=function(t,n){return finishNodeAt.call(this,t,n,this.lastTokEnd,this.lastTokEndLoc)},dt.finishNodeAt=function(t,n,i,r){return finishNodeAt.call(this,t,n,i,r)},dt.copyNode=function(t){var n=new ut(this,t.start,this.startLoc);for(var i in t)n[i]=t[i];return n};for(var pt,ft,gt="ASCII ASCII_Hex_Digit AHex Alphabetic Alpha Any Assigned Bidi_Control Bidi_C Bidi_Mirrored Bidi_M Case_Ignorable CI Cased Changes_When_Casefolded CWCF Changes_When_Casemapped CWCM Changes_When_Lowercased CWL Changes_When_NFKC_Casefolded CWKCF Changes_When_Titlecased CWT Changes_When_Uppercased CWU Dash Default_Ignorable_Code_Point DI Deprecated Dep Diacritic Dia Emoji Emoji_Component Emoji_Modifier Emoji_Modifier_Base Emoji_Presentation Extender Ext Grapheme_Base Gr_Base Grapheme_Extend Gr_Ext Hex_Digit Hex IDS_Binary_Operator IDSB IDS_Trinary_Operator IDST ID_Continue IDC ID_Start IDS Ideographic Ideo Join_Control Join_C Logical_Order_Exception LOE Lowercase Lower Math Noncharacter_Code_Point NChar Pattern_Syntax Pat_Syn Pattern_White_Space Pat_WS Quotation_Mark QMark Radical Regional_Indicator RI Sentence_Terminal STerm Soft_Dotted SD Terminal_Punctuation Term Unified_Ideograph UIdeo Uppercase Upper Variation_Selector VS White_Space space XID_Continue XIDC XID_Start XIDS",mt=gt+" Extended_Pictographic",vt=mt+" EBase EComp EMod EPres ExtPict",_t={9:gt,10:mt,11:mt,12:vt,13:vt,14:vt},yt={9:"",10:"",11:"",12:"",13:"",14:"Basic_Emoji Emoji_Keycap_Sequence RGI_Emoji_Modifier_Sequence RGI_Emoji_Flag_Sequence RGI_Emoji_Tag_Sequence RGI_Emoji_ZWJ_Sequence RGI_Emoji"},wt="Cased_Letter LC Close_Punctuation Pe Connector_Punctuation Pc Control Cc cntrl Currency_Symbol Sc Dash_Punctuation Pd Decimal_Number Nd digit Enclosing_Mark Me Final_Punctuation Pf Format Cf Initial_Punctuation Pi Letter L Letter_Number Nl Line_Separator Zl Lowercase_Letter Ll Mark M Combining_Mark Math_Symbol Sm Modifier_Letter Lm Modifier_Symbol Sk Nonspacing_Mark Mn Number N Open_Punctuation Ps Other C Other_Letter Lo Other_Number No Other_Punctuation Po Other_Symbol So Paragraph_Separator Zp Private_Use Co Punctuation P punct Separator Z Space_Separator Zs Spacing_Mark Mc Surrogate Cs Symbol S Titlecase_Letter Lt Unassigned Cn Uppercase_Letter Lu",bt="Adlam Adlm Ahom Anatolian_Hieroglyphs Hluw Arabic Arab Armenian Armn Avestan Avst Balinese Bali Bamum Bamu Bassa_Vah Bass Batak Batk Bengali Beng Bhaiksuki Bhks Bopomofo Bopo Brahmi Brah Braille Brai Buginese Bugi Buhid Buhd Canadian_Aboriginal Cans Carian Cari Caucasian_Albanian Aghb Chakma Cakm Cham Cham Cherokee Cher Common Zyyy Coptic Copt Qaac Cuneiform Xsux Cypriot Cprt Cyrillic Cyrl Deseret Dsrt Devanagari Deva Duployan Dupl Egyptian_Hieroglyphs Egyp Elbasan Elba Ethiopic Ethi Georgian Geor Glagolitic Glag Gothic Goth Grantha Gran Greek Grek Gujarati Gujr Gurmukhi Guru Han Hani Hangul Hang Hanunoo Hano Hatran Hatr Hebrew Hebr Hiragana Hira Imperial_Aramaic Armi Inherited Zinh Qaai Inscriptional_Pahlavi Phli Inscriptional_Parthian Prti Javanese Java Kaithi Kthi Kannada Knda Katakana Kana Kayah_Li Kali Kharoshthi Khar Khmer Khmr Khojki Khoj Khudawadi Sind Lao Laoo Latin Latn Lepcha Lepc Limbu Limb Linear_A Lina Linear_B Linb Lisu Lisu Lycian Lyci Lydian Lydi Mahajani Mahj Malayalam Mlym Mandaic Mand Manichaean Mani Marchen Marc Masaram_Gondi Gonm Meetei_Mayek Mtei Mende_Kikakui Mend Meroitic_Cursive Merc Meroitic_Hieroglyphs Mero Miao Plrd Modi Mongolian Mong Mro Mroo Multani Mult Myanmar Mymr Nabataean Nbat New_Tai_Lue Talu Newa Newa Nko Nkoo Nushu Nshu Ogham Ogam Ol_Chiki Olck Old_Hungarian Hung Old_Italic Ital Old_North_Arabian Narb Old_Permic Perm Old_Persian Xpeo Old_South_Arabian Sarb Old_Turkic Orkh Oriya Orya Osage Osge Osmanya Osma Pahawh_Hmong Hmng Palmyrene Palm Pau_Cin_Hau Pauc Phags_Pa Phag Phoenician Phnx Psalter_Pahlavi Phlp Rejang Rjng Runic Runr Samaritan Samr Saurashtra Saur Sharada Shrd Shavian Shaw Siddham Sidd SignWriting Sgnw Sinhala Sinh Sora_Sompeng Sora Soyombo Soyo Sundanese Sund Syloti_Nagri Sylo Syriac Syrc Tagalog Tglg Tagbanwa Tagb Tai_Le Tale Tai_Tham Lana Tai_Viet Tavt Takri Takr Tamil Taml Tangut Tang Telugu Telu Thaana Thaa Thai Thai Tibetan Tibt Tifinagh Tfng Tirhuta Tirh Ugaritic Ugar Vai Vaii Warang_Citi Wara Yi Yiii Zanabazar_Square Zanb",xt=bt+" Dogra Dogr Gunjala_Gondi Gong Hanifi_Rohingya Rohg Makasar Maka Medefaidrin Medf Old_Sogdian Sogo Sogdian Sogd",St=xt+" Elymaic Elym Nandinagari Nand Nyiakeng_Puachue_Hmong Hmnp Wancho Wcho",Ct=St+" Chorasmian Chrs Diak Dives_Akuru Khitan_Small_Script Kits Yezi Yezidi",kt=Ct+" Cypro_Minoan Cpmn Old_Uyghur Ougr Tangsa Tnsa Toto Vithkuqi Vith",Pt={9:bt,10:xt,11:St,12:Ct,13:kt,14:kt+" Hrkt Katakana_Or_Hiragana Kawi Nag_Mundari Nagm Unknown Zzzz"},It={},Mt=0,Et=[9,10,11,12,13,14];Mt<Et.length;Mt+=1)ft=void 0,(ft=It[pt=Et[Mt]]={binary:wordsRegexp(_t[pt]+" "+wt),binaryOfStrings:wordsRegexp(yt[pt]),nonBinary:{General_Category:wordsRegexp(wt),Script:wordsRegexp(Pt[pt])}}).nonBinary.Script_Extensions=ft.nonBinary.Script,ft.nonBinary.gc=ft.nonBinary.General_Category,ft.nonBinary.sc=ft.nonBinary.Script,ft.nonBinary.scx=ft.nonBinary.Script_Extensions;var At=z.prototype,Tt=function RegExpValidationState2(t){this.parser=t,this.validFlags="gim"+(t.options.ecmaVersion>=6?"uy":"")+(t.options.ecmaVersion>=9?"s":"")+(t.options.ecmaVersion>=13?"d":"")+(t.options.ecmaVersion>=15?"v":""),this.unicodeProperties=It[t.options.ecmaVersion>=14?14:t.options.ecmaVersion],this.source="",this.flags="",this.start=0,this.switchU=!1,this.switchV=!1,this.switchN=!1,this.pos=0,this.lastIntValue=0,this.lastStringValue="",this.lastAssertionIsQuantifiable=!1,this.numCapturingParens=0,this.maxBackReference=0,this.groupNames=[],this.backReferenceNames=[]};function isSyntaxCharacter(t){return 36===t||t>=40&&t<=43||46===t||63===t||t>=91&&t<=94||t>=123&&t<=125}function isControlLetter(t){return t>=65&&t<=90||t>=97&&t<=122}function isUnicodePropertyNameCharacter(t){return isControlLetter(t)||95===t}function isUnicodePropertyValueCharacter(t){return isUnicodePropertyNameCharacter(t)||isDecimalDigit(t)}function isDecimalDigit(t){return t>=48&&t<=57}function isHexDigit(t){return t>=48&&t<=57||t>=65&&t<=70||t>=97&&t<=102}function hexToInt(t){return t>=65&&t<=70?t-65+10:t>=97&&t<=102?t-97+10:t-48}function isOctalDigit(t){return t>=48&&t<=55}Tt.prototype.reset=function reset(t,n,i){var r=-1!==i.indexOf("v"),o=-1!==i.indexOf("u");this.start=0|t,this.source=n+"",this.flags=i,r&&this.parser.options.ecmaVersion>=15?(this.switchU=!0,this.switchV=!0,this.switchN=!0):(this.switchU=o&&this.parser.options.ecmaVersion>=6,this.switchV=!1,this.switchN=o&&this.parser.options.ecmaVersion>=9)},Tt.prototype.raise=function raise(t){this.parser.raiseRecoverable(this.start,"Invalid regular expression: /"+this.source+"/: "+t)},Tt.prototype.at=function at(t,n){void 0===n&&(n=!1);var i=this.source,r=i.length;if(t>=r)return-1;var o=i.charCodeAt(t);if(!n&&!this.switchU||o<=55295||o>=57344||t+1>=r)return o;var h=i.charCodeAt(t+1);return h>=56320&&h<=57343?(o<<10)+h-56613888:o},Tt.prototype.nextIndex=function nextIndex(t,n){void 0===n&&(n=!1);var i=this.source,r=i.length;if(t>=r)return r;var o,h=i.charCodeAt(t);return!n&&!this.switchU||h<=55295||h>=57344||t+1>=r||(o=i.charCodeAt(t+1))<56320||o>57343?t+1:t+2},Tt.prototype.current=function current(t){return void 0===t&&(t=!1),this.at(this.pos,t)},Tt.prototype.lookahead=function lookahead(t){return void 0===t&&(t=!1),this.at(this.nextIndex(this.pos,t),t)},Tt.prototype.advance=function advance(t){void 0===t&&(t=!1),this.pos=this.nextIndex(this.pos,t)},Tt.prototype.eat=function eat(t,n){return void 0===n&&(n=!1),this.current(n)===t&&(this.advance(n),!0)},Tt.prototype.eatChars=function eatChars(t,n){void 0===n&&(n=!1);for(var i=this.pos,r=0,o=t;r<o.length;r+=1){var h=o[r],c=this.at(i,n);if(-1===c||c!==h)return!1;i=this.nextIndex(i,n)}return this.pos=i,!0},At.validateRegExpFlags=function(t){for(var n=t.validFlags,i=t.flags,r=!1,o=!1,h=0;h<i.length;h++){var c=i.charAt(h);-1===n.indexOf(c)&&this.raise(t.start,"Invalid regular expression flag"),i.indexOf(c,h+1)>-1&&this.raise(t.start,"Duplicate regular expression flag"),"u"===c&&(r=!0),"v"===c&&(o=!0)}this.options.ecmaVersion>=15&&r&&o&&this.raise(t.start,"Invalid regular expression flag")},At.validateRegExpPattern=function(t){this.regexp_pattern(t),!t.switchN&&this.options.ecmaVersion>=9&&t.groupNames.length>0&&(t.switchN=!0,this.regexp_pattern(t))},At.regexp_pattern=function(t){t.pos=0,t.lastIntValue=0,t.lastStringValue="",t.lastAssertionIsQuantifiable=!1,t.numCapturingParens=0,t.maxBackReference=0,t.groupNames.length=0,t.backReferenceNames.length=0,this.regexp_disjunction(t),t.pos!==t.source.length&&(t.eat(41)&&t.raise("Unmatched ')'"),(t.eat(93)||t.eat(125))&&t.raise("Lone quantifier brackets")),t.maxBackReference>t.numCapturingParens&&t.raise("Invalid escape");for(var n=0,i=t.backReferenceNames;n<i.length;n+=1){var r=i[n];-1===t.groupNames.indexOf(r)&&t.raise("Invalid named capture referenced")}},At.regexp_disjunction=function(t){for(this.regexp_alternative(t);t.eat(124);)this.regexp_alternative(t);this.regexp_eatQuantifier(t,!0)&&t.raise("Nothing to repeat"),t.eat(123)&&t.raise("Lone quantifier brackets")},At.regexp_alternative=function(t){for(;t.pos<t.source.length&&this.regexp_eatTerm(t););},At.regexp_eatTerm=function(t){return this.regexp_eatAssertion(t)?(t.lastAssertionIsQuantifiable&&this.regexp_eatQuantifier(t)&&t.switchU&&t.raise("Invalid quantifier"),!0):!!(t.switchU?this.regexp_eatAtom(t):this.regexp_eatExtendedAtom(t))&&(this.regexp_eatQuantifier(t),!0)},At.regexp_eatAssertion=function(t){var n=t.pos;if(t.lastAssertionIsQuantifiable=!1,t.eat(94)||t.eat(36))return!0;if(t.eat(92)){if(t.eat(66)||t.eat(98))return!0;t.pos=n}if(t.eat(40)&&t.eat(63)){var i=!1;if(this.options.ecmaVersion>=9&&(i=t.eat(60)),t.eat(61)||t.eat(33))return this.regexp_disjunction(t),t.eat(41)||t.raise("Unterminated group"),t.lastAssertionIsQuantifiable=!i,!0}return t.pos=n,!1},At.regexp_eatQuantifier=function(t,n){return void 0===n&&(n=!1),!!this.regexp_eatQuantifierPrefix(t,n)&&(t.eat(63),!0)},At.regexp_eatQuantifierPrefix=function(t,n){return t.eat(42)||t.eat(43)||t.eat(63)||this.regexp_eatBracedQuantifier(t,n)},At.regexp_eatBracedQuantifier=function(t,n){var i=t.pos;if(t.eat(123)){var r=0,o=-1;if(this.regexp_eatDecimalDigits(t)&&(r=t.lastIntValue,t.eat(44)&&this.regexp_eatDecimalDigits(t)&&(o=t.lastIntValue),t.eat(125)))return-1!==o&&o<r&&!n&&t.raise("numbers out of order in {} quantifier"),!0;t.switchU&&!n&&t.raise("Incomplete quantifier"),t.pos=i}return!1},At.regexp_eatAtom=function(t){return this.regexp_eatPatternCharacters(t)||t.eat(46)||this.regexp_eatReverseSolidusAtomEscape(t)||this.regexp_eatCharacterClass(t)||this.regexp_eatUncapturingGroup(t)||this.regexp_eatCapturingGroup(t)},At.regexp_eatReverseSolidusAtomEscape=function(t){var n=t.pos;if(t.eat(92)){if(this.regexp_eatAtomEscape(t))return!0;t.pos=n}return!1},At.regexp_eatUncapturingGroup=function(t){var n=t.pos;if(t.eat(40)){if(t.eat(63)&&t.eat(58)){if(this.regexp_disjunction(t),t.eat(41))return!0;t.raise("Unterminated group")}t.pos=n}return!1},At.regexp_eatCapturingGroup=function(t){if(t.eat(40)){if(this.options.ecmaVersion>=9?this.regexp_groupSpecifier(t):63===t.current()&&t.raise("Invalid group"),this.regexp_disjunction(t),t.eat(41))return t.numCapturingParens+=1,!0;t.raise("Unterminated group")}return!1},At.regexp_eatExtendedAtom=function(t){return t.eat(46)||this.regexp_eatReverseSolidusAtomEscape(t)||this.regexp_eatCharacterClass(t)||this.regexp_eatUncapturingGroup(t)||this.regexp_eatCapturingGroup(t)||this.regexp_eatInvalidBracedQuantifier(t)||this.regexp_eatExtendedPatternCharacter(t)},At.regexp_eatInvalidBracedQuantifier=function(t){return this.regexp_eatBracedQuantifier(t,!0)&&t.raise("Nothing to repeat"),!1},At.regexp_eatSyntaxCharacter=function(t){var n=t.current();return!!isSyntaxCharacter(n)&&(t.lastIntValue=n,t.advance(),!0)},At.regexp_eatPatternCharacters=function(t){for(var n=t.pos,i=0;-1!==(i=t.current())&&!isSyntaxCharacter(i);)t.advance();return t.pos!==n},At.regexp_eatExtendedPatternCharacter=function(t){var n=t.current();return!(-1===n||36===n||n>=40&&n<=43||46===n||63===n||91===n||94===n||124===n||(t.advance(),0))},At.regexp_groupSpecifier=function(t){if(t.eat(63)){if(this.regexp_eatGroupName(t))return-1!==t.groupNames.indexOf(t.lastStringValue)&&t.raise("Duplicate capture group name"),void t.groupNames.push(t.lastStringValue);t.raise("Invalid group")}},At.regexp_eatGroupName=function(t){if(t.lastStringValue="",t.eat(60)){if(this.regexp_eatRegExpIdentifierName(t)&&t.eat(62))return!0;t.raise("Invalid capture group name")}return!1},At.regexp_eatRegExpIdentifierName=function(t){if(t.lastStringValue="",this.regexp_eatRegExpIdentifierStart(t)){for(t.lastStringValue+=codePointToString(t.lastIntValue);this.regexp_eatRegExpIdentifierPart(t);)t.lastStringValue+=codePointToString(t.lastIntValue);return!0}return!1},At.regexp_eatRegExpIdentifierStart=function(t){var n=t.pos,i=this.options.ecmaVersion>=11,r=t.current(i);return t.advance(i),92===r&&this.regexp_eatRegExpUnicodeEscapeSequence(t,i)&&(r=t.lastIntValue),function isRegExpIdentifierStart(t){return isIdentifierStart(t,!0)||36===t||95===t}(r)?(t.lastIntValue=r,!0):(t.pos=n,!1)},At.regexp_eatRegExpIdentifierPart=function(t){var n=t.pos,i=this.options.ecmaVersion>=11,r=t.current(i);return t.advance(i),92===r&&this.regexp_eatRegExpUnicodeEscapeSequence(t,i)&&(r=t.lastIntValue),function isRegExpIdentifierPart(t){return isIdentifierChar(t,!0)||36===t||95===t||8204===t||8205===t}(r)?(t.lastIntValue=r,!0):(t.pos=n,!1)},At.regexp_eatAtomEscape=function(t){return!!(this.regexp_eatBackReference(t)||this.regexp_eatCharacterClassEscape(t)||this.regexp_eatCharacterEscape(t)||t.switchN&&this.regexp_eatKGroupName(t))||(t.switchU&&(99===t.current()&&t.raise("Invalid unicode escape"),t.raise("Invalid escape")),!1)},At.regexp_eatBackReference=function(t){var n=t.pos;if(this.regexp_eatDecimalEscape(t)){var i=t.lastIntValue;if(t.switchU)return i>t.maxBackReference&&(t.maxBackReference=i),!0;if(i<=t.numCapturingParens)return!0;t.pos=n}return!1},At.regexp_eatKGroupName=function(t){if(t.eat(107)){if(this.regexp_eatGroupName(t))return t.backReferenceNames.push(t.lastStringValue),!0;t.raise("Invalid named reference")}return!1},At.regexp_eatCharacterEscape=function(t){return this.regexp_eatControlEscape(t)||this.regexp_eatCControlLetter(t)||this.regexp_eatZero(t)||this.regexp_eatHexEscapeSequence(t)||this.regexp_eatRegExpUnicodeEscapeSequence(t,!1)||!t.switchU&&this.regexp_eatLegacyOctalEscapeSequence(t)||this.regexp_eatIdentityEscape(t)},At.regexp_eatCControlLetter=function(t){var n=t.pos;if(t.eat(99)){if(this.regexp_eatControlLetter(t))return!0;t.pos=n}return!1},At.regexp_eatZero=function(t){return 48===t.current()&&!isDecimalDigit(t.lookahead())&&(t.lastIntValue=0,t.advance(),!0)},At.regexp_eatControlEscape=function(t){var n=t.current();return 116===n?(t.lastIntValue=9,t.advance(),!0):110===n?(t.lastIntValue=10,t.advance(),!0):118===n?(t.lastIntValue=11,t.advance(),!0):102===n?(t.lastIntValue=12,t.advance(),!0):114===n&&(t.lastIntValue=13,t.advance(),!0)},At.regexp_eatControlLetter=function(t){var n=t.current();return!!isControlLetter(n)&&(t.lastIntValue=n%32,t.advance(),!0)},At.regexp_eatRegExpUnicodeEscapeSequence=function(t,n){void 0===n&&(n=!1);var i=t.pos,r=n||t.switchU;if(t.eat(117)){if(this.regexp_eatFixedHexDigits(t,4)){var o=t.lastIntValue;if(r&&o>=55296&&o<=56319){var h=t.pos;if(t.eat(92)&&t.eat(117)&&this.regexp_eatFixedHexDigits(t,4)){var c=t.lastIntValue;if(c>=56320&&c<=57343)return t.lastIntValue=1024*(o-55296)+(c-56320)+65536,!0}t.pos=h,t.lastIntValue=o}return!0}if(r&&t.eat(123)&&this.regexp_eatHexDigits(t)&&t.eat(125)&&function isValidUnicode(t){return t>=0&&t<=1114111}(t.lastIntValue))return!0;r&&t.raise("Invalid unicode escape"),t.pos=i}return!1},At.regexp_eatIdentityEscape=function(t){if(t.switchU)return!!this.regexp_eatSyntaxCharacter(t)||!!t.eat(47)&&(t.lastIntValue=47,!0);var n=t.current();return!(99===n||t.switchN&&107===n||(t.lastIntValue=n,t.advance(),0))},At.regexp_eatDecimalEscape=function(t){t.lastIntValue=0;var n=t.current();if(n>=49&&n<=57){do{t.lastIntValue=10*t.lastIntValue+(n-48),t.advance()}while((n=t.current())>=48&&n<=57);return!0}return!1},At.regexp_eatCharacterClassEscape=function(t){var n=t.current();if(function isCharacterClassEscape(t){return 100===t||68===t||115===t||83===t||119===t||87===t}(n))return t.lastIntValue=-1,t.advance(),1;var i=!1;if(t.switchU&&this.options.ecmaVersion>=9&&((i=80===n)||112===n)){var r;if(t.lastIntValue=-1,t.advance(),t.eat(123)&&(r=this.regexp_eatUnicodePropertyValueExpression(t))&&t.eat(125))return i&&2===r&&t.raise("Invalid property name"),r;t.raise("Invalid property name")}return 0},At.regexp_eatUnicodePropertyValueExpression=function(t){var n=t.pos;if(this.regexp_eatUnicodePropertyName(t)&&t.eat(61)){var i=t.lastStringValue;if(this.regexp_eatUnicodePropertyValue(t)){var r=t.lastStringValue;return this.regexp_validateUnicodePropertyNameAndValue(t,i,r),1}}if(t.pos=n,this.regexp_eatLoneUnicodePropertyNameOrValue(t)){var o=t.lastStringValue;return this.regexp_validateUnicodePropertyNameOrValue(t,o)}return 0},At.regexp_validateUnicodePropertyNameAndValue=function(t,n,i){M(t.unicodeProperties.nonBinary,n)||t.raise("Invalid property name"),t.unicodeProperties.nonBinary[n].test(i)||t.raise("Invalid property value")},At.regexp_validateUnicodePropertyNameOrValue=function(t,n){return t.unicodeProperties.binary.test(n)?1:t.switchV&&t.unicodeProperties.binaryOfStrings.test(n)?2:void t.raise("Invalid property name")},At.regexp_eatUnicodePropertyName=function(t){var n=0;for(t.lastStringValue="";isUnicodePropertyNameCharacter(n=t.current());)t.lastStringValue+=codePointToString(n),t.advance();return""!==t.lastStringValue},At.regexp_eatUnicodePropertyValue=function(t){var n=0;for(t.lastStringValue="";isUnicodePropertyValueCharacter(n=t.current());)t.lastStringValue+=codePointToString(n),t.advance();return""!==t.lastStringValue},At.regexp_eatLoneUnicodePropertyNameOrValue=function(t){return this.regexp_eatUnicodePropertyValue(t)},At.regexp_eatCharacterClass=function(t){if(t.eat(91)){var n=t.eat(94),i=this.regexp_classContents(t);return t.eat(93)||t.raise("Unterminated character class"),n&&2===i&&t.raise("Negated character class may contain strings"),!0}return!1},At.regexp_classContents=function(t){return 93===t.current()?1:t.switchV?this.regexp_classSetExpression(t):(this.regexp_nonEmptyClassRanges(t),1)},At.regexp_nonEmptyClassRanges=function(t){for(;this.regexp_eatClassAtom(t);){var n=t.lastIntValue;if(t.eat(45)&&this.regexp_eatClassAtom(t)){var i=t.lastIntValue;!t.switchU||-1!==n&&-1!==i||t.raise("Invalid character class"),-1!==n&&-1!==i&&n>i&&t.raise("Range out of order in character class")}}},At.regexp_eatClassAtom=function(t){var n=t.pos;if(t.eat(92)){if(this.regexp_eatClassEscape(t))return!0;if(t.switchU){var i=t.current();(99===i||isOctalDigit(i))&&t.raise("Invalid class escape"),t.raise("Invalid escape")}t.pos=n}var r=t.current();return 93!==r&&(t.lastIntValue=r,t.advance(),!0)},At.regexp_eatClassEscape=function(t){var n=t.pos;if(t.eat(98))return t.lastIntValue=8,!0;if(t.switchU&&t.eat(45))return t.lastIntValue=45,!0;if(!t.switchU&&t.eat(99)){if(this.regexp_eatClassControlLetter(t))return!0;t.pos=n}return this.regexp_eatCharacterClassEscape(t)||this.regexp_eatCharacterEscape(t)},At.regexp_classSetExpression=function(t){var n,i=1;if(this.regexp_eatClassSetRange(t));else if(n=this.regexp_eatClassSetOperand(t)){2===n&&(i=2);for(var r=t.pos;t.eatChars([38,38]);)38!==t.current()&&(n=this.regexp_eatClassSetOperand(t))?2!==n&&(i=1):t.raise("Invalid character in character class");if(r!==t.pos)return i;for(;t.eatChars([45,45]);)this.regexp_eatClassSetOperand(t)||t.raise("Invalid character in character class");if(r!==t.pos)return i}else t.raise("Invalid character in character class");for(;;)if(!this.regexp_eatClassSetRange(t)){if(!(n=this.regexp_eatClassSetOperand(t)))return i;2===n&&(i=2)}},At.regexp_eatClassSetRange=function(t){var n=t.pos;if(this.regexp_eatClassSetCharacter(t)){var i=t.lastIntValue;if(t.eat(45)&&this.regexp_eatClassSetCharacter(t)){var r=t.lastIntValue;return-1!==i&&-1!==r&&i>r&&t.raise("Range out of order in character class"),!0}t.pos=n}return!1},At.regexp_eatClassSetOperand=function(t){return this.regexp_eatClassSetCharacter(t)?1:this.regexp_eatClassStringDisjunction(t)||this.regexp_eatNestedClass(t)},At.regexp_eatNestedClass=function(t){var n=t.pos;if(t.eat(91)){var i=t.eat(94),r=this.regexp_classContents(t);if(t.eat(93))return i&&2===r&&t.raise("Negated character class may contain strings"),r;t.pos=n}if(t.eat(92)){var o=this.regexp_eatCharacterClassEscape(t);if(o)return o;t.pos=n}return null},At.regexp_eatClassStringDisjunction=function(t){var n=t.pos;if(t.eatChars([92,113])){if(t.eat(123)){var i=this.regexp_classStringDisjunctionContents(t);if(t.eat(125))return i}else t.raise("Invalid escape");t.pos=n}return null},At.regexp_classStringDisjunctionContents=function(t){for(var n=this.regexp_classString(t);t.eat(124);)2===this.regexp_classString(t)&&(n=2);return n},At.regexp_classString=function(t){for(var n=0;this.regexp_eatClassSetCharacter(t);)n++;return 1===n?1:2},At.regexp_eatClassSetCharacter=function(t){var n=t.pos;if(t.eat(92))return!(!this.regexp_eatCharacterEscape(t)&&!this.regexp_eatClassSetReservedPunctuator(t)&&(t.eat(98)?(t.lastIntValue=8,0):(t.pos=n,1)));var i=t.current();return!(i<0||i===t.lookahead()&&function isClassSetReservedDoublePunctuatorCharacter(t){return 33===t||t>=35&&t<=38||t>=42&&t<=44||46===t||t>=58&&t<=64||94===t||96===t||126===t}(i)||function isClassSetSyntaxCharacter(t){return 40===t||41===t||45===t||47===t||t>=91&&t<=93||t>=123&&t<=125}(i)||(t.advance(),t.lastIntValue=i,0))},At.regexp_eatClassSetReservedPunctuator=function(t){var n=t.current();return!!function isClassSetReservedPunctuator(t){return 33===t||35===t||37===t||38===t||44===t||45===t||t>=58&&t<=62||64===t||96===t||126===t}(n)&&(t.lastIntValue=n,t.advance(),!0)},At.regexp_eatClassControlLetter=function(t){var n=t.current();return!(!isDecimalDigit(n)&&95!==n||(t.lastIntValue=n%32,t.advance(),0))},At.regexp_eatHexEscapeSequence=function(t){var n=t.pos;if(t.eat(120)){if(this.regexp_eatFixedHexDigits(t,2))return!0;t.switchU&&t.raise("Invalid escape"),t.pos=n}return!1},At.regexp_eatDecimalDigits=function(t){var n=t.pos,i=0;for(t.lastIntValue=0;isDecimalDigit(i=t.current());)t.lastIntValue=10*t.lastIntValue+(i-48),t.advance();return t.pos!==n},At.regexp_eatHexDigits=function(t){var n=t.pos,i=0;for(t.lastIntValue=0;isHexDigit(i=t.current());)t.lastIntValue=16*t.lastIntValue+hexToInt(i),t.advance();return t.pos!==n},At.regexp_eatLegacyOctalEscapeSequence=function(t){if(this.regexp_eatOctalDigit(t)){var n=t.lastIntValue;if(this.regexp_eatOctalDigit(t)){var i=t.lastIntValue;n<=3&&this.regexp_eatOctalDigit(t)?t.lastIntValue=64*n+8*i+t.lastIntValue:t.lastIntValue=8*n+i}else t.lastIntValue=n;return!0}return!1},At.regexp_eatOctalDigit=function(t){var n=t.current();return isOctalDigit(n)?(t.lastIntValue=n-48,t.advance(),!0):(t.lastIntValue=0,!1)},At.regexp_eatFixedHexDigits=function(t,n){var i=t.pos;t.lastIntValue=0;for(var r=0;r<n;++r){var o=t.current();if(!isHexDigit(o))return t.pos=i,!1;t.lastIntValue=16*t.lastIntValue+hexToInt(o),t.advance()}return!0};var Ot=function Token2(t){this.type=t.type,this.value=t.value,this.start=t.start,this.end=t.end,t.options.locations&&(this.loc=new N(t,t.startLoc,t.endLoc)),t.options.ranges&&(this.range=[t.start,t.end])},Lt=z.prototype;function stringToBigInt(t){return"function"!=typeof BigInt?null:BigInt(t.replace(/_/g,""))}Lt.next=function(t){!t&&this.type.keyword&&this.containsEsc&&this.raiseRecoverable(this.start,"Escape sequence in keyword "+this.type.keyword),this.options.onToken&&this.options.onToken(new Ot(this)),this.lastTokEnd=this.end,this.lastTokStart=this.start,this.lastTokEndLoc=this.endLoc,this.lastTokStartLoc=this.startLoc,this.nextToken()},Lt.getToken=function(){return this.next(),new Ot(this)},"undefined"!=typeof Symbol&&(Lt[Symbol.iterator]=function(){var t=this;return{next:function(){var n=t.getToken();return{done:n.type===y.eof,value:n}}}}),Lt.nextToken=function(){var t=this.curContext();return t&&t.preserveSpace||this.skipSpace(),this.start=this.pos,this.options.locations&&(this.startLoc=this.curPosition()),this.pos>=this.input.length?this.finishToken(y.eof):t.override?t.override(this):void this.readToken(this.fullCharCodeAtPos())},Lt.readToken=function(t){return isIdentifierStart(t,this.options.ecmaVersion>=6)||92===t?this.readWord():this.getTokenFromCode(t)},Lt.fullCharCodeAtPos=function(){var t=this.input.charCodeAt(this.pos);if(t<=55295||t>=56320)return t;var n=this.input.charCodeAt(this.pos+1);return n<=56319||n>=57344?t:(t<<10)+n-56613888},Lt.skipBlockComment=function(){var t=this.options.onComment&&this.curPosition(),n=this.pos,i=this.input.indexOf("*/",this.pos+=2);if(-1===i&&this.raise(this.pos-2,"Unterminated comment"),this.pos=i+2,this.options.locations)for(var r=void 0,o=n;(r=nextLineBreak(this.input,o,this.pos))>-1;)++this.curLine,o=this.lineStart=r;this.options.onComment&&this.options.onComment(!0,this.input.slice(n+2,i),n,this.pos,t,this.curPosition())},Lt.skipLineComment=function(t){for(var n=this.pos,i=this.options.onComment&&this.curPosition(),r=this.input.charCodeAt(this.pos+=t);this.pos<this.input.length&&!isNewLine(r);)r=this.input.charCodeAt(++this.pos);this.options.onComment&&this.options.onComment(!1,this.input.slice(n+t,this.pos),n,this.pos,i,this.curPosition())},Lt.skipSpace=function(){t:for(;this.pos<this.input.length;){var t=this.input.charCodeAt(this.pos);switch(t){case 32:case 160:++this.pos;break;case 13:10===this.input.charCodeAt(this.pos+1)&&++this.pos;case 10:case 8232:case 8233:++this.pos,this.options.locations&&(++this.curLine,this.lineStart=this.pos);break;case 47:switch(this.input.charCodeAt(this.pos+1)){case 42:this.skipBlockComment();break;case 47:this.skipLineComment(2);break;default:break t}break;default:if(!(t>8&&t<14||t>=5760&&S.test(String.fromCharCode(t))))break t;++this.pos}}},Lt.finishToken=function(t,n){this.end=this.pos,this.options.locations&&(this.endLoc=this.curPosition());var i=this.type;this.type=t,this.value=n,this.updateContext(i)},Lt.readToken_dot=function(){var t=this.input.charCodeAt(this.pos+1);if(t>=48&&t<=57)return this.readNumber(!0);var n=this.input.charCodeAt(this.pos+2);return this.options.ecmaVersion>=6&&46===t&&46===n?(this.pos+=3,this.finishToken(y.ellipsis)):(++this.pos,this.finishToken(y.dot))},Lt.readToken_slash=function(){var t=this.input.charCodeAt(this.pos+1);return this.exprAllowed?(++this.pos,this.readRegexp()):61===t?this.finishOp(y.assign,2):this.finishOp(y.slash,1)},Lt.readToken_mult_modulo_exp=function(t){var n=this.input.charCodeAt(this.pos+1),i=1,r=42===t?y.star:y.modulo;return this.options.ecmaVersion>=7&&42===t&&42===n&&(++i,r=y.starstar,n=this.input.charCodeAt(this.pos+2)),61===n?this.finishOp(y.assign,i+1):this.finishOp(r,i)},Lt.readToken_pipe_amp=function(t){var n=this.input.charCodeAt(this.pos+1);return n===t?this.options.ecmaVersion>=12&&61===this.input.charCodeAt(this.pos+2)?this.finishOp(y.assign,3):this.finishOp(124===t?y.logicalOR:y.logicalAND,2):61===n?this.finishOp(y.assign,2):this.finishOp(124===t?y.bitwiseOR:y.bitwiseAND,1)},Lt.readToken_caret=function(){return 61===this.input.charCodeAt(this.pos+1)?this.finishOp(y.assign,2):this.finishOp(y.bitwiseXOR,1)},Lt.readToken_plus_min=function(t){var n=this.input.charCodeAt(this.pos+1);return n===t?45!==n||this.inModule||62!==this.input.charCodeAt(this.pos+2)||0!==this.lastTokEnd&&!w.test(this.input.slice(this.lastTokEnd,this.pos))?this.finishOp(y.incDec,2):(this.skipLineComment(3),this.skipSpace(),this.nextToken()):61===n?this.finishOp(y.assign,2):this.finishOp(y.plusMin,1)},Lt.readToken_lt_gt=function(t){var n=this.input.charCodeAt(this.pos+1),i=1;return n===t?(i=62===t&&62===this.input.charCodeAt(this.pos+2)?3:2,61===this.input.charCodeAt(this.pos+i)?this.finishOp(y.assign,i+1):this.finishOp(y.bitShift,i)):33!==n||60!==t||this.inModule||45!==this.input.charCodeAt(this.pos+2)||45!==this.input.charCodeAt(this.pos+3)?(61===n&&(i=2),this.finishOp(y.relational,i)):(this.skipLineComment(4),this.skipSpace(),this.nextToken())},Lt.readToken_eq_excl=function(t){var n=this.input.charCodeAt(this.pos+1);return 61===n?this.finishOp(y.equality,61===this.input.charCodeAt(this.pos+2)?3:2):61===t&&62===n&&this.options.ecmaVersion>=6?(this.pos+=2,this.finishToken(y.arrow)):this.finishOp(61===t?y.eq:y.prefix,1)},Lt.readToken_question=function(){var t=this.options.ecmaVersion;if(t>=11){var n=this.input.charCodeAt(this.pos+1);if(46===n){var i=this.input.charCodeAt(this.pos+2);if(i<48||i>57)return this.finishOp(y.questionDot,2)}if(63===n)return t>=12&&61===this.input.charCodeAt(this.pos+2)?this.finishOp(y.assign,3):this.finishOp(y.coalesce,2)}return this.finishOp(y.question,1)},Lt.readToken_numberSign=function(){var t=35;if(this.options.ecmaVersion>=13&&(++this.pos,isIdentifierStart(t=this.fullCharCodeAtPos(),!0)||92===t))return this.finishToken(y.privateId,this.readWord1());this.raise(this.pos,"Unexpected character '"+codePointToString(t)+"'")},Lt.getTokenFromCode=function(t){switch(t){case 46:return this.readToken_dot();case 40:return++this.pos,this.finishToken(y.parenL);case 41:return++this.pos,this.finishToken(y.parenR);case 59:return++this.pos,this.finishToken(y.semi);case 44:return++this.pos,this.finishToken(y.comma);case 91:return++this.pos,this.finishToken(y.bracketL);case 93:return++this.pos,this.finishToken(y.bracketR);case 123:return++this.pos,this.finishToken(y.braceL);case 125:return++this.pos,this.finishToken(y.braceR);case 58:return++this.pos,this.finishToken(y.colon);case 96:if(this.options.ecmaVersion<6)break;return++this.pos,this.finishToken(y.backQuote);case 48:var n=this.input.charCodeAt(this.pos+1);if(120===n||88===n)return this.readRadixNumber(16);if(this.options.ecmaVersion>=6){if(111===n||79===n)return this.readRadixNumber(8);if(98===n||66===n)return this.readRadixNumber(2)}case 49:case 50:case 51:case 52:case 53:case 54:case 55:case 56:case 57:return this.readNumber(!1);case 34:case 39:return this.readString(t);case 47:return this.readToken_slash();case 37:case 42:return this.readToken_mult_modulo_exp(t);case 124:case 38:return this.readToken_pipe_amp(t);case 94:return this.readToken_caret();case 43:case 45:return this.readToken_plus_min(t);case 60:case 62:return this.readToken_lt_gt(t);case 61:case 33:return this.readToken_eq_excl(t);case 63:return this.readToken_question();case 126:return this.finishOp(y.prefix,1);case 35:return this.readToken_numberSign()}this.raise(this.pos,"Unexpected character '"+codePointToString(t)+"'")},Lt.finishOp=function(t,n){var i=this.input.slice(this.pos,this.pos+n);return this.pos+=n,this.finishToken(t,i)},Lt.readRegexp=function(){for(var t,n,i=this.pos;;){this.pos>=this.input.length&&this.raise(i,"Unterminated regular expression");var r=this.input.charAt(this.pos);if(w.test(r)&&this.raise(i,"Unterminated regular expression"),t)t=!1;else{if("["===r)n=!0;else if("]"===r&&n)n=!1;else if("/"===r&&!n)break;t="\\"===r}++this.pos}var o=this.input.slice(i,this.pos);++this.pos;var h=this.pos,c=this.readWord1();this.containsEsc&&this.unexpected(h);var u=this.regexpState||(this.regexpState=new Tt(this));u.reset(i,o,c),this.validateRegExpFlags(u),this.validateRegExpPattern(u);var d=null;try{d=new RegExp(o,c)}catch(dr){}return this.finishToken(y.regexp,{pattern:o,flags:c,value:d})},Lt.readInt=function(t,n,i){for(var r=this.options.ecmaVersion>=12&&void 0===n,o=i&&48===this.input.charCodeAt(this.pos),h=this.pos,c=0,u=0,d=0,p=null==n?1/0:n;d<p;++d,++this.pos){var g=this.input.charCodeAt(this.pos),m=void 0;if(r&&95===g)o&&this.raiseRecoverable(this.pos,"Numeric separator is not allowed in legacy octal numeric literals"),95===u&&this.raiseRecoverable(this.pos,"Numeric separator must be exactly one underscore"),0===d&&this.raiseRecoverable(this.pos,"Numeric separator is not allowed at the first of digits"),u=g;else{if((m=g>=97?g-97+10:g>=65?g-65+10:g>=48&&g<=57?g-48:1/0)>=t)break;u=g,c=c*t+m}}return r&&95===u&&this.raiseRecoverable(this.pos-1,"Numeric separator is not allowed at the last of digits"),this.pos===h||null!=n&&this.pos-h!==n?null:c},Lt.readRadixNumber=function(t){var n=this.pos;this.pos+=2;var i=this.readInt(t);return null==i&&this.raise(this.start+2,"Expected number in radix "+t),this.options.ecmaVersion>=11&&110===this.input.charCodeAt(this.pos)?(i=stringToBigInt(this.input.slice(n,this.pos)),++this.pos):isIdentifierStart(this.fullCharCodeAtPos())&&this.raise(this.pos,"Identifier directly after number"),this.finishToken(y.num,i)},Lt.readNumber=function(t){var n=this.pos;t||null!==this.readInt(10,void 0,!0)||this.raise(n,"Invalid number");var i=this.pos-n>=2&&48===this.input.charCodeAt(n);i&&this.strict&&this.raise(n,"Invalid number");var r=this.input.charCodeAt(this.pos);if(!i&&!t&&this.options.ecmaVersion>=11&&110===r){var o=stringToBigInt(this.input.slice(n,this.pos));return++this.pos,isIdentifierStart(this.fullCharCodeAtPos())&&this.raise(this.pos,"Identifier directly after number"),this.finishToken(y.num,o)}i&&/[89]/.test(this.input.slice(n,this.pos))&&(i=!1),46!==r||i||(++this.pos,this.readInt(10),r=this.input.charCodeAt(this.pos)),69!==r&&101!==r||i||(43!==(r=this.input.charCodeAt(++this.pos))&&45!==r||++this.pos,null===this.readInt(10)&&this.raise(n,"Invalid number")),isIdentifierStart(this.fullCharCodeAtPos())&&this.raise(this.pos,"Identifier directly after number");var h=function stringToNumber(t,n){return n?parseInt(t,8):parseFloat(t.replace(/_/g,""))}(this.input.slice(n,this.pos),i);return this.finishToken(y.num,h)},Lt.readCodePoint=function(){var t;if(123===this.input.charCodeAt(this.pos)){this.options.ecmaVersion<6&&this.unexpected();var n=++this.pos;t=this.readHexChar(this.input.indexOf("}",this.pos)-this.pos),++this.pos,t>1114111&&this.invalidStringToken(n,"Code point out of bounds")}else t=this.readHexChar(4);return t},Lt.readString=function(t){for(var n="",i=++this.pos;;){this.pos>=this.input.length&&this.raise(this.start,"Unterminated string constant");var r=this.input.charCodeAt(this.pos);if(r===t)break;92===r?(n+=this.input.slice(i,this.pos),n+=this.readEscapedChar(!1),i=this.pos):8232===r||8233===r?(this.options.ecmaVersion<10&&this.raise(this.start,"Unterminated string constant"),++this.pos,this.options.locations&&(this.curLine++,this.lineStart=this.pos)):(isNewLine(r)&&this.raise(this.start,"Unterminated string constant"),++this.pos)}return n+=this.input.slice(i,this.pos++),this.finishToken(y.string,n)};var Dt={};Lt.tryReadTemplateToken=function(){this.inTemplateElement=!0;try{this.readTmplToken()}catch(t){if(t!==Dt)throw t;this.readInvalidTemplateToken()}this.inTemplateElement=!1},Lt.invalidStringToken=function(t,n){if(this.inTemplateElement&&this.options.ecmaVersion>=9)throw Dt;this.raise(t,n)},Lt.readTmplToken=function(){for(var t="",n=this.pos;;){this.pos>=this.input.length&&this.raise(this.start,"Unterminated template");var i=this.input.charCodeAt(this.pos);if(96===i||36===i&&123===this.input.charCodeAt(this.pos+1))return this.pos!==this.start||this.type!==y.template&&this.type!==y.invalidTemplate?(t+=this.input.slice(n,this.pos),this.finishToken(y.template,t)):36===i?(this.pos+=2,this.finishToken(y.dollarBraceL)):(++this.pos,this.finishToken(y.backQuote));if(92===i)t+=this.input.slice(n,this.pos),t+=this.readEscapedChar(!0),n=this.pos;else if(isNewLine(i)){switch(t+=this.input.slice(n,this.pos),++this.pos,i){case 13:10===this.input.charCodeAt(this.pos)&&++this.pos;case 10:t+="\n";break;default:t+=String.fromCharCode(i)}this.options.locations&&(++this.curLine,this.lineStart=this.pos),n=this.pos}else++this.pos}},Lt.readInvalidTemplateToken=function(){for(;this.pos<this.input.length;this.pos++)switch(this.input[this.pos]){case"\\":++this.pos;break;case"$":if("{"!==this.input[this.pos+1])break;case"`":return this.finishToken(y.invalidTemplate,this.input.slice(this.start,this.pos))}this.raise(this.start,"Unterminated template")},Lt.readEscapedChar=function(t){var n=this.input.charCodeAt(++this.pos);switch(++this.pos,n){case 110:return"\n";case 114:return"\r";case 120:return String.fromCharCode(this.readHexChar(2));case 117:return codePointToString(this.readCodePoint());case 116:return"\t";case 98:return"\b";case 118:return"\v";case 102:return"\f";case 13:10===this.input.charCodeAt(this.pos)&&++this.pos;case 10:return this.options.locations&&(this.lineStart=this.pos,++this.curLine),"";case 56:case 57:if(this.strict&&this.invalidStringToken(this.pos-1,"Invalid escape sequence"),t){var i=this.pos-1;this.invalidStringToken(i,"Invalid escape sequence in template string")}default:if(n>=48&&n<=55){var r=this.input.substr(this.pos-1,3).match(/^[0-7]+/)[0],o=parseInt(r,8);return o>255&&(r=r.slice(0,-1),o=parseInt(r,8)),this.pos+=r.length-1,n=this.input.charCodeAt(this.pos),"0"===r&&56!==n&&57!==n||!this.strict&&!t||this.invalidStringToken(this.pos-1-r.length,t?"Octal literal in template string":"Octal literal in strict mode"),String.fromCharCode(o)}return isNewLine(n)?"":String.fromCharCode(n)}},Lt.readHexChar=function(t){var n=this.pos,i=this.readInt(16,t);return null===i&&this.invalidStringToken(n,"Bad character escape sequence"),i},Lt.readWord1=function(){this.containsEsc=!1;for(var t="",n=!0,i=this.pos,r=this.options.ecmaVersion>=6;this.pos<this.input.length;){var o=this.fullCharCodeAtPos();if(isIdentifierChar(o,r))this.pos+=o<=65535?1:2;else{if(92!==o)break;this.containsEsc=!0,t+=this.input.slice(i,this.pos);var h=this.pos;117!==this.input.charCodeAt(++this.pos)&&this.invalidStringToken(this.pos,"Expecting Unicode escape sequence \\uXXXX"),++this.pos;var c=this.readCodePoint();(n?isIdentifierStart:isIdentifierChar)(c,r)||this.invalidStringToken(h,"Invalid Unicode escape"),t+=codePointToString(c),i=this.pos}n=!1}return t+this.input.slice(i,this.pos)},Lt.readWord=function(){var t=this.readWord1(),n=y.name;return this.keywords.test(t)&&(n=_[t]),this.finishToken(n,t)};var Nt="8.11.3";z.acorn={Parser:z,version:Nt,defaultOptions:j,Position:D,SourceLocation:N,getLineInfo:getLineInfo,Node:ut,TokenType:g,tokTypes:y,keywordTypes:_,TokContext:nt,tokContexts:it,isIdentifierChar:isIdentifierChar,isIdentifierStart:isIdentifierStart,Token:Ot,isNewLine:isNewLine,lineBreak:w,lineBreakG:x,nonASCIIwhitespace:S},t.Node=ut,t.Parser=z,t.Position=D,t.SourceLocation=N,t.TokContext=nt,t.Token=Ot,t.TokenType=g,t.defaultOptions=j,t.getLineInfo=getLineInfo,t.isIdentifierChar=isIdentifierChar,t.isIdentifierStart=isIdentifierStart,t.isNewLine=isNewLine,t.keywordTypes=_,t.lineBreak=w,t.lineBreakG=x,t.nonASCIIwhitespace=S,t.parse=function parse2(t,n){return z.parse(t,n)},t.parseExpressionAt=function parseExpressionAt(t,n,i){return z.parseExpressionAt(t,n,i)},t.tokContexts=it,t.tokTypes=y,t.tokenizer=function tokenizer(t,n){return z.tokenizer(t,n)},t.version=Nt},"object"==typeof t&&void 0!==n?r(t):"function"==typeof define&&define.amd?define(["exports"],r):r((i="undefined"!=typeof globalThis?globalThis:i||self).acorn={})}}),we=__commonJS({"(disabled):../../node_modules/.pnpm/paper@0.12.17/node_modules/paper/dist/node/extend.js"(){}}),be=__commonJS({"../../node_modules/.pnpm/paper@0.12.17/node_modules/paper/dist/paper-full.js"(t,n){(function(t,i){var r=(t=t||_e()).window,o=t.document,h=new function(){var t=/^(statics|enumerable|beans|preserve)$/,n=[],r=n.slice,o=Object.create,h=Object.getOwnPropertyDescriptor,c=Object.defineProperty,u=n.forEach||function(t,n){for(var i=0,r=this.length;i<r;i++)t.call(n,this[i],i,this)},forIn=function(t,n){for(var i in this)this.hasOwnProperty(i)&&t.call(n,this[i],i,this)},d=Object.assign||function(t){for(var n=1,i=arguments.length;n<i;n++){var r=arguments[n];for(var o in r)r.hasOwnProperty(o)&&(t[o]=r[o])}return t},each=function(t,n,i){if(t){var r=h(t,"length");(r&&"number"==typeof r.value?u:forIn).call(t,n,i=i||t)}return i};function inject(n,i,r,o,u){var d={};function field(t,p){"string"==typeof(p=p||(p=h(i,t))&&(p.get?p:p.value))&&"#"===p[0]&&(p=n[p.substring(1)]||p);var g,m="function"==typeof p,v=p,_=u||m&&!p.base?p&&p.get?t in n:n[t]:null;u&&_||(m&&_&&(p.base=_),m&&!1!==o&&(g=t.match(/^([gs]et|is)(([A-Z])(.*))$/))&&(d[g[3].toLowerCase()+g[4]]=g[2]),v&&!m&&v.get&&"function"==typeof v.get&&Base2.isPlainObject(v)||(v={value:v,writable:!0}),(h(n,t)||{configurable:!0}).configurable&&(v.configurable=!0,v.enumerable=null!=r?r:!g),c(n,t,v))}if(i){for(var p in i)i.hasOwnProperty(p)&&!t.test(p)&&field(p);for(var p in d){var g=d[p],m=n["set"+g],v=n["get"+g]||m&&n["is"+g];!v||!0!==o&&0!==v.length||field(p,{get:v,set:m})}}return n}function Base2(){for(var t=0,n=arguments.length;t<n;t++){var i=arguments[t];i&&d(this,i)}return this}return inject(Base2,{inject:function(t){if(t){var n=!0===t.statics?t:t.statics,i=t.beans,r=t.preserve;n!==t&&inject(this.prototype,t,t.enumerable,i,r),inject(this,n,null,i,r)}for(var o=1,h=arguments.length;o<h;o++)this.inject(arguments[o]);return this},extend:function(){for(var t,n,i,r=this,h=0,u=arguments.length;h<u&&(!t||!n);h++)i=arguments[h],t=t||i.initialize,n=n||i.prototype;return t=t||function(){r.apply(this,arguments)},n=t.prototype=n||o(this.prototype),c(n,"constructor",{value:t,writable:!0,configurable:!0}),inject(t,this),arguments.length&&this.inject.apply(t,arguments),t.base=r,t}}).inject({enumerable:!1,initialize:Base2,set:Base2,inject:function(){for(var t=0,n=arguments.length;t<n;t++){var i=arguments[t];i&&inject(this,i,i.enumerable,i.beans,i.preserve)}return this},extend:function(){var t=o(this);return t.inject.apply(t,arguments)},each:function(t,n){return each(this,t,n)},clone:function(){return new this.constructor(this)},statics:{set:d,each:each,create:o,define:c,describe:h,clone:function(t){return d(new t.constructor,t)},isPlainObject:function(t){var n=null!=t&&t.constructor;return n&&(n===Object||n===Base2||"Object"===n.name)},pick:function(t,n){return t!==i?t:n},slice:function(t,n,i){return r.call(t,n,i)}}})};void 0!==n&&(n.exports=h),h.inject({enumerable:!1,toString:function(){return null!=this._id?(this._class||"Object")+(this._name?" '"+this._name+"'":" @"+this._id):"{ "+h.each(this,(function(t,n){if(!/^_/.test(n)){var i=typeof t;this.push(n+": "+("number"===i?g.instance.number(t):"string"===i?"'"+t+"'":t))}}),[]).join(", ")+" }"},getClassName:function(){return this._class||""},importJSON:function(t){return h.importJSON(t,this)},exportJSON:function(t){return h.exportJSON(this,t)},toJSON:function(){return h.serialize(this)},set:function(t,n){return t&&h.filter(this,t,n,this._prioritize),this}},{beans:!1,statics:{exports:{},extend:function extend(){var t=extend.base.apply(this,arguments),n=t.prototype._class;return n&&!h.exports[n]&&(h.exports[n]=t),t},equals:function(t,n){if(t===n)return!0;if(t&&t.equals)return t.equals(n);if(n&&n.equals)return n.equals(t);if(t&&n&&"object"==typeof t&&"object"==typeof n){if(Array.isArray(t)&&Array.isArray(n)){if((i=t.length)!==n.length)return!1;for(;i--;)if(!h.equals(t[i],n[i]))return!1}else{var i,r=Object.keys(t);if((i=r.length)!==Object.keys(n).length)return!1;for(;i--;){var o=r[i];if(!n.hasOwnProperty(o)||!h.equals(t[o],n[o]))return!1}}return!0}return!1},read:function(t,n,r,o){if(this===h){var c=this.peek(t,n);return t.__index++,c}var u=this.prototype,d=u._readIndex,p=n||d&&t.__index||0,g=t.length,m=t[p];if(o=o||g-p,m instanceof this||r&&r.readNull&&null==m&&o<=1)return d&&(t.__index=p+1),m&&r&&r.clone?m.clone():m;if(m=h.create(u),d&&(m.__read=!0),m=m.initialize.apply(m,p>0||p+o<g?h.slice(t,p,p+o):t)||m,d){t.__index=p+m.__read;var v=m.__filtered;v&&(t.__filtered=v,m.__filtered=i),m.__read=i}return m},peek:function(t,n){return t[t.__index=n||t.__index||0]},remain:function(t){return t.length-(t.__index||0)},readList:function(t,n,i,r){for(var o,h=[],c=n||0,u=r?c+r:t.length,d=c;d<u;d++)h.push(Array.isArray(o=t[d])?this.read(o,0,i):this.read(t,d,i,1));return h},readNamed:function(t,n,r,o,c){var u=this.getNamed(t,n),d=u!==i;if(d){var p=t.__filtered;if(!p){var g=this.getSource(t);(p=t.__filtered=h.create(g)).__unfiltered=g}p[n]=i}return this.read(d?[u]:t,r,o,c)},readSupported:function(t,n){var r=this.getSource(t),o=this,h=!1;return r&&Object.keys(r).forEach((function(r){if(r in n){var c=o.readNamed(t,r);c!==i&&(n[r]=c),h=!0}})),h},getSource:function(t){var n=t.__source;if(n===i){var r=1===t.length&&t[0];n=t.__source=r&&h.isPlainObject(r)?r:null}return n},getNamed:function(t,n){var i=this.getSource(t);if(i)return n?i[n]:t.__filtered||i},hasNamed:function(t,n){return!!this.getNamed(t,n)},filter:function(t,n,r,o){var h;function handleKey(o){if(!(r&&o in r||h&&o in h)){var c=n[o];c!==i&&(t[o]=c)}}if(o){for(var c,u={},d=0,p=o.length;d<p;d++)(c=o[d])in n&&(handleKey(c),u[c]=!0);h=u}return Object.keys(n.__unfiltered||n).forEach(handleKey),t},isPlainValue:function(t,n){return h.isPlainObject(t)||Array.isArray(t)||n&&"string"==typeof t},serialize:function(t,n,i,r){n=n||{};var o,c=!r;if(c&&(n.formatter=new g(n.precision),r={length:0,definitions:{},references:{},add:function(t,n){var i="#"+t._id,r=this.references[i];if(!r){this.length++;var o=n.call(t),h=t._class;h&&o[0]!==h&&o.unshift(h),this.definitions[i]=o,r=this.references[i]=[i]}return r}}),t&&t._serialize){o=t._serialize(n,r);var u=t._class;!u||t._compactSerialize||!c&&i||o[0]===u||o.unshift(u)}else if(Array.isArray(t)){o=[];for(var d=0,p=t.length;d<p;d++)o[d]=h.serialize(t[d],n,i,r)}else if(h.isPlainObject(t)){o={};var m=Object.keys(t);for(d=0,p=m.length;d<p;d++){var v=m[d];o[v]=h.serialize(t[v],n,i,r)}}else o="number"==typeof t?n.formatter.number(t,n.precision):t;return c&&r.length>0?[["dictionary",r.definitions],o]:o},deserialize:function(t,n,i,r,o){var c=t,u=!i,d=u&&t&&t.length&&"dictionary"===t[0][0];if(i=i||{},Array.isArray(t)){var p=t[0],g="dictionary"===p;if(1==t.length&&/^#/.test(p))return i.dictionary[p];c=[];for(var m=(p=h.exports[p])?1:0,v=t.length;m<v;m++)c.push(h.deserialize(t[m],n,i,g,d));if(p){var _=c;c=n?n(p,_,u||o):new p(_)}}else if(h.isPlainObject(t))for(var y in c={},r&&(i.dictionary=c),t)c[y]=h.deserialize(t[y],n,i);return d?c[1]:c},exportJSON:function(t,n){var i=h.serialize(t,n);return n&&0==n.asString?i:JSON.stringify(i)},importJSON:function(t,n){return h.deserialize("string"==typeof t?JSON.parse(t):t,(function(t,i,r){var o=r&&n&&n.constructor===t,c=o?n:h.create(t.prototype);if(1===i.length&&c instanceof M&&(o||!(c instanceof T))){var u=i[0];h.isPlainObject(u)&&(u.insert=!1,o&&(i=i.concat([M.INSERT])))}return(o?c.set:t).apply(c,i),o&&(n=null),c}))},push:function(t,n){var i=n.length;if(i<4096)t.push.apply(t,n);else{var r=t.length;t.length+=i;for(var o=0;o<i;o++)t[r+o]=n[o]}return t},splice:function(t,n,r,o){var c=n&&n.length,u=r===i;(r=u?t.length:r)>t.length&&(r=t.length);for(var d=0;d<c;d++)n[d]._index=r+d;if(u)return h.push(t,n),[];var p=[r,o];n&&h.push(p,n);for(var g=t.splice.apply(t,p),m=(d=0,g.length);d<m;d++)g[d]._index=i;for(d=r+c,m=t.length;d<m;d++)t[d]._index=d;return g},capitalize:function(t){return t.replace(/\b[a-z]/g,(function(t){return t.toUpperCase()}))},camelize:function(t){return t.replace(/-(.)/g,(function(t,n){return n.toUpperCase()}))},hyphenate:function(t){return t.replace(/([a-z])([A-Z])/g,"$1-$2").toLowerCase()}}});var c={on:function(t,n){if("string"!=typeof t)h.each(t,(function(t,n){this.on(n,t)}),this);else{var i=this._eventTypes,r=i&&i[t],o=this._callbacks=this._callbacks||{};-1===(o=o[t]=o[t]||[]).indexOf(n)&&(o.push(n),r&&r.install&&1===o.length&&r.install.call(this,t))}return this},off:function(t,n){if("string"==typeof t){var i,r=this._eventTypes,o=r&&r[t],c=this._callbacks&&this._callbacks[t];return c&&(!n||-1!==(i=c.indexOf(n))&&1===c.length?(o&&o.uninstall&&o.uninstall.call(this,t),delete this._callbacks[t]):-1!==i&&c.splice(i,1)),this}h.each(t,(function(t,n){this.off(n,t)}),this)},once:function(t,n){return this.on(t,(function handler(){n.apply(this,arguments),this.off(t,handler)}))},emit:function(t,n){var i=this._callbacks&&this._callbacks[t];if(!i)return!1;var r=h.slice(arguments,1),o=n&&n.target&&!n.currentTarget;i=i.slice(),o&&(n.currentTarget=this);for(var c=0,u=i.length;c<u;c++)if(0==i[c].apply(this,r)){n&&n.stop&&n.stop();break}return o&&delete n.currentTarget,!0},responds:function(t){return!(!this._callbacks||!this._callbacks[t])},attach:"#on",detach:"#off",fire:"#emit",_installEvents:function(t){var n=this._eventTypes,i=this._callbacks,r=t?"install":"uninstall";if(n)for(var o in i)if(i[o].length>0){var h=n[o],c=h&&h[r];c&&c.call(this,o)}},statics:{inject:function inject(t){var n=t._events;if(n){var i={};h.each(n,(function(n,r){var o="string"==typeof n,c=o?n:r,u=h.capitalize(c),d=c.substring(2).toLowerCase();i[d]=o?{}:n,c="_"+c,t["get"+u]=function(){return this[c]},t["set"+u]=function(t){var n=this[c];n&&this.off(d,n),t&&this.on(d,t),this[c]=t}})),t._eventTypes=i}return inject.base.apply(this,arguments)}}},u=h.extend({_class:"PaperScope",initialize:function PaperScope2(){wt=this,this.settings=new h({applyMatrix:!0,insertItems:!0,handleSize:4,hitTolerance:0}),this.project=null,this.projects=[],this.tools=[],this._id=PaperScope2._id++,PaperScope2._scopes[this._id]=this;var n=PaperScope2.prototype;if(!this.support){var i=mt.getContext(1,1)||{};n.support={nativeDash:"setLineDash"in i||"mozDash"in i,nativeBlendModes:vt.nativeModes},mt.release(i)}if(!this.agent){var r=t.navigator.userAgent.toLowerCase(),o=(/(darwin|win|mac|linux|freebsd|sunos)/.exec(r)||[])[0],c="darwin"===o?"mac":o,u=n.agent=n.browser={platform:c};c&&(u[c]=!0),r.replace(/(opera|chrome|safari|webkit|firefox|msie|trident|atom|node|jsdom)\/?\s*([.\d]+)(?:.*version\/([.\d]+))?(?:.*rv\:v?([.\d]+))?/g,(function(t,n,i,r,o){if(!u.chrome){var h="opera"===n?r:/^(node|trident)$/.test(n)?o:i;u.version=h,u.versionNumber=parseFloat(h),n={trident:"msie",jsdom:"node"}[n]||n,u.name=n,u[n]=!0}})),u.chrome&&delete u.webkit,u.atom&&delete u.chrome}},version:"0.12.17",getView:function(){var t=this.project;return t&&t._view},getPaper:function(){return this},execute:function(t,n){var i=wt.PaperScript.execute(t,this,n);return ot.updateFocus(),i},install:function(t){var n=this;for(var i in h.each(["project","view","tool"],(function(i){h.define(t,i,{configurable:!0,get:function(){return n[i]}})})),this)!/^_/.test(i)&&this[i]&&(t[i]=this[i])},setup:function(t){return wt=this,this.project=new I(t),this},createCanvas:function(t,n){return mt.getCanvas(t,n)},activate:function(){wt=this},clear:function(){for(var t=this.projects,n=this.tools,i=t.length-1;i>=0;i--)t[i].remove();for(i=n.length-1;i>=0;i--)n[i].remove()},remove:function(){this.clear(),delete u._scopes[this._id]},statics:new function(){function handleAttribute(t){return t+="Attribute",function(n,i){return n[t](i)||n[t]("data-paper-"+i)}}return{_scopes:{},_id:0,get:function(t){return this._scopes[t]||null},getAttribute:handleAttribute("get"),hasAttribute:handleAttribute("has")}}}),d=h.extend(c,{initialize:function(t){this._scope=wt,this._index=this._scope[this._list].push(this)-1,!t&&this._scope[this._reference]||this.activate()},activate:function(){if(!this._scope)return!1;var t=this._scope[this._reference];return t&&t!==this&&t.emit("deactivate"),this._scope[this._reference]=this,this.emit("activate",t),!0},isActive:function(){return this._scope[this._reference]===this},remove:function(){return null!=this._index&&(h.splice(this._scope[this._list],null,this._index,1),this._scope[this._reference]==this&&(this._scope[this._reference]=null),this._scope=null,!0)},getView:function(){return this._scope.getView()}}),p={findItemBoundsCollisions:function(t,n,i){function getBounds(t){for(var n=new Array(t.length),i=0;i<t.length;i++){var r=t[i].getBounds();n[i]=[r.left,r.top,r.right,r.bottom]}return n}var r=getBounds(t),o=n&&n!==t?getBounds(n):r;return this.findBoundsCollisions(r,o,i||0)},findCurveBoundsCollisions:function(t,n,i,r){function getBounds(t){for(var n=Math.min,i=Math.max,r=new Array(t.length),o=0;o<t.length;o++){var h=t[o];r[o]=[n(h[0],h[2],h[4],h[6]),n(h[1],h[3],h[5],h[7]),i(h[0],h[2],h[4],h[6]),i(h[1],h[3],h[5],h[7])]}return r}var o=getBounds(t),h=n&&n!==t?getBounds(n):o;if(r){for(var c=this.findBoundsCollisions(o,h,i||0,!1,!0),u=this.findBoundsCollisions(o,h,i||0,!0,!0),d=[],p=0,g=c.length;p<g;p++)d[p]={hor:c[p],ver:u[p]};return d}return this.findBoundsCollisions(o,h,i||0)},findBoundsCollisions:function(t,n,i,r,o){var h=!n||t===n,c=h?t:t.concat(n),u=t.length,d=c.length;function binarySearch(t,n,i){for(var r=0,o=t.length;r<o;){var h=o+r>>>1;c[t[h]][n]<i?r=h+1:o=h}return r-1}for(var p=r?1:0,g=p+2,m=r?0:1,v=m+2,_=new Array(d),y=0;y<d;y++)_[y]=y;_.sort((function(t,n){return c[t][p]-c[n][p]}));var w=[],x=new Array(u);for(y=0;y<d;y++){var S=_[y],C=c[S],k=h?S:S-u,P=S<u,I=h||!P,M=P?[]:null;if(w.length){var E=binarySearch(w,g,C[p]-i)+1;if(w.splice(0,E),h&&o){M=M.concat(w);for(var T=0;T<w.length;T++){x[N=w[T]].push(k)}}else{var O=C[v],D=C[m];for(T=0;T<w.length;T++){var N=w[T],j=c[N],V=N<u,U=h||N>=u;(o||(P&&U||I&&V)&&O>=j[m]-i&&D<=j[v]+i)&&(P&&U&&M.push(h?N:N-u),I&&V&&x[N].push(k))}}}if(P&&(t===n&&M.push(S),x[S]=M),w.length){var z=binarySearch(w,g,C[g]);w.splice(z+1,0,S)}else w.push(S)}for(y=0;y<x.length;y++){var F=x[y];F&&F.sort((function(t,n){return t-n}))}return x}},g=h.extend({initialize:function(t){this.precision=h.pick(t,5),this.multiplier=Math.pow(10,this.precision)},number:function(t){return this.precision<16?Math.round(t*this.multiplier)/this.multiplier:t},pair:function(t,n,i){return this.number(t)+(i||",")+this.number(n)},point:function(t,n){return this.number(t.x)+(n||",")+this.number(t.y)},size:function(t,n){return this.number(t.width)+(n||",")+this.number(t.height)},rectangle:function(t,n){return this.point(t,n)+(n||",")+this.size(t,n)}});g.instance=new g;var m=new function(){var t=[[.5773502691896257],[0,.7745966692414834],[.33998104358485626,.8611363115940526],[0,.5384693101056831,.906179845938664],[.2386191860831969,.6612093864662645,.932469514203152],[0,.4058451513773972,.7415311855993945,.9491079123427585],[.1834346424956498,.525532409916329,.7966664774136267,.9602898564975363],[0,.3242534234038089,.6133714327005904,.8360311073266358,.9681602395076261],[.14887433898163122,.4333953941292472,.6794095682990244,.8650633666889845,.9739065285171717],[0,.26954315595234496,.5190961292068118,.7301520055740494,.8870625997680953,.978228658146057],[.1252334085114689,.3678314989981802,.5873179542866175,.7699026741943047,.9041172563704749,.9815606342467192],[0,.2304583159551348,.44849275103644687,.6423493394403402,.8015780907333099,.9175983992229779,.9841830547185881],[.10805494870734367,.31911236892788974,.5152486363581541,.6872929048116855,.827201315069765,.9284348836635735,.9862838086968123],[0,.20119409399743451,.3941513470775634,.5709721726085388,.7244177313601701,.8482065834104272,.937273392400706,.9879925180204854],[.09501250983763744,.2816035507792589,.45801677765722737,.6178762444026438,.755404408355003,.8656312023878318,.9445750230732326,.9894009349916499]],n=[[1],[.8888888888888888,.5555555555555556],[.6521451548625461,.34785484513745385],[.5688888888888889,.47862867049936647,.23692688505618908],[.46791393457269104,.3607615730481386,.17132449237917036],[.4179591836734694,.3818300505051189,.27970539148927664,.1294849661688697],[.362683783378362,.31370664587788727,.22238103445337448,.10122853629037626],[.3302393550012598,.31234707704000286,.26061069640293544,.1806481606948574,.08127438836157441],[.29552422471475287,.26926671930999635,.21908636251598204,.1494513491505806,.06667134430868814],[.2729250867779006,.26280454451024665,.23319376459199048,.18629021092773426,.1255803694649046,.05566856711617366],[.24914704581340277,.2334925365383548,.20316742672306592,.16007832854334622,.10693932599531843,.04717533638651183],[.2325515532308739,.22628318026289723,.2078160475368885,.17814598076194574,.13887351021978725,.09212149983772845,.04048400476531588],[.2152638534631578,.2051984637212956,.18553839747793782,.15720316715819355,.12151857068790319,.08015808715976021,.03511946033175186],[.2025782419255613,.19843148532711158,.1861610000155622,.16626920581699392,.13957067792615432,.10715922046717194,.07036604748810812,.03075324199611727],[.1894506104550685,.18260341504492358,.16915651939500254,.14959598881657674,.12462897125553388,.09515851168249279,.062253523938647894,.027152459411754096]],i=Math.abs,r=Math.sqrt,o=Math.pow,h=Math.log2||function(t){return Math.log(t)*Math.LOG2E},c=1e-12,u=112e-18;function clamp(t,n,i){return t<n?n:t>i?i:t}function getDiscriminant(t,n,r){function split(t){var n=134217729*t,i=t-n+n;return[i,t-i]}var o=n*n-t*r,h=n*n+t*r;if(3*i(o)<h){var c=split(t),u=split(n),d=split(r),p=n*n,g=t*r;o=p-g+(u[0]*u[0]-p+2*u[0]*u[1]+u[1]*u[1]-(c[0]*d[0]-g+c[0]*d[1]+c[1]*d[0]+c[1]*d[1]))}return o}function getNormalizationFactor(){var t=Math.max.apply(Math,arguments);return t&&(t<1e-8||t>1e8)?o(2,-Math.round(h(t))):0}return{EPSILON:c,MACHINE_EPSILON:u,CURVETIME_EPSILON:1e-8,GEOMETRIC_EPSILON:1e-7,TRIGONOMETRIC_EPSILON:1e-8,ANGULAR_EPSILON:1e-5,KAPPA:4*(r(2)-1)/3,isZero:function(t){return t>=-1e-12&&t<=c},isMachineZero:function(t){return t>=-112e-18&&t<=u},clamp:clamp,integrate:function(i,r,o,h){for(var c=t[h-2],u=n[h-2],d=.5*(o-r),p=d+r,g=0,m=h+1>>1,v=1&h?u[g++]*i(p):0;g<m;){var _=d*c[g];v+=u[g++]*(i(p+_)+i(p-_))}return d*v},findRoot:function(t,n,r,o,h,c,u){for(var d=0;d<c;d++){var p=t(r),g=p/n(r),m=r-g;if(i(g)<u){r=m;break}p>0?(h=r,r=m<=o?.5*(o+h):m):(o=r,r=m>=h?.5*(o+h):m)}return clamp(r,o,h)},solveQuadratic:function(t,n,o,h,d,p){var g,m=1/0;if(i(t)<c){if(i(n)<c)return i(o)<c?-1:0;g=-o/n}else{var v=getDiscriminant(t,n*=-.5,o);if(v&&i(v)<u){var _=getNormalizationFactor(i(t),i(n),i(o));_&&(v=getDiscriminant(t*=_,n*=_,o*=_))}if(v>=-112e-18){var y=v<0?0:r(v),w=n+(n<0?-y:y);0===w?m=-(g=o/t):(g=w/t,m=o/w)}}var x=0,S=null==d,C=d-c,k=p+c;return isFinite(g)&&(S||g>C&&g<k)&&(h[x++]=S?g:clamp(g,d,p)),m!==g&&isFinite(m)&&(S||m>C&&m<k)&&(h[x++]=S?m:clamp(m,d,p)),x},solveCubic:function(t,n,h,d,p,g,v){var _,y,w,x,S,C=getNormalizationFactor(i(t),i(n),i(h),i(d));function evaluate(i){var r=t*(_=i);x=(r+(y=r+n))*_+(w=y*_+h),S=w*_+d}if(C&&(t*=C,n*=C,h*=C,d*=C),i(t)<c)t=n,y=h,w=d,_=1/0;else if(i(d)<c)y=n,w=h,_=0;else{evaluate(-n/t/3);var k=S/t,P=o(i(k),1/3),I=k<0?-1:1,M=-x/t,E=M>0?1.324717957244746*Math.max(P,r(M)):P,T=_-I*E;if(T!==_){do{evaluate(T),T=0===x?_:_-S/x/(1+u)}while(I*T>I*_);i(t)*_*_>i(d/_)&&(y=((w=-d/_)-h)/_)}}var O=m.solveQuadratic(t,y,w,p,g,v),D=null==g;return isFinite(_)&&(0===O||O>0&&_!==p[0]&&_!==p[1])&&(D||_>g-c&&_<v+c)&&(p[O++]=D?_:clamp(_,g,v)),O}}},v={_id:1,_pools:{},get:function(t){if(t){var n=this._pools[t];return n||(n=this._pools[t]={_id:1}),n._id++}return this._id++}},_=h.extend({_class:"Point",_readIndex:!0,initialize:function Point3(t,n){var i=typeof t,r=this.__read,o=0;if("number"===i){var h="number"==typeof n;this._set(t,h?n:t),r&&(o=h?2:1)}else if("undefined"===i||null===t)this._set(0,0),r&&(o=null===t?1:0);else{var c="string"===i?t.split(/[\s,]+/)||[]:t;o=1,Array.isArray(c)?this._set(+c[0],+(c.length>1?c[1]:c[0])):"x"in c?this._set(c.x||0,c.y||0):"width"in c?this._set(c.width||0,c.height||0):"angle"in c?(this._set(c.length||0,0),this.setAngle(c.angle||0)):(this._set(0,0),o=0)}return r&&(this.__read=o),this},set:"#initialize",_set:function(t,n){return this.x=t,this.y=n,this},equals:function(t){return this===t||t&&(this.x===t.x&&this.y===t.y||Array.isArray(t)&&this.x===t[0]&&this.y===t[1])||!1},clone:function(){return new _(this.x,this.y)},toString:function(){var t=g.instance;return"{ x: "+t.number(this.x)+", y: "+t.number(this.y)+" }"},_serialize:function(t){var n=t.formatter;return[n.number(this.x),n.number(this.y)]},getLength:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},setLength:function(t){if(this.isZero()){var n=this._angle||0;this._set(Math.cos(n)*t,Math.sin(n)*t)}else{var i=t/this.getLength();m.isZero(i)&&this.getAngle(),this._set(this.x*i,this.y*i)}},getAngle:function(){return 180*this.getAngleInRadians.apply(this,arguments)/Math.PI},setAngle:function(t){this.setAngleInRadians.call(this,t*Math.PI/180)},getAngleInDegrees:"#getAngle",setAngleInDegrees:"#setAngle",getAngleInRadians:function(){if(arguments.length){var t=_.read(arguments),n=this.getLength()*t.getLength();if(m.isZero(n))return NaN;var i=this.dot(t)/n;return Math.acos(i<-1?-1:i>1?1:i)}return this.isZero()?this._angle||0:this._angle=Math.atan2(this.y,this.x)},setAngleInRadians:function(t){if(this._angle=t,!this.isZero()){var n=this.getLength();this._set(Math.cos(t)*n,Math.sin(t)*n)}},getQuadrant:function(){return this.x>=0?this.y>=0?1:4:this.y>=0?2:3}},{beans:!1,getDirectedAngle:function(){var t=_.read(arguments);return 180*Math.atan2(this.cross(t),this.dot(t))/Math.PI},getDistance:function(){var t=arguments,n=_.read(t),i=n.x-this.x,r=n.y-this.y,o=i*i+r*r;return h.read(t)?o:Math.sqrt(o)},normalize:function(t){t===i&&(t=1);var n=this.getLength(),r=0!==n?t/n:0,o=new _(this.x*r,this.y*r);return r>=0&&(o._angle=this._angle),o},rotate:function(t,n){if(0===t)return this.clone();t=t*Math.PI/180;var i=n?this.subtract(n):this,r=Math.sin(t),o=Math.cos(t);return i=new _(i.x*o-i.y*r,i.x*r+i.y*o),n?i.add(n):i},transform:function(t){return t?t._transformPoint(this):this},add:function(){var t=_.read(arguments);return new _(this.x+t.x,this.y+t.y)},subtract:function(){var t=_.read(arguments);return new _(this.x-t.x,this.y-t.y)},multiply:function(){var t=_.read(arguments);return new _(this.x*t.x,this.y*t.y)},divide:function(){var t=_.read(arguments);return new _(this.x/t.x,this.y/t.y)},modulo:function(){var t=_.read(arguments);return new _(this.x%t.x,this.y%t.y)},negate:function(){return new _(-this.x,-this.y)},isInside:function(){return S.read(arguments).contains(this)},isClose:function(){var t=arguments,n=_.read(t),i=h.read(t);return this.getDistance(n)<=i},isCollinear:function(){var t=_.read(arguments);return _.isCollinear(this.x,this.y,t.x,t.y)},isColinear:"#isCollinear",isOrthogonal:function(){var t=_.read(arguments);return _.isOrthogonal(this.x,this.y,t.x,t.y)},isZero:function(){var t=m.isZero;return t(this.x)&&t(this.y)},isNaN:function(){return isNaN(this.x)||isNaN(this.y)},isInQuadrant:function(t){return this.x*(t>1&&t<4?-1:1)>=0&&this.y*(t>2?-1:1)>=0},dot:function(){var t=_.read(arguments);return this.x*t.x+this.y*t.y},cross:function(){var t=_.read(arguments);return this.x*t.y-this.y*t.x},project:function(){var t=_.read(arguments),n=t.isZero()?0:this.dot(t)/t.dot(t);return new _(t.x*n,t.y*n)},statics:{min:function(){var t=arguments,n=_.read(t),i=_.read(t);return new _(Math.min(n.x,i.x),Math.min(n.y,i.y))},max:function(){var t=arguments,n=_.read(t),i=_.read(t);return new _(Math.max(n.x,i.x),Math.max(n.y,i.y))},random:function(){return new _(Math.random(),Math.random())},isCollinear:function(t,n,i,r){return Math.abs(t*r-n*i)<=1e-8*Math.sqrt((t*t+n*n)*(i*i+r*r))},isOrthogonal:function(t,n,i,r){return Math.abs(t*i+n*r)<=1e-8*Math.sqrt((t*t+n*n)*(i*i+r*r))}}},h.each(["round","ceil","floor","abs"],(function(t){var n=Math[t];this[t]=function(){return new _(n(this.x),n(this.y))}}),{})),y=_.extend({initialize:function Point3(t,n,i,r){this._x=t,this._y=n,this._owner=i,this._setter=r},_set:function(t,n,i){return this._x=t,this._y=n,i||this._owner[this._setter](this),this},getX:function(){return this._x},setX:function(t){this._x=t,this._owner[this._setter](this)},getY:function(){return this._y},setY:function(t){this._y=t,this._owner[this._setter](this)},isSelected:function(){return!!(this._owner._selection&this._getSelection())},setSelected:function(t){this._owner._changeSelection(this._getSelection(),t)},_getSelection:function(){return"setPosition"===this._setter?4:0}}),w=h.extend({_class:"Size",_readIndex:!0,initialize:function Size2(t,n){var i=typeof t,r=this.__read,o=0;if("number"===i){var h="number"==typeof n;this._set(t,h?n:t),r&&(o=h?2:1)}else if("undefined"===i||null===t)this._set(0,0),r&&(o=null===t?1:0);else{var c="string"===i?t.split(/[\s,]+/)||[]:t;o=1,Array.isArray(c)?this._set(+c[0],+(c.length>1?c[1]:c[0])):"width"in c?this._set(c.width||0,c.height||0):"x"in c?this._set(c.x||0,c.y||0):(this._set(0,0),o=0)}return r&&(this.__read=o),this},set:"#initialize",_set:function(t,n){return this.width=t,this.height=n,this},equals:function(t){return t===this||t&&(this.width===t.width&&this.height===t.height||Array.isArray(t)&&this.width===t[0]&&this.height===t[1])||!1},clone:function(){return new w(this.width,this.height)},toString:function(){var t=g.instance;return"{ width: "+t.number(this.width)+", height: "+t.number(this.height)+" }"},_serialize:function(t){var n=t.formatter;return[n.number(this.width),n.number(this.height)]},add:function(){var t=w.read(arguments);return new w(this.width+t.width,this.height+t.height)},subtract:function(){var t=w.read(arguments);return new w(this.width-t.width,this.height-t.height)},multiply:function(){var t=w.read(arguments);return new w(this.width*t.width,this.height*t.height)},divide:function(){var t=w.read(arguments);return new w(this.width/t.width,this.height/t.height)},modulo:function(){var t=w.read(arguments);return new w(this.width%t.width,this.height%t.height)},negate:function(){return new w(-this.width,-this.height)},isZero:function(){var t=m.isZero;return t(this.width)&&t(this.height)},isNaN:function(){return isNaN(this.width)||isNaN(this.height)},statics:{min:function(t,n){return new w(Math.min(t.width,n.width),Math.min(t.height,n.height))},max:function(t,n){return new w(Math.max(t.width,n.width),Math.max(t.height,n.height))},random:function(){return new w(Math.random(),Math.random())}}},h.each(["round","ceil","floor","abs"],(function(t){var n=Math[t];this[t]=function(){return new w(n(this.width),n(this.height))}}),{})),x=w.extend({initialize:function Size2(t,n,i,r){this._width=t,this._height=n,this._owner=i,this._setter=r},_set:function(t,n,i){return this._width=t,this._height=n,i||this._owner[this._setter](this),this},getWidth:function(){return this._width},setWidth:function(t){this._width=t,this._owner[this._setter](this)},getHeight:function(){return this._height},setHeight:function(t){this._height=t,this._owner[this._setter](this)}}),S=h.extend({_class:"Rectangle",_readIndex:!0,beans:!0,initialize:function Rectangle3(t,n,r,o){var c,u=arguments,d=typeof t;if("number"===d?(this._set(t,n,r,o),c=4):"undefined"===d||null===t?(this._set(0,0,0,0),c=null===t?1:0):1===u.length&&(Array.isArray(t)?(this._set.apply(this,t),c=1):t.x!==i||t.width!==i?(this._set(t.x||0,t.y||0,t.width||0,t.height||0),c=1):t.from===i&&t.to===i&&(this._set(0,0,0,0),h.readSupported(u,this)&&(c=1))),c===i){var p,g,m=_.readNamed(u,"from"),v=h.peek(u),y=m.x,x=m.y;if(v&&v.x!==i||h.hasNamed(u,"to")){var S=_.readNamed(u,"to");p=S.x-y,g=S.y-x,p<0&&(y=S.x,p=-p),g<0&&(x=S.y,g=-g)}else{var C=w.read(u);p=C.width,g=C.height}this._set(y,x,p,g),c=u.__index}var k=u.__filtered;return k&&(this.__filtered=k),this.__read&&(this.__read=c),this},set:"#initialize",_set:function(t,n,i,r){return this.x=t,this.y=n,this.width=i,this.height=r,this},clone:function(){return new S(this.x,this.y,this.width,this.height)},equals:function(t){var n=h.isPlainValue(t)?S.read(arguments):t;return n===this||n&&this.x===n.x&&this.y===n.y&&this.width===n.width&&this.height===n.height||!1},toString:function(){var t=g.instance;return"{ x: "+t.number(this.x)+", y: "+t.number(this.y)+", width: "+t.number(this.width)+", height: "+t.number(this.height)+" }"},_serialize:function(t){var n=t.formatter;return[n.number(this.x),n.number(this.y),n.number(this.width),n.number(this.height)]},getPoint:function(t){return new(t?_:y)(this.x,this.y,this,"setPoint")},setPoint:function(){var t=_.read(arguments);this.x=t.x,this.y=t.y},getSize:function(t){return new(t?w:x)(this.width,this.height,this,"setSize")},_fw:1,_fh:1,setSize:function(){var t=w.read(arguments),n=this._sx,i=this._sy,r=t.width,o=t.height;n&&(this.x+=(this.width-r)*n),i&&(this.y+=(this.height-o)*i),this.width=r,this.height=o,this._fw=this._fh=1},getLeft:function(){return this.x},setLeft:function(t){if(!this._fw){var n=t-this.x;this.width-=.5===this._sx?2*n:n}this.x=t,this._sx=this._fw=0},getTop:function(){return this.y},setTop:function(t){if(!this._fh){var n=t-this.y;this.height-=.5===this._sy?2*n:n}this.y=t,this._sy=this._fh=0},getRight:function(){return this.x+this.width},setRight:function(t){if(!this._fw){var n=t-this.x;this.width=.5===this._sx?2*n:n}this.x=t-this.width,this._sx=1,this._fw=0},getBottom:function(){return this.y+this.height},setBottom:function(t){if(!this._fh){var n=t-this.y;this.height=.5===this._sy?2*n:n}this.y=t-this.height,this._sy=1,this._fh=0},getCenterX:function(){return this.x+this.width/2},setCenterX:function(t){this._fw||.5===this._sx?this.x=t-this.width/2:(this._sx&&(this.x+=2*(t-this.x)*this._sx),this.width=2*(t-this.x)),this._sx=.5,this._fw=0},getCenterY:function(){return this.y+this.height/2},setCenterY:function(t){this._fh||.5===this._sy?this.y=t-this.height/2:(this._sy&&(this.y+=2*(t-this.y)*this._sy),this.height=2*(t-this.y)),this._sy=.5,this._fh=0},getCenter:function(t){return new(t?_:y)(this.getCenterX(),this.getCenterY(),this,"setCenter")},setCenter:function(){var t=_.read(arguments);return this.setCenterX(t.x),this.setCenterY(t.y),this},getArea:function(){return this.width*this.height},isEmpty:function(){return 0===this.width||0===this.height},contains:function(t){return t&&t.width!==i||4===(Array.isArray(t)?t:arguments).length?this._containsRectangle(S.read(arguments)):this._containsPoint(_.read(arguments))},_containsPoint:function(t){var n=t.x,i=t.y;return n>=this.x&&i>=this.y&&n<=this.x+this.width&&i<=this.y+this.height},_containsRectangle:function(t){var n=t.x,i=t.y;return n>=this.x&&i>=this.y&&n+t.width<=this.x+this.width&&i+t.height<=this.y+this.height},intersects:function(){var t=S.read(arguments),n=h.read(arguments)||0;return t.x+t.width>this.x-n&&t.y+t.height>this.y-n&&t.x<this.x+this.width+n&&t.y<this.y+this.height+n},intersect:function(){var t=S.read(arguments),n=Math.max(this.x,t.x),i=Math.max(this.y,t.y),r=Math.min(this.x+this.width,t.x+t.width),o=Math.min(this.y+this.height,t.y+t.height);return new S(n,i,r-n,o-i)},unite:function(){var t=S.read(arguments),n=Math.min(this.x,t.x),i=Math.min(this.y,t.y),r=Math.max(this.x+this.width,t.x+t.width),o=Math.max(this.y+this.height,t.y+t.height);return new S(n,i,r-n,o-i)},include:function(){var t=_.read(arguments),n=Math.min(this.x,t.x),i=Math.min(this.y,t.y),r=Math.max(this.x+this.width,t.x),o=Math.max(this.y+this.height,t.y);return new S(n,i,r-n,o-i)},expand:function(){var t=w.read(arguments),n=t.width,i=t.height;return new S(this.x-n/2,this.y-i/2,this.width+n,this.height+i)},scale:function(t,n){return this.expand(this.width*t-this.width,this.height*(n===i?t:n)-this.height)}},h.each([["Top","Left"],["Top","Right"],["Bottom","Left"],["Bottom","Right"],["Left","Center"],["Top","Center"],["Right","Center"],["Bottom","Center"]],(function(t,n){var i=t.join(""),r=/^[RL]/.test(i);n>=4&&(t[1]+=r?"Y":"X");var o=t[r?0:1],h=t[r?1:0],c="get"+o,u="get"+h,d="set"+o,p="set"+h,g="set"+i;this["get"+i]=function(t){return new(t?_:y)(this[c](),this[u](),this,g)},this[g]=function(){var t=_.read(arguments);this[d](t.x),this[p](t.y)}}),{beans:!0})),C=S.extend({initialize:function Rectangle3(t,n,i,r,o,h){this._set(t,n,i,r,!0),this._owner=o,this._setter=h},_set:function(t,n,i,r,o){return this._x=t,this._y=n,this._width=i,this._height=r,o||this._owner[this._setter](this),this}},new function(){var t=S.prototype;return h.each(["x","y","width","height"],(function(t){var n=h.capitalize(t),i="_"+t;this["get"+n]=function(){return this[i]},this["set"+n]=function(t){this[i]=t,this._dontNotify||this._owner[this._setter](this)}}),h.each(["Point","Size","Center","Left","Top","Right","Bottom","CenterX","CenterY","TopLeft","TopRight","BottomLeft","BottomRight","LeftCenter","TopCenter","RightCenter","BottomCenter"],(function(n){var i="set"+n;this[i]=function(){this._dontNotify=!0,t[i].apply(this,arguments),this._dontNotify=!1,this._owner[this._setter](this)}}),{isSelected:function(){return!!(2&this._owner._selection)},setSelected:function(t){var n=this._owner;n._changeSelection&&n._changeSelection(2,t)}}))}),k=h.extend({_class:"Matrix",initialize:function Matrix2(t,n){var i=arguments,r=i.length,o=!0;if(r>=6?this._set.apply(this,i):1===r||2===r?t instanceof Matrix2?this._set(t._a,t._b,t._c,t._d,t._tx,t._ty,n):Array.isArray(t)?this._set.apply(this,n?t.concat([n]):t):o=!1:r?o=!1:this.reset(),!o)throw new Error("Unsupported matrix parameters");return this},set:"#initialize",_set:function(t,n,i,r,o,h,c){return this._a=t,this._b=n,this._c=i,this._d=r,this._tx=o,this._ty=h,c||this._changed(),this},_serialize:function(t,n){return h.serialize(this.getValues(),t,!0,n)},_changed:function(){var t=this._owner;t&&(t._applyMatrix?t.transform(null,!0):t._changed(25))},clone:function(){return new k(this._a,this._b,this._c,this._d,this._tx,this._ty)},equals:function(t){return t===this||t&&this._a===t._a&&this._b===t._b&&this._c===t._c&&this._d===t._d&&this._tx===t._tx&&this._ty===t._ty},toString:function(){var t=g.instance;return"[["+[t.number(this._a),t.number(this._c),t.number(this._tx)].join(", ")+"], ["+[t.number(this._b),t.number(this._d),t.number(this._ty)].join(", ")+"]]"},reset:function(t){return this._a=this._d=1,this._b=this._c=this._tx=this._ty=0,t||this._changed(),this},apply:function(t,n){var i=this._owner;return!!i&&(i.transform(null,h.pick(t,!0),n),this.isIdentity())},translate:function(){var t=_.read(arguments),n=t.x,i=t.y;return this._tx+=n*this._a+i*this._c,this._ty+=n*this._b+i*this._d,this._changed(),this},scale:function(){var t=arguments,n=_.read(t),i=_.read(t,0,{readNull:!0});return i&&this.translate(i),this._a*=n.x,this._b*=n.x,this._c*=n.y,this._d*=n.y,i&&this.translate(i.negate()),this._changed(),this},rotate:function(t){t*=Math.PI/180;var n=_.read(arguments,1),i=n.x,r=n.y,o=Math.cos(t),h=Math.sin(t),c=i-i*o+r*h,u=r-i*h-r*o,d=this._a,p=this._b,g=this._c,m=this._d;return this._a=o*d+h*g,this._b=o*p+h*m,this._c=-h*d+o*g,this._d=-h*p+o*m,this._tx+=c*d+u*g,this._ty+=c*p+u*m,this._changed(),this},shear:function(){var t=arguments,n=_.read(t),i=_.read(t,0,{readNull:!0});i&&this.translate(i);var r=this._a,o=this._b;return this._a+=n.y*this._c,this._b+=n.y*this._d,this._c+=n.x*r,this._d+=n.x*o,i&&this.translate(i.negate()),this._changed(),this},skew:function(){var t=arguments,n=_.read(t),i=_.read(t,0,{readNull:!0}),r=Math.PI/180,o=new _(Math.tan(n.x*r),Math.tan(n.y*r));return this.shear(o,i)},append:function(t,n){if(t){var i=this._a,r=this._b,o=this._c,h=this._d,c=t._a,u=t._c,d=t._b,p=t._d,g=t._tx,m=t._ty;this._a=c*i+d*o,this._c=u*i+p*o,this._b=c*r+d*h,this._d=u*r+p*h,this._tx+=g*i+m*o,this._ty+=g*r+m*h,n||this._changed()}return this},prepend:function(t,n){if(t){var i=this._a,r=this._b,o=this._c,h=this._d,c=this._tx,u=this._ty,d=t._a,p=t._c,g=t._b,m=t._d,v=t._tx,_=t._ty;this._a=d*i+p*r,this._c=d*o+p*h,this._b=g*i+m*r,this._d=g*o+m*h,this._tx=d*c+p*u+v,this._ty=g*c+m*u+_,n||this._changed()}return this},appended:function(t){return this.clone().append(t)},prepended:function(t){return this.clone().prepend(t)},invert:function(){var t=this._a,n=this._b,i=this._c,r=this._d,o=this._tx,h=this._ty,c=t*r-n*i,u=null;return c&&!isNaN(c)&&isFinite(o)&&isFinite(h)&&(this._a=r/c,this._b=-n/c,this._c=-i/c,this._d=t/c,this._tx=(i*h-r*o)/c,this._ty=(n*o-t*h)/c,u=this),u},inverted:function(){return this.clone().invert()},concatenate:"#append",preConcatenate:"#prepend",chain:"#appended",_shiftless:function(){return new k(this._a,this._b,this._c,this._d,0,0)},_orNullIfIdentity:function(){return this.isIdentity()?null:this},isIdentity:function(){return 1===this._a&&0===this._b&&0===this._c&&1===this._d&&0===this._tx&&0===this._ty},isInvertible:function(){var t=this._a*this._d-this._c*this._b;return t&&!isNaN(t)&&isFinite(this._tx)&&isFinite(this._ty)},isSingular:function(){return!this.isInvertible()},transform:function(t,n,i){return arguments.length<3?this._transformPoint(_.read(arguments)):this._transformCoordinates(t,n,i)},_transformPoint:function(t,n,i){var r=t.x,o=t.y;return n||(n=new _),n._set(r*this._a+o*this._c+this._tx,r*this._b+o*this._d+this._ty,i)},_transformCoordinates:function(t,n,i){for(var r=0,o=2*i;r<o;r+=2){var h=t[r],c=t[r+1];n[r]=h*this._a+c*this._c+this._tx,n[r+1]=h*this._b+c*this._d+this._ty}return n},_transformCorners:function(t){var n=t.x,i=t.y,r=n+t.width,o=i+t.height,h=[n,i,r,i,r,o,n,o];return this._transformCoordinates(h,h,4)},_transformBounds:function(t,n,i){for(var r=this._transformCorners(t),o=r.slice(0,2),h=o.slice(),c=2;c<8;c++){var u=r[c],d=1&c;u<o[d]?o[d]=u:u>h[d]&&(h[d]=u)}return n||(n=new S),n._set(o[0],o[1],h[0]-o[0],h[1]-o[1],i)},inverseTransform:function(){return this._inverseTransform(_.read(arguments))},_inverseTransform:function(t,n,i){var r=this._a,o=this._b,h=this._c,c=this._d,u=this._tx,d=this._ty,p=r*c-o*h,g=null;if(p&&!isNaN(p)&&isFinite(u)&&isFinite(d)){var m=t.x-this._tx,v=t.y-this._ty;n||(n=new _),g=n._set((m*c-v*h)/p,(v*r-m*o)/p,i)}return g},decompose:function(){var t,n,i,r=this._a,o=this._b,h=this._c,c=this._d,u=r*c-o*h,d=Math.sqrt,p=Math.atan2,g=180/Math.PI;if(0!==r||0!==o){var m=d(r*r+o*o);t=Math.acos(r/m)*(o>0?1:-1),n=[m,u/m],i=[p(r*h+o*c,m*m),0]}else if(0!==h||0!==c){var v=d(h*h+c*c);t=Math.asin(h/v)*(c>0?1:-1),n=[u/v,v],i=[0,p(r*h+o*c,v*v)]}else t=0,i=n=[0,0];return{translation:this.getTranslation(),rotation:t*g,scaling:new _(n),skewing:new _(i[0]*g,i[1]*g)}},getValues:function(){return[this._a,this._b,this._c,this._d,this._tx,this._ty]},getTranslation:function(){return new _(this._tx,this._ty)},getScaling:function(){return this.decompose().scaling},getRotation:function(){return this.decompose().rotation},applyToContext:function(t){this.isIdentity()||t.transform(this._a,this._b,this._c,this._d,this._tx,this._ty)}},h.each(["a","b","c","d","tx","ty"],(function(t){var n=h.capitalize(t),i="_"+t;this["get"+n]=function(){return this[i]},this["set"+n]=function(t){this[i]=t,this._changed()}}),{})),P=h.extend({_class:"Line",initialize:function Line2(t,n,i,r,o){var h=!1;arguments.length>=4?(this._px=t,this._py=n,this._vx=i,this._vy=r,h=o):(this._px=t.x,this._py=t.y,this._vx=n.x,this._vy=n.y,h=i),h||(this._vx-=this._px,this._vy-=this._py)},getPoint:function(){return new _(this._px,this._py)},getVector:function(){return new _(this._vx,this._vy)},getLength:function(){return this.getVector().getLength()},intersect:function(t,n){return P.intersect(this._px,this._py,this._vx,this._vy,t._px,t._py,t._vx,t._vy,!0,n)},getSide:function(t,n){return P.getSide(this._px,this._py,this._vx,this._vy,t.x,t.y,!0,n)},getDistance:function(t){return Math.abs(this.getSignedDistance(t))},getSignedDistance:function(t){return P.getSignedDistance(this._px,this._py,this._vx,this._vy,t.x,t.y,!0)},isCollinear:function(t){return _.isCollinear(this._vx,this._vy,t._vx,t._vy)},isOrthogonal:function(t){return _.isOrthogonal(this._vx,this._vy,t._vx,t._vy)},statics:{intersect:function(t,n,i,r,o,h,c,u,d,p){d||(i-=t,r-=n,c-=o,u-=h);var g=i*u-r*c;if(!m.isMachineZero(g)){var v=t-o,y=n-h,w=(c*y-u*v)/g,x=(i*y-r*v)/g,S=-1e-12,C=1+1e-12;if(p||S<w&&w<C&&S<x&&x<C)return p||(w=w<=0?0:w>=1?1:w),new _(t+w*i,n+w*r)}},getSide:function(t,n,i,r,o,h,c,u){c||(i-=t,r-=n);var d=o-t,p=d*r-(h-n)*i;return!u&&m.isMachineZero(p)&&(p=(d*i+d*i)/(i*i+r*r))>=0&&p<=1&&(p=0),p<0?-1:p>0?1:0},getSignedDistance:function(t,n,i,r,o,h,c){return c||(i-=t,r-=n),0===i?r>0?o-t:t-o:0===r?i<0?h-n:n-h:((o-t)*r-(h-n)*i)/(r>i?r*Math.sqrt(1+i*i/(r*r)):i*Math.sqrt(1+r*r/(i*i)))},getDistance:function(t,n,i,r,o,h,c){return Math.abs(P.getSignedDistance(t,n,i,r,o,h,c))}}}),I=d.extend({_class:"Project",_list:"projects",_reference:"project",_compactSerialize:!0,initialize:function Project2(t){d.call(this,!0),this._children=[],this._namedChildren={},this._activeLayer=null,this._currentStyle=new it(null,null,this),this._view=ot.create(this,t||mt.getCanvas(1,1)),this._selectionItems={},this._selectionCount=0,this._updateVersion=0},_serialize:function(t,n){return h.serialize(this._children,t,!0,n)},_changed:function(t,n){if(1&t){var i=this._view;i&&(i._needsUpdate=!0,!i._requested&&i._autoUpdate&&i.requestUpdate())}var r=this._changes;if(r&&n){var o=this._changesById,h=n._id,c=o[h];c?c.flags|=t:r.push(o[h]={item:n,flags:t})}},clear:function(){for(var t=this._children,n=t.length-1;n>=0;n--)t[n].remove()},isEmpty:function(){return!this._children.length},remove:function remove(){return!!remove.base.call(this)&&(this._view&&this._view.remove(),!0)},getView:function(){return this._view},getCurrentStyle:function(){return this._currentStyle},setCurrentStyle:function(t){this._currentStyle.set(t)},getIndex:function(){return this._index},getOptions:function(){return this._scope.settings},getLayers:function(){return this._children},getActiveLayer:function(){return this._activeLayer||new T({project:this,insert:!0})},getSymbolDefinitions:function(){var t=[],n={};return this.getItems({class:N,match:function(i){var r=i._definition,o=r._id;return n[o]||(n[o]=!0,t.push(r)),!1}}),t},getSymbols:"getSymbolDefinitions",getSelectedItems:function(){var t=this._selectionItems,n=[];for(var i in t){var r=t[i],o=r._selection;1&o&&r.isInserted()?n.push(r):o||this._updateSelection(r)}return n},_updateSelection:function(t){var n=t._id,i=this._selectionItems;t._selection?i[n]!==t&&(this._selectionCount++,i[n]=t):i[n]===t&&(this._selectionCount--,delete i[n])},selectAll:function(){for(var t=this._children,n=0,i=t.length;n<i;n++)t[n].setFullySelected(!0)},deselectAll:function(){var t=this._selectionItems;for(var n in t)t[n].setFullySelected(!1)},addLayer:function(t){return this.insertLayer(i,t)},insertLayer:function(t,n){if(n instanceof T){n._remove(!1,!0),h.splice(this._children,[n],t,0),n._setProject(this,!0);var i=n._name;i&&n.setName(i),this._changes&&n._changed(5),this._activeLayer||(this._activeLayer=n)}else n=null;return n},_insertItem:function(t,n,r){return n=this.insertLayer(t,n)||(this._activeLayer||this._insertItem(i,new T(M.NO_INSERT),!0)).insertChild(t,n),r&&n.activate&&n.activate(),n},getItems:function(t){return M._getItems(this,t)},getItem:function(t){return M._getItems(this,t,null,null,!0)[0]||null},importJSON:function(t){this.activate();var n=this._activeLayer;return h.importJSON(t,n&&n.isEmpty()&&n)},removeOn:function(t){var n=this._removeSets;if(n){"mouseup"===t&&(n.mousedrag=null);var i=n[t];if(i){for(var r in i){var o=i[r];for(var h in n){var c=n[h];c&&c!=i&&delete c[o._id]}o.remove()}n[t]=null}}},draw:function(t,n,i){this._updateVersion++,t.save(),n.applyToContext(t);for(var r=this._children,o=new h({offset:new _(0,0),pixelRatio:i,viewMatrix:n.isIdentity()?null:n,matrices:[new k],updateMatrix:!0}),c=0,u=r.length;c<u;c++)r[c].draw(t,o);if(t.restore(),this._selectionCount>0){t.save(),t.strokeWidth=1;var d=this._selectionItems,p=this._scope.settings.handleSize,g=this._updateVersion;for(var m in d)d[m]._drawSelection(t,n,p,d,g);t.restore()}}}),M=h.extend(c,{statics:{extend:function extend(t){return t._serializeFields&&(t._serializeFields=h.set({},this.prototype._serializeFields,t._serializeFields)),extend.base.apply(this,arguments)},INSERT:{insert:!0},NO_INSERT:{insert:!1}},_class:"Item",_name:null,_applyMatrix:!0,_canApplyMatrix:!0,_canScaleStroke:!1,_pivot:null,_visible:!0,_blendMode:"normal",_opacity:1,_locked:!1,_guide:!1,_clipMask:!1,_selection:0,_selectBounds:!0,_selectChildren:!1,_serializeFields:{name:null,applyMatrix:null,matrix:new k,pivot:null,visible:!0,blendMode:"normal",opacity:1,locked:!1,guide:!1,clipMask:!1,selected:!1,data:{}},_prioritize:["applyMatrix"]},new function(){var t=["onMouseDown","onMouseUp","onMouseDrag","onClick","onDoubleClick","onMouseMove","onMouseEnter","onMouseLeave"];return h.each(t,(function(t){this._events[t]={install:function(t){this.getView()._countItemEvent(t,1)},uninstall:function(t){this.getView()._countItemEvent(t,-1)}}}),{_events:{onFrame:{install:function(){this.getView()._animateItem(this,!0)},uninstall:function(){this.getView()._animateItem(this,!1)}},onLoad:{},onError:{}},statics:{_itemHandlers:t}})},{initialize:function Item22(){},_initialize:function(t,n){var r=t&&h.isPlainObject(t),o=r&&!0===t.internal,c=this._matrix=new k,u=r&&t.project||wt.project,d=wt.settings;return this._id=o?null:v.get(),this._parent=this._index=null,this._applyMatrix=this._canApplyMatrix&&d.applyMatrix,n&&c.translate(n),c._owner=this,this._style=new it(u._currentStyle,this,u),o||r&&0==t.insert||!d.insertItems&&(!r||1!=t.insert)?this._setProject(u):(r&&t.parent||u)._insertItem(i,this,!0),r&&t!==M.NO_INSERT&&t!==M.INSERT&&this.set(t,{internal:!0,insert:!0,project:!0,parent:!0}),r},_serialize:function(t,n){var i={},r=this;function serialize(o){for(var c in o){var u=r[c];h.equals(u,"leading"===c?1.2*o.fontSize:o[c])||(i[c]=h.serialize(u,t,"data"!==c,n))}}return serialize(this._serializeFields),this instanceof E||serialize(this._style._defaults),[this._class,i]},_changed:function(t){var n=this._symbol,r=this._parent||n,o=this._project;8&t&&(this._bounds=this._position=this._decomposed=i),16&t&&(this._globalMatrix=i),r&&72&t&&M._clearBoundsCache(r),2&t&&M._clearBoundsCache(this),o&&o._changed(t,this),n&&n._changed(t)},getId:function(){return this._id},getName:function(){return this._name},setName:function(t){if(this._name&&this._removeNamed(),t===+t+"")throw new Error("Names consisting only of numbers are not supported.");var n=this._getOwner();if(t&&n){var r=n._children,o=n._namedChildren;(o[t]=o[t]||[]).push(this),t in r||(r[t]=this)}this._name=t||i,this._changed(256)},getStyle:function(){return this._style},setStyle:function(t){this.getStyle().set(t)}},h.each(["locked","visible","blendMode","opacity","guide"],(function(t){var n=h.capitalize(t),i="_"+t,r={locked:256,visible:265};this["get"+n]=function(){return this[i]},this["set"+n]=function(n){n!=this[i]&&(this[i]=n,this._changed(r[t]||257))}}),{}),{beans:!0,getSelection:function(){return this._selection},setSelection:function(t){if(t!==this._selection){this._selection=t;var n=this._project;n&&(n._updateSelection(this),this._changed(257))}},_changeSelection:function(t,n){var i=this._selection;this.setSelection(n?i|t:i&~t)},isSelected:function(){if(this._selectChildren)for(var t=this._children,n=0,i=t.length;n<i;n++)if(t[n].isSelected())return!0;return!!(1&this._selection)},setSelected:function(t){if(this._selectChildren)for(var n=this._children,i=0,r=n.length;i<r;i++)n[i].setSelected(t);this._changeSelection(1,t)},isFullySelected:function(){var t=this._children,n=!!(1&this._selection);if(t&&n){for(var i=0,r=t.length;i<r;i++)if(!t[i].isFullySelected())return!1;return!0}return n},setFullySelected:function(t){var n=this._children;if(n)for(var i=0,r=n.length;i<r;i++)n[i].setFullySelected(t);this._changeSelection(1,t)},isClipMask:function(){return this._clipMask},setClipMask:function(t){this._clipMask!=(t=!!t)&&(this._clipMask=t,t&&(this.setFillColor(null),this.setStrokeColor(null)),this._changed(257),this._parent&&this._parent._changed(2048))},getData:function(){return this._data||(this._data={}),this._data},setData:function(t){this._data=t},getPosition:function(t){var n=t?_:y,i=this._position||(this._position=this._getPositionFromBounds());return new n(i.x,i.y,this,"setPosition")},setPosition:function(){this.translate(_.read(arguments).subtract(this.getPosition(!0)))},_getPositionFromBounds:function(t){return this._pivot?this._matrix._transformPoint(this._pivot):(t||this.getBounds()).getCenter(!0)},getPivot:function(){var t=this._pivot;return t?new y(t.x,t.y,this,"setPivot"):null},setPivot:function(){this._pivot=_.read(arguments,0,{clone:!0,readNull:!0}),this._position=i}},h.each({getStrokeBounds:{stroke:!0},getHandleBounds:{handle:!0},getInternalBounds:{internal:!0}},(function(t,n){this[n]=function(n){return this.getBounds(n,t)}}),{beans:!0,getBounds:function(t,n){var i=n||t instanceof k,r=h.set({},i?n:t,this._boundsOptions);r.stroke&&!this.getStrokeScaling()||(r.cacheItem=this);var o=this._getCachedBounds(i&&t,r).rect;return arguments.length?o:new C(o.x,o.y,o.width,o.height,this,"setBounds")},setBounds:function(){var t=S.read(arguments),n=this.getBounds(),i=this._matrix,r=new k,o=t.getCenter();r.translate(o),t.width==n.width&&t.height==n.height||(i.isInvertible()||(i.set(i._backup||(new k).translate(i.getTranslation())),n=this.getBounds()),r.scale(0!==n.width?t.width/n.width:0,0!==n.height?t.height/n.height:0)),o=n.getCenter(),r.translate(-o.x,-o.y),this.transform(r)},_getBounds:function(t,n){var i=this._children;return i&&i.length?(M._updateBoundsCache(this,n.cacheItem),M._getBounds(i,t,n)):new S},_getBoundsCacheKey:function(t,n){return[t.stroke?1:0,t.handle?1:0,n?1:0].join("")},_getCachedBounds:function(t,n,i){t=t&&t._orNullIfIdentity();var r=n.internal&&!i,o=n.cacheItem,h=r?null:this._matrix._orNullIfIdentity(),c=o&&(!t||t.equals(h))&&this._getBoundsCacheKey(n,r),u=this._bounds;if(M._updateBoundsCache(this._parent||this._symbol,o),c&&u&&c in u)return{rect:(v=u[c]).rect.clone(),nonscaling:v.nonscaling};var d=this._getBounds(t||h,n),p=d.rect||d,g=this._style,m=d.nonscaling||g.hasStroke()&&!g.getStrokeScaling();if(c){u||(this._bounds=u={});var v=u[c]={rect:p.clone(),nonscaling:m,internal:r}}return{rect:p,nonscaling:m}},_getStrokeMatrix:function(t,n){var i=this.getStrokeScaling()?null:n&&n.internal?this:this._parent||this._symbol&&this._symbol._item,r=i?i.getViewMatrix().invert():t;return r&&r._shiftless()},statics:{_updateBoundsCache:function(t,n){if(t&&n){var i=n._id,r=t._boundsCache=t._boundsCache||{ids:{},list:[]};r.ids[i]||(r.list.push(n),r.ids[i]=n)}},_clearBoundsCache:function(t){var n=t._boundsCache;if(n){t._bounds=t._position=t._boundsCache=i;for(var r=0,o=n.list,h=o.length;r<h;r++){var c=o[r];c!==t&&(c._bounds=c._position=i,c._boundsCache&&M._clearBoundsCache(c))}}},_getBounds:function(t,n,i){var r=1/0,o=-r,h=r,c=o,u=!1;i=i||{};for(var d=0,p=t.length;d<p;d++){var g=t[d];if(g._visible&&!g.isEmpty(!0)){var m=g._getCachedBounds(n&&n.appended(g._matrix),i,!0),v=m.rect;r=Math.min(v.x,r),h=Math.min(v.y,h),o=Math.max(v.x+v.width,o),c=Math.max(v.y+v.height,c),m.nonscaling&&(u=!0)}}return{rect:isFinite(r)?new S(r,h,o-r,c-h):new S,nonscaling:u}}}}),{beans:!0,_decompose:function(){return this._applyMatrix?null:this._decomposed||(this._decomposed=this._matrix.decompose())},getRotation:function(){var t=this._decompose();return t?t.rotation:0},setRotation:function(t){var n=this.getRotation();if(null!=n&&null!=t){var i=this._decomposed;this.rotate(t-n),i&&(i.rotation=t,this._decomposed=i)}},getScaling:function(){var t=this._decompose(),n=t&&t.scaling;return new y(n?n.x:1,n?n.y:1,this,"setScaling")},setScaling:function(){var t=this.getScaling(),n=_.read(arguments,0,{clone:!0,readNull:!0});if(t&&n&&!t.equals(n)){var i=this.getRotation(),r=this._decomposed,o=new k,h=m.isZero;if(h(t.x)||h(t.y))o.translate(r.translation),i&&o.rotate(i),o.scale(n.x,n.y),this._matrix.set(o);else{var c=this.getPosition(!0);o.translate(c),i&&o.rotate(i),o.scale(n.x/t.x,n.y/t.y),i&&o.rotate(-i),o.translate(c.negate()),this.transform(o)}r&&(r.scaling=n,this._decomposed=r)}},getMatrix:function(){return this._matrix},setMatrix:function(){var t=this._matrix;t.set.apply(t,arguments)},getGlobalMatrix:function(t){var n=this._globalMatrix;if(n)for(var i=this._parent,r=[];i;){if(!i._globalMatrix){n=null;for(var o=0,h=r.length;o<h;o++)r[o]._globalMatrix=null;break}r.push(i),i=i._parent}n||(n=this._globalMatrix=this._matrix.clone(),(i=this._parent)&&n.prepend(i.getGlobalMatrix(!0)));return t?n:n.clone()},getViewMatrix:function(){return this.getGlobalMatrix().prepend(this.getView()._matrix)},getApplyMatrix:function(){return this._applyMatrix},setApplyMatrix:function(t){(this._applyMatrix=this._canApplyMatrix&&!!t)&&this.transform(null,!0)},getTransformContent:"#getApplyMatrix",setTransformContent:"#setApplyMatrix"},{getProject:function(){return this._project},_setProject:function(t,n){if(this._project!==t){this._project&&this._installEvents(!1),this._project=t;for(var i=this._children,r=0,o=i&&i.length;r<o;r++)i[r]._setProject(t);n=!0}n&&this._installEvents(!0)},getView:function(){return this._project._view},_installEvents:function _installEvents(t){_installEvents.base.call(this,t);for(var n=this._children,i=0,r=n&&n.length;i<r;i++)n[i]._installEvents(t)},getLayer:function(){for(var t=this;t=t._parent;)if(t instanceof T)return t;return null},getParent:function(){return this._parent},setParent:function(t){return t.addChild(this)},_getOwner:"#getParent",getChildren:function(){return this._children},setChildren:function(t){this.removeChildren(),this.addChildren(t)},getFirstChild:function(){return this._children&&this._children[0]||null},getLastChild:function(){return this._children&&this._children[this._children.length-1]||null},getNextSibling:function(){var t=this._getOwner();return t&&t._children[this._index+1]||null},getPreviousSibling:function(){var t=this._getOwner();return t&&t._children[this._index-1]||null},getIndex:function(){return this._index},equals:function(t){return t===this||t&&this._class===t._class&&this._style.equals(t._style)&&this._matrix.equals(t._matrix)&&this._locked===t._locked&&this._visible===t._visible&&this._blendMode===t._blendMode&&this._opacity===t._opacity&&this._clipMask===t._clipMask&&this._guide===t._guide&&this._equals(t)||!1},_equals:function(t){return h.equals(this._children,t._children)},clone:function(t){var n=new this.constructor(M.NO_INSERT),r=this._children,o=h.pick(t?t.insert:i,t===i||!0===t),c=h.pick(t?t.deep:i,!0);r&&n.copyAttributes(this),r&&!c||n.copyContent(this),r||n.copyAttributes(this),o&&n.insertAbove(this);var u=this._name,d=this._parent;if(u&&d){r=d._children;for(var p=u,g=1;r[u];)u=p+" "+g++;u!==p&&n.setName(u)}return n},copyContent:function(t){for(var n=t._children,i=0,r=n&&n.length;i<r;i++)this.addChild(n[i].clone(!1),!0)},copyAttributes:function(t,n){this.setStyle(t._style);for(var i=["_locked","_visible","_blendMode","_opacity","_clipMask","_guide"],r=0,o=i.length;r<o;r++){var c=i[r];t.hasOwnProperty(c)&&(this[c]=t[c])}n||this._matrix.set(t._matrix,!0),this.setApplyMatrix(t._applyMatrix),this.setPivot(t._pivot),this.setSelection(t._selection);var u=t._data,d=t._name;this._data=u?h.clone(u):null,d&&this.setName(d)},rasterize:function(t,n){var r,o,c;h.isPlainObject(t)?(r=t.resolution,o=t.insert,c=t.raster):(r=t,o=n),c||(c=new D(M.NO_INSERT));var u=this.getStrokeBounds(),d=(r||this.getView().getResolution())/72,p=u.getTopLeft().floor(),g=u.getBottomRight().ceil(),m=new w(g.subtract(p)),v=m.multiply(d);if(c.setSize(v,!0),!v.isZero()){var _=c.getContext(!0),y=(new k).scale(d).translate(p.negate());_.save(),y.applyToContext(_),this.draw(_,new h({matrices:[y]})),_.restore()}return c._matrix.set((new k).translate(p.add(m.divide(2))).scale(1/d)),(o===i||o)&&c.insertAbove(this),c},contains:function(){var t=this._matrix;return t.isInvertible()&&!!this._contains(t._inverseTransform(_.read(arguments)))},_contains:function(t){var n=this._children;if(n){for(var i=n.length-1;i>=0;i--)if(n[i].contains(t))return!0;return!1}return t.isInside(this.getInternalBounds())},isInside:function(){return S.read(arguments).contains(this.getBounds())},_asPathItem:function(){return new Y.Rectangle({rectangle:this.getInternalBounds(),matrix:this._matrix,insert:!1})},intersects:function(t,n){return t instanceof M&&this._asPathItem().getIntersections(t._asPathItem(),null,n,!0).length>0}},new function(){function hitTest(){var t=arguments;return this._hitTest(_.read(t),V.getOptions(t))}function hitTestAll(){var t=arguments,n=_.read(t),i=V.getOptions(t),r=[];return this._hitTest(n,new h({all:r},i)),r}function hitTestChildren(t,n,i,r){var o=this._children;if(o)for(var h=o.length-1;h>=0;h--){var c=o[h],u=c!==r&&c._hitTest(t,n,i);if(u&&!n.all)return u}return null}return I.inject({hitTest:hitTest,hitTestAll:hitTestAll,_hitTest:hitTestChildren}),{hitTest:hitTest,hitTestAll:hitTestAll,_hitTestChildren:hitTestChildren}},{_hitTest:function(t,n,i){if(this._locked||!this._visible||this._guide&&!n.guides||this.isEmpty())return null;var r=this._matrix,o=i?i.appended(r):this.getGlobalMatrix().prepend(this.getView()._matrix),c=Math.max(n.tolerance,1e-12),u=n._tolerancePadding=new w(Y._getStrokePadding(c,r._shiftless().invert()));if(!(t=r._inverseTransform(t))||!this._children&&!this.getBounds({internal:!0,stroke:!0,handle:!0}).expand(u.multiply(2))._containsPoint(t))return null;var d,p,g=!(n.guides&&!this._guide||n.selected&&!this.isSelected()||n.type&&n.type!==h.hyphenate(this._class)||n.class&&!(this instanceof n.class)),m=n.match,v=this;function filter(t){return t&&m&&!m(t)&&(t=null),t&&n.all&&n.all.push(t),t}function checkPoint(n,i){var r=i?d["get"+i]():v.getPosition();if(t.subtract(r).divide(u).length<=1)return new V(n,v,{name:i?h.hyphenate(i):n,point:r})}var _=n.position,y=n.center,x=n.bounds;if(g&&this._parent&&(_||y||x)){if((y||x)&&(d=this.getInternalBounds()),!(p=_&&checkPoint("position")||y&&checkPoint("center","Center"))&&x)for(var S=["TopLeft","TopRight","BottomLeft","BottomRight","LeftCenter","TopCenter","RightCenter","BottomCenter"],C=0;C<8&&!p;C++)p=checkPoint("bounds",S[C]);p=filter(p)}return p||(p=this._hitTestChildren(t,n,o)||g&&filter(this._hitTestSelf(t,n,o,this.getStrokeScaling()?null:o._shiftless().invert()))||null),p&&p.point&&(p.point=r.transform(p.point)),p},_hitTestSelf:function(t,n){if(n.fill&&this.hasFill()&&this._contains(t))return new V("fill",this)},matches:function(t,n){var i=typeof t;if("object"===i){for(var r in t)if(t.hasOwnProperty(r)&&!this.matches(r,t[r]))return!1;return!0}if("function"===i)return t(this);if("match"===t)return n(this);var o=/^(empty|editable)$/.test(t)?this["is"+h.capitalize(t)]():"type"===t?h.hyphenate(this._class):this[t];if("class"===t){if("function"==typeof n)return this instanceof n;o=this._class}if("function"==typeof n)return!!n(o);if(n){if(n.test)return n.test(o);if(h.isPlainObject(n))return function matchObject(t,n){for(var i in t)if(t.hasOwnProperty(i)){var r=t[i],o=n[i];if(h.isPlainObject(r)&&h.isPlainObject(o)){if(!matchObject(r,o))return!1}else if(!h.equals(r,o))return!1}return!0}(n,o)}return h.equals(o,n)},getItems:function(t){return M._getItems(this,t,this._matrix)},getItem:function(t){return M._getItems(this,t,this._matrix,null,!0)[0]||null},statics:{_getItems:function _getItems(t,n,i,r,o){if(!r){var c="object"==typeof n&&n,u=c&&c.overlapping,d=c&&c.inside,p=(C=u||d)&&S.read([C]);r={items:[],recursive:c&&!1!==c.recursive,inside:!!d,overlapping:!!u,rect:p,path:u&&new Y.Rectangle({rectangle:p,insert:!1})},c&&(n=h.filter({},n,{recursive:!0,inside:!0,overlapping:!0}))}var g=t._children,m=r.items;i=(p=r.rect)&&(i||new k);for(var v=0,_=g&&g.length;v<_;v++){var y=g[v],w=i&&i.appended(y._matrix),x=!0;if(p){var C=y.getBounds(w);if(!p.intersects(C))continue;p.contains(C)||r.overlapping&&(C.contains(p)||r.path.intersects(y,w))||(x=!1)}if(x&&y.matches(n)&&(m.push(y),o))break;if(!1!==r.recursive&&_getItems(y,n,w,r,o),o&&m.length>0)break}return m}}},{importJSON:function(t){var n=h.importJSON(t,this);return n!==this?this.addChild(n):n},addChild:function(t){return this.insertChild(i,t)},insertChild:function(t,n){var i=n?this.insertChildren(t,[n]):null;return i&&i[0]},addChildren:function(t){return this.insertChildren(this._children.length,t)},insertChildren:function(t,n){var i=this._children;if(i&&n&&n.length>0){for(var r={},o=(n=h.slice(n)).length-1;o>=0;o--){var c=(g=n[o])&&g._id;!g||r[c]?n.splice(o,1):(g._remove(!1,!0),r[c]=!0)}h.splice(i,n,t,0);for(var u=this._project,d=u._changes,p=(o=0,n.length);o<p;o++){var g,m=(g=n[o])._name;g._parent=this,g._setProject(u,!0),m&&g.setName(m),d&&g._changed(5)}this._changed(11)}else n=null;return n},_insertItem:"#insertChild",_insertAt:function(t,n){var i=t&&t._getOwner(),r=t!==this&&i?this:null;return r&&(r._remove(!1,!0),i._insertItem(t._index+n,r)),r},insertAbove:function(t){return this._insertAt(t,1)},insertBelow:function(t){return this._insertAt(t,0)},sendToBack:function(){var t=this._getOwner();return t?t._insertItem(0,this):null},bringToFront:function(){var t=this._getOwner();return t?t._insertItem(i,this):null},appendTop:"#addChild",appendBottom:function(t){return this.insertChild(0,t)},moveAbove:"#insertAbove",moveBelow:"#insertBelow",addTo:function(t){return t._insertItem(i,this)},copyTo:function(t){return this.clone(!1).addTo(t)},reduce:function(t){var n=this._children;if(n&&1===n.length){var i=n[0].reduce(t);return this._parent?(i.insertAbove(this),this.remove()):i.remove(),i}return this},_removeNamed:function(){var t=this._getOwner();if(t){var n=t._children,i=t._namedChildren,r=this._name,o=i[r],h=o?o.indexOf(this):-1;-1!==h&&(n[r]==this&&delete n[r],o.splice(h,1),o.length?n[r]=o[0]:delete i[r])}},_remove:function(t,n){var i=this._getOwner(),r=this._project,o=this._index;return this._style&&this._style._dispose(),!!i&&(this._name&&this._removeNamed(),null!=o&&(r._activeLayer===this&&(r._activeLayer=this.getNextSibling()||this.getPreviousSibling()),h.splice(i._children,null,o,1)),this._installEvents(!1),t&&r._changes&&this._changed(5),n&&i._changed(11,this),this._parent=null,!0)},remove:function(){return this._remove(!0,!0)},replaceWith:function(t){var n=t&&t.insertBelow(this);return n&&this.remove(),n},removeChildren:function(t,n){if(!this._children)return null;t=t||0,n=h.pick(n,this._children.length);for(var i=h.splice(this._children,null,t,n-t),r=i.length-1;r>=0;r--)i[r]._remove(!0,!1);return i.length>0&&this._changed(11),i},clear:"#removeChildren",reverseChildren:function(){if(this._children){this._children.reverse();for(var t=0,n=this._children.length;t<n;t++)this._children[t]._index=t;this._changed(11)}},isEmpty:function(t){var n=this._children,i=n?n.length:0;if(t){for(var r=0;r<i;r++)if(!n[r].isEmpty(t))return!1;return!0}return!i},isEditable:function(){for(var t=this;t;){if(!t._visible||t._locked)return!1;t=t._parent}return!0},hasFill:function(){return this.getStyle().hasFill()},hasStroke:function(){return this.getStyle().hasStroke()},hasShadow:function(){return this.getStyle().hasShadow()},_getOrder:function(t){function getList(t){var n=[];do{n.unshift(t)}while(t=t._parent);return n}for(var n=getList(this),i=getList(t),r=0,o=Math.min(n.length,i.length);r<o;r++)if(n[r]!=i[r])return n[r]._index<i[r]._index?1:-1;return 0},hasChildren:function(){return this._children&&this._children.length>0},isInserted:function(){return!!this._parent&&this._parent.isInserted()},isAbove:function(t){return-1===this._getOrder(t)},isBelow:function(t){return 1===this._getOrder(t)},isParent:function(t){return this._parent===t},isChild:function(t){return t&&t._parent===this},isDescendant:function(t){for(var n=this;n=n._parent;)if(n===t)return!0;return!1},isAncestor:function(t){return!!t&&t.isDescendant(this)},isSibling:function(t){return this._parent===t._parent},isGroupedWith:function(t){for(var n=this._parent;n;){if(n._parent&&/^(Group|Layer|CompoundPath)$/.test(n._class)&&t.isDescendant(n))return!0;n=n._parent}return!1}},h.each(["rotate","scale","shear","skew"],(function(t){var n="rotate"===t;this[t]=function(){var i=arguments,r=(n?h:_).read(i),o=_.read(i,0,{readNull:!0});return this.transform((new k)[t](r,o||this.getPosition(!0)))}}),{translate:function(){var t=new k;return this.transform(t.translate.apply(t,arguments))},transform:function(t,n,i){var r=this._matrix,o=t&&!t.isIdentity(),h=i&&this._canApplyMatrix||this._applyMatrix&&(o||!r.isIdentity()||n&&this._children);if(!o&&!h)return this;if(o){!t.isInvertible()&&r.isInvertible()&&(r._backup=r.getValues()),r.prepend(t,!0);var c=this._style,u=c.getFillColor(!0),d=c.getStrokeColor(!0);u&&u.transform(t),d&&d.transform(t)}if(h&&(h=this._transformContent(r,n,i))){var p=this._pivot;p&&r._transformPoint(p,p,!0),r.reset(!0),i&&this._canApplyMatrix&&(this._applyMatrix=!0)}var g=this._bounds,m=this._position;(o||h)&&this._changed(25);var v=o&&g&&t.decompose();if(v&&v.skewing.isZero()&&v.rotation%90==0){for(var _ in g){var y=g[_];if(y.nonscaling)delete g[_];else if(h||!y.internal){var w=y.rect;t._transformBounds(w,w)}}this._bounds=g;var x=g[this._getBoundsCacheKey(this._boundsOptions||{})];x&&(this._position=this._getPositionFromBounds(x.rect))}else o&&m&&this._pivot&&(this._position=t._transformPoint(m,m));return this},_transformContent:function(t,n,i){var r=this._children;if(r){for(var o=0,h=r.length;o<h;o++)r[o].transform(t,n,i);return!0}},globalToLocal:function(){return this.getGlobalMatrix(!0)._inverseTransform(_.read(arguments))},localToGlobal:function(){return this.getGlobalMatrix(!0)._transformPoint(_.read(arguments))},parentToLocal:function(){return this._matrix._inverseTransform(_.read(arguments))},localToParent:function(){return this._matrix._transformPoint(_.read(arguments))},fitBounds:function(t,n){t=S.read(arguments);var i=this.getBounds(),r=i.height/i.width,o=t.height/t.width,h=(n?r>o:r<o)?t.width/i.width:t.height/i.height,c=new S(new _,new w(i.width*h,i.height*h));c.setCenter(t.getCenter()),this.setBounds(c)}}),{_setStyles:function(t,n,i){var r=this._style,o=this._matrix;if(r.hasFill()&&(t.fillStyle=r.getFillColor().toCanvasStyle(t,o)),r.hasStroke()){t.strokeStyle=r.getStrokeColor().toCanvasStyle(t,o),t.lineWidth=r.getStrokeWidth();var h=r.getStrokeJoin(),c=r.getStrokeCap(),u=r.getMiterLimit();if(h&&(t.lineJoin=h),c&&(t.lineCap=c),u&&(t.miterLimit=u),wt.support.nativeDash){var d=r.getDashArray(),p=r.getDashOffset();d&&d.length&&("setLineDash"in t?(t.setLineDash(d),t.lineDashOffset=p):(t.mozDash=d,t.mozDashOffset=p))}}if(r.hasShadow()){var g=n.pixelRatio||1,m=i._shiftless().prepend((new k).scale(g,g)),v=m.transform(new _(r.getShadowBlur(),0)),y=m.transform(this.getShadowOffset());t.shadowColor=r.getShadowColor().toCanvasStyle(t),t.shadowBlur=v.getLength(),t.shadowOffsetX=y.x,t.shadowOffsetY=y.y}},draw:function(t,n,i){if(this._updateVersion=this._project._updateVersion,this._visible&&0!==this._opacity){var r=n.matrices,o=n.viewMatrix,h=this._matrix,c=r[r.length-1].appended(h);if(c.isInvertible()){o=o?o.appended(c):c,r.push(c),n.updateMatrix&&(this._globalMatrix=c);var u,d,p,g=this._blendMode,v=m.clamp(this._opacity,0,1),_="normal"===g,y=vt.nativeModes[g],w=_&&1===v||n.dontStart||n.clip||(y||_&&v<1)&&this._canComposite(),x=n.pixelRatio||1;if(!w){var S=this.getStrokeBounds(o);if(!S.width||!S.height)return void r.pop();p=n.offset,d=n.offset=S.getTopLeft().floor(),u=t,t=mt.getContext(S.getSize().ceil().add(1).multiply(x)),1!==x&&t.scale(x,x)}t.save();var C=i?i.appended(h):this._canScaleStroke&&!this.getStrokeScaling(!0)&&o,k=!w&&n.clipItem,P=!C||k;if(w?(t.globalAlpha=v,y&&(t.globalCompositeOperation=g)):P&&t.translate(-d.x,-d.y),P&&(w?h:o).applyToContext(t),k&&n.clipItem.draw(t,n.extend({clip:!0})),C){t.setTransform(x,0,0,x,0,0);var I=n.offset;I&&t.translate(-I.x,-I.y)}this._draw(t,n,o,C),t.restore(),r.pop(),n.clip&&!n.dontFinish&&t.clip(this.getFillRule()),w||(vt.process(g,t,u,v,d.subtract(p).multiply(x)),mt.release(t),n.offset=p)}}},_isUpdated:function(t){var n=this._parent;if(n instanceof H)return n._isUpdated(t);var i=this._updateVersion===t;return!i&&n&&n._visible&&n._isUpdated(t)&&(this._updateVersion=t,i=!0),i},_drawSelection:function(t,n,i,r,o){var h=this._selection,c=1&h,u=2&h||c&&this._selectBounds,d=4&h;if(this._drawSelected||(c=!1),(c||u||d)&&this._isUpdated(o)){var p,g=this.getSelectedColor(!0)||(p=this.getLayer())&&p.getSelectedColor(!0),m=n.appended(this.getGlobalMatrix(!0)),v=i/2;if(t.strokeStyle=t.fillStyle=g?g.toCanvasStyle(t):"#009dec",c&&this._drawSelected(t,m,r),d){var _=this.getPosition(!0),y=this._parent,w=y?y.localToGlobal(_):_,x=w.x,S=w.y;t.beginPath(),t.arc(x,S,v,0,2*Math.PI,!0),t.stroke();for(var C=[[0,-1],[1,0],[0,1],[-1,0]],k=v,P=i+1,I=0;I<4;I++){var M=C[I],E=M[0],T=M[1];t.moveTo(x+E*k,S+T*k),t.lineTo(x+E*P,S+T*P),t.stroke()}}if(u){var O=m._transformCorners(this.getInternalBounds());t.beginPath();for(I=0;I<8;I++)t[I?"lineTo":"moveTo"](O[I],O[++I]);t.closePath(),t.stroke();for(I=0;I<8;I++)t.fillRect(O[I]-v,O[++I]-v,i,i)}}},_canComposite:function(){return!1}},h.each(["down","drag","up","move"],(function(t){this["removeOn"+h.capitalize(t)]=function(){var n={};return n[t]=!0,this.removeOn(n)}}),{removeOn:function(t){for(var n in t)if(t[n]){var i="mouse"+n,r=this._project,o=r._removeSets=r._removeSets||{};o[i]=o[i]||{},o[i][this._id]=this}return this}}),{tween:function(t,n,i){i||(i=n,n=t,t=null,i||(i=n,n=null));var r=i&&i.easing,o=i&&i.start,h=null!=i&&("number"==typeof i?i:i.duration),c=new gt(this,t,n,h,r,o);return h&&this.on("frame",(function onFrame(t){c._handleFrame(1e3*t.time),c.running||this.off("frame",onFrame)})),c},tweenTo:function(t,n){return this.tween(null,t,n)},tweenFrom:function(t,n){return this.tween(t,null,n)}}),E=M.extend({_class:"Group",_selectBounds:!1,_selectChildren:!0,_serializeFields:{children:[]},initialize:function Group2(t){this._children=[],this._namedChildren={},this._initialize(t)||this.addChildren(Array.isArray(t)?t:arguments)},_changed:function _changed(t){_changed.base.call(this,t),2050&t&&(this._clipItem=i)},_getClipItem:function(){var t=this._clipItem;if(t===i){t=null;for(var n=this._children,r=0,o=n.length;r<o;r++)if(n[r]._clipMask){t=n[r];break}this._clipItem=t}return t},isClipped:function(){return!!this._getClipItem()},setClipped:function(t){var n=this.getFirstChild();n&&n.setClipMask(t)},_getBounds:function _getBounds(t,n){var i=this._getClipItem();return i?i._getCachedBounds(i._matrix.prepended(t),h.set({},n,{stroke:!1})):_getBounds.base.call(this,t,n)},_hitTestChildren:function _hitTestChildren(t,n,i){var r=this._getClipItem();return(!r||r.contains(t))&&_hitTestChildren.base.call(this,t,n,i,r)},_draw:function(t,n){var i=n.clip,r=!i&&this._getClipItem();n=n.extend({clipItem:r,clip:!1}),i?(t.beginPath(),n.dontStart=n.dontFinish=!0):r&&r.draw(t,n.extend({clip:!0}));for(var o=this._children,h=0,c=o.length;h<c;h++){var u=o[h];u!==r&&u.draw(t,n)}}}),T=E.extend({_class:"Layer",initialize:function Layer2(){E.apply(this,arguments)},_getOwner:function(){return this._parent||null!=this._index&&this._project},isInserted:function isInserted(){return this._parent?isInserted.base.call(this):null!=this._index},activate:function(){this._project._activeLayer=this},_hitTestSelf:function(){}}),O=M.extend({_class:"Shape",_applyMatrix:!1,_canApplyMatrix:!1,_canScaleStroke:!0,_serializeFields:{type:null,size:null,radius:null},initialize:function Shape2(t,n){this._initialize(t,n)},_equals:function(t){return this._type===t._type&&this._size.equals(t._size)&&h.equals(this._radius,t._radius)},copyContent:function(t){this.setType(t._type),this.setSize(t._size),this.setRadius(t._radius)},getType:function(){return this._type},setType:function(t){this._type=t},getShape:"#getType",setShape:"#setType",getSize:function(){var t=this._size;return new x(t.width,t.height,this,"setSize")},setSize:function(){var t=w.read(arguments);if(this._size){if(!this._size.equals(t)){var n=this._type,i=t.width,r=t.height;"rectangle"===n?this._radius.set(w.min(this._radius,t.divide(2).abs())):"circle"===n?(i=r=(i+r)/2,this._radius=i/2):"ellipse"===n&&this._radius._set(i/2,r/2),this._size._set(i,r),this._changed(9)}}else this._size=t.clone()},getRadius:function(){var t=this._radius;return"circle"===this._type?t:new x(t.width,t.height,this,"setRadius")},setRadius:function(t){var n=this._type;if("circle"===n){if(t===this._radius)return;var i=2*t;this._radius=t,this._size._set(i,i)}else if(t=w.read(arguments),this._radius){if(this._radius.equals(t))return;if(this._radius.set(t),"rectangle"===n){i=w.max(this._size,t.multiply(2));this._size.set(i)}else"ellipse"===n&&this._size._set(2*t.width,2*t.height)}else this._radius=t.clone();this._changed(9)},isEmpty:function(){return!1},toPath:function(t){var n=new(Y[h.capitalize(this._type)])({center:new _,size:this._size,radius:this._radius,insert:!1});return n.copyAttributes(this),wt.settings.applyMatrix&&n.setApplyMatrix(!0),(t===i||t)&&n.insertAbove(this),n},toShape:"#clone",_asPathItem:function(){return this.toPath(!1)},_draw:function(t,n,i,r){var o=this._style,h=o.hasFill(),c=o.hasStroke(),u=n.dontFinish||n.clip,d=!r;if(h||c||u){var p=this._type,g=this._radius,m="circle"===p;if(n.dontStart||t.beginPath(),d&&m)t.arc(0,0,g,0,2*Math.PI,!0);else{var v=m?g:g.width,_=m?g:g.height,y=this._size,w=y.width,x=y.height;if(d&&"rectangle"===p&&0===v&&0===_)t.rect(-w/2,-x/2,w,x);else{var S=w/2,C=x/2,k=.44771525016920644,P=v*k,I=_*k,M=[-S,-C+_,-S,-C+I,-S+P,-C,-S+v,-C,S-v,-C,S-P,-C,S,-C+I,S,-C+_,S,C-_,S,C-I,S-P,C,S-v,C,-S+v,C,-S+P,C,-S,C-I,-S,C-_];r&&r.transform(M,M,32),t.moveTo(M[0],M[1]),t.bezierCurveTo(M[2],M[3],M[4],M[5],M[6],M[7]),S!==v&&t.lineTo(M[8],M[9]),t.bezierCurveTo(M[10],M[11],M[12],M[13],M[14],M[15]),C!==_&&t.lineTo(M[16],M[17]),t.bezierCurveTo(M[18],M[19],M[20],M[21],M[22],M[23]),S!==v&&t.lineTo(M[24],M[25]),t.bezierCurveTo(M[26],M[27],M[28],M[29],M[30],M[31])}}t.closePath()}u||!h&&!c||(this._setStyles(t,n,i),h&&(t.fill(o.getFillRule()),t.shadowColor="rgba(0,0,0,0)"),c&&t.stroke())},_canComposite:function(){return!(this.hasFill()&&this.hasStroke())},_getBounds:function(t,n){var i=new S(this._size).setCenter(0,0),r=this._style,o=n.stroke&&r.hasStroke()&&r.getStrokeWidth();return t&&(i=t._transformBounds(i)),o?i.expand(Y._getStrokePadding(o,this._getStrokeMatrix(t,n))):i}},new function(){function getCornerCenter(t,n,i){var r=t._radius;if(!r.isZero())for(var o=t._size.divide(2),h=1;h<=4;h++){var c=new _(h>1&&h<4?-1:1,h>2?-1:1),u=c.multiply(o),d=u.subtract(c.multiply(r));if(new S(i?u.add(c.multiply(i)):u,d).contains(n))return{point:d,quadrant:h}}}function isOnEllipseStroke(t,n,i,r){var o=t.divide(n);return(!r||o.isInQuadrant(r))&&o.subtract(o.normalize()).multiply(n).divide(i).length<=1}return{_contains:function _contains(t){if("rectangle"===this._type){var n=getCornerCenter(this,t);return n?t.subtract(n.point).divide(this._radius).getLength()<=1:_contains.base.call(this,t)}return t.divide(this.size).getLength()<=.5},_hitTestSelf:function _hitTestSelf(t,n,i,r){var o=!1,h=this._style,c=n.stroke&&h.hasStroke(),u=n.fill&&h.hasFill();if(c||u){var d=this._type,p=this._radius,g=c?h.getStrokeWidth()/2:0,m=n._tolerancePadding.add(Y._getStrokePadding(g,!h.getStrokeScaling()&&r));if("rectangle"===d){var v=m.multiply(2),_=getCornerCenter(this,t,v);if(_)o=isOnEllipseStroke(t.subtract(_.point),p,m,_.quadrant);else{var y=new S(this._size).setCenter(0,0),w=y.expand(v),x=y.expand(v.negate());o=w._containsPoint(t)&&!x._containsPoint(t)}}else o=isOnEllipseStroke(t,p,m)}return o?new V(c?"stroke":"fill",this):_hitTestSelf.base.apply(this,arguments)}}},{statics:new function(){function createShape(t,n,i,r,o){var c=h.create(O.prototype);return c._type=t,c._size=i,c._radius=r,c._initialize(h.getNamed(o),n),c}return{Circle:function(){var t=arguments,n=_.readNamed(t,"center"),i=h.readNamed(t,"radius");return createShape("circle",n,new w(2*i),i,t)},Rectangle:function(){var t=arguments,n=S.readNamed(t,"rectangle"),i=w.min(w.readNamed(t,"radius"),n.getSize(!0).divide(2));return createShape("rectangle",n.getCenter(!0),n.getSize(!0),i,t)},Ellipse:function(){var t=arguments,n=O._readEllipse(t),i=n.radius;return createShape("ellipse",n.center,i.multiply(2),i,t)},_readEllipse:function(t){var n,i;if(h.hasNamed(t,"radius"))n=_.readNamed(t,"center"),i=w.readNamed(t,"radius");else{var r=S.readNamed(t,"rectangle");n=r.getCenter(!0),i=r.getSize(!0).divide(2)}return{center:n,radius:i}}}}}),D=M.extend({_class:"Raster",_applyMatrix:!1,_canApplyMatrix:!1,_boundsOptions:{stroke:!1,handle:!1},_serializeFields:{crossOrigin:null,source:null},_prioritize:["crossOrigin"],_smoothing:"low",beans:!0,initialize:function Raster2(t,n){if(!this._initialize(t,n!==i&&_.read(arguments))){var r,h=typeof t,c="string"===h?o.getElementById(t):"object"===h?t:null;if(c&&c!==M.NO_INSERT)if(c.getContext||null!=c.naturalHeight)r=c;else if(c){var u=w.read(arguments);u.isZero()||(r=mt.getCanvas(u))}r?this.setImage(r):this.setSource(t)}this._size||(this._size=new w,this._loaded=!1)},_equals:function(t){return this.getSource()===t.getSource()},copyContent:function(t){var n=t._image,i=t._canvas;if(n)this._setImage(n);else if(i){var r=mt.getCanvas(t._size);r.getContext("2d").drawImage(i,0,0),this._setImage(r)}this._crossOrigin=t._crossOrigin},getSize:function(){var t=this._size;return new x(t?t.width:0,t?t.height:0,this,"setSize")},setSize:function(t,n){var i=w.read(arguments);if(i.equals(this._size))n&&this.clear();else if(i.width>0&&i.height>0){var r=!n&&this.getElement();this._setImage(mt.getCanvas(i)),r&&this.getContext(!0).drawImage(r,0,0,i.width,i.height)}else this._canvas&&mt.release(this._canvas),this._size=i.clone()},getWidth:function(){return this._size?this._size.width:0},setWidth:function(t){this.setSize(t,this.getHeight())},getHeight:function(){return this._size?this._size.height:0},setHeight:function(t){this.setSize(this.getWidth(),t)},getLoaded:function(){return this._loaded},isEmpty:function(){var t=this._size;return!t||0===t.width&&0===t.height},getResolution:function(){var t=this._matrix,n=new _(0,0).transform(t),i=new _(1,0).transform(t).subtract(n),r=new _(0,1).transform(t).subtract(n);return new w(72/i.getLength(),72/r.getLength())},getPpi:"#getResolution",getImage:function(){return this._image},setImage:function(t){var n=this;function emit(t){var i=n.getView(),r=t&&t.type||"load";i&&n.responds(r)&&(wt=i._scope,n.emit(r,new lt(t)))}this._setImage(t),this._loaded?setTimeout(emit,0):t&&st.add(t,{load:function(i){n._setImage(t),emit(i)},error:emit})},_setImage:function(t){this._canvas&&mt.release(this._canvas),t&&t.getContext?(this._image=null,this._canvas=t,this._loaded=!0):(this._image=t,this._canvas=null,this._loaded=!!(t&&t.src&&t.complete)),this._size=new w(t?t.naturalWidth||t.width:0,t?t.naturalHeight||t.height:0),this._context=null,this._changed(1033)},getCanvas:function(){if(!this._canvas){var t=mt.getContext(this._size);try{this._image&&t.drawImage(this._image,0,0),this._canvas=t.canvas}catch(dr){mt.release(t)}}return this._canvas},setCanvas:"#setImage",getContext:function(t){return this._context||(this._context=this.getCanvas().getContext("2d")),t&&(this._image=null,this._changed(1025)),this._context},setContext:function(t){this._context=t},getSource:function(){var t=this._image;return t&&t.src||this.toDataURL()},setSource:function(n){var i=new t.Image,r=this._crossOrigin;r&&(i.crossOrigin=r),n&&(i.src=n),this.setImage(i)},getCrossOrigin:function(){var t=this._image;return t&&t.crossOrigin||this._crossOrigin||""},setCrossOrigin:function(t){this._crossOrigin=t;var n=this._image;n&&(n.crossOrigin=t)},getSmoothing:function(){return this._smoothing},setSmoothing:function(t){this._smoothing="string"==typeof t?t:t?"low":"off",this._changed(257)},getElement:function(){return this._canvas||this._loaded&&this._image}},{beans:!1,getSubCanvas:function(){var t=S.read(arguments),n=mt.getContext(t.getSize());return n.drawImage(this.getCanvas(),t.x,t.y,t.width,t.height,0,0,t.width,t.height),n.canvas},getSubRaster:function(){var t=S.read(arguments),n=new D(M.NO_INSERT);return n._setImage(this.getSubCanvas(t)),n.translate(t.getCenter().subtract(this.getSize().divide(2))),n._matrix.prepend(this._matrix),n.insertAbove(this),n},toDataURL:function(){var t=this._image,n=t&&t.src;if(/^data:/.test(n))return n;var i=this.getCanvas();return i?i.toDataURL.apply(i,arguments):null},drawImage:function(t){var n=_.read(arguments,1);this.getContext(!0).drawImage(t,n.x,n.y)},getAverageColor:function(t){var n,i;if(t?t instanceof W?(i=t,n=t.getBounds()):"object"==typeof t&&("width"in t?n=new S(t):"x"in t&&(n=new S(t.x-.5,t.y-.5,1,1))):n=this.getBounds(),!n)return null;var r=Math.min(n.width,32),o=Math.min(n.height,32),c=D._sampleContext;c?c.clearRect(0,0,33,33):c=D._sampleContext=mt.getContext(new w(32)),c.save();var u=(new k).scale(r/n.width,o/n.height).translate(-n.x,-n.y);u.applyToContext(c),i&&i.draw(c,new h({clip:!0,matrices:[u]})),this._matrix.applyToContext(c);var d=this.getElement(),p=this._size;d&&c.drawImage(d,-p.width/2,-p.height/2),c.restore();for(var g=c.getImageData(.5,.5,Math.ceil(r),Math.ceil(o)).data,m=[0,0,0],v=0,_=0,y=g.length;_<y;_+=4){var x=g[_+3];v+=x,x/=255,m[0]+=g[_]*x,m[1]+=g[_+1]*x,m[2]+=g[_+2]*x}for(_=0;_<3;_++)m[_]/=v;return v?tt.read(m):null},getPixel:function(){var t=_.read(arguments),n=this.getContext().getImageData(t.x,t.y,1,1).data;return new tt("rgb",[n[0]/255,n[1]/255,n[2]/255],n[3]/255)},setPixel:function(){var t=arguments,n=_.read(t),i=tt.read(t),r=i._convert("rgb"),o=i._alpha,h=this.getContext(!0),c=h.createImageData(1,1),u=c.data;u[0]=255*r[0],u[1]=255*r[1],u[2]=255*r[2],u[3]=null!=o?255*o:255,h.putImageData(c,n.x,n.y)},clear:function(){var t=this._size;this.getContext(!0).clearRect(0,0,t.width+1,t.height+1)},createImageData:function(){var t=w.read(arguments);return this.getContext().createImageData(t.width,t.height)},getImageData:function(){var t=S.read(arguments);return t.isEmpty()&&(t=new S(this._size)),this.getContext().getImageData(t.x,t.y,t.width,t.height)},putImageData:function(t){var n=_.read(arguments,1);this.getContext(!0).putImageData(t,n.x,n.y)},setImageData:function(t){this.setSize(t),this.getContext(!0).putImageData(t,0,0)},_getBounds:function(t,n){var i=new S(this._size).setCenter(0,0);return t?t._transformBounds(i):i},_hitTestSelf:function(t){if(this._contains(t)){var n=this;return new V("pixel",n,{offset:t.add(n._size.divide(2)).round(),color:{get:function(){return n.getPixel(this.offset)}}})}},_draw:function(t,n,i){var r=this.getElement();if(r&&r.width>0&&r.height>0){t.globalAlpha=m.clamp(this._opacity,0,1),this._setStyles(t,n,i);var o=this._smoothing,h="off"===o;rt.setPrefixed(t,h?"imageSmoothingEnabled":"imageSmoothingQuality",!h&&o),t.drawImage(r,-this._size.width/2,-this._size.height/2)}},_canComposite:function(){return!0}}),N=M.extend({_class:"SymbolItem",_applyMatrix:!1,_canApplyMatrix:!1,_boundsOptions:{stroke:!0},_serializeFields:{symbol:null},initialize:function SymbolItem2(t,n){this._initialize(t,n!==i&&_.read(arguments,1))||this.setDefinition(t instanceof j?t:new j(t))},_equals:function(t){return this._definition===t._definition},copyContent:function(t){this.setDefinition(t._definition)},getDefinition:function(){return this._definition},setDefinition:function(t){this._definition=t,this._changed(9)},getSymbol:"#getDefinition",setSymbol:"#setDefinition",isEmpty:function(){return this._definition._item.isEmpty()},_getBounds:function(t,n){var i=this._definition._item;return i._getCachedBounds(i._matrix.prepended(t),n)},_hitTestSelf:function(t,n,i){var r=n.extend({all:!1}),o=this._definition._item._hitTest(t,r,i);return o&&(o.item=this),o},_draw:function(t,n){this._definition._item.draw(t,n)}}),j=h.extend({_class:"SymbolDefinition",initialize:function SymbolDefinition2(t,n){this._id=v.get(),this.project=wt.project,t&&this.setItem(t,n)},_serialize:function(t,n){return n.add(this,(function(){return h.serialize([this._class,this._item],t,!1,n)}))},_changed:function(t){8&t&&M._clearBoundsCache(this),1&t&&this.project._changed(t)},getItem:function(){return this._item},setItem:function(t,n){t._symbol&&(t=t.clone()),this._item&&(this._item._symbol=null),this._item=t,t.remove(),t.setSelected(!1),n||t.setPosition(new _),t._symbol=this,this._changed(9)},getDefinition:"#getItem",setDefinition:"#setItem",place:function(t){return new N(this,t)},clone:function(){return new j(this._item.clone(!1))},equals:function(t){return t===this||t&&this._item.equals(t._item)||!1}}),V=h.extend({_class:"HitResult",initialize:function HitResult2(t,n,i){this.type=t,this.item=n,i&&this.inject(i)},statics:{getOptions:function(t){var n=t&&h.read(t);return new h({type:null,tolerance:wt.settings.hitTolerance,fill:!n,stroke:!n,segments:!n,handles:!1,ends:!1,position:!1,center:!1,bounds:!1,guides:!1,selected:!1},n)}}}),U=h.extend({_class:"Segment",beans:!0,_selection:0,initialize:function Segment2(t,n,r,o,h,c){var u,d,p,g,m=arguments.length;m>0&&(null==t||"object"==typeof t?1===m&&t&&"point"in t?(u=t.point,d=t.handleIn,p=t.handleOut,g=t.selection):(u=t,d=n,p=r,g=o):(u=[t,n],d=r!==i?[r,o]:null,p=h!==i?[h,c]:null)),new z(u,this,"_point"),new z(d,this,"_handleIn"),new z(p,this,"_handleOut"),g&&this.setSelection(g)},_serialize:function(t,n){var i=this._point,r=this._selection,o=r||this.hasHandles()?[i,this._handleIn,this._handleOut]:i;return r&&o.push(r),h.serialize(o,t,!0,n)},_changed:function(t){var n=this._path;if(n){var i,r=n._curves,o=this._index;r&&(t&&t!==this._point&&t!==this._handleIn||!(i=o>0?r[o-1]:n._closed?r[r.length-1]:null)||i._changed(),t&&t!==this._point&&t!==this._handleOut||!(i=r[o])||i._changed()),n._changed(41)}},getPoint:function(){return this._point},setPoint:function(){this._point.set(_.read(arguments))},getHandleIn:function(){return this._handleIn},setHandleIn:function(){this._handleIn.set(_.read(arguments))},getHandleOut:function(){return this._handleOut},setHandleOut:function(){this._handleOut.set(_.read(arguments))},hasHandles:function(){return!this._handleIn.isZero()||!this._handleOut.isZero()},isSmooth:function(){var t=this._handleIn,n=this._handleOut;return!t.isZero()&&!n.isZero()&&t.isCollinear(n)},clearHandles:function(){this._handleIn._set(0,0),this._handleOut._set(0,0)},getSelection:function(){return this._selection},setSelection:function(t){var n=this._selection,i=this._path;this._selection=t=t||0,i&&t!==n&&(i._updateSelection(this,n,t),i._changed(257))},_changeSelection:function(t,n){var i=this._selection;this.setSelection(n?i|t:i&~t)},isSelected:function(){return!!(7&this._selection)},setSelected:function(t){this._changeSelection(7,t)},getIndex:function(){return this._index!==i?this._index:null},getPath:function(){return this._path||null},getCurve:function(){var t=this._path,n=this._index;return t?(n>0&&!t._closed&&n===t._segments.length-1&&n--,t.getCurves()[n]||null):null},getLocation:function(){var t=this.getCurve();return t?new q(t,this===t._segment1?0:1):null},getNext:function(){var t=this._path&&this._path._segments;return t&&(t[this._index+1]||this._path._closed&&t[0])||null},smooth:function(t,n,r){var o=t||{},h=o.type,c=o.factor,u=this.getPrevious(),d=this.getNext(),p=(u||this)._point,g=this._point,m=(d||this)._point,v=p.getDistance(g),y=g.getDistance(m);if(h&&"catmull-rom"!==h){if("geometric"!==h)throw new Error("Smoothing method '"+h+"' not supported.");if(u&&d){var w=p.subtract(m),x=c===i?.4:c,S=x*v/(v+y);n||this.setHandleIn(w.multiply(S)),r||this.setHandleOut(w.multiply(S-x))}}else{var C=c===i?.5:c,k=Math.pow(v,C),P=k*k,I=Math.pow(y,C),M=I*I;if(!n&&u){var E=2*M+3*I*k+P,T=3*I*(I+k);this.setHandleIn(0!==T?new _((M*p._x+E*g._x-P*m._x)/T-g._x,(M*p._y+E*g._y-P*m._y)/T-g._y):new _)}if(!r&&d){E=2*P+3*k*I+M,T=3*k*(k+I);this.setHandleOut(0!==T?new _((P*m._x+E*g._x-M*p._x)/T-g._x,(P*m._y+E*g._y-M*p._y)/T-g._y):new _)}}},getPrevious:function(){var t=this._path&&this._path._segments;return t&&(t[this._index-1]||this._path._closed&&t[t.length-1])||null},isFirst:function(){return!this._index},isLast:function(){var t=this._path;return t&&this._index===t._segments.length-1||!1},reverse:function(){var t=this._handleIn,n=this._handleOut,i=t.clone();t.set(n),n.set(i)},reversed:function(){return new U(this._point,this._handleOut,this._handleIn)},remove:function(){return!!this._path&&!!this._path.removeSegment(this._index)},clone:function(){return new U(this._point,this._handleIn,this._handleOut)},equals:function(t){return t===this||t&&this._class===t._class&&this._point.equals(t._point)&&this._handleIn.equals(t._handleIn)&&this._handleOut.equals(t._handleOut)||!1},toString:function(){var t=["point: "+this._point];return this._handleIn.isZero()||t.push("handleIn: "+this._handleIn),this._handleOut.isZero()||t.push("handleOut: "+this._handleOut),"{ "+t.join(", ")+" }"},transform:function(t){this._transformCoordinates(t,new Array(6),!0),this._changed()},interpolate:function(t,n,i){var r=1-i,o=i,h=t._point,c=n._point,u=t._handleIn,d=n._handleIn,p=n._handleOut,g=t._handleOut;this._point._set(r*h._x+o*c._x,r*h._y+o*c._y,!0),this._handleIn._set(r*u._x+o*d._x,r*u._y+o*d._y,!0),this._handleOut._set(r*g._x+o*p._x,r*g._y+o*p._y,!0),this._changed()},_transformCoordinates:function(t,n,i){var r=this._point,o=i&&this._handleIn.isZero()?null:this._handleIn,h=i&&this._handleOut.isZero()?null:this._handleOut,c=r._x,u=r._y,d=2;return n[0]=c,n[1]=u,o&&(n[d++]=o._x+c,n[d++]=o._y+u),h&&(n[d++]=h._x+c,n[d++]=h._y+u),t&&(t._transformCoordinates(n,n,d/2),c=n[0],u=n[1],i?(r._x=c,r._y=u,d=2,o&&(o._x=n[d++]-c,o._y=n[d++]-u),h&&(h._x=n[d++]-c,h._y=n[d++]-u)):(o||(n[d++]=c,n[d++]=u),h||(n[d++]=c,n[d++]=u))),n}}),z=_.extend({initialize:function SegmentPoint2(t,n,r){var o,h,c;if(t)if((o=t[0])!==i)h=t[1];else{var u=t;(o=u.x)===i&&(o=(u=_.read(arguments)).x),h=u.y,c=u.selected}else o=h=0;this._x=o,this._y=h,this._owner=n,n[r]=this,c&&this.setSelected(!0)},_set:function(t,n){return this._x=t,this._y=n,this._owner._changed(this),this},getX:function(){return this._x},setX:function(t){this._x=t,this._owner._changed(this)},getY:function(){return this._y},setY:function(t){this._y=t,this._owner._changed(this)},isZero:function(){var t=m.isZero;return t(this._x)&&t(this._y)},isSelected:function(){return!!(this._owner._selection&this._getSelection())},setSelected:function(t){this._owner._changeSelection(this._getSelection(),t)},_getSelection:function(){var t=this._owner;return this===t._point?1:this===t._handleIn?2:this===t._handleOut?4:0}}),F=h.extend({_class:"Curve",beans:!0,initialize:function Curve2(t,n,i,r,o,h,c,u){var d,p,g,m,v,_,y=arguments.length;3===y?(this._path=t,d=n,p=i):y?1===y?"segment1"in t?(d=new U(t.segment1),p=new U(t.segment2)):"point1"in t?(g=t.point1,v=t.handle1,_=t.handle2,m=t.point2):Array.isArray(t)&&(g=[t[0],t[1]],m=[t[6],t[7]],v=[t[2]-t[0],t[3]-t[1]],_=[t[4]-t[6],t[5]-t[7]]):2===y?(d=new U(t),p=new U(n)):4===y?(g=t,v=n,_=i,m=r):8===y&&(g=[t,n],m=[c,u],v=[i-t,r-n],_=[o-c,h-u]):(d=new U,p=new U),this._segment1=d||new U(g,null,v),this._segment2=p||new U(m,_,null)},_serialize:function(t,n){return h.serialize(this.hasHandles()?[this.getPoint1(),this.getHandle1(),this.getHandle2(),this.getPoint2()]:[this.getPoint1(),this.getPoint2()],t,!0,n)},_changed:function(){this._length=this._bounds=i},clone:function(){return new F(this._segment1,this._segment2)},toString:function(){var t=["point1: "+this._segment1._point];return this._segment1._handleOut.isZero()||t.push("handle1: "+this._segment1._handleOut),this._segment2._handleIn.isZero()||t.push("handle2: "+this._segment2._handleIn),t.push("point2: "+this._segment2._point),"{ "+t.join(", ")+" }"},classify:function(){return F.classify(this.getValues())},remove:function(){var t=!1;if(this._path){var n=this._segment2,i=n._handleOut;(t=n.remove())&&this._segment1._handleOut.set(i)}return t},getPoint1:function(){return this._segment1._point},setPoint1:function(){this._segment1._point.set(_.read(arguments))},getPoint2:function(){return this._segment2._point},setPoint2:function(){this._segment2._point.set(_.read(arguments))},getHandle1:function(){return this._segment1._handleOut},setHandle1:function(){this._segment1._handleOut.set(_.read(arguments))},getHandle2:function(){return this._segment2._handleIn},setHandle2:function(){this._segment2._handleIn.set(_.read(arguments))},getSegment1:function(){return this._segment1},getSegment2:function(){return this._segment2},getPath:function(){return this._path},getIndex:function(){return this._segment1._index},getNext:function(){var t=this._path&&this._path._curves;return t&&(t[this._segment1._index+1]||this._path._closed&&t[0])||null},getPrevious:function(){var t=this._path&&this._path._curves;return t&&(t[this._segment1._index-1]||this._path._closed&&t[t.length-1])||null},isFirst:function(){return!this._segment1._index},isLast:function(){var t=this._path;return t&&this._segment1._index===t._curves.length-1||!1},isSelected:function(){return this.getPoint1().isSelected()&&this.getHandle1().isSelected()&&this.getHandle2().isSelected()&&this.getPoint2().isSelected()},setSelected:function(t){this.getPoint1().setSelected(t),this.getHandle1().setSelected(t),this.getHandle2().setSelected(t),this.getPoint2().setSelected(t)},getValues:function(t){return F.getValues(this._segment1,this._segment2,t)},getPoints:function(){for(var t=this.getValues(),n=[],i=0;i<8;i+=2)n.push(new _(t[i],t[i+1]));return n}},{getLength:function(){return null==this._length&&(this._length=F.getLength(this.getValues(),0,1)),this._length},getArea:function(){return F.getArea(this.getValues())},getLine:function(){return new P(this._segment1._point,this._segment2._point)},getPart:function(t,n){return new F(F.getPart(this.getValues(),t,n))},getPartLength:function(t,n){return F.getLength(this.getValues(),t,n)},divideAt:function(t){return this.divideAtTime(t&&t.curve===this?t.time:this.getTimeAt(t))},divideAtTime:function(t,n){var i=null;if(t>=1e-8&&t<=.99999999){var r=F.subdivide(this.getValues(),t),o=r[0],h=r[1],c=n||this.hasHandles(),u=this._segment1,d=this._segment2,p=this._path;c&&(u._handleOut._set(o[2]-o[0],o[3]-o[1]),d._handleIn._set(h[4]-h[6],h[5]-h[7]));var g=o[6],m=o[7],v=new U(new _(g,m),c&&new _(o[4]-g,o[5]-m),c&&new _(h[2]-g,h[3]-m));p?(p.insert(u._index+1,v),i=this.getNext()):(this._segment2=v,this._changed(),i=new F(v,d))}return i},splitAt:function(t){var n=this._path;return n?n.splitAt(t):null},splitAtTime:function(t){return this.splitAt(this.getLocationAtTime(t))},divide:function(t,n){return this.divideAtTime(t===i?.5:n?t:this.getTimeAt(t))},split:function(t,n){return this.splitAtTime(t===i?.5:n?t:this.getTimeAt(t))},reversed:function(){return new F(this._segment2.reversed(),this._segment1.reversed())},clearHandles:function(){this._segment1._handleOut._set(0,0),this._segment2._handleIn._set(0,0)},statics:{getValues:function(t,n,i,r){var o=t._point,h=t._handleOut,c=n._handleIn,u=n._point,d=o.x,p=o.y,g=u.x,m=u.y,v=r?[d,p,d,p,g,m,g,m]:[d,p,d+h._x,p+h._y,g+c._x,m+c._y,g,m];return i&&i._transformCoordinates(v,v,4),v},subdivide:function(t,n){var r=t[0],o=t[1],h=t[2],c=t[3],u=t[4],d=t[5],p=t[6],g=t[7];n===i&&(n=.5);var m=1-n,v=m*r+n*h,_=m*o+n*c,y=m*h+n*u,w=m*c+n*d,x=m*u+n*p,S=m*d+n*g,C=m*v+n*y,k=m*_+n*w,P=m*y+n*x,I=m*w+n*S,M=m*C+n*P,E=m*k+n*I;return[[r,o,v,_,C,k,M,E],[M,E,P,I,x,S,p,g]]},getMonoCurves:function(t,n){var i=[],r=n?0:1,o=t[r+0],h=t[r+2],c=t[r+4],u=t[r+6];if(o>=h==h>=c&&h>=c==c>=u||F.isStraight(t))i.push(t);else{var d=3*(h-c)-o+u,p=2*(o+c)-4*h,g=h-o,v=[],_=m.solveQuadratic(d,p,g,v,1e-8,.99999999);if(_){v.sort();var y=v[0],w=F.subdivide(t,y);i.push(w[0]),_>1&&(y=(v[1]-y)/(1-y),w=F.subdivide(w[1],y),i.push(w[0])),i.push(w[1])}else i.push(t)}return i},solveCubic:function(t,n,i,r,o,h){var c=t[n],u=t[n+2],d=t[n+4],p=t[n+6],g=0;if(!(c<i&&p<i&&u<i&&d<i||c>i&&p>i&&u>i&&d>i)){var v=3*(u-c),_=3*(d-u)-v,y=p-c-v-_;g=m.solveCubic(y,_,v,c-i,r,o,h)}return g},getTimeOf:function(t,n){var i=new _(t[0],t[1]),r=new _(t[6],t[7]),o=1e-7;if(null===(n.isClose(i,1e-12)?0:n.isClose(r,1e-12)?1:null))for(var h=[n.x,n.y],c=[],u=0;u<2;u++)for(var d=F.solveCubic(t,u,h[u],c,0,1),p=0;p<d;p++){var g=c[p];if(n.isClose(F.getPoint(t,g),o))return g}return n.isClose(i,o)?0:n.isClose(r,o)?1:null},getNearestTime:function(t,n){if(F.isStraight(t)){var i=t[0],r=t[1],o=t[6]-i,h=t[7]-r,c=o*o+h*h;if(0===c)return 0;var u=((n.x-i)*o+(n.y-r)*h)/c;return u<1e-12?0:u>.999999999999?1:F.getTimeOf(t,new _(i+u*o,r+u*h))}var d=1/0,p=0;function refine(i){if(i>=0&&i<=1){var r=n.getDistance(F.getPoint(t,i),!0);if(r<d)return d=r,p=i,!0}}for(var g=0;g<=100;g++)refine(g/100);for(var m=.005;m>1e-8;)refine(p-m)||refine(p+m)||(m/=2);return p},getPart:function(t,n,i){var r=n>i;if(r){var o=n;n=i,i=o}return n>0&&(t=F.subdivide(t,n)[1]),i<1&&(t=F.subdivide(t,(i-n)/(1-n))[0]),r?[t[6],t[7],t[4],t[5],t[2],t[3],t[0],t[1]]:t},isFlatEnough:function(t,n){var i=t[0],r=t[1],o=t[2],h=t[3],c=t[4],u=t[5],d=t[6],p=t[7],g=3*o-2*i-d,m=3*h-2*r-p,v=3*c-2*d-i,_=3*u-2*p-r;return Math.max(g*g,v*v)+Math.max(m*m,_*_)<=16*n*n},getArea:function(t){var n=t[0],i=t[1],r=t[2],o=t[3],h=t[4],c=t[5],u=t[6],d=t[7];return 3*((d-i)*(r+h)-(u-n)*(o+c)+o*(n-h)-r*(i-c)+d*(h+n/3)-u*(c+i/3))/20},getBounds:function(t){for(var n=t.slice(0,2),i=n.slice(),r=[0,0],o=0;o<2;o++)F._addBounds(t[o],t[o+2],t[o+4],t[o+6],o,0,n,i,r);return new S(n[0],n[1],i[0]-n[0],i[1]-n[1])},_addBounds:function(t,n,i,r,o,h,c,u,d){function add(t,n){var i=t-n,r=t+n;i<c[o]&&(c[o]=i),r>u[o]&&(u[o]=r)}h/=2;var p=c[o]+h,g=u[o]-h;if(t<p||n<p||i<p||r<p||t>g||n>g||i>g||r>g)if(n<t!=n<r&&i<t!=i<r)add(t,0),add(r,0);else{var v=3*(n-i)-t+r,_=2*(t+i)-4*n,y=n-t,w=m.solveQuadratic(v,_,y,d);add(r,0);for(var x=0;x<w;x++){var S=d[x],C=1-S;1e-8<=S&&S<=.99999999&&add(C*C*C*t+3*C*C*S*n+3*C*S*S*i+S*S*S*r,h)}}}}},h.each(["getBounds","getStrokeBounds","getHandleBounds"],(function(t){this[t]=function(){this._bounds||(this._bounds={});var n=this._bounds[t];return n||(n=this._bounds[t]=Y[t]([this._segment1,this._segment2],!1,this._path)),n.clone()}}),{}),h.each({isStraight:function(t,n,i,r){if(n.isZero()&&i.isZero())return!0;var o=r.subtract(t);if(o.isZero())return!1;if(o.isCollinear(n)&&o.isCollinear(i)){var h=new P(t,r);if(h.getDistance(t.add(n))<1e-7&&h.getDistance(r.add(i))<1e-7){var c=o.dot(o),u=o.dot(n)/c,d=o.dot(i)/c;return u>=0&&u<=1&&d<=0&&d>=-1}}return!1},isLinear:function(t,n,i,r){var o=r.subtract(t).divide(3);return n.equals(o)&&i.negate().equals(o)}},(function(t,n){this[n]=function(n){var i=this._segment1,r=this._segment2;return t(i._point,i._handleOut,r._handleIn,r._point,n)},this.statics[n]=function(n,i){var r=n[0],o=n[1],h=n[6],c=n[7];return t(new _(r,o),new _(n[2]-r,n[3]-o),new _(n[4]-h,n[5]-c),new _(h,c),i)}}),{statics:{},hasHandles:function(){return!this._segment1._handleOut.isZero()||!this._segment2._handleIn.isZero()},hasLength:function(t){return(!this.getPoint1().equals(this.getPoint2())||this.hasHandles())&&this.getLength()>(t||0)},isCollinear:function(t){return t&&this.isStraight()&&t.isStraight()&&this.getLine().isCollinear(t.getLine())},isHorizontal:function(){return this.isStraight()&&Math.abs(this.getTangentAtTime(.5).y)<1e-8},isVertical:function(){return this.isStraight()&&Math.abs(this.getTangentAtTime(.5).x)<1e-8}}),{beans:!1,getLocationAt:function(t,n){return this.getLocationAtTime(n?t:this.getTimeAt(t))},getLocationAtTime:function(t){return null!=t&&t>=0&&t<=1?new q(this,t):null},getTimeAt:function(t,n){return F.getTimeAt(this.getValues(),t,n)},getParameterAt:"#getTimeAt",getTimesWithTangent:function(){var t=_.read(arguments);return t.isZero()?[]:F.getTimesWithTangent(this.getValues(),t)},getOffsetAtTime:function(t){return this.getPartLength(0,t)},getLocationOf:function(){return this.getLocationAtTime(this.getTimeOf(_.read(arguments)))},getOffsetOf:function(){var t=this.getLocationOf.apply(this,arguments);return t?t.getOffset():null},getTimeOf:function(){return F.getTimeOf(this.getValues(),_.read(arguments))},getParameterOf:"#getTimeOf",getNearestLocation:function(){var t=_.read(arguments),n=this.getValues(),i=F.getNearestTime(n,t),r=F.getPoint(n,i);return new q(this,i,r,null,t.getDistance(r))},getNearestPoint:function(){var t=this.getNearestLocation.apply(this,arguments);return t?t.getPoint():t}},new function(){var t=["getPoint","getTangent","getNormal","getWeightedTangent","getWeightedNormal","getCurvature"];return h.each(t,(function(t){this[t+"At"]=function(n,i){var r=this.getValues();return F[t](r,i?n:F.getTimeAt(r,n))},this[t+"AtTime"]=function(n){return F[t](this.getValues(),n)}}),{statics:{_evaluateMethods:t}})},new function(){function getLengthIntegrand(t){var n=t[0],i=t[1],r=t[2],o=t[3],h=t[4],c=t[5],u=t[6],d=t[7],p=9*(r-h)+3*(u-n),g=6*(n+h)-12*r,m=3*(r-n),v=9*(o-c)+3*(d-i),_=6*(i+c)-12*o,y=3*(o-i);return function(t){var n=(p*t+g)*t+m,i=(v*t+_)*t+y;return Math.sqrt(n*n+i*i)}}function getIterations(t,n){return Math.max(2,Math.min(16,Math.ceil(32*Math.abs(n-t))))}function evaluate(t,n,i,r){if(null==n||n<0||n>1)return null;var o=t[0],h=t[1],c=t[2],u=t[3],d=t[4],p=t[5],g=t[6],v=t[7],y=m.isZero;y(c-o)&&y(u-h)&&(c=o,u=h),y(d-g)&&y(p-v)&&(d=g,p=v);var w,x,S=3*(c-o),C=3*(d-c)-S,k=g-o-S-C,P=3*(u-h),I=3*(p-u)-P,M=v-h-P-I;if(0===i)w=0===n?o:1===n?g:((k*n+C)*n+S)*n+o,x=0===n?h:1===n?v:((M*n+I)*n+P)*n+h;else{var E=1e-8,T=1-E;if(n<E?(w=S,x=P):n>T?(w=3*(g-d),x=3*(v-p)):(w=(3*k*n+2*C)*n+S,x=(3*M*n+2*I)*n+P),r){0===w&&0===x&&(n<E||n>T)&&(w=d-c,x=p-u);var O=Math.sqrt(w*w+x*x);O&&(w/=O,x/=O)}if(3===i){d=6*k*n+2*C,p=6*M*n+2*I;var D=Math.pow(w*w+x*x,1.5);w=0!==D?(w*p-x*d)/D:0,x=0}}return 2===i?new _(x,-w):new _(w,x)}return{statics:{classify:function(t){var n=t[0],r=t[1],o=t[2],h=t[3],c=t[4],u=t[5],d=t[6],p=t[7],g=o*(r-p)+h*(d-n)+n*p-r*d,v=3*(c*(h-r)+u*(n-o)+o*r-h*n),_=v-g,y=_-g+(n*(p-u)+r*(c-d)+d*u-p*c),w=Math.sqrt(y*y+_*_+v*v),x=0!==w?1/w:0,S=m.isZero,C="serpentine";function type(t,n,r){var o=n!==i,h=o&&n>0&&n<1,c=o&&r>0&&r<1;return!o||(h||c)&&("loop"!==t||h&&c)||(t="arch",h=c=!1),{type:t,roots:h||c?h&&c?n<r?[n,r]:[r,n]:[h?n:r]:null}}if(_*=x,v*=x,S(y*=x))return S(_)?type(S(v)?"line":"quadratic"):type(C,v/(3*_));var k=3*_*_-4*y*v;if(S(k))return type("cusp",_/(2*y));var P=k>0?Math.sqrt(k/3):Math.sqrt(-k),I=2*y;return type(k>0?C:"loop",(_+P)/I,(_-P)/I)},getLength:function(t,n,r,o){if(n===i&&(n=0),r===i&&(r=1),F.isStraight(t)){var h=t;r<1&&(h=F.subdivide(h,r)[0],n/=r),n>0&&(h=F.subdivide(h,n)[1]);var c=h[6]-h[0],u=h[7]-h[1];return Math.sqrt(c*c+u*u)}return m.integrate(o||getLengthIntegrand(t),n,r,getIterations(n,r))},getTimeAt:function(t,n,r){if(r===i&&(r=n<0?1:0),0===n)return r;var o=Math.abs,h=n>0,c=h?r:0,u=h?1:r,d=getLengthIntegrand(t),p=F.getLength(t,c,u,d),g=o(n)-p;if(o(g)<1e-12)return h?u:c;if(g>1e-12)return null;var v=n/p,_=0;return m.findRoot((function f2(t){return _+=m.integrate(d,r,t,getIterations(r,t)),r=t,_-n}),d,r+v,c,u,32,1e-12)},getPoint:function(t,n){return evaluate(t,n,0,!1)},getTangent:function(t,n){return evaluate(t,n,1,!0)},getWeightedTangent:function(t,n){return evaluate(t,n,1,!1)},getNormal:function(t,n){return evaluate(t,n,2,!0)},getWeightedNormal:function(t,n){return evaluate(t,n,2,!1)},getCurvature:function(t,n){return evaluate(t,n,3,!1).x},getPeaks:function(t){var n=t[0],i=t[1],r=t[2],o=t[3],h=t[4],c=t[5],u=3*r-n-3*h+t[6],d=3*n-6*r+3*h,p=-3*n+3*r,g=3*o-i-3*c+t[7],v=3*i-6*o+3*c,_=-3*i+3*o,y=[];return m.solveCubic(9*(u*u+g*g),9*(u*d+v*g),2*(d*d+v*v)+3*(p*u+_*g),p*d+v*_,y,1e-8,.99999999),y.sort()}}}},new function(){function addLocation(t,n,i,r,o,h,c){var u=!c&&i.getPrevious()===o,d=!c&&i!==o&&i.getNext()===o,p=1e-8,g=1-p;if(null!==r&&r>=(u?p:0)&&r<=(d?g:1)&&null!==h&&h>=(d?p:0)&&h<=(u?g:1)){var m=new q(i,r,null,c),v=new q(o,h,null,c);m._intersection=v,v._intersection=m,n&&!n(m)||q.insert(t,m,!0)}}function addCurveIntersections(t,n,i,r,o,h,c,u,d,p,g,m,v){if(++d>=4096||++u>=40)return d;var _,y,w=n[0],x=n[1],S=n[6],C=n[7],k=P.getSignedDistance,I=k(w,x,S,C,n[2],n[3]),M=k(w,x,S,C,n[4],n[5]),E=I*M>0?3/4:4/9,T=E*Math.min(0,I,M),O=E*Math.max(0,I,M),D=k(w,x,S,C,t[0],t[1]),N=k(w,x,S,C,t[2],t[3]),j=k(w,x,S,C,t[4],t[5]),V=k(w,x,S,C,t[6],t[7]),U=function getConvexHull(t,n,i,r){var o,h=[0,t],c=[1/3,n],u=[2/3,i],d=[1,r],p=n-(2*t+r)/3,g=i-(t+2*r)/3;if(p*g<0)o=[[h,c,d],[h,u,d]];else{var m=p/g;o=[m>=2?[h,c,d]:m<=.5?[h,u,d]:[h,c,u,d],[h,d]]}return(p||g)<0?o.reverse():o}(D,N,j,V),z=U[0],q=U[1];if(0===I&&0===M&&0===D&&0===N&&0===j&&0===V||null==(_=clipConvexHull(z,q,T,O))||null==(y=clipConvexHull(z.reverse(),q.reverse(),T,O)))return d;var W=p+(g-p)*_,Y=p+(g-p)*y;if(Math.max(v-m,Y-W)<1e-9){var H=(W+Y)/2,X=(m+v)/2;addLocation(o,h,c?r:i,c?X:H,c?i:r,c?H:X)}else{t=F.getPart(t,_,y);var J=v-m;if(y-_>.8)if(Y-W>J){H=(W+Y)/2;d=addCurveIntersections(n,(Z=F.subdivide(t,.5))[0],r,i,o,h,!c,u,d,m,v,W,H),d=addCurveIntersections(n,Z[1],r,i,o,h,!c,u,d,m,v,H,Y)}else{var Z;X=(m+v)/2;d=addCurveIntersections((Z=F.subdivide(n,.5))[0],t,r,i,o,h,!c,u,d,m,X,W,Y),d=addCurveIntersections(Z[1],t,r,i,o,h,!c,u,d,X,v,W,Y)}else d=0===J||J>=1e-9?addCurveIntersections(n,t,r,i,o,h,!c,u,d,m,v,W,Y):addCurveIntersections(t,n,i,r,o,h,c,u,d,W,Y,m,v)}return d}function clipConvexHull(t,n,i,r){return t[0][1]<i?clipConvexHullPart(t,!0,i):n[0][1]>r?clipConvexHullPart(n,!1,r):t[0][0]}function clipConvexHullPart(t,n,i){for(var r=t[0][0],o=t[0][1],h=1,c=t.length;h<c;h++){var u=t[h][0],d=t[h][1];if(n?d>=i:d<=i)return d===i?u:r+(i-o)*(u-r)/(d-o);r=u,o=d}return null}function getCurveLineIntersections(t,n,i,r,o){var h=m.isZero;if(h(r)&&h(o)){var c=F.getTimeOf(t,new _(n,i));return null===c?[]:[c]}for(var u=Math.atan2(-o,r),d=Math.sin(u),p=Math.cos(u),g=[],v=[],y=0;y<8;y+=2){var w=t[y]-n,x=t[y+1]-i;g.push(w*p-x*d,w*d+x*p)}return F.solveCubic(g,1,0,v,0,1),v}function addCurveLineIntersections(t,n,i,r,o,h,c){for(var u=n[0],d=n[1],p=getCurveLineIntersections(t,u,d,n[6]-u,n[7]-d),g=0,m=p.length;g<m;g++){var v=p[g],_=F.getPoint(t,v),y=F.getTimeOf(n,_);null!==y&&addLocation(o,h,c?r:i,c?y:v,c?i:r,c?v:y)}}function addLineIntersection(t,n,i,r,o,h){var c=P.intersect(t[0],t[1],t[6],t[7],n[0],n[1],n[6],n[7]);c&&addLocation(o,h,i,F.getTimeOf(t,c),r,F.getTimeOf(n,c))}function getCurveIntersections(t,n,i,r,o,h){var c=1e-12,u=Math.min,d=Math.max;if(d(t[0],t[2],t[4],t[6])+c>u(n[0],n[2],n[4],n[6])&&u(t[0],t[2],t[4],t[6])-c<d(n[0],n[2],n[4],n[6])&&d(t[1],t[3],t[5],t[7])+c>u(n[1],n[3],n[5],n[7])&&u(t[1],t[3],t[5],t[7])-c<d(n[1],n[3],n[5],n[7])){var p=getOverlaps(t,n);if(p)for(var g=0;g<2;g++){var m=p[g];addLocation(o,h,i,m[0],r,m[1],!0)}else{var v=F.isStraight(t),y=F.isStraight(n),w=v&&y,x=v&&!y,S=o.length;if((w?addLineIntersection:v||y?addCurveLineIntersections:addCurveIntersections)(x?n:t,x?t:n,x?r:i,x?i:r,o,h,x,0,0,0,1,0,1),!w||o.length===S)for(g=0;g<4;g++){var C=g>>1,k=1&g,P=6*C,I=6*k,M=new _(t[P],t[P+1]),E=new _(n[I],n[I+1]);M.isClose(E,c)&&addLocation(o,h,i,C,r,k)}}}return o}function getSelfIntersection(t,n,i,r){var o=F.classify(t);if("loop"===o.type){var h=o.roots;addLocation(i,r,n,h[0],n,h[1])}return i}function getOverlaps(t,n){function getSquaredLineLength(t){var n=t[6]-t[0],i=t[7]-t[1];return n*n+i*i}var i=Math.abs,r=P.getDistance,o=1e-7,h=F.isStraight(t),c=F.isStraight(n),u=h&&c,d=getSquaredLineLength(t)<getSquaredLineLength(n),p=d?n:t,g=d?t:n,m=p[0],v=p[1],y=p[6]-m,w=p[7]-v;if(r(m,v,y,w,g[0],g[1],!0)<o&&r(m,v,y,w,g[6],g[7],!0)<o)!u&&r(m,v,y,w,p[2],p[3],!0)<o&&r(m,v,y,w,p[4],p[5],!0)<o&&r(m,v,y,w,g[2],g[3],!0)<o&&r(m,v,y,w,g[4],g[5],!0)<o&&(h=c=u=!0);else if(u)return null;if(h^c)return null;for(var x=[t,n],S=[],C=0;C<4&&S.length<2;C++){var k=1&C,I=1^k,M=C>>1,E=F.getTimeOf(x[k],new _(x[I][M?6:0],x[I][M?7:1]));if(null!=E){var T=k?[M,E]:[E,M];(!S.length||i(T[0]-S[0][0])>1e-8&&i(T[1]-S[0][1])>1e-8)&&S.push(T)}if(C>2&&!S.length)break}if(2!==S.length)S=null;else if(!u){var O=F.getPart(t,S[0][0],S[1][0]),D=F.getPart(n,S[0][1],S[1][1]);(i(D[2]-O[2])>o||i(D[3]-O[3])>o||i(D[4]-O[4])>o||i(D[5]-O[5])>o)&&(S=null)}return S}return{getIntersections:function(t){var n=this.getValues(),i=t&&t!==this&&t.getValues();return i?getCurveIntersections(n,i,this,t,[]):getSelfIntersection(n,this,[])},statics:{getOverlaps:getOverlaps,getIntersections:function getIntersections(t,n,i,r,o,h){var c=!n;c&&(n=t);for(var u=t.length,d=n.length,g=new Array(u),m=c?g:new Array(d),v=[],_=0;_<u;_++)g[_]=t[_].getValues(r);if(!c)for(_=0;_<d;_++)m[_]=n[_].getValues(o);for(var y=p.findCurveBoundsCollisions(g,m,1e-7),w=0;w<u;w++){var x=t[w],S=g[w];c&&getSelfIntersection(S,x,v,i);var C=y[w];if(C)for(var k=0;k<C.length;k++){if(h&&v.length)return v;var P=C[k];if(!c||P>w){var I=n[P];getCurveIntersections(S,m[P],x,I,v,i)}}}return v},getCurveLineIntersections:getCurveLineIntersections,getTimesWithTangent:function getTimesWithTangent(t,n){var i=t[0],r=t[1],o=t[2],h=t[3],c=t[4],u=t[5],d=t[6],p=t[7],g=n.normalize(),v=g.x,_=g.y,y=3*d-9*c+9*o-3*i,w=3*p-9*u+9*h-3*r,x=6*c-12*o+6*i,S=6*u-12*h+6*r,C=3*o-3*i,k=3*h-3*r,P=2*y*_-2*w*v,I=[];if(Math.abs(P)<m.CURVETIME_EPSILON){if(0!=(P=y*S-w*x)){var M=-(y*k-w*C)/P;M>=0&&M<=1&&I.push(M)}}else{var E=(x*x-4*y*C)*_*_+(-2*x*S+4*w*C+4*y*k)*v*_+(S*S-4*w*k)*v*v,T=x*_-S*v;if(E>=0&&0!=P){var O=Math.sqrt(E),D=-(T+O)/P,N=(-T+O)/P;D>=0&&D<=1&&I.push(D),N>=0&&N<=1&&I.push(N)}}return I}}}}),q=h.extend({_class:"CurveLocation",initialize:function CurveLocation2(t,n,i,r,o){if(n>=.99999999){var h=t.getNext();h&&(n=0,t=h)}this._setCurve(t),this._time=n,this._point=i||t.getPointAtTime(n),this._overlap=r,this._distance=o,this._intersection=this._next=this._previous=null},_setPath:function(t){this._path=t,this._version=t?t._version:0},_setCurve:function(t){this._setPath(t._path),this._curve=t,this._segment=null,this._segment1=t._segment1,this._segment2=t._segment2},_setSegment:function(t){var n=t.getCurve();n?this._setCurve(n):(this._setPath(t._path),this._segment1=t,this._segment2=null),this._segment=t,this._time=t===this._segment1?0:1,this._point=t._point.clone()},getSegment:function(){var t=this._segment;if(!t){var n=this.getCurve(),i=this.getTime();0===i?t=n._segment1:1===i?t=n._segment2:null!=i&&(t=n.getPartLength(0,i)<n.getPartLength(i,1)?n._segment1:n._segment2),this._segment=t}return t},getCurve:function(){var t=this._path,n=this;function trySegment(t){var i=t&&t.getCurve();if(i&&null!=(n._time=i.getTimeOf(n._point)))return n._setCurve(i),i}return t&&t._version!==this._version&&(this._time=this._offset=this._curveOffset=this._curve=null),this._curve||trySegment(this._segment)||trySegment(this._segment1)||trySegment(this._segment2.getPrevious())},getPath:function(){var t=this.getCurve();return t&&t._path},getIndex:function(){var t=this.getCurve();return t&&t.getIndex()},getTime:function(){var t=this.getCurve(),n=this._time;return t&&null==n?this._time=t.getTimeOf(this._point):n},getParameter:"#getTime",getPoint:function(){return this._point},getOffset:function(){var t=this._offset;if(null==t){t=0;var n=this.getPath(),i=this.getIndex();if(n&&null!=i)for(var r=n.getCurves(),o=0;o<i;o++)t+=r[o].getLength();this._offset=t+=this.getCurveOffset()}return t},getCurveOffset:function(){var t=this._curveOffset;if(null==t){var n=this.getCurve(),i=this.getTime();this._curveOffset=t=null!=i&&n&&n.getPartLength(0,i)}return t},getIntersection:function(){return this._intersection},getDistance:function(){return this._distance},divide:function(){var t=this.getCurve(),n=t&&t.divideAtTime(this.getTime());return n&&this._setSegment(n._segment1),n},split:function(){var t=this.getCurve(),n=t._path,i=t&&t.splitAtTime(this.getTime());return i&&this._setSegment(n.getLastSegment()),i},equals:function(t,n){var i=this===t;if(!i&&t instanceof q){var r=this.getCurve(),o=t.getCurve(),h=r._path;if(h===o._path){var c=Math.abs,u=c(this.getOffset()-t.getOffset()),d=!n&&this._intersection,p=!n&&t._intersection;i=(u<1e-7||h&&c(h.getLength()-u)<1e-7)&&(!d&&!p||d&&p&&d.equals(p,!0))}}return i},toString:function(){var t=[],n=this.getPoint(),i=g.instance;n&&t.push("point: "+n);var r=this.getIndex();null!=r&&t.push("index: "+r);var o=this.getTime();return null!=o&&t.push("time: "+i.number(o)),null!=this._distance&&t.push("distance: "+i.number(this._distance)),"{ "+t.join(", ")+" }"},isTouching:function(){var t=this._intersection;if(t&&this.getTangent().isCollinear(t.getTangent())){var n=this.getCurve(),i=t.getCurve();return!(n.isStraight()&&i.isStraight()&&n.getLine().intersect(i.getLine()))}return!1},isCrossing:function(){var t=this._intersection;if(!t)return!1;var n=this.getTime(),i=t.getTime(),r=1e-8,o=1-r,h=n>=r&&n<=o,c=i>=r&&i<=o;if(h&&c)return!this.isTouching();var u=this.getCurve(),d=u&&n<r?u.getPrevious():u,p=t.getCurve(),g=p&&i<r?p.getPrevious():p;if(n>o&&(u=u.getNext()),i>o&&(p=p.getNext()),!(d&&u&&g&&p))return!1;var m=[];function addOffsets(t,n){var i=t.getValues(),r=F.classify(i).roots||F.getPeaks(i),o=r.length,h=F.getLength(i,n&&o?r[o-1]:0,!n&&o?r[0]:1);m.push(o?h:h/32)}function isInRange(t,n,i){return n<i?t>n&&t<i:t>n||t<i}h||(addOffsets(d,!0),addOffsets(u,!1)),c||(addOffsets(g,!0),addOffsets(p,!1));var v=this.getPoint(),_=Math.min.apply(Math,m),y=h?u.getTangentAtTime(n):u.getPointAt(_).subtract(v),w=h?y.negate():d.getPointAt(-_).subtract(v),x=c?p.getTangentAtTime(i):p.getPointAt(_).subtract(v),S=c?x.negate():g.getPointAt(-_).subtract(v),C=w.getAngle(),k=y.getAngle(),P=S.getAngle(),I=x.getAngle();return!!(h?isInRange(C,P,I)^isInRange(k,P,I)&&isInRange(C,I,P)^isInRange(k,I,P):isInRange(P,C,k)^isInRange(I,C,k)&&isInRange(P,k,C)^isInRange(I,k,C))},hasOverlap:function(){return!!this._overlap}},h.each(F._evaluateMethods,(function(t){var n=t+"At";this[t]=function(){var t=this.getCurve(),i=this.getTime();return null!=i&&t&&t[n](i,!0)}}),{preserve:!0}),new function(){function insert(t,n,i){var r=t.length,o=0,h=r-1;function search(i,o){for(var h=i+o;h>=-1&&h<=r;h+=o){var c=t[(h%r+r)%r];if(!n.getPoint().isClose(c.getPoint(),1e-7))break;if(n.equals(c))return c}return null}for(;o<=h;){var c,u=o+h>>>1,d=t[u];if(i&&(c=n.equals(d)?d:search(u,-1)||search(u,1)))return n._overlap&&(c._overlap=c._intersection._overlap=!0),c;var p=n.getPath(),g=d.getPath();(p!==g?p._id-g._id:n.getIndex()+n.getTime()-(d.getIndex()+d.getTime()))<0?h=u-1:o=u+1}return t.splice(o,0,n),n}return{statics:{insert:insert,expand:function(t){for(var n=t.slice(),i=t.length-1;i>=0;i--)insert(n,t[i]._intersection,!1);return n}}}}),W=M.extend({_class:"PathItem",_selectBounds:!1,_canScaleStroke:!0,beans:!0,initialize:function PathItem2(){},statics:{create:function(t){var n,i,r;if(h.isPlainObject(t)?(i=t.segments,n=t.pathData):Array.isArray(t)?i=t:"string"==typeof t&&(n=t),i){var o=i[0];r=o&&Array.isArray(o[0])}else n&&(r=(n.match(/m/gi)||[]).length>1||/z\s*\S+/i.test(n));return new(r?H:Y)(t)}},_asPathItem:function(){return this},isClockwise:function(){return this.getArea()>=0},setClockwise:function(t){this.isClockwise()!=(t=!!t)&&this.reverse()},setPathData:function(t){var n,i,r,o=t&&t.match(/[mlhvcsqtaz][^mlhvcsqtaz]*/gi),h=!1,c=new _,u=new _;function getCoord(t,i){var r=+n[t];return h&&(r+=c[i]),r}function getPoint(t){return new _(getCoord(t,"x"),getCoord(t+1,"y"))}this.clear();for(var d=0,p=o&&o.length;d<p;d++){var g=o[d],m=g[0],v=m.toLowerCase(),y=(n=g.match(/[+-]?(?:\d*\.\d+|\d+\.?)(?:[eE][+-]?\d+)?/g))&&n.length;switch(h=m===v,"z"!==i||/[mz]/.test(v)||this.moveTo(c),v){case"m":case"l":for(var x="m"===v,S=0;S<y;S+=2)this[x?"moveTo":"lineTo"](c=getPoint(S)),x&&(u=c,x=!1);r=c;break;case"h":case"v":var C="h"===v?"x":"y";c=c.clone();for(S=0;S<y;S++)c[C]=getCoord(S,C),this.lineTo(c);r=c;break;case"c":for(S=0;S<y;S+=6)this.cubicCurveTo(getPoint(S),r=getPoint(S+2),c=getPoint(S+4));break;case"s":for(S=0;S<y;S+=4)this.cubicCurveTo(/[cs]/.test(i)?c.multiply(2).subtract(r):c,r=getPoint(S),c=getPoint(S+2)),i=v;break;case"q":for(S=0;S<y;S+=4)this.quadraticCurveTo(r=getPoint(S),c=getPoint(S+2));break;case"t":for(S=0;S<y;S+=2)this.quadraticCurveTo(r=/[qt]/.test(i)?c.multiply(2).subtract(r):c,c=getPoint(S)),i=v;break;case"a":for(S=0;S<y;S+=7)this.arcTo(c=getPoint(S+5),new w(+n[S],+n[S+1]),+n[S+2],+n[S+4],+n[S+3]);break;case"z":this.closePath(1e-12),c=u}i=v}},_canComposite:function(){return!(this.hasFill()&&this.hasStroke())},_contains:function(t){var n=t.isInside(this.getBounds({internal:!0,handle:!0}))?this._getWinding(t):{};return n.onPath||!!("evenodd"===this.getFillRule()?1&n.windingL||1&n.windingR:n.winding)},getIntersections:function(t,n,i,r){var o=this===t||!t,h=this._matrix._orNullIfIdentity(),c=o?h:(i||t._matrix)._orNullIfIdentity();return o||this.getBounds(h).intersects(t.getBounds(c),1e-12)?F.getIntersections(this.getCurves(),!o&&t.getCurves(),n,h,c,r):[]},getCrossings:function(t){return this.getIntersections(t,(function(t){return t.isCrossing()}))},getNearestLocation:function(){for(var t=_.read(arguments),n=this.getCurves(),i=1/0,r=null,o=0,h=n.length;o<h;o++){var c=n[o].getNearestLocation(t);c._distance<i&&(i=c._distance,r=c)}return r},getNearestPoint:function(){var t=this.getNearestLocation.apply(this,arguments);return t?t.getPoint():t},interpolate:function(t,n,i){var r=!this._children,o=r?"_segments":"_children",h=t[o],c=n[o],u=this[o];if(!h||!c||h.length!==c.length)throw new Error("Invalid operands in interpolate() call: "+t+", "+n);var d=u.length,p=c.length;if(d<p)for(var g=r?U:Y,m=d;m<p;m++)this.add(new g);else d>p&&this[r?"removeSegments":"removeChildren"](p,d);for(m=0;m<p;m++)u[m].interpolate(h[m],c[m],i);r&&(this.setClosed(t._closed),this._changed(9))},compare:function(t){var n=!1;if(t){var i=this._children||[this],r=t._children?t._children.slice():[t],o=i.length,h=r.length,c=[],u=0;n=!0;for(var d=p.findItemBoundsCollisions(i,r,m.GEOMETRIC_EPSILON),g=o-1;g>=0&&n;g--){var v=i[g];n=!1;var _=d[g];if(_)for(var y=_.length-1;y>=0&&!n;y--)v.compare(r[_[y]])&&(c[_[y]]||(c[_[y]]=!0,u++),n=!0)}n=n&&u===h}return n}}),Y=W.extend({_class:"Path",_serializeFields:{segments:[],closed:!1},initialize:function Path2(t){this._closed=!1,this._segments=[],this._version=0;var n=arguments,r=Array.isArray(t)?"object"==typeof t[0]?t:n:!t||t.size!==i||t.x===i&&t.point===i?null:n;r&&r.length>0?this.setSegments(r):(this._curves=i,this._segmentSelection=0,r||"string"!=typeof t||(this.setPathData(t),t=null)),this._initialize(!r&&t)},_equals:function(t){return this._closed===t._closed&&h.equals(this._segments,t._segments)},copyContent:function(t){this.setSegments(t._segments),this._closed=t._closed},_changed:function _changed(t){if(_changed.base.call(this,t),8&t){if(this._length=this._area=i,32&t)this._version++;else if(this._curves)for(var n=0,r=this._curves.length;n<r;n++)this._curves[n]._changed()}else 64&t&&(this._bounds=i)},getStyle:function(){var t=this._parent;return(t instanceof H?t:this)._style},getSegments:function(){return this._segments},setSegments:function(t){var n=this.isFullySelected(),r=t&&t.length;if(this._segments.length=0,this._segmentSelection=0,this._curves=i,r){var o=t[r-1];"boolean"==typeof o&&(this.setClosed(o),r--),this._add(U.readList(t,0,{},r))}n&&this.setFullySelected(!0)},getFirstSegment:function(){return this._segments[0]},getLastSegment:function(){return this._segments[this._segments.length-1]},getCurves:function(){var t=this._curves,n=this._segments;if(!t){var i=this._countCurves();t=this._curves=new Array(i);for(var r=0;r<i;r++)t[r]=new F(this,n[r],n[r+1]||n[0])}return t},getFirstCurve:function(){return this.getCurves()[0]},getLastCurve:function(){var t=this.getCurves();return t[t.length-1]},isClosed:function(){return this._closed},setClosed:function(t){if(this._closed!=(t=!!t)){if(this._closed=t,this._curves){var n=this._curves.length=this._countCurves();t&&(this._curves[n-1]=new F(this,this._segments[n-1],this._segments[0]))}this._changed(41)}}},{beans:!0,getPathData:function(t,n){var i,r,o,h,c,u,d,p,m=this._segments,v=m.length,_=new g(n),y=new Array(6),w=!0,x=[];function addSegment(n,g){if(n._transformCoordinates(t,y),i=y[0],r=y[1],w)x.push("M"+_.pair(i,r)),w=!1;else if(c=y[2],u=y[3],c===i&&u===r&&d===o&&p===h){if(!g){var m=i-o,v=r-h;x.push(0===m?"v"+_.number(v):0===v?"h"+_.number(m):"l"+_.pair(m,v))}}else x.push("c"+_.pair(d-o,p-h)+" "+_.pair(c-o,u-h)+" "+_.pair(i-o,r-h));o=i,h=r,d=y[4],p=y[5]}if(!v)return"";for(var S=0;S<v;S++)addSegment(m[S]);return this._closed&&v>0&&(addSegment(m[0],!0),x.push("z")),x.join("")},isEmpty:function(){return!this._segments.length},_transformContent:function(t){for(var n=this._segments,i=new Array(6),r=0,o=n.length;r<o;r++)n[r]._transformCoordinates(t,i,!0);return!0},_add:function(t,n){for(var i=this._segments,r=this._curves,o=t.length,c=null==n,u=(n=c?i.length:n,0);u<o;u++){var d=t[u];d._path&&(d=t[u]=d.clone()),d._path=this,d._index=n+u,d._selection&&this._updateSelection(d,0,d._selection)}if(c)h.push(i,t);else{i.splice.apply(i,[n,0].concat(t));u=n+o;for(var p=i.length;u<p;u++)i[u]._index=u}if(r){var g=this._countCurves(),m=n>0&&n+o-1===g?n-1:n,v=m,_=Math.min(m+o,g);t._curves&&(r.splice.apply(r,[m,0].concat(t._curves)),v+=t._curves.length);for(u=v;u<_;u++)r.splice(u,0,new F(this,null,null));this._adjustCurves(m,_)}return this._changed(41),t},_adjustCurves:function(t,n){for(var i,r=this._segments,o=this._curves,h=t;h<n;h++)(i=o[h])._path=this,i._segment1=r[h],i._segment2=r[h+1]||r[0],i._changed();(i=o[this._closed&&!t?r.length-1:t-1])&&(i._segment2=r[t]||r[0],i._changed()),(i=o[n])&&(i._segment1=r[n],i._changed())},_countCurves:function(){var t=this._segments.length;return!this._closed&&t>0?t-1:t},add:function(t){var n=arguments;return n.length>1&&"number"!=typeof t?this._add(U.readList(n)):this._add([U.read(n)])[0]},insert:function(t,n){var i=arguments;return i.length>2&&"number"!=typeof n?this._add(U.readList(i,1),t):this._add([U.read(i,1)],t)[0]},addSegment:function(){return this._add([U.read(arguments)])[0]},insertSegment:function(t){return this._add([U.read(arguments,1)],t)[0]},addSegments:function(t){return this._add(U.readList(t))},insertSegments:function(t,n){return this._add(U.readList(n),t)},removeSegment:function(t){return this.removeSegments(t,t+1)[0]||null},removeSegments:function(t,n,i){t=t||0,n=h.pick(n,this._segments.length);var r=this._segments,o=this._curves,c=r.length,u=r.splice(t,n-t),d=u.length;if(!d)return u;for(var p=0;p<d;p++){var g=u[p];g._selection&&this._updateSelection(g,g._selection,0),g._index=g._path=null}p=t;for(var m=r.length;p<m;p++)r[p]._index=p;if(o){var v=t>0&&n===c+(this._closed?1:0)?t-1:t;for(p=(o=o.splice(v,d)).length-1;p>=0;p--)o[p]._path=null;i&&(u._curves=o.slice(1)),this._adjustCurves(v,v)}return this._changed(41),u},clear:"#removeSegments",hasHandles:function(){for(var t=this._segments,n=0,i=t.length;n<i;n++)if(t[n].hasHandles())return!0;return!1},clearHandles:function(){for(var t=this._segments,n=0,i=t.length;n<i;n++)t[n].clearHandles()},getLength:function(){if(null==this._length){for(var t=this.getCurves(),n=0,i=0,r=t.length;i<r;i++)n+=t[i].getLength();this._length=n}return this._length},getArea:function(){var t=this._area;if(null==t){var n=this._segments,i=this._closed;t=0;for(var r=0,o=n.length;r<o;r++){var h=r+1===o;t+=F.getArea(F.getValues(n[r],n[h?0:r+1],null,h&&!i))}this._area=t}return t},isFullySelected:function(){var t=this._segments.length;return this.isSelected()&&t>0&&this._segmentSelection===7*t},setFullySelected:function(t){t&&this._selectSegments(!0),this.setSelected(t)},setSelection:function setSelection(t){1&t||this._selectSegments(!1),setSelection.base.call(this,t)},_selectSegments:function(t){var n=this._segments,i=n.length,r=t?7:0;this._segmentSelection=r*i;for(var o=0;o<i;o++)n[o]._selection=r},_updateSelection:function(t,n,i){t._selection=i,(this._segmentSelection+=i-n)>0&&this.setSelected(!0)},divideAt:function(t){var n,i=this.getLocationAt(t);return i&&(n=i.getCurve().divideAt(i.getCurveOffset()))?n._segment1:null},splitAt:function(t){var n=this.getLocationAt(t),i=n&&n.index,r=n&&n.time;r>.99999999&&(i++,r=0);var o=this.getCurves();if(i>=0&&i<o.length){r>=1e-8&&o[i++].divideAtTime(r);var h,c=this.removeSegments(i,this._segments.length,!0);return this._closed?(this.setClosed(!1),h=this):((h=new Y(M.NO_INSERT)).insertAbove(this),h.copyAttributes(this)),h._add(c,0),this.addSegment(c[0]),h}return null},split:function(t,n){var r,o=n===i?t:(r=this.getCurves()[t])&&r.getLocationAtTime(n);return null!=o?this.splitAt(o):null},join:function(t,n){var i=n||0;if(t&&t!==this){var r=t._segments,o=this.getLastSegment(),h=t.getLastSegment();if(!h)return this;o&&o._point.isClose(h._point,i)&&t.reverse();var c=t.getFirstSegment();if(o&&o._point.isClose(c._point,i))o.setHandleOut(c._handleOut),this._add(r.slice(1));else{var u=this.getFirstSegment();u&&u._point.isClose(c._point,i)&&t.reverse(),h=t.getLastSegment(),u&&u._point.isClose(h._point,i)?(u.setHandleIn(h._handleIn),this._add(r.slice(0,r.length-1),0)):this._add(r.slice())}t._closed&&this._add([r[0]]),t.remove()}var d=this.getFirstSegment(),p=this.getLastSegment();return d!==p&&d._point.isClose(p._point,i)&&(d.setHandleIn(p._handleIn),p.remove(),this.setClosed(!0)),this},reduce:function(t){for(var n=this.getCurves(),i=t&&t.simplify,r=i?1e-7:0,o=n.length-1;o>=0;o--){var h=n[o];!h.hasHandles()&&(!h.hasLength(r)||i&&h.isCollinear(h.getNext()))&&h.remove()}return this},reverse:function(){this._segments.reverse();for(var t=0,n=this._segments.length;t<n;t++){var i=this._segments[t],r=i._handleIn;i._handleIn=i._handleOut,i._handleOut=r,i._index=t}this._curves=null,this._changed(9)},flatten:function(t){for(var n=new X(this,t||.25,256,!0).parts,i=n.length,r=[],o=0;o<i;o++)r.push(new U(n[o].curve.slice(0,2)));!this._closed&&i>0&&r.push(new U(n[i-1].curve.slice(6))),this.setSegments(r)},simplify:function(t){var n=new J(this).fit(t||2.5);return n&&this.setSegments(n),!!n},smooth:function(t){var n=this,r=t||{},o=r.type||"asymmetric",h=this._segments,c=h.length,u=this._closed;function getIndex(t,i){var r=t&&t.index;if(null!=r){var o=t.path;if(o&&o!==n)throw new Error(t._class+" "+r+" of "+o+" is not part of "+n);i&&t instanceof F&&r++}else r="number"==typeof t?t:i;return Math.min(r<0&&u?r%c:r<0?r+c:r,c-1)}var d=u&&r.from===i&&r.to===i,p=getIndex(r.from,0),g=getIndex(r.to,c-1);if(p>g)if(u)p-=c;else{var m=p;p=g,g=m}if(/^(?:asymmetric|continuous)$/.test(o)){var v="asymmetric"===o,_=Math.min,y=g-p+1,w=y-1,x=d?_(y,4):1,S=x,C=x,k=[];if(u||(S=_(1,p),C=_(1,c-g-1)),(w+=S+C)<=1)return;for(var P=0,I=p-S;P<=w;P++,I++)k[P]=h[(I<0?I+c:I)%c]._point;var M=k[0]._x+2*k[1]._x,E=k[0]._y+2*k[1]._y,T=2,O=w-1,D=[M],N=[E],j=[T],V=[],U=[];for(P=1;P<w;P++){var z=P<O,q=z?4:v?2:7,W=z?4:v?3:8,Y=z?2:v?0:1,H=(z||v?1:2)/T;T=j[P]=q-H,M=D[P]=W*k[P]._x+Y*k[P+1]._x-H*M,E=N[P]=W*k[P]._y+Y*k[P+1]._y-H*E}V[O]=D[O]/j[O],U[O]=N[O]/j[O];for(P=w-2;P>=0;P--)V[P]=(D[P]-V[P+1])/j[P],U[P]=(N[P]-U[P+1])/j[P];V[w]=(3*k[w]._x-V[O])/2,U[w]=(3*k[w]._y-U[O])/2;P=S;var X=w-C;for(I=p;P<=X;P++,I++){var J=h[I<0?I+c:I],Z=J._point,Q=V[P]-Z._x,tt=U[P]-Z._y;(d||P<X)&&J.setHandleOut(Q,tt),(d||P>S)&&J.setHandleIn(-Q,-tt)}}else for(P=p;P<=g;P++)h[P<0?P+c:P].smooth(r,!d&&P===p,!d&&P===g)},toShape:function(t){if(!this._closed)return null;var n,r,o,h,c=this._segments;function isCollinear(t,n){var i=c[t],r=i.getNext(),o=c[n],h=o.getNext();return i._handleOut.isZero()&&r._handleIn.isZero()&&o._handleOut.isZero()&&h._handleIn.isZero()&&r._point.subtract(i._point).isCollinear(h._point.subtract(o._point))}function isArc(t){var n=c[t],i=n.getNext(),r=n._handleOut,o=i._handleIn,h=.5522847498307936;if(r.isOrthogonal(o)){var u=n._point,d=i._point,p=new P(u,r,!0).intersect(new P(d,o,!0),!0);return p&&m.isZero(r.getLength()/p.subtract(u).getLength()-h)&&m.isZero(o.getLength()/p.subtract(d).getLength()-h)}return!1}function getDistance(t,n){return c[t]._point.getDistance(c[n]._point)}if(!this.hasHandles()&&4===c.length&&isCollinear(0,2)&&isCollinear(1,3)&&function isOrthogonal(t){var n=c[t],i=n.getPrevious(),r=n.getNext();return i._handleOut.isZero()&&n._handleIn.isZero()&&n._handleOut.isZero()&&r._handleIn.isZero()&&n._point.subtract(i._point).isOrthogonal(r._point.subtract(n._point))}(1)?(n=O.Rectangle,r=new w(getDistance(0,3),getDistance(0,1)),h=c[1]._point.add(c[2]._point).divide(2)):8===c.length&&isArc(0)&&isArc(2)&&isArc(4)&&isArc(6)&&isCollinear(1,5)&&isCollinear(3,7)?(n=O.Rectangle,o=(r=new w(getDistance(1,6),getDistance(0,3))).subtract(new w(getDistance(0,7),getDistance(1,2))).divide(2),h=c[3]._point.add(c[4]._point).divide(2)):4===c.length&&isArc(0)&&isArc(1)&&isArc(2)&&isArc(3)&&(m.isZero(getDistance(0,2)-getDistance(1,3))?(n=O.Circle,o=getDistance(0,2)/2):(n=O.Ellipse,o=new w(getDistance(2,0)/2,getDistance(3,1)/2)),h=c[1]._point),n){var u=this.getPosition(!0),d=new n({center:u,size:r,radius:o,insert:!1});return d.copyAttributes(this,!0),d._matrix.prepend(this._matrix),d.rotate(h.subtract(u).getAngle()+90),(t===i||t)&&d.insertAbove(this),d}return null},toPath:"#clone",compare:function compare(t){if(!t||t instanceof H)return compare.base.call(this,t);var n=this.getCurves(),i=t.getCurves(),r=n.length,o=i.length;if(!r||!o)return r==o;for(var h,c,u=n[0].getValues(),d=[],p=0,g=0,m=0;m<o;m++){var v=i[m].getValues();if(d.push(v),w=F.getOverlaps(u,v)){h=!m&&w[0][0]>0?o-1:m,c=w[0][1];break}}var _,y=Math.abs;for(v=d[h];u&&v;){var w;if(w=F.getOverlaps(u,v))if(y(w[0][0]-g)<1e-8){1===(g=w[1][0])&&(u=++p<r?n[p].getValues():null,g=0);var x=w[0][1];if(y(x-c)<1e-8){if(_||(_=[h,x]),1===(c=w[1][1])&&(++h>=o&&(h=0),v=d[h]||i[h].getValues(),c=0),!u)return _[0]===h&&_[1]===c;continue}}break}return!1},_hitTestSelf:function(t,n,i,r){var o,h,c,u,d,p,g=this,m=this.getStyle(),v=this._segments,_=v.length,y=this._closed,w=n._tolerancePadding,x=w,S=n.stroke&&m.hasStroke(),C=n.fill&&m.hasFill(),k=n.curves,P=S?m.getStrokeWidth()/2:C&&n.tolerance>0||k?0:null;function isCloseEnough(n,i){return t.subtract(n).divide(i).length<=1}function checkSegmentPoint(t,i,r){if(!n.selected||i.isSelected()){var o=t._point;if(i!==o&&(i=i.add(o)),isCloseEnough(i,x))return new V(r,g,{segment:t,point:i})}}function checkSegmentPoints(t,i){return(i||n.segments)&&checkSegmentPoint(t,t._point,"segment")||!i&&n.handles&&(checkSegmentPoint(t,t._handleIn,"handle-in")||checkSegmentPoint(t,t._handleOut,"handle-out"))}function addToArea(t){u.add(t)}function checkSegmentStroke(n){var i,d=y||n._index>0&&n._index<_-1;return"round"===(d?o:h)?isCloseEnough(n._point,x):(u=new Y({internal:!0,closed:!0}),d?n.isSmooth()||Y._addBevelJoin(n,o,P,c,null,r,addToArea,!0):"square"===h&&Y._addSquareCap(n,h,P,null,r,addToArea,!0),u.isEmpty()?void 0:u.contains(t)||(i=u.getNearestLocation(t))&&isCloseEnough(i.getPoint(),w))}if(null!==P&&(P>0?(o=m.getStrokeJoin(),h=m.getStrokeCap(),c=m.getMiterLimit(),x=x.add(Y._getStrokePadding(P,r))):o=h="round"),!n.ends||n.segments||y){if(n.segments||n.handles)for(var I=0;I<_;I++)if(p=checkSegmentPoints(v[I]))return p}else if(p=checkSegmentPoints(v[0],!0)||checkSegmentPoints(v[_-1],!0))return p;if(null!==P){if(d=this.getNearestLocation(t)){var M=d.getTime();0===M||1===M&&_>1?checkSegmentStroke(d.getSegment())||(d=null):isCloseEnough(d.getPoint(),x)||(d=null)}if(!d&&"miter"===o&&_>1)for(I=0;I<_;I++){var E=v[I];if(t.getDistance(E._point)<=c*P&&checkSegmentStroke(E)){d=E.getLocation();break}}}return!d&&C&&this._contains(t)||d&&!S&&!k?new V("fill",this):d?new V(S?"stroke":"curve",this,{location:d,point:d.getPoint()}):null}},h.each(F._evaluateMethods,(function(t){this[t+"At"]=function(n){var i=this.getLocationAt(n);return i&&i[t]()}}),{beans:!1,getLocationOf:function(){for(var t=_.read(arguments),n=this.getCurves(),i=0,r=n.length;i<r;i++){var o=n[i].getLocationOf(t);if(o)return o}return null},getOffsetOf:function(){var t=this.getLocationOf.apply(this,arguments);return t?t.getOffset():null},getLocationAt:function(t){if("number"==typeof t){for(var n=this.getCurves(),i=0,r=0,o=n.length;r<o;r++){var h=i,c=n[r];if((i+=c.getLength())>t)return c.getLocationAt(t-h)}if(n.length>0&&t<=this.getLength())return new q(n[n.length-1],1)}else if(t&&t.getPath&&t.getPath()===this)return t;return null},getOffsetsWithTangent:function(){var t=_.read(arguments);if(t.isZero())return[];for(var n=[],i=0,r=this.getCurves(),o=0,h=r.length;o<h;o++){for(var c=r[o],u=c.getTimesWithTangent(t),d=0,p=u.length;d<p;d++){var g=i+c.getOffsetAtTime(u[d]);n.indexOf(g)<0&&n.push(g)}i+=c.length}return n}}),new function(){function drawSegments(t,n,i){var r,o,h,c,u,d,p,g,m=n._segments,v=m.length,_=new Array(6),y=!0;function drawSegment(n){if(i)n._transformCoordinates(i,_),r=_[0],o=_[1];else{var m=n._point;r=m._x,o=m._y}if(y)t.moveTo(r,o),y=!1;else{if(i)u=_[2],d=_[3];else{var v=n._handleIn;u=r+v._x,d=o+v._y}u===r&&d===o&&p===h&&g===c?t.lineTo(r,o):t.bezierCurveTo(p,g,u,d,r,o)}if(h=r,c=o,i)p=_[4],g=_[5];else{v=n._handleOut;p=h+v._x,g=c+v._y}}for(var w=0;w<v;w++)drawSegment(m[w]);n._closed&&v>0&&drawSegment(m[0])}return{_draw:function(t,n,i,r){var o=n.dontStart,h=n.dontFinish||n.clip,c=this.getStyle(),u=c.hasFill(),d=c.hasStroke(),p=c.getDashArray(),g=!wt.support.nativeDash&&d&&p&&p.length;function getOffset(t){return p[(t%g+g)%g]}if(o||t.beginPath(),(u||d&&!g||h)&&(drawSegments(t,this,r),this._closed&&t.closePath()),!h&&(u||d)&&(this._setStyles(t,n,i),u&&(t.fill(c.getFillRule()),t.shadowColor="rgba(0,0,0,0)"),d)){if(g){o||t.beginPath();for(var m,v=new X(this,.25,32,!1,r),_=v.length,y=-c.getDashOffset(),w=0;y>0;)y-=getOffset(w--)+getOffset(w--);for(;y<_;)m=y+getOffset(w++),(y>0||m>0)&&v.drawPart(t,Math.max(y,0),Math.max(m,0)),y=m+getOffset(w++)}t.stroke()}},_drawSelected:function(t,n){t.beginPath(),drawSegments(t,this,n),t.stroke(),function drawHandles(t,n,i,r){if(!(r<=0))for(var o,h,c=r/2,u=r-2,d=c-1,p=new Array(6),g=0,m=n.length;g<m;g++){var v=n[g],_=v._selection;if(v._transformCoordinates(i,p),o=p[0],h=p[1],2&_&&drawHandle(2),4&_&&drawHandle(4),t.fillRect(o-c,h-c,r,r),u>0&&!(1&_)){var y=t.fillStyle;t.fillStyle="#ffffff",t.fillRect(o-d,h-d,u,u),t.fillStyle=y}}function drawHandle(n){var i=p[n],r=p[n+1];o==i&&h==r||(t.beginPath(),t.moveTo(o,h),t.lineTo(i,r),t.stroke(),t.beginPath(),t.arc(i,r,c,0,2*Math.PI,!0),t.fill())}}(t,this._segments,n,wt.settings.handleSize)}}},new function(){function getCurrentSegment(t){var n=t._segments;if(!n.length)throw new Error("Use a moveTo() command first");return n[n.length-1]}return{moveTo:function(){var t=this._segments;1===t.length&&this.removeSegment(0),t.length||this._add([new U(_.read(arguments))])},moveBy:function(){throw new Error("moveBy() is unsupported on Path items.")},lineTo:function(){this._add([new U(_.read(arguments))])},cubicCurveTo:function(){var t=arguments,n=_.read(t),i=_.read(t),r=_.read(t),o=getCurrentSegment(this);o.setHandleOut(n.subtract(o._point)),this._add([new U(r,i.subtract(r))])},quadraticCurveTo:function(){var t=arguments,n=_.read(t),i=_.read(t),r=getCurrentSegment(this)._point;this.cubicCurveTo(n.add(r.subtract(n).multiply(1/3)),n.add(i.subtract(n).multiply(1/3)),i)},curveTo:function(){var t=arguments,n=_.read(t),i=_.read(t),r=h.pick(h.read(t),.5),o=1-r,c=getCurrentSegment(this)._point,u=n.subtract(c.multiply(o*o)).subtract(i.multiply(r*r)).divide(2*r*o);if(u.isNaN())throw new Error("Cannot put a curve through points with parameter = "+r);this.quadraticCurveTo(u,i)},arcTo:function(){var t,n,i,r,o=arguments,c=Math.abs,u=Math.sqrt,d=getCurrentSegment(this),p=d._point,g=_.read(o),v=h.peek(o);if("boolean"==typeof(I=h.pick(v,!0)))var y=(E=p.add(g).divide(2)).add(E.subtract(p).rotate(I?-90:90));else if(h.remain(o)<=2)y=g,g=_.read(o);else if(!p.equals(g)){var x=w.read(o),S=m.isZero;if(S(x.width)||S(x.height))return this.lineTo(g);var C=h.read(o),I=!!h.read(o),M=!!h.read(o),E=p.add(g).divide(2),T=(st=p.subtract(E).rotate(-C)).x,O=st.y,D=c(x.width),N=c(x.height),j=D*D,V=N*N,z=T*T,F=O*O,q=u(z/j+F/V);if(q>1&&(j=(D*=q)*D,V=(N*=q)*N),c(q=(j*V-j*F-V*z)/(j*F+V*z))<1e-12&&(q=0),q<0)throw new Error("Cannot create an arc with the given arguments");t=new _(D*O/N,-N*T/D).multiply((M===I?-1:1)*u(q)).rotate(C).add(E),n=(i=(r=(new k).translate(t).rotate(C).scale(D,N))._inverseTransform(p)).getDirectedAngle(r._inverseTransform(g)),!I&&n>0?n-=360:I&&n<0&&(n+=360)}if(y){var W=new P(p.add(y).divide(2),y.subtract(p).rotate(90),!0),Y=new P(y.add(g).divide(2),g.subtract(y).rotate(90),!0),H=new P(p,g),X=H.getSide(y);if(!(t=W.intersect(Y,!0))){if(!X)return this.lineTo(g);throw new Error("Cannot create an arc with the given arguments")}n=(i=p.subtract(t)).getDirectedAngle(g.subtract(t));var J=H.getSide(t,!0);0===J?n=X*c(n):X===J&&(n+=n<0?360:-360)}if(n){for(var Z=c(n),Q=Z>=360?4:Math.ceil((Z-1e-5)/90),tt=n/Q,et=tt*Math.PI/360,nt=4/3*Math.sin(et)/(1+Math.cos(et)),it=[],rt=0;rt<=Q;rt++){var st=g,ot=null;if(rt<Q&&(ot=i.rotate(90).multiply(nt),r?(st=r._transformPoint(i),ot=r._transformPoint(i.add(ot)).subtract(st)):st=t.add(i)),rt){var ht=i.rotate(-90).multiply(nt);r&&(ht=r._transformPoint(i.add(ht)).subtract(st)),it.push(new U(st,ht,ot))}else d.setHandleOut(ot);i=i.rotate(tt)}this._add(it)}},lineBy:function(){var t=_.read(arguments),n=getCurrentSegment(this)._point;this.lineTo(n.add(t))},curveBy:function(){var t=arguments,n=_.read(t),i=_.read(t),r=h.read(t),o=getCurrentSegment(this)._point;this.curveTo(o.add(n),o.add(i),r)},cubicCurveBy:function(){var t=arguments,n=_.read(t),i=_.read(t),r=_.read(t),o=getCurrentSegment(this)._point;this.cubicCurveTo(o.add(n),o.add(i),o.add(r))},quadraticCurveBy:function(){var t=arguments,n=_.read(t),i=_.read(t),r=getCurrentSegment(this)._point;this.quadraticCurveTo(r.add(n),r.add(i))},arcBy:function(){var t=arguments,n=getCurrentSegment(this)._point,i=n.add(_.read(t)),r=h.pick(h.peek(t),!0);"boolean"==typeof r?this.arcTo(i,r):this.arcTo(i,n.add(_.read(t)))},closePath:function(t){this.setClosed(!0),this.join(this,t)}}},{_getBounds:function(t,n){var i=n.handle?"getHandleBounds":n.stroke?"getStrokeBounds":"getBounds";return Y[i](this._segments,this._closed,this,t,n)},statics:{getBounds:function(t,n,i,r,o,h){var c=t[0];if(!c)return new S;var u=new Array(6),d=c._transformCoordinates(r,new Array(6)),p=d.slice(0,2),g=p.slice(),m=new Array(2);function processSegment(t){t._transformCoordinates(r,u);for(var n=0;n<2;n++)F._addBounds(d[n],d[n+4],u[n+2],u[n],n,h?h[n]:0,p,g,m);var i=d;d=u,u=i}for(var v=1,_=t.length;v<_;v++)processSegment(t[v]);return n&&processSegment(c),new S(p[0],p[1],g[0]-p[0],g[1]-p[1])},getStrokeBounds:function(t,n,i,r,o){var h=i.getStyle(),c=h.hasStroke(),u=h.getStrokeWidth(),d=c&&i._getStrokeMatrix(r,o),p=c&&Y._getStrokePadding(u,d),g=Y.getBounds(t,n,i,r,o,p);if(!c)return g;var m=u/2,v=h.getStrokeJoin(),_=h.getStrokeCap(),y=h.getMiterLimit(),x=new S(new w(p));function addPoint(t){g=g.include(t)}function addRound(t){g=g.unite(x.setCenter(t._point.transform(r)))}function addJoin(t,n){"round"===n||t.isSmooth()?addRound(t):Y._addBevelJoin(t,n,m,y,r,d,addPoint)}function addCap(t,n){"round"===n?addRound(t):Y._addSquareCap(t,n,m,r,d,addPoint)}var C=t.length-(n?0:1);if(C>0){for(var k=1;k<C;k++)addJoin(t[k],v);n?addJoin(t[0],v):(addCap(t[0],_),addCap(t[t.length-1],_))}return g},_getStrokePadding:function(t,n){if(!n)return[t,t];var i=new _(t,0).transform(n),r=new _(0,t).transform(n),o=i.getAngleInRadians(),h=i.getLength(),c=r.getLength(),u=Math.sin(o),d=Math.cos(o),p=Math.tan(o),g=Math.atan2(c*p,h),m=Math.atan2(c,p*h);return[Math.abs(h*Math.cos(g)*d+c*Math.sin(g)*u),Math.abs(c*Math.sin(m)*d+h*Math.cos(m)*u)]},_addBevelJoin:function(t,n,i,r,o,h,c,u){var d=t.getCurve(),p=d.getPrevious(),g=d.getPoint1().transform(o),m=p.getNormalAtTime(1).multiply(i).transform(h),v=d.getNormalAtTime(0).multiply(i).transform(h),y=m.getDirectedAngle(v);if((y<0||y>=180)&&(m=m.negate(),v=v.negate()),u&&c(g),c(g.add(m)),"miter"===n){var w=new P(g.add(m),new _(-m.y,m.x),!0).intersect(new P(g.add(v),new _(-v.y,v.x),!0),!0);w&&g.getDistance(w)<=r*i&&c(w)}c(g.add(v))},_addSquareCap:function(t,n,i,r,o,h,c){var u=t._point.transform(r),d=t.getLocation(),p=d.getNormal().multiply(0===d.getTime()?i:-i).transform(o);"square"===n&&(c&&(h(u.subtract(p)),h(u.add(p))),u=u.add(p.rotate(-90))),h(u.add(p)),h(u.subtract(p))},getHandleBounds:function(t,n,i,r,o){var h,c,u=i.getStyle();if(o.stroke&&u.hasStroke()){var d=i._getStrokeMatrix(r,o),p=u.getStrokeWidth()/2,g=p;"miter"===u.getStrokeJoin()&&(g=p*u.getMiterLimit()),"square"===u.getStrokeCap()&&(g=Math.max(g,p*Math.SQRT2)),h=Y._getStrokePadding(p,d),c=Y._getStrokePadding(g,d)}for(var m=new Array(6),v=1/0,_=-v,y=v,w=_,x=0,C=t.length;x<C;x++){t[x]._transformCoordinates(r,m);for(var k=0;k<6;k+=2){var P=k?h:c,I=P?P[0]:0,M=P?P[1]:0,E=m[k],T=m[k+1],O=E-I,D=E+I,N=T-M,j=T+M;O<v&&(v=O),D>_&&(_=D),N<y&&(y=N),j>w&&(w=j)}}return new S(v,y,_-v,w-y)}}});Y.inject({statics:new function(){var t=.5522847498307936,n=[new U([-1,0],[0,t],[0,-t]),new U([0,-1],[-t,0],[t,0]),new U([1,0],[0,-t],[0,t]),new U([0,1],[t,0],[-t,0])];function createPath(t,n,i){var r=h.getNamed(i),o=new Y(r&&(1==r.insert?M.INSERT:0==r.insert?M.NO_INSERT:null));return o._add(t),o._closed=n,o.set(r,M.INSERT)}function createEllipse(t,i,r){for(var o=new Array(4),h=0;h<4;h++){var c=n[h];o[h]=new U(c._point.multiply(i).add(t),c._handleIn.multiply(i),c._handleOut.multiply(i))}return createPath(o,!0,r)}return{Line:function(){var t=arguments;return createPath([new U(_.readNamed(t,"from")),new U(_.readNamed(t,"to"))],!1,t)},Circle:function(){var t=arguments,n=_.readNamed(t,"center"),i=h.readNamed(t,"radius");return createEllipse(n,new w(i),t)},Rectangle:function(){var n,i=arguments,r=S.readNamed(i,"rectangle"),o=w.readNamed(i,"radius",0,{readNull:!0}),h=r.getBottomLeft(!0),c=r.getTopLeft(!0),u=r.getTopRight(!0),d=r.getBottomRight(!0);if(!o||o.isZero())n=[new U(h),new U(c),new U(u),new U(d)];else{var p=(o=w.min(o,r.getSize(!0).divide(2))).width,g=o.height,m=p*t,v=g*t;n=[new U(h.add(p,0),null,[-m,0]),new U(h.subtract(0,g),[0,v]),new U(c.add(0,g),null,[0,-v]),new U(c.add(p,0),[-m,0],null),new U(u.subtract(p,0),null,[m,0]),new U(u.add(0,g),[0,-v],null),new U(d.subtract(0,g),null,[0,v]),new U(d.subtract(p,0),[m,0])]}return createPath(n,!0,i)},RoundRectangle:"#Rectangle",Ellipse:function(){var t=arguments,n=O._readEllipse(t);return createEllipse(n.center,n.radius,t)},Oval:"#Ellipse",Arc:function(){var t=arguments,n=_.readNamed(t,"from"),i=_.readNamed(t,"through"),r=_.readNamed(t,"to"),o=h.getNamed(t),c=new Y(o&&0==o.insert&&M.NO_INSERT);return c.moveTo(n),c.arcTo(i,r),c.set(o)},RegularPolygon:function(){for(var t=arguments,n=_.readNamed(t,"center"),i=h.readNamed(t,"sides"),r=h.readNamed(t,"radius"),o=360/i,c=i%3==0,u=new _(0,c?-r:r),d=c?-1:.5,p=new Array(i),g=0;g<i;g++)p[g]=new U(n.add(u.rotate((g+d)*o)));return createPath(p,!0,t)},Star:function(){for(var t=arguments,n=_.readNamed(t,"center"),i=2*h.readNamed(t,"points"),r=h.readNamed(t,"radius1"),o=h.readNamed(t,"radius2"),c=360/i,u=new _(0,-1),d=new Array(i),p=0;p<i;p++)d[p]=new U(n.add(u.rotate(c*p).multiply(p%2?o:r)));return createPath(d,!0,t)}}}});var H=W.extend({_class:"CompoundPath",_serializeFields:{children:[]},beans:!0,initialize:function CompoundPath2(t){this._children=[],this._namedChildren={},this._initialize(t)||("string"==typeof t?this.setPathData(t):this.addChildren(Array.isArray(t)?t:arguments))},insertChildren:function insertChildren(t,n){var i=n,r=i[0];r&&"number"==typeof r[0]&&(i=[i]);for(var o=n.length-1;o>=0;o--){var c=i[o];i!==n||c instanceof Y||(i=h.slice(i)),Array.isArray(c)?i[o]=new Y({segments:c,insert:!1}):c instanceof H&&(i.splice.apply(i,[o,1].concat(c.removeChildren())),c.remove())}return insertChildren.base.call(this,t,i)},reduce:function reduce(t){for(var n=this._children,i=n.length-1;i>=0;i--){var r;(r=n[i].reduce(t)).isEmpty()&&r.remove()}return n.length?reduce.base.call(this):((r=new Y(M.NO_INSERT)).copyAttributes(this),r.insertAbove(this),this.remove(),r)},isClosed:function(){for(var t=this._children,n=0,i=t.length;n<i;n++)if(!t[n]._closed)return!1;return!0},setClosed:function(t){for(var n=this._children,i=0,r=n.length;i<r;i++)n[i].setClosed(t)},getFirstSegment:function(){var t=this.getFirstChild();return t&&t.getFirstSegment()},getLastSegment:function(){var t=this.getLastChild();return t&&t.getLastSegment()},getCurves:function(){for(var t=this._children,n=[],i=0,r=t.length;i<r;i++)h.push(n,t[i].getCurves());return n},getFirstCurve:function(){var t=this.getFirstChild();return t&&t.getFirstCurve()},getLastCurve:function(){var t=this.getLastChild();return t&&t.getLastCurve()},getArea:function(){for(var t=this._children,n=0,i=0,r=t.length;i<r;i++)n+=t[i].getArea();return n},getLength:function(){for(var t=this._children,n=0,i=0,r=t.length;i<r;i++)n+=t[i].getLength();return n},getPathData:function(t,n){for(var i=this._children,r=[],o=0,h=i.length;o<h;o++){var c=i[o],u=c._matrix;r.push(c.getPathData(t&&!u.isIdentity()?t.appended(u):t,n))}return r.join("")},_hitTestChildren:function _hitTestChildren(t,n,i){return _hitTestChildren.base.call(this,t,n.class===Y||"path"===n.type?n:h.set({},n,{fill:!1}),i)},_draw:function(t,n,i,r){var o=this._children;if(o.length){n=n.extend({dontStart:!0,dontFinish:!0}),t.beginPath();for(var h=0,c=o.length;h<c;h++)o[h].draw(t,n,r);if(!n.clip){this._setStyles(t,n,i);var u=this._style;u.hasFill()&&(t.fill(u.getFillRule()),t.shadowColor="rgba(0,0,0,0)"),u.hasStroke()&&t.stroke()}}},_drawSelected:function(t,n,i){for(var r=this._children,o=0,h=r.length;o<h;o++){var c=r[o],u=c._matrix;i[c._id]||c._drawSelected(t,u.isIdentity()?n:n.appended(u))}}},new function(){function getCurrentPath(t,n){var i=t._children;if(n&&!i.length)throw new Error("Use a moveTo() command first");return i[i.length-1]}return h.each(["lineTo","cubicCurveTo","quadraticCurveTo","curveTo","arcTo","lineBy","cubicCurveBy","quadraticCurveBy","curveBy","arcBy"],(function(t){this[t]=function(){var n=getCurrentPath(this,!0);n[t].apply(n,arguments)}}),{moveTo:function(){var t=getCurrentPath(this),n=t&&t.isEmpty()?t:new Y(M.NO_INSERT);n!==t&&this.addChild(n),n.moveTo.apply(n,arguments)},moveBy:function(){var t=getCurrentPath(this,!0),n=t&&t.getLastSegment(),i=_.read(arguments);this.moveTo(n?i.add(n._point):i)},closePath:function(t){getCurrentPath(this,!0).closePath(t)}})},h.each(["reverse","flatten","simplify","smooth"],(function(t){this[t]=function(n){for(var i,r=this._children,o=0,h=r.length;o<h;o++)i=r[o][t](n)||i;return i}}),{}));W.inject(new function(){var t=Math.min,n=Math.max,r=Math.abs,o={unite:{1:!0,2:!0},intersect:{2:!0},subtract:{1:!0},exclude:{1:!0,"-1":!0}};function getPaths(t){return t._children||[t]}function preparePath(t,n){var i=t.clone(!1).reduce({simplify:!0}).transform(null,!0,!0);if(n){for(var r=getPaths(i),o=0,h=r.length;o<h;o++){(t=r[o])._closed||t.isEmpty()||(t.closePath(1e-12),t.getFirstSegment().setHandleIn(0,0),t.getLastSegment().setHandleOut(0,0))}i=i.resolveCrossings().reorient("nonzero"===i.getFillRule(),!0)}return i}function createResult(t,n,i,r,o){var h=new H(M.NO_INSERT);return h.addChildren(t,!0),h=h.reduce({simplify:n}),o&&0==o.insert||h.insertAbove(r&&i.isSibling(r)&&i.getIndex()<r.getIndex()?r:i),h.copyAttributes(i,!0),h}function filterIntersection(t){return t.hasOverlap()||t.isCrossing()}function traceBoolean(t,n,i,r){if(r&&(0==r.trace||r.stroke)&&/^(subtract|intersect)$/.test(i))return splitBoolean(t,n,i);var c=preparePath(t,!0),u=n&&t!==n&&preparePath(n,!0),d=o[i];d[i]=!0,u&&(d.subtract||d.exclude)^u.isClockwise()^c.isClockwise()&&u.reverse();var g,m=divideLocations(q.expand(c.getIntersections(u,filterIntersection))),v=getPaths(c),_=u&&getPaths(u),y=[],w=[];function collectPaths(t){for(var n=0,i=t.length;n<i;n++){var r=t[n];h.push(y,r._segments),h.push(w,r.getCurves()),r._overlapsOnly=!0}}function getCurves(t){for(var n=[],i=0,r=t&&t.length;i<r;i++)n.push(w[t[i]]);return n}if(m.length){collectPaths(v),_&&collectPaths(_);for(var x=new Array(w.length),S=0,C=w.length;S<C;S++)x[S]=w[S].getValues();var k=p.findCurveBoundsCollisions(x,x,0,!0),P={};for(S=0;S<w.length;S++){var I=w[S],M=I._path._id;(P[M]=P[M]||{})[I.getIndex()]={hor:getCurves(k[S].hor),ver:getCurves(k[S].ver)}}for(S=0,C=m.length;S<C;S++)propagateWinding(m[S]._segment,c,u,P,d);for(S=0,C=y.length;S<C;S++){var E=y[S],T=E._intersection;E._winding||propagateWinding(E,c,u,P,d),T&&T._overlap||(E._path._overlapsOnly=!1)}g=tracePaths(y,d)}else g=reorientPaths(_?v.concat(_):v.slice(),(function(t){return!!d[t]}));return createResult(g,!0,t,n,r)}function splitBoolean(t,n,i){var r=preparePath(t),o=preparePath(n),h=r.getIntersections(o,filterIntersection),c="subtract"===i,u="divide"===i,d={},p=[];function addPath(t){if(!d[t._id]&&(u||o.contains(t.getPointAt(t.getLength()/2))^c))return p.unshift(t),d[t._id]=!0}for(var g=h.length-1;g>=0;g--){var m=h[g].split();m&&(addPath(m)&&m.getFirstSegment().setHandleIn(0,0),r.getLastSegment().setHandleOut(0,0))}return addPath(r),createResult(p,!1,t,n)}function linkIntersections(t,n){for(var i=t;i;){if(i===n)return;i=i._previous}for(;t._next&&t._next!==n;)t=t._next;if(!t._next){for(;n._previous;)n=n._previous;t._next=n,n._previous=t}}function clearCurveHandles(t){for(var n=t.length-1;n>=0;n--)t[n].clearHandles()}function reorientPaths(t,n,i){var o=t&&t.length;if(o){var c=h.each(t,(function(t,n){this[t._id]={container:null,winding:t.isClockwise()?1:-1,index:n}}),{}),u=t.slice().sort((function(t,n){return r(n.getArea())-r(t.getArea())})),d=u[0],g=p.findItemBoundsCollisions(u,null,m.GEOMETRIC_EPSILON);null==i&&(i=d.isClockwise());for(var v=0;v<o;v++){var _=u[v],y=c[_._id],w=0,x=g[v];if(x)for(var S=null,C=x.length-1;C>=0;C--)if(x[C]<v){S=S||_.getInteriorPoint();var k=u[x[C]];if(k.contains(S)){var P=c[k._id];w=P.winding,y.winding+=w,y.container=P.exclude?P.container:k;break}}if(n(y.winding)===n(w))y.exclude=!0,t[y.index]=null;else{var I=y.container;_.setClockwise(I?!I.isClockwise():i)}}}return t}function divideLocations(t,n,i){var r,o,h,c=n&&[],u=1e-8,d=1-u,p=!1,g=i||[],m=i&&{};function getId(t){return t._path._id+"."+t._segment1._index}for(var v=(i&&i.length)-1;v>=0;v--){(_=i[v])._path&&(m[getId(_)]=!0)}for(v=t.length-1;v>=0;v--){var _,y,w=t[v],x=w._time,S=x,C=n&&!n(w);if((_=w._curve)&&(_!==o?(p=!_.hasHandles()||m&&m[getId(_)],r=[],h=null,o=_):h>=u&&(x/=h)),C)r&&r.push(w);else{if(n&&c.unshift(w),h=S,x<u)y=_._segment1;else if(x>d)y=_._segment2;else{var k=_.divideAtTime(x,!0);p&&g.push(_,k),y=k._segment1;for(var P=r.length-1;P>=0;P--){var I=r[P];I._time=(I._time-x)/(1-x)}}w._setSegment(y);var M=y._intersection,E=w._intersection;if(M){linkIntersections(M,E);for(var T=M;T;)linkIntersections(T._intersection,M),T=T._next}else y._intersection=E}}return i||clearCurveHandles(g),c||t}function getWinding(i,o,h,c,u){var d,p,g=Array.isArray(o)?o:o[h?"hor":"ver"],m=h?1:0,v=1^m,_=[i.x,i.y],y=_[m],w=_[v],x=1e-6,S=y-1e-9,C=y+1e-9,k=0,P=0,I=0,M=0,E=!1,T=!1,O=1,D=[];function addWinding(r){var p=r[v+0],g=r[v+6];if(!(w<t(p,g)||w>n(p,g))){var _=r[m+0],k=r[m+2],P=r[m+4],T=r[m+6];if(p!==g){var N=w===p?0:w===g||S>n(_,k,P,T)||C<t(_,k,P,T)?1:F.solveCubic(r,v,w,D,0,1)>0?D[0]:1,j=0===N?_:1===N?T:F.getPoint(r,N)[h?"y":"x"],V=p>g?1:-1,U=d[v]>d[v+6]?1:-1,z=d[m+6];return w!==p?(j<S?I+=V:j>C?M+=V:E=!0,j>y-x&&j<y+x&&(O/=2)):(V!==U?_<S?I+=V:_>C&&(M+=V):_!=z&&(z<C&&j>C?(M+=V,E=!0):z>S&&j<S&&(I+=V,E=!0)),O/=4),d=r,!u&&j>S&&j<C&&0===F.getTangent(r,N)[h?"x":"y"]&&getWinding(i,o,!h,c,!0)}(_<C&&T>S||T<C&&_>S)&&(E=!0)}}function handleCurve(i){var r=i[v+0],o=i[v+2],c=i[v+4],u=i[v+6];if(w<=n(r,o,c,u)&&w>=t(r,o,c,u))for(var d,p=i[m+0],g=i[m+2],_=i[m+4],y=i[m+6],x=S>n(p,g,_,y)||C<t(p,g,_,y)?[i]:F.getMonoCurves(i,h),k=0,P=x.length;k<P;k++)if(d=addWinding(x[k]))return d}for(var N=0,j=g.length;N<j;N++){var V,U=g[N],z=U._path,q=U.getValues();if(!(N&&g[N-1]._path===z||(d=null,z._closed||(p=F.getValues(z.getLastCurve().getSegment2(),U.getSegment1(),null,!c))[v]!==p[v+6]&&(d=p),d))){d=q;for(var W=z.getLastCurve();W&&W!==U;){var Y=W.getValues();if(Y[v]!==Y[v+6]){d=Y;break}W=W.getPrevious()}}if(V=handleCurve(q))return V;if(N+1===j||g[N+1]._path!==z){if(p&&(V=handleCurve(p)))return V;!E||I||M||(I=M=z.isClockwise(c)^h?1:-1),k+=I,P+=M,I=M=0,E&&(T=!0,E=!1),p=null}}return k=r(k),P=r(P),{winding:n(k,P),windingL:k,windingR:P,quality:O,onPath:T}}function propagateWinding(t,n,i,o,h){var c=[],u=t,d=0;do{if(C=t.getCurve()){var p=C.getLength();c.push({segment:t,curve:C,length:p}),d+=p}t=t.getNext()}while(t&&!t._intersection&&t!==u);for(var g=[.5,.25,.75],v={winding:0,quality:-1},_=0;_<g.length&&v.quality<.5;_++){p=d*g[_];for(var y=0,w=c.length;y<w;y++){var x=c[y],S=x.length;if(p<=S){var C,k=(C=x.curve)._path,P=k._parent,I=P instanceof H?P:k,M=m.clamp(C.getTimeAt(p),.001,.999),E=C.getPointAtTime(M),T=r(C.getTangentAtTime(M).y)<Math.SQRT1_2,O=null;if(h.subtract&&i){var D=(I===n?i:n)._getWinding(E,T,!0);if(I===n&&D.winding||I===i&&!D.winding){if(D.quality<1)continue;O={winding:0,quality:1}}}(O=O||getWinding(E,o[k._id][C.getIndex()],T,!0)).quality>v.quality&&(v=O);break}p-=S}}for(y=c.length-1;y>=0;y--)c[y].segment._winding=v}function tracePaths(t,n){var i,r=[];function isValid(t){var i;return!(!t||t._visited||n&&(!n[(i=t._winding||{}).winding]||n.unite&&2===i.winding&&i.windingL&&i.windingR))}function isStart(t){if(t)for(var n=0,r=i.length;n<r;n++)if(t===i[n])return!0;return!1}function visitPath(t){for(var n=t._segments,i=0,r=n.length;i<r;i++)n[i]._visited=!0}function getCrossingSegments(t,n){var r=t._intersection,o=r,h=[];function collect(r,o){for(;r&&r!==o;){var c=r._segment,u=c&&c._path;if(u){var d=c.getNext()||u.getFirstSegment(),p=d._intersection;c!==t&&(isStart(c)||isStart(d)||d&&isValid(c)&&(isValid(d)||p&&isValid(p._segment)))&&h.push(c),n&&i.push(c)}r=r._next}}if(n&&(i=[t]),r){for(collect(r);r&&r._previous;)r=r._previous;collect(r,o)}return h}t.sort((function(t,n){var i=t._intersection,r=n._intersection,o=!(!i||!i._overlap),h=!(!r||!r._overlap),c=t._path,u=n._path;return o^h?o?1:-1:!i^!r?i?1:-1:c!==u?c._id-u._id:t._index-n._index}));for(var o=0,h=t.length;o<h;o++){var c,u,d,p=t[o],g=isValid(p),m=null,v=!1,_=!0,y=[];if(g&&p._path._overlapsOnly){var w=p._path,x=p._intersection._segment._path;w.compare(x)&&(w.getArea()&&r.push(w.clone(!1)),visitPath(w),visitPath(x),g=!1)}for(;g;){var S=!m,C=getCrossingSegments(p,S),k=C.shift(),P=!(v=!S&&(isStart(p)||isStart(k)))&&k;if(S&&(m=new Y(M.NO_INSERT),c=null),v){(p.isFirst()||p.isLast())&&(_=p._path._closed),p._visited=!0;break}if(P&&c&&(y.push(c),c=null),c||(P&&C.push(p),c={start:m._segments.length,crossings:C,visited:u=[],handleIn:d}),P&&(p=k),!isValid(p)){m.removeSegments(c.start);for(var I=0,E=u.length;I<E;I++)u[I]._visited=!1;u.length=0;do{(p=c&&c.crossings.shift())&&p._path||(p=null,(c=y.pop())&&(u=c.visited,d=c.handleIn))}while(c&&!isValid(p));if(!p)break}var T=p.getNext();m.add(new U(p._point,d,T&&p._handleOut)),p._visited=!0,u.push(p),p=T||p._path.getFirstSegment(),d=T&&T._handleIn}v&&(_&&(m.getFirstSegment().setHandleIn(d),m.setClosed(_)),0!==m.getArea()&&r.push(m))}return r}return{_getWinding:function(t,n,i){return getWinding(t,this.getCurves(),n,i)},unite:function(t,n){return traceBoolean(this,t,"unite",n)},intersect:function(t,n){return traceBoolean(this,t,"intersect",n)},subtract:function(t,n){return traceBoolean(this,t,"subtract",n)},exclude:function(t,n){return traceBoolean(this,t,"exclude",n)},divide:function(t,n){return n&&(0==n.trace||n.stroke)?splitBoolean(this,t,"divide"):createResult([this.subtract(t,n),this.intersect(t,n)],!0,this,t,n)},resolveCrossings:function(){var t=this._children,n=t||[this];function hasOverlap(t,n){var i=t&&t._intersection;return i&&i._overlap&&i._path===n}var i=!1,r=!1,o=this.getIntersections(null,(function(t){return t.hasOverlap()&&(i=!0)||t.isCrossing()&&(r=!0)})),c=i&&r&&[];if(o=q.expand(o),i)for(var u=divideLocations(o,(function(t){return t.hasOverlap()}),c),d=u.length-1;d>=0;d--){var p=u[d],g=p._path,m=p._segment,v=m.getPrevious(),_=m.getNext();hasOverlap(v,g)&&hasOverlap(_,g)&&(m.remove(),v._handleOut._set(0,0),_._handleIn._set(0,0),v===m||v.getCurve().hasLength()||(_._handleIn.set(v._handleIn),v.remove()))}r&&(divideLocations(o,i&&function(t){var n=t.getCurve(),i=t.getSegment(),r=t._intersection,o=r._curve,h=r._segment;if(n&&o&&n._path&&o._path)return!0;i&&(i._intersection=null),h&&(h._intersection=null)},c),c&&clearCurveHandles(c),n=tracePaths(h.each(n,(function(t){h.push(this,t._segments)}),[])));var y,w=n.length;return w>1&&t?(n!==t&&this.setChildren(n),y=this):1!==w||t||(n[0]!==this&&this.setSegments(n[0].removeSegments()),y=this),y||((y=new H(M.NO_INSERT)).addChildren(n),(y=y.reduce()).copyAttributes(this),this.replaceWith(y)),y},reorient:function(t,n){var r=this._children;return r&&r.length?this.setChildren(reorientPaths(this.removeChildren(),(function(n){return!!(t?n:1&n)}),n)):n!==i&&this.setClockwise(n),this},getInteriorPoint:function(){var i=this.getBounds().getCenter(!0);if(!this.contains(i)){for(var r=this.getCurves(),o=i.y,h=[],c=[],u=0,d=r.length;u<d;u++){var p=r[u].getValues(),g=p[1],m=p[3],v=p[5],_=p[7];if(o>=t(g,m,v,_)&&o<=n(g,m,v,_))for(var y=F.getMonoCurves(p),w=0,x=y.length;w<x;w++){var S=y[w],C=S[1],k=S[7];if(C!==k&&(o>=C&&o<=k||o>=k&&o<=C)){var P=o===C?S[0]:o===k?S[6]:1===F.solveCubic(S,1,o,c,0,1)?F.getPoint(S,c[0]).x:(S[0]+S[6])/2;h.push(P)}}}h.length>1&&(h.sort((function(t,n){return t-n})),i.x=(h[0]+h[1])/2)}return i}}});var X=h.extend({_class:"PathFlattener",initialize:function(t,n,i,r,o){var h,c=[],u=[],d=0,p=1/(i||32),g=t._segments,m=g[0];function addCurve(t,n){var i=F.getValues(t,n,o);c.push(i),computeParts(i,t._index,0,1)}function computeParts(t,i,o,h){if(!(h-o>p)||r&&F.isStraight(t)||F.isFlatEnough(t,n||.25)){var c=t[6]-t[0],g=t[7]-t[1],m=Math.sqrt(c*c+g*g);m>0&&(d+=m,u.push({offset:d,curve:t,index:i,time:h}))}else{var v=F.subdivide(t,.5),_=(o+h)/2;computeParts(v[0],i,o,_),computeParts(v[1],i,_,h)}}for(var v=1,_=g.length;v<_;v++)addCurve(m,h=g[v]),m=h;t._closed&&addCurve(h||m,g[0]),this.curves=c,this.parts=u,this.length=d,this.index=0},_get:function(t){for(var n,i=this.parts,r=i.length,o=this.index;n=o,o&&!(i[--o].offset<t););for(;n<r;n++){var h=i[n];if(h.offset>=t){this.index=n;var c=i[n-1],u=c&&c.index===h.index?c.time:0,d=c?c.offset:0;return{index:h.index,time:u+(h.time-u)*(t-d)/(h.offset-d)}}}return{index:i[r-1].index,time:1}},drawPart:function(t,n,i){for(var r=this._get(n),o=this._get(i),h=r.index,c=o.index;h<=c;h++){var u=F.getPart(this.curves[h],h===r.index?r.time:0,h===o.index?o.time:1);h===r.index&&t.moveTo(u[0],u[1]),t.bezierCurveTo.apply(t,u.slice(2))}}},h.each(F._evaluateMethods,(function(t){this[t+"At"]=function(n){var i=this._get(n);return F[t](this.curves[i.index],i.time)}}),{})),J=h.extend({initialize:function(t){for(var n,i=this.points=[],r=t._segments,o=t._closed,h=0,c=r.length;h<c;h++){var u=r[h].point;n&&n.equals(u)||i.push(n=u.clone())}o&&(i.unshift(i[i.length-1]),i.push(i[1])),this.closed=o},fit:function(t){var n=this.points,i=n.length,r=null;return i>0&&(r=[new U(n[0])],i>1&&(this.fitCubic(r,t,0,i-1,n[1].subtract(n[0]),n[i-2].subtract(n[i-1])),this.closed&&(r.shift(),r.pop()))),r},fitCubic:function(t,n,i,r,o,h){var c=this.points;if(r-i!=1){for(var u,d=this.chordLengthParameterize(i,r),p=Math.max(n,n*n),g=!0,m=0;m<=4;m++){var v=this.generateBezier(i,r,d,o,h),_=this.findMaxError(i,r,v,d);if(_.error<n&&g)return void this.addCurve(t,v);if(u=_.index,_.error>=p)break;g=this.reparameterize(i,r,d,v),p=_.error}var y=c[u-1].subtract(c[u+1]);this.fitCubic(t,n,i,u,o,y),this.fitCubic(t,n,u,r,y.negate(),h)}else{var w=c[i],x=c[r],S=w.getDistance(x)/3;this.addCurve(t,[w,w.add(o.normalize(S)),x.add(h.normalize(S)),x])}},addCurve:function(t,n){t[t.length-1].setHandleOut(n[1].subtract(n[0])),t.push(new U(n[3],n[2].subtract(n[3])))},generateBezier:function(t,n,i,r,o){for(var h=1e-12,c=Math.abs,u=this.points,d=u[t],p=u[n],g=[[0,0],[0,0]],m=[0,0],v=0,_=n-t+1;v<_;v++){var y=i[v],w=1-y,x=3*y*w,S=w*w*w,C=x*w,k=x*y,P=y*y*y,I=r.normalize(C),M=o.normalize(k),E=u[t+v].subtract(d.multiply(S+C)).subtract(p.multiply(k+P));g[0][0]+=I.dot(I),g[0][1]+=I.dot(M),g[1][0]=g[0][1],g[1][1]+=M.dot(M),m[0]+=I.dot(E),m[1]+=M.dot(E)}var T,O,D=g[0][0]*g[1][1]-g[1][0]*g[0][1];if(c(D)>h){var N=g[0][0]*m[1]-g[1][0]*m[0];T=(m[0]*g[1][1]-m[1]*g[0][1])/D,O=N/D}else{var j=g[0][0]+g[0][1],V=g[1][0]+g[1][1];T=O=c(j)>h?m[0]/j:c(V)>h?m[1]/V:0}var U,z,F=p.getDistance(d),q=h*F;if(T<q||O<q)T=O=F/3;else{var W=p.subtract(d);U=r.normalize(T),z=o.normalize(O),U.dot(W)-z.dot(W)>F*F&&(T=O=F/3,U=z=null)}return[d,d.add(U||r.normalize(T)),p.add(z||o.normalize(O)),p]},reparameterize:function(t,n,i,r){for(var o=t;o<=n;o++)i[o-t]=this.findRoot(r,this.points[o],i[o-t]);o=1;for(var h=i.length;o<h;o++)if(i[o]<=i[o-1])return!1;return!0},findRoot:function(t,n,i){for(var r=[],o=[],h=0;h<=2;h++)r[h]=t[h+1].subtract(t[h]).multiply(3);for(h=0;h<=1;h++)o[h]=r[h+1].subtract(r[h]).multiply(2);var c=this.evaluate(3,t,i),u=this.evaluate(2,r,i),d=this.evaluate(1,o,i),p=c.subtract(n),g=u.dot(u)+p.dot(d);return m.isMachineZero(g)?i:i-p.dot(u)/g},evaluate:function(t,n,i){for(var r=n.slice(),o=1;o<=t;o++)for(var h=0;h<=t-o;h++)r[h]=r[h].multiply(1-i).add(r[h+1].multiply(i));return r[0]},chordLengthParameterize:function(t,n){for(var i=[0],r=t+1;r<=n;r++)i[r-t]=i[r-t-1]+this.points[r].getDistance(this.points[r-1]);r=1;for(var o=n-t;r<=o;r++)i[r]/=i[o];return i},findMaxError:function(t,n,i,r){for(var o=Math.floor((n-t+1)/2),h=0,c=t+1;c<n;c++){var u=this.evaluate(3,i,r[c-t]).subtract(this.points[c]),d=u.x*u.x+u.y*u.y;d>=h&&(h=d,o=c)}return{error:h,index:o}}}),Z=M.extend({_class:"TextItem",_applyMatrix:!1,_canApplyMatrix:!1,_serializeFields:{content:null},_boundsOptions:{stroke:!1,handle:!1},initialize:function TextItem2(t){this._content="",this._lines=[];var n=t&&h.isPlainObject(t)&&t.x===i&&t.y===i;this._initialize(n&&t,!n&&_.read(arguments))},_equals:function(t){return this._content===t._content},copyContent:function(t){this.setContent(t._content)},getContent:function(){return this._content},setContent:function(t){this._content=""+t,this._lines=this._content.split(/\r\n|\n|\r/gm),this._changed(521)},isEmpty:function(){return!this._content},getCharacterStyle:"#getStyle",setCharacterStyle:"#setStyle",getParagraphStyle:"#getStyle",setParagraphStyle:"#setStyle"}),Q=Z.extend({_class:"PointText",initialize:function PointText2(){Z.apply(this,arguments)},getPoint:function(){var t=this._matrix.getTranslation();return new y(t.x,t.y,this,"setPoint")},setPoint:function(){var t=_.read(arguments);this.translate(t.subtract(this._matrix.getTranslation()))},_draw:function(t,n,i){if(this._content){this._setStyles(t,n,i);var r=this._lines,o=this._style,h=o.hasFill(),c=o.hasStroke(),u=o.getLeading(),d=t.shadowColor;t.font=o.getFontStyle(),t.textAlign=o.getJustification();for(var p=0,g=r.length;p<g;p++){t.shadowColor=d;var m=r[p];h&&(t.fillText(m,0,0),t.shadowColor="rgba(0,0,0,0)"),c&&t.strokeText(m,0,0),t.translate(0,u)}}},_getBounds:function(t,n){var i=this._style,r=this._lines,o=r.length,h=i.getJustification(),c=i.getLeading(),u=this.getView().getTextWidth(i.getFontStyle(),r),d=0;"left"!==h&&(d-=u/("center"===h?2:1));var p=new S(d,o?-.75*c:0,u,o*c);return t?t._transformBounds(p,p):p}}),tt=h.extend(new function(){var t,n={gray:["gray"],rgb:["red","green","blue"],hsb:["hue","saturation","brightness"],hsl:["hue","saturation","lightness"],gradient:["gradient","origin","destination","highlight"]},i={},o={transparent:[0,0,0,0]};var c=[[0,3,1],[2,0,1],[1,0,3],[1,2,0],[3,1,0],[0,1,2]],u={"rgb-hsb":function(t,n,i){var r=Math.max(t,n,i),o=r-Math.min(t,n,i);return[0===o?0:60*(r==t?(n-i)/o+(n<i?6:0):r==n?(i-t)/o+2:(t-n)/o+4),0===r?0:o/r,r]},"hsb-rgb":function(t,n,i){var r,o=(t=(t/60%6+6)%6)-(r=Math.floor(t)),h=[i,i*(1-n),i*(1-n*o),i*(1-n*(1-o))];return[h[(r=c[r])[0]],h[r[1]],h[r[2]]]},"rgb-hsl":function(t,n,i){var r=Math.max(t,n,i),o=Math.min(t,n,i),h=r-o,c=0===h,u=(r+o)/2;return[c?0:60*(r==t?(n-i)/h+(n<i?6:0):r==n?(i-t)/h+2:(t-n)/h+4),c?0:u<.5?h/(r+o):h/(2-r-o),u]},"hsl-rgb":function(t,n,i){if(0===n)return[i,i,i];for(var r=[(t=(t/360%1+1)%1)+1/3,t,t-1/3],o=i<.5?i*(1+n):i+n-i*n,h=2*i-o,c=[],u=0;u<3;u++){var d=r[u];d<0&&(d+=1),d>1&&(d-=1),c[u]=6*d<1?h+6*(o-h)*d:2*d<1?o:3*d<2?h+(o-h)*(2/3-d)*6:h}return c},"rgb-gray":function(t,n,i){return[.2989*t+.587*n+.114*i]},"gray-rgb":function(t){return[t,t,t]},"gray-hsb":function(t){return[0,0,t]},"gray-hsl":function(t){return[0,0,t]},"gradient-rgb":function(){return[]},"rgb-gradient":function(){return[]}};return h.each(n,(function(t,r){i[r]=[],h.each(t,(function(t,o){var c=h.capitalize(t),u=/^(hue|saturation)$/.test(t),d=i[r][o]="gradient"===r?"gradient"===t?function(t){var n=this._components[0];return n!==(t=et.read(Array.isArray(t)?t:arguments,0,{readNull:!0}))&&(n&&n._removeOwner(this),t&&t._addOwner(this)),t}:function(){return _.read(arguments,0,{readNull:"highlight"===t,clone:!0})}:function(t){return null==t||isNaN(t)?0:+t};this["get"+c]=function(){return this._type===r||u&&/^hs[bl]$/.test(this._type)?this._components[o]:this._convert(r)[o]},this["set"+c]=function(t){this._type===r||u&&/^hs[bl]$/.test(this._type)||(this._components=this._convert(r),this._properties=n[r],this._type=r),this._components[o]=d.call(this,t),this._changed()}}),this)}),{_class:"Color",_readIndex:!0,initialize:function Color2(c){var u,d,p,g,m=arguments,v=this.__read,_=0;Array.isArray(c)&&(c=(m=c)[0]);var y=null!=c&&typeof c;if("string"===y&&c in n&&(u=c,c=m[1],Array.isArray(c)?(d=c,p=m[2]):(v&&(_=1),m=h.slice(m,1),y=typeof c)),!d){if(g="number"===y?m:"object"===y&&null!=c.length?c:null){u||(u=g.length>=3?"rgb":"gray");var w=n[u].length;p=g[w],v&&(_+=g===arguments?w+(null!=p?1:0):1),g.length>w&&(g=h.slice(g,0,w))}else if("string"===y){var x=function fromCSS(n){var i,h=n.match(/^#([\da-f]{2})([\da-f]{2})([\da-f]{2})([\da-f]{2})?$/i)||n.match(/^#([\da-f])([\da-f])([\da-f])([\da-f])?$/i),c="rgb";if(h){var u=h[4]?4:3;i=new Array(u);for(var d=0;d<u;d++){var p=h[d+1];i[d]=parseInt(1==p.length?p+p:p,16)/255}}else if(h=n.match(/^(rgb|hsl)a?\((.*)\)$/)){c=h[1],i=h[2].trim().split(/[,\s]+/g);for(var g="hsl"===c,m=(d=0,Math.min(i.length,4));d<m;d++){var v=i[d];if(p=parseFloat(v),g)if(0===d){var _=v.match(/([a-z]*)$/)[1];p*={turn:360,rad:180/Math.PI,grad:.9}[_]||1}else d<3&&(p/=100);else d<3&&(p/=/%$/.test(v)?100:255);i[d]=p}}else{var y=o[n];if(!y)if(r){t||((t=mt.getContext(1,1,{willReadFrequently:!0})).globalCompositeOperation="copy"),t.fillStyle="rgba(0,0,0,0)",t.fillStyle=n,t.fillRect(0,0,1,1);var w=t.getImageData(0,0,1,1).data;y=o[n]=[w[0]/255,w[1]/255,w[2]/255]}else y=[0,0,0];i=y.slice()}return[c,i]}(c);u=x[0],4===(d=x[1]).length&&(p=d[3],d.length--)}else if("object"===y)if(c.constructor===Color2){if(u=c._type,d=c._components.slice(),p=c._alpha,"gradient"===u)for(var S=1,C=d.length;S<C;S++){var k=d[S];k&&(d[S]=k.clone())}}else if(c.constructor===et)u="gradient",g=m;else{var P=n[u="hue"in c?"lightness"in c?"hsl":"hsb":"gradient"in c||"stops"in c||"radial"in c?"gradient":"gray"in c?"gray":"rgb"],I=i[u];this._components=d=[];for(S=0,C=P.length;S<C;S++){null==(M=c[P[S]])&&!S&&"gradient"===u&&"stops"in c&&(M={stops:c.stops,radial:c.radial}),null!=(M=I[S].call(this,M))&&(d[S]=M)}p=c.alpha}v&&u&&(_=1)}if(this._type=u||"rgb",!d){this._components=d=[];for(S=0,C=(I=i[this._type]).length;S<C;S++){var M;null!=(M=I[S].call(this,g&&g[S]))&&(d[S]=M)}}return this._components=d,this._properties=n[this._type],this._alpha=p,v&&(this.__read=_),this},set:"#initialize",_serialize:function(t,n){var i=this.getComponents();return h.serialize(/^(gray|rgb)$/.test(this._type)?i:[this._type].concat(i),t,!0,n)},_changed:function(){this._canvasStyle=null,this._owner&&(this._setter?this._owner[this._setter](this):this._owner._changed(129))},_convert:function(t){var n;return this._type===t?this._components.slice():(n=u[this._type+"-"+t])?n.apply(this,this._components):u["rgb-"+t].apply(this,u[this._type+"-rgb"].apply(this,this._components))},convert:function(t){return new tt(t,this._convert(t),this._alpha)},getType:function(){return this._type},setType:function(t){this._components=this._convert(t),this._properties=n[t],this._type=t},getComponents:function(){var t=this._components.slice();return null!=this._alpha&&t.push(this._alpha),t},getAlpha:function(){return null!=this._alpha?this._alpha:1},setAlpha:function(t){this._alpha=null==t?null:Math.min(Math.max(t,0),1),this._changed()},hasAlpha:function(){return null!=this._alpha},equals:function(t){var n=h.isPlainValue(t,!0)?tt.read(arguments):t;return n===this||n&&this._class===n._class&&this._type===n._type&&this.getAlpha()===n.getAlpha()&&h.equals(this._components,n._components)||!1},toString:function(){for(var t=this._properties,n=[],i="gradient"===this._type,r=g.instance,o=0,h=t.length;o<h;o++){var c=this._components[o];null!=c&&n.push(t[o]+": "+(i?c:r.number(c)))}return null!=this._alpha&&n.push("alpha: "+r.number(this._alpha)),"{ "+n.join(", ")+" }"},toCSS:function(t){var n=this._convert("rgb"),i=t||null==this._alpha?1:this._alpha;function convert(t){return Math.round(255*(t<0?0:t>1?1:t))}return n=[convert(n[0]),convert(n[1]),convert(n[2])],i<1&&n.push(i<0?0:i),t?"#"+((1<<24)+(n[0]<<16)+(n[1]<<8)+n[2]).toString(16).slice(1):(4==n.length?"rgba(":"rgb(")+n.join(",")+")"},toCanvasStyle:function(t,n){if(this._canvasStyle)return this._canvasStyle;if("gradient"!==this._type)return this._canvasStyle=this.toCSS();var i,r=this._components,o=r[0],h=o._stops,c=r[1],u=r[2],d=r[3],p=n&&n.inverted();if(p&&(c=p._transformPoint(c),u=p._transformPoint(u),d&&(d=p._transformPoint(d))),o._radial){var g=u.getDistance(c);if(d){var m=d.subtract(c);m.getLength()>g&&(d=c.add(m.normalize(g-.1)))}var v=d||c;i=t.createRadialGradient(v.x,v.y,0,c.x,c.y,g)}else i=t.createLinearGradient(c.x,c.y,u.x,u.y);for(var _=0,y=h.length;_<y;_++){var w=h[_],x=w._offset;i.addColorStop(null==x?_/(y-1):x,w._color.toCanvasStyle())}return this._canvasStyle=i},transform:function(t){if("gradient"===this._type){for(var n=this._components,i=1,r=n.length;i<r;i++){var o=n[i];t._transformPoint(o,o,!0)}this._changed()}},statics:{_types:n,random:function(){var t=Math.random;return new tt(t(),t(),t())},_setOwner:function(t,n,i){return t&&(t._owner&&n&&t._owner!==n&&(t=t.clone()),!t._owner^!n&&(t._owner=n||null,t._setter=i||null)),t}}})},new function(){return h.each({add:function(t,n){return t+n},subtract:function(t,n){return t-n},multiply:function(t,n){return t*n},divide:function(t,n){return t/n}},(function(t,n){this[n]=function(n){n=tt.read(arguments);for(var i=this._type,r=this._components,o=n._convert(i),h=0,c=r.length;h<c;h++)o[h]=t(r[h],o[h]);return new tt(i,o,null!=this._alpha?t(this._alpha,n.getAlpha()):null)}}),{})}),et=h.extend({_class:"Gradient",initialize:function Gradient2(t,n){this._id=v.get(),t&&h.isPlainObject(t)&&(this.set(t),t=n=null),null==this._stops&&this.setStops(t||["white","black"]),null==this._radial&&this.setRadial("string"==typeof n&&"radial"===n||n||!1)},_serialize:function(t,n){return n.add(this,(function(){return h.serialize([this._stops,this._radial],t,!0,n)}))},_changed:function(){for(var t=0,n=this._owners&&this._owners.length;t<n;t++)this._owners[t]._changed()},_addOwner:function(t){this._owners||(this._owners=[]),this._owners.push(t)},_removeOwner:function(t){var n=this._owners?this._owners.indexOf(t):-1;-1!=n&&(this._owners.splice(n,1),this._owners.length||(this._owners=i))},clone:function(){for(var t=[],n=0,i=this._stops.length;n<i;n++)t[n]=this._stops[n].clone();return new et(t,this._radial)},getStops:function(){return this._stops},setStops:function(t){if(t.length<2)throw new Error("Gradient stop list needs to contain at least two stops.");var n=this._stops;if(n)for(var r=0,o=n.length;r<o;r++)n[r]._owner=i;for(r=0,o=(n=this._stops=nt.readList(t,0,{clone:!0})).length;r<o;r++)n[r]._owner=this;this._changed()},getRadial:function(){return this._radial},setRadial:function(t){this._radial=t,this._changed()},equals:function(t){if(t===this)return!0;if(t&&this._class===t._class){var n=this._stops,i=t._stops,r=n.length;if(r===i.length){for(var o=0;o<r;o++)if(!n[o].equals(i[o]))return!1;return!0}}return!1}}),nt=h.extend({_class:"GradientStop",initialize:function GradientStop2(t,n){var r=t,o=n;"object"==typeof t&&n===i&&(Array.isArray(t)&&"number"!=typeof t[0]?(r=t[0],o=t[1]):("color"in t||"offset"in t||"rampPoint"in t)&&(r=t.color,o=t.offset||t.rampPoint||0)),this.setColor(r),this.setOffset(o)},clone:function(){return new nt(this._color.clone(),this._offset)},_serialize:function(t,n){var i=this._color,r=this._offset;return h.serialize(null==r?[i]:[i,r],t,!0,n)},_changed:function(){this._owner&&this._owner._changed(129)},getOffset:function(){return this._offset},setOffset:function(t){this._offset=t,this._changed()},getRampPoint:"#getOffset",setRampPoint:"#setOffset",getColor:function(){return this._color},setColor:function(){tt._setOwner(this._color,null),this._color=tt._setOwner(tt.read(arguments,0),this,"setColor"),this._changed()},equals:function(t){return t===this||t&&this._class===t._class&&this._color.equals(t._color)&&this._offset==t._offset||!1}}),it=h.extend(new function(){var t={fillColor:null,fillRule:"nonzero",strokeColor:null,strokeWidth:1,strokeCap:"butt",strokeJoin:"miter",strokeScaling:!0,miterLimit:10,dashOffset:0,dashArray:[],shadowColor:null,shadowBlur:0,shadowOffset:new _,selectedColor:null},n=h.set({},t,{fontFamily:"sans-serif",fontWeight:"normal",fontSize:12,leading:null,justification:"left"}),r=h.set({},n,{fillColor:new tt}),o={strokeWidth:193,strokeCap:193,strokeJoin:193,strokeScaling:201,miterLimit:193,fontFamily:9,fontWeight:9,fontSize:9,font:9,leading:9,justification:9},c={beans:!0},u={_class:"Style",beans:!0,initialize:function Style2(i,o,h){this._values={},this._owner=o,this._project=o&&o._project||h||wt.project,this._defaults=!o||o instanceof E?n:o instanceof Z?r:t,i&&this.set(i)}};return h.each(n,(function(t,n){var r=/Color$/.test(n),d="shadowOffset"===n,p=h.capitalize(n),g=o[n],m="set"+p,v="get"+p;u[m]=function(t){var i=this._owner,o=i&&i._children,h=o&&o.length>0&&!(i instanceof H);if(h)for(var c=0,u=o.length;c<u;c++)o[c]._style[m](t);if(("selectedColor"===n||!h)&&n in this._defaults){var d=this._values[n];d!==t&&(r&&(d&&(tt._setOwner(d,null),d._canvasStyle=null),t&&t.constructor===tt&&(t=tt._setOwner(t,i,h&&m))),this._values[n]=t,i&&i._changed(g||129))}},u[v]=function(t){var o=this._owner,c=o&&o._children,u=c&&c.length>0&&!(o instanceof H);if(u&&!t)for(var p=0,g=c.length;p<g;p++){var y=c[p]._style[v]();if(p){if(!h.equals(w,y))return i}else w=y}else if(n in this._defaults){var w;if((w=this._values[n])===i)(w=this._defaults[n])&&w.clone&&(w=w.clone());else{var x=r?tt:d?_:null;!x||w&&w.constructor===x||(this._values[n]=w=x.read([w],0,{readNull:!0,clone:!0}))}}return w&&r&&(w=tt._setOwner(w,o,u&&m)),w},c[v]=function(t){return this._style[v](t)},c[m]=function(t){this._style[m](t)}})),h.each({Font:"FontFamily",WindingRule:"FillRule"},(function(t,n){var i="get"+n,r="set"+n;u[i]=c[i]="#get"+t,u[r]=c[r]="#set"+t})),M.inject(c),u},{set:function(t){var n=t instanceof it,i=n?t._values:t;if(i)for(var r in i)if(r in this._defaults){var o=i[r];this[r]=o&&n&&o.clone?o.clone():o}},equals:function(t){function compare(t,n,r){var o=t._values,c=n._values,u=n._defaults;for(var d in o){var p=o[d],g=c[d];if(!(r&&d in c||h.equals(p,g===i?u[d]:g)))return!1}return!0}return t===this||t&&this._class===t._class&&compare(this,t)&&compare(t,this,!0)||!1},_dispose:function(){var t;(t=this.getFillColor())&&(t._canvasStyle=null),(t=this.getStrokeColor())&&(t._canvasStyle=null),(t=this.getShadowColor())&&(t._canvasStyle=null)},hasFill:function(){var t=this.getFillColor();return!!t&&t.alpha>0},hasStroke:function(){var t=this.getStrokeColor();return!!t&&t.alpha>0&&this.getStrokeWidth()>0},hasShadow:function(){var t=this.getShadowColor();return!!t&&t.alpha>0&&(this.getShadowBlur()>0||!this.getShadowOffset().isZero())},getView:function(){return this._project._view},getFontStyle:function(){var t=this.getFontSize();return this.getFontWeight()+" "+t+(/[a-z]/i.test(t+"")?" ":"px ")+this.getFontFamily()},getFont:"#getFontFamily",setFont:"#setFontFamily",getLeading:function getLeading(){var t=getLeading.base.call(this),n=this.getFontSize();return/pt|em|%|px/.test(n)&&(n=this.getView().getPixelSize(n)),null!=t?t:1.2*n}}),rt=new function(){function handlePrefix(t,n,i,r){for(var o=["","webkit","moz","Moz","ms","o"],h=n[0].toUpperCase()+n.substring(1),c=0;c<6;c++){var u=o[c],d=u?u+h:n;if(d in t){if(!i)return t[d];t[d]=r;break}}}return{getStyles:function(t){var n=t&&9!==t.nodeType?t.ownerDocument:t,i=n&&n.defaultView;return i&&i.getComputedStyle(t,"")},getBounds:function(t,n){var i,r=t.ownerDocument,o=r.body,h=r.documentElement;try{i=t.getBoundingClientRect()}catch(dr){i={left:0,top:0,width:0,height:0}}var c=i.left-(h.clientLeft||o.clientLeft||0),u=i.top-(h.clientTop||o.clientTop||0);if(!n){var d=r.defaultView;c+=d.pageXOffset||h.scrollLeft||o.scrollLeft,u+=d.pageYOffset||h.scrollTop||o.scrollTop}return new S(c,u,i.width,i.height)},getViewportBounds:function(t){var n=t.ownerDocument,i=n.defaultView,r=n.documentElement;return new S(0,0,i.innerWidth||r.clientWidth,i.innerHeight||r.clientHeight)},getOffset:function(t,n){return rt.getBounds(t,n).getPoint()},getSize:function(t){return rt.getBounds(t,!0).getSize()},isInvisible:function(t){return rt.getSize(t).equals(new w(0,0))},isInView:function(t){return!rt.isInvisible(t)&&rt.getViewportBounds(t).intersects(rt.getBounds(t,!0))},isInserted:function(t){return o.body.contains(t)},getPrefixed:function(t,n){return t&&handlePrefix(t,n)},setPrefixed:function(t,n,i){if("object"==typeof n)for(var r in n)handlePrefix(t,r,!0,n[r]);else handlePrefix(t,n,!0,i)}}},st={add:function(t,n){if(t)for(var i in n)for(var r=n[i],h=i.split(/[\s,]+/g),c=0,u=h.length;c<u;c++){var d=h[c],p=t===o&&("touchstart"===d||"touchmove"===d)&&{passive:!1};t.addEventListener(d,r,p)}},remove:function(t,n){if(t)for(var i in n)for(var r=n[i],o=i.split(/[\s,]+/g),h=0,c=o.length;h<c;h++)t.removeEventListener(o[h],r,!1)},getPoint:function(t){var n=t.targetTouches?t.targetTouches.length?t.targetTouches[0]:t.changedTouches[0]:t;return new _(n.pageX||n.clientX+o.documentElement.scrollLeft,n.pageY||n.clientY+o.documentElement.scrollTop)},getTarget:function(t){return t.target||t.srcElement},getRelatedTarget:function(t){return t.relatedTarget||t.toElement},getOffset:function(t,n){return st.getPoint(t).subtract(rt.getOffset(n||st.getTarget(t)))}};st.requestAnimationFrame=new function(){var t,n=rt.getPrefixed(r,"requestAnimationFrame"),i=!1,o=[];function handleCallbacks(){var t=o;o=[];for(var r=0,h=t.length;r<h;r++)t[r]();(i=n&&o.length)&&n(handleCallbacks)}return function(r){o.push(r),n?i||(n(handleCallbacks),i=!0):t||(t=setInterval(handleCallbacks,1e3/60))}};var ot=h.extend(c,{_class:"View",initialize:function View2(t,n){function getSize(t){return n[t]||parseInt(n.getAttribute(t),10)}function getCanvasSize(){var t=rt.getSize(n);return t.isNaN()||t.isZero()?new w(getSize("width"),getSize("height")):t}var i;if(r&&n){this._id=n.getAttribute("id"),null==this._id&&n.setAttribute("id",this._id="paper-view-"+View2._id++),st.add(n,this._viewEvents);var h="none";if(rt.setPrefixed(n.style,{userDrag:h,userSelect:h,touchCallout:h,contentZooming:h,tapHighlightColor:"rgba(0,0,0,0)"}),u.hasAttribute(n,"resize")){var c=this;st.add(r,this._windowEvents={resize:function(){c.setViewSize(getCanvasSize())}})}if(i=getCanvasSize(),u.hasAttribute(n,"stats")&&"undefined"!=typeof Stats){this._stats=new Stats;var d=this._stats.domElement,p=d.style,g=rt.getOffset(n);p.position="absolute",p.left=g.x+"px",p.top=g.y+"px",o.body.appendChild(d)}}else i=new w(n),n=null;this._project=t,this._scope=t._scope,this._element=n,this._pixelRatio||(this._pixelRatio=r&&r.devicePixelRatio||1),this._setElementSize(i.width,i.height),this._viewSize=i,View2._views.push(this),View2._viewsById[this._id]=this,(this._matrix=new k)._owner=this,View2._focused||(View2._focused=this),this._frameItems={},this._frameItemCount=0,this._itemEvents={native:{},virtual:{}},this._autoUpdate=!wt.agent.node,this._needsUpdate=!1},remove:function(){if(!this._project)return!1;ot._focused===this&&(ot._focused=null),ot._views.splice(ot._views.indexOf(this),1),delete ot._viewsById[this._id];var t=this._project;return t._view===this&&(t._view=null),st.remove(this._element,this._viewEvents),st.remove(r,this._windowEvents),this._element=this._project=null,this.off("frame"),this._animate=!1,this._frameItems={},!0},_events:h.each(M._itemHandlers.concat(["onResize","onKeyDown","onKeyUp"]),(function(t){this[t]={}}),{onFrame:{install:function(){this.play()},uninstall:function(){this.pause()}}}),_animate:!1,_time:0,_count:0,getAutoUpdate:function(){return this._autoUpdate},setAutoUpdate:function(t){this._autoUpdate=t,t&&this.requestUpdate()},update:function(){},draw:function(){this.update()},requestUpdate:function(){if(!this._requested){var t=this;st.requestAnimationFrame((function(){if(t._requested=!1,t._animate){t.requestUpdate();var n=t._element;rt.getPrefixed(o,"hidden")&&"true"!==u.getAttribute(n,"keepalive")||!rt.isInView(n)||t._handleFrame()}t._autoUpdate&&t.update()})),this._requested=!0}},play:function(){this._animate=!0,this.requestUpdate()},pause:function(){this._animate=!1},_handleFrame:function(){wt=this._scope;var t=Date.now()/1e3,n=this._last?t-this._last:0;this._last=t,this.emit("frame",new h({delta:n,time:this._time+=n,count:this._count++})),this._stats&&this._stats.update()},_animateItem:function(t,n){var i=this._frameItems;n?(i[t._id]={item:t,time:0,count:0},1==++this._frameItemCount&&this.on("frame",this._handleFrameItems)):(delete i[t._id],0==--this._frameItemCount&&this.off("frame",this._handleFrameItems))},_handleFrameItems:function(t){for(var n in this._frameItems){var i=this._frameItems[n];i.item.emit("frame",new h(t,{time:i.time+=t.delta,count:i.count++}))}},_changed:function(){this._project._changed(4097),this._bounds=this._decomposed=i},getElement:function(){return this._element},getPixelRatio:function(){return this._pixelRatio},getResolution:function(){return 72*this._pixelRatio},getViewSize:function(){var t=this._viewSize;return new x(t.width,t.height,this,"setViewSize")},setViewSize:function(){var t=w.read(arguments),n=t.subtract(this._viewSize);n.isZero()||(this._setElementSize(t.width,t.height),this._viewSize.set(t),this._changed(),this.emit("resize",{size:t,delta:n}),this._autoUpdate&&this.update())},_setElementSize:function(t,n){var i=this._element;i&&(i.width!==t&&(i.width=t),i.height!==n&&(i.height=n))},getBounds:function(){return this._bounds||(this._bounds=this._matrix.inverted()._transformBounds(new S(new _,this._viewSize))),this._bounds},getSize:function(){return this.getBounds().getSize()},isVisible:function(){return rt.isInView(this._element)},isInserted:function(){return rt.isInserted(this._element)},getPixelSize:function(t){var n,i=this._element;if(i){var r=i.parentNode,h=o.createElement("div");h.style.fontSize=t,r.appendChild(h),n=parseFloat(rt.getStyles(h).fontSize),r.removeChild(h)}else n=parseFloat(n);return n},getTextWidth:function(t,n){return 0}},h.each(["rotate","scale","shear","skew"],(function(t){var n="rotate"===t;this[t]=function(){var i=arguments,r=(n?h:_).read(i),o=_.read(i,0,{readNull:!0});return this.transform((new k)[t](r,o||this.getCenter(!0)))}}),{_decompose:function(){return this._decomposed||(this._decomposed=this._matrix.decompose())},translate:function(){var t=new k;return this.transform(t.translate.apply(t,arguments))},getCenter:function(){return this.getBounds().getCenter()},setCenter:function(){var t=_.read(arguments);this.translate(this.getCenter().subtract(t))},getZoom:function(){var t=this._decompose().scaling;return(t.x+t.y)/2},setZoom:function(t){this.transform((new k).scale(t/this.getZoom(),this.getCenter()))},getRotation:function(){return this._decompose().rotation},setRotation:function(t){var n=this.getRotation();null!=n&&null!=t&&this.rotate(t-n)},getScaling:function(){var t=this._decompose().scaling;return new y(t.x,t.y,this,"setScaling")},setScaling:function(){var t=this.getScaling(),n=_.read(arguments,0,{clone:!0,readNull:!0});t&&n&&this.scale(n.x/t.x,n.y/t.y)},getMatrix:function(){return this._matrix},setMatrix:function(){var t=this._matrix;t.set.apply(t,arguments)},transform:function(t){this._matrix.append(t)},scrollBy:function(){this.translate(_.read(arguments).negate())}}),{projectToView:function(){return this._matrix._transformPoint(_.read(arguments))},viewToProject:function(){return this._matrix._inverseTransform(_.read(arguments))},getEventPoint:function(t){return this.viewToProject(st.getOffset(t,this._element))}},{statics:{_views:[],_viewsById:{},_id:0,create:function(t,n){return o&&"string"==typeof n&&(n=o.getElementById(n)),new(r?ht:ot)(t,n)}}},new function(){if(r){var t,n,i,h,c,u=!1,d=!1,p=r.navigator;p.pointerEnabled||p.msPointerEnabled?(i="pointerdown MSPointerDown",h="pointermove MSPointerMove",c="pointerup pointercancel MSPointerUp MSPointerCancel"):(i="touchstart",h="touchmove",c="touchend touchcancel","ontouchstart"in r&&p.userAgent.match(/mobile|tablet|ip(ad|hone|od)|android|silk/i)||(i+=" mousedown",h+=" mousemove",c+=" mouseup"));var g={},m={mouseout:function(t){var n=ot._focused,i=st.getRelatedTarget(t);if(n&&(!i||"HTML"===i.nodeName)){var r=st.getOffset(t,n._element),o=r.x,h=Math.abs,c=h(o),u=c-(1<<25);r.x=h(u)<c?u*(o<0?-1:1):o,handleMouseMove(n,t,n.viewToProject(r))}},scroll:updateFocus};g[i]=function(t){var n=ot._focused=getView(t);u||(u=!0,n._handleMouseEvent("mousedown",t))},m[h]=function(i){var r=ot._focused;if(!d){var o=getView(i);o?r!==o&&(r&&handleMouseMove(r,i),t||(t=r),r=ot._focused=n=o):n&&n===r&&(t&&!t.isInserted()&&(t=null),r=ot._focused=t,t=null,updateFocus())}r&&handleMouseMove(r,i)},m[i]=function(){d=!0},m[c]=function(t){var n=ot._focused;n&&u&&n._handleMouseEvent("mouseup",t),d=u=!1},st.add(o,m),st.add(r,{load:updateFocus});var v,_,y,w,x,S,C,k,P=!1,I=!1,M={doubleclick:"click",mousedrag:"mousemove"},E=!1,T={mousedown:{mousedown:1,mousedrag:1,click:1,doubleclick:1},mouseup:{mouseup:1,mousedrag:1,click:1,doubleclick:1},mousemove:{mousedrag:1,mousemove:1,mouseenter:1,mouseleave:1}};return{_viewEvents:g,_handleMouseEvent:function(t,n,i){var r=this._itemEvents,o=r.native[t],h="mousemove"===t,c=this._scope.tool,d=this;function responds(t){return r.virtual[t]||d.responds(t)||c&&c.responds(t)}h&&u&&responds("mousedrag")&&(t="mousedrag"),i||(i=this.getEventPoint(n));var p=this.getBounds().contains(i),g=o&&p&&d._project.hitTest(i,{tolerance:0,fill:!0,stroke:!0}),m=g&&g.item||null,M=!1,T={};if(T[t.substr(5)]=!0,o&&m!==w&&(w&&emitMouseEvent(w,null,"mouseleave",n,i),m&&emitMouseEvent(m,null,"mouseenter",n,i),w=m),E^p&&(emitMouseEvent(this,null,p?"mouseenter":"mouseleave",n,i),M=!0),!p&&!T.drag||i.equals(_)||(emitMouseEvents(this,m,h?t:"mousemove",n,i,_),M=!0),E=p,T.down&&p||T.up&&v){if(emitMouseEvents(this,m,t,n,i,v),T.down){if(k=m===S&&Date.now()-C<300,y=S=m,!I&&m){for(var O=m;O&&!O.responds("mousedrag");)O=O._parent;O&&(x=m)}v=i}else T.up&&(I||m!==y||(C=Date.now(),emitMouseEvents(this,m,k?"doubleclick":"click",n,i,v),k=!1),y=x=null);E=!1,M=!0}_=i,M&&c&&(P=c._handleMouseEvent(t,n,i,T)||P),!1!==n.cancelable&&(P&&!T.move||T.down&&responds("mouseup"))&&n.preventDefault()},_handleKeyEvent:function(t,n,i,r){var o,h=this._scope,c=h.tool;function emit(c){c.responds(t)&&(wt=h,c.emit(t,o=o||new ct(t,n,i,r)))}this.isVisible()&&(emit(this),c&&c.responds(t)&&emit(c))},_countItemEvent:function(t,n){var i=this._itemEvents,r=i.native,o=i.virtual;for(var h in T)r[h]=(r[h]||0)+(T[h][t]||0)*n;o[t]=(o[t]||0)+n},statics:{updateFocus:updateFocus,_resetState:function(){u=d=P=E=!1,t=n=v=_=y=w=x=S=C=k=null}}}}function getView(t){var n=st.getTarget(t);return n.getAttribute&&ot._viewsById[n.getAttribute("id")]}function updateFocus(){var t=ot._focused;if(!t||!t.isVisible())for(var i=0,r=ot._views.length;i<r;i++)if((t=ot._views[i]).isVisible()){ot._focused=n=t;break}}function handleMouseMove(t,n,i){t._handleMouseEvent("mousemove",n,i)}function emitMouseEvent(t,n,i,r,o,h,c){var u,d=!1;function emit(t,i){if(t.responds(i)){if(u||(u=new dt(i,r,o,n||t,h?o.subtract(h):null)),t.emit(i,u)&&(P=!0,u.prevented&&(I=!0),u.stopped))return d=!0}else{var c=M[i];if(c)return emit(t,c)}}for(;t&&t!==c&&!emit(t,i);)t=t._parent;return d}function emitMouseEvents(t,n,i,r,o,h){return t._project.removeOn(i),I=P=!1,x&&emitMouseEvent(x,null,i,r,o,h)||n&&n!==x&&!n.isDescendant(x)&&emitMouseEvent(n,null,"mousedrag"===i?"mousemove":i,r,o,h,x)||emitMouseEvent(t,x||n||t,i,r,o,h)}}),ht=ot.extend({_class:"CanvasView",initialize:function CanvasView2(t,n){if(!(n instanceof r.HTMLCanvasElement)){var i=w.read(arguments,1);if(i.isZero())throw new Error("Cannot create CanvasView with the provided argument: "+h.slice(arguments,1));n=mt.getCanvas(i)}var o=this._context=n.getContext("2d");if(o.save(),this._pixelRatio=1,!/^off|false$/.test(u.getAttribute(n,"hidpi"))){var c=r.devicePixelRatio||1,d=rt.getPrefixed(o,"backingStorePixelRatio")||1;this._pixelRatio=c/d}ot.call(this,t,n),this._needsUpdate=!0},remove:function remove(){return this._context.restore(),remove.base.call(this)},_setElementSize:function _setElementSize(t,n){var i=this._pixelRatio;if(_setElementSize.base.call(this,t*i,n*i),1!==i){var r=this._element,o=this._context;if(!u.hasAttribute(r,"resize")){var h=r.style;h.width=t+"px",h.height=n+"px"}o.restore(),o.save(),o.scale(i,i)}},getContext:function(){return this._context},getPixelSize:function getPixelSize(t){var n,i=wt.agent;if(i&&i.firefox)n=getPixelSize.base.call(this,t);else{var r=this._context,o=r.font;r.font=t+" serif",n=parseFloat(r.font),r.font=o}return n},getTextWidth:function(t,n){var i=this._context,r=i.font,o=0;i.font=t;for(var h=0,c=n.length;h<c;h++)o=Math.max(o,i.measureText(n[h]).width);return i.font=r,o},update:function(){if(!this._needsUpdate)return!1;var t=this._project,n=this._context,i=this._viewSize;return n.clearRect(0,0,i.width+1,i.height+1),t&&t.draw(n,this._matrix,this._pixelRatio),this._needsUpdate=!1,!0}}),lt=h.extend({_class:"Event",initialize:function Event2(t){this.event=t,this.type=t&&t.type},prevented:!1,stopped:!1,preventDefault:function(){this.prevented=!0,this.event.preventDefault()},stopPropagation:function(){this.stopped=!0,this.event.stopPropagation()},stop:function(){this.stopPropagation(),this.preventDefault()},getTimeStamp:function(){return this.event.timeStamp},getModifiers:function(){return ut.modifiers}}),ct=lt.extend({_class:"KeyEvent",initialize:function KeyEvent2(t,n,i,r){this.type=t,this.event=n,this.key=i,this.character=r},toString:function(){return"{ type: '"+this.type+"', key: '"+this.key+"', character: '"+this.character+"', modifiers: "+this.getModifiers()+" }"}}),ut=new function(){var t,n,c={"\t":"tab"," ":"space","\b":"backspace","":"delete",Spacebar:"space",Del:"delete",Win:"meta",Esc:"escape"},u={tab:"\t",space:" ",enter:"\r"},d={},p={},g=new h({shift:!1,control:!1,alt:!1,meta:!1,capsLock:!1,space:!1}).inject({option:{get:function(){return this.alt}},command:{get:function(){var t=wt&&wt.agent;return t&&t.mac?this.meta:this.control}}});function getKey(t){var n=t.key||t.keyIdentifier;return n=/^U\+/.test(n)?String.fromCharCode(parseInt(n.substr(2),16)):/^Arrow[A-Z]/.test(n)?n.substr(5):"Unidentified"===n||n===i?String.fromCharCode(t.keyCode):n,c[n]||(n.length>1?h.hyphenate(n):n.toLowerCase())}function handleKey(n,i,r,o){var c,u=ot._focused;if(d[i]=n,n?p[i]=r:delete p[i],i.length>1&&(c=h.camelize(i))in g){g[c]=n;var m=wt&&wt.agent;if("meta"===c&&m&&m.mac)if(n)t={};else{for(var v in t)v in p&&handleKey(!1,v,t[v],o);t=null}}else n&&t&&(t[i]=r);u&&u._handleKeyEvent(n?"keydown":"keyup",o,i,r)}return st.add(o,{keydown:function(t){var i=getKey(t),r=wt&&wt.agent;i.length>1||r&&r.chrome&&(t.altKey||r.mac&&t.metaKey||!r.mac&&t.ctrlKey)?handleKey(!0,i,u[i]||(i.length>1?"":i),t):n=i},keypress:function(t){if(n){var i=getKey(t),r=t.charCode,o=r>=32?String.fromCharCode(r):i.length>1?"":i;i!==n&&(i=o.toLowerCase()),handleKey(!0,i,o,t),n=null}},keyup:function(t){var n=getKey(t);n in p&&handleKey(!1,n,p[n],t)}}),st.add(r,{blur:function(t){for(var n in p)handleKey(!1,n,p[n],t)}}),{modifiers:g,isDown:function(t){return!!d[t]}}},dt=lt.extend({_class:"MouseEvent",initialize:function MouseEvent2(t,n,i,r,o){this.type=t,this.event=n,this.point=i,this.target=r,this.delta=o},toString:function(){return"{ type: '"+this.type+"', point: "+this.point+", target: "+this.target+(this.delta?", delta: "+this.delta:"")+", modifiers: "+this.getModifiers()+" }"}}),pt=lt.extend({_class:"ToolEvent",_item:null,initialize:function ToolEvent2(t,n,i){this.tool=t,this.type=n,this.event=i},_choosePoint:function(t,n){return t||(n?n.clone():null)},getPoint:function(){return this._choosePoint(this._point,this.tool._point)},setPoint:function(t){this._point=t},getLastPoint:function(){return this._choosePoint(this._lastPoint,this.tool._lastPoint)},setLastPoint:function(t){this._lastPoint=t},getDownPoint:function(){return this._choosePoint(this._downPoint,this.tool._downPoint)},setDownPoint:function(t){this._downPoint=t},getMiddlePoint:function(){return!this._middlePoint&&this.tool._lastPoint?this.tool._point.add(this.tool._lastPoint).divide(2):this._middlePoint},setMiddlePoint:function(t){this._middlePoint=t},getDelta:function(){return!this._delta&&this.tool._lastPoint?this.tool._point.subtract(this.tool._lastPoint):this._delta},setDelta:function(t){this._delta=t},getCount:function(){return this.tool[/^mouse(down|up)$/.test(this.type)?"_downCount":"_moveCount"]},setCount:function(t){this.tool[/^mouse(down|up)$/.test(this.type)?"downCount":"count"]=t},getItem:function(){if(!this._item){var t=this.tool._scope.project.hitTest(this.getPoint());if(t){for(var n=t.item,i=n._parent;/^(Group|CompoundPath)$/.test(i._class);)n=i,i=i._parent;this._item=n}}return this._item},setItem:function(t){this._item=t},toString:function(){return"{ type: "+this.type+", point: "+this.getPoint()+", count: "+this.getCount()+", modifiers: "+this.getModifiers()+" }"}}),ft=d.extend({_class:"Tool",_list:"tools",_reference:"tool",_events:["onMouseDown","onMouseUp","onMouseDrag","onMouseMove","onActivate","onDeactivate","onEditOptions","onKeyDown","onKeyUp"],initialize:function Tool2(t){d.call(this),this._moveCount=-1,this._downCount=-1,this.set(t)},getMinDistance:function(){return this._minDistance},setMinDistance:function(t){this._minDistance=t,null!=t&&null!=this._maxDistance&&t>this._maxDistance&&(this._maxDistance=t)},getMaxDistance:function(){return this._maxDistance},setMaxDistance:function(t){this._maxDistance=t,null!=this._minDistance&&null!=t&&t<this._minDistance&&(this._minDistance=t)},getFixedDistance:function(){return this._minDistance==this._maxDistance?this._minDistance:null},setFixedDistance:function(t){this._minDistance=this._maxDistance=t},_handleMouseEvent:function(t,n,i,r){wt=this._scope,r.drag&&!this.responds(t)&&(t="mousemove");var o=r.move||r.drag,h=this.responds(t),c=this.minDistance,u=this.maxDistance,d=!1,p=this;function update(t,n){var h=i,c=o?p._point:p._downPoint||h;if(o){if(p._moveCount>=0&&h.equals(c))return!1;if(c&&(null!=t||null!=n)){var u=h.subtract(c),d=u.getLength();if(d<(t||0))return!1;n&&(h=c.add(u.normalize(Math.min(d,n))))}p._moveCount++}return p._point=h,p._lastPoint=c||h,r.down&&(p._moveCount=-1,p._downPoint=h,p._downCount++),!0}function emit(){h&&(d=p.emit(t,new pt(p,t,n))||d)}if(r.down)update(),emit();else if(r.up)update(null,u),emit();else if(h)for(;update(c,u);)emit();return d}}),gt=h.extend(c,{_class:"Tween",statics:{easings:new h({linear:function(t){return t},easeInQuad:function(t){return t*t},easeOutQuad:function(t){return t*(2-t)},easeInOutQuad:function(t){return t<.5?2*t*t:2*(2-t)*t-1},easeInCubic:function(t){return t*t*t},easeOutCubic:function(t){return--t*t*t+1},easeInOutCubic:function(t){return t<.5?4*t*t*t:(t-1)*(2*t-2)*(2*t-2)+1},easeInQuart:function(t){return t*t*t*t},easeOutQuart:function(t){return 1- --t*t*t*t},easeInOutQuart:function(t){return t<.5?8*t*t*t*t:1-8*--t*t*t*t},easeInQuint:function(t){return t*t*t*t*t},easeOutQuint:function(t){return 1+--t*t*t*t*t},easeInOutQuint:function(t){return t<.5?16*t*t*t*t*t:1+16*--t*t*t*t*t}})},initialize:function Tween2(t,n,i,r,o,h){this.object=t;var c=typeof o,u="function"===c;this.type=u?c:"string"===c?o:"linear",this.easing=u?o:Tween2.easings[this.type],this.duration=r,this.running=!1,this._then=null,this._startTime=null;var d=n||i;this._keys=d?Object.keys(d):[],this._parsedKeys=this._parseKeys(this._keys),this._from=d&&this._getState(n),this._to=d&&this._getState(i),!1!==h&&this.start()},then:function(t){return this._then=t,this},start:function(){return this._startTime=null,this.running=!0,this},stop:function(){return this.running=!1,this},update:function(t){if(this.running){t>=1&&(t=1,this.running=!1);for(var n=this.easing(t),i=this._keys,getValue=function(i){return"function"==typeof i?i(n,t):i},r=0,o=i&&i.length;r<o;r++){var c=i[r],u=getValue(this._from[c]),d=getValue(this._to[c]),p=u&&d&&u.__add&&d.__add?d.__subtract(u).__multiply(n).__add(u):(d-u)*n+u;this._setProperty(this._parsedKeys[c],p)}this.responds("update")&&this.emit("update",new h({progress:t,factor:n})),!this.running&&this._then&&this._then(this.object)}return this},_events:{onUpdate:{}},_handleFrame:function(t){var n=this._startTime,i=n?(t-n)/this.duration:0;n||(this._startTime=t),this.update(i)},_getState:function(t){for(var n=this._keys,i={},r=0,o=n.length;r<o;r++){var h,c=n[r],u=this._parsedKeys[c],d=this._getProperty(u);if(t){var p=this._resolveValue(d,t[c]);this._setProperty(u,p),h=(h=this._getProperty(u))&&h.clone?h.clone():h,this._setProperty(u,d)}else h=d&&d.clone?d.clone():d;i[c]=h}return i},_resolveValue:function(t,n){if(n){if(Array.isArray(n)&&2===n.length){var i=n[0];return i&&i.match&&i.match(/^[+\-\*\/]=/)?this._calculate(t,i[0],n[1]):n}if("string"==typeof n){var r=n.match(/^[+\-*/]=(.*)/);if(r){var o=JSON.parse(r[1].replace(/(['"])?([a-zA-Z0-9_]+)(['"])?:/g,'"$2": '));return this._calculate(t,n[0],o)}}}return n},_calculate:function(t,n,i){return wt.PaperScript.calculateBinary(t,n,i)},_parseKeys:function(t){for(var n={},i=0,r=t.length;i<r;i++){var o=t[i],h=o.replace(/\.([^.]*)/g,"/$1").replace(/\[['"]?([^'"\]]*)['"]?\]/g,"/$1");n[o]=h.split("/")}return n},_getProperty:function(t,n){for(var i=this.object,r=0,o=t.length-(n||0);r<o&&i;r++)i=i[t[r]];return i},_setProperty:function(t,n){var i=this._getProperty(t,1);i&&(i[t[t.length-1]]=n)}}),Http_request=function(n){var i=new t.XMLHttpRequest;return i.open((n.method||"get").toUpperCase(),n.url,h.pick(n.async,!0)),n.mimeType&&i.overrideMimeType(n.mimeType),i.onload=function(){var t=i.status;0===t||200===t?n.onLoad&&n.onLoad.call(i,i.responseText):i.onerror()},i.onerror=function(){var t=i.status,r='Could not load "'+n.url+'" (Status: '+t+")";if(!n.onError)throw new Error(r);n.onError(r,t)},i.send(null)},mt=h.exports.CanvasProvider={canvases:[],getCanvas:function(t,n,i){if(!r)return null;var h,c=!0;"object"==typeof t&&(n=t.height,t=t.width),this.canvases.length?h=this.canvases.pop():(h=o.createElement("canvas"),c=!1);var u=h.getContext("2d",i||{});if(!u)throw new Error("Canvas "+h+" is unable to provide a 2D context.");return h.width===t&&h.height===n?c&&u.clearRect(0,0,t+1,n+1):(h.width=t,h.height=n),u.save(),h},getContext:function(t,n,i){var r=this.getCanvas(t,n,i);return r?r.getContext("2d",i||{}):null},release:function(t){var n=t&&t.canvas?t.canvas:t;n&&n.getContext&&(n.getContext("2d").restore(),this.canvases.push(n))}},vt=new function(){var t,n,i,r,o,c,u,d,p,g,m,v=Math.min,_=Math.max,y=Math.abs;function getLum(t,n,i){return.2989*t+.587*n+.114*i}function setLum(t,n,i,r){var o=r-getLum(t,n,i),h=(r=getLum(p=t+o,g=n+o,m=i+o),v(p,g,m)),c=_(p,g,m);if(h<0){var u=r-h;p=r+(p-r)*r/u,g=r+(g-r)*r/u,m=r+(m-r)*r/u}if(c>255){var d=255-r,y=c-r;p=r+(p-r)*d/y,g=r+(g-r)*d/y,m=r+(m-r)*d/y}}function getSat(t,n,i){return _(t,n,i)-v(t,n,i)}function setSat(t,n,i,r){var o,h=[t,n,i],c=_(t,n,i),u=v(t,n,i);o=0===v(u=u===t?0:u===n?1:2,c=c===t?0:c===n?1:2)?1===_(u,c)?2:1:0,h[c]>h[u]?(h[o]=(h[o]-h[u])*r/(h[c]-h[u]),h[c]=r):h[o]=h[c]=0,h[u]=0,p=h[0],g=h[1],m=h[2]}var w={multiply:function(){p=o*t/255,g=c*n/255,m=u*i/255},screen:function(){p=o+t-o*t/255,g=c+n-c*n/255,m=u+i-u*i/255},overlay:function(){p=o<128?2*o*t/255:255-2*(255-o)*(255-t)/255,g=c<128?2*c*n/255:255-2*(255-c)*(255-n)/255,m=u<128?2*u*i/255:255-2*(255-u)*(255-i)/255},"soft-light":function(){var r=t*o/255;p=r+o*(255-(255-o)*(255-t)/255-r)/255,g=(r=n*c/255)+c*(255-(255-c)*(255-n)/255-r)/255,m=(r=i*u/255)+u*(255-(255-u)*(255-i)/255-r)/255},"hard-light":function(){p=t<128?2*t*o/255:255-2*(255-t)*(255-o)/255,g=n<128?2*n*c/255:255-2*(255-n)*(255-c)/255,m=i<128?2*i*u/255:255-2*(255-i)*(255-u)/255},"color-dodge":function(){p=0===o?0:255===t?255:v(255,255*o/(255-t)),g=0===c?0:255===n?255:v(255,255*c/(255-n)),m=0===u?0:255===i?255:v(255,255*u/(255-i))},"color-burn":function(){p=255===o?255:0===t?0:_(0,255-255*(255-o)/t),g=255===c?255:0===n?0:_(0,255-255*(255-c)/n),m=255===u?255:0===i?0:_(0,255-255*(255-u)/i)},darken:function(){p=o<t?o:t,g=c<n?c:n,m=u<i?u:i},lighten:function(){p=o>t?o:t,g=c>n?c:n,m=u>i?u:i},difference:function(){(p=o-t)<0&&(p=-p),(g=c-n)<0&&(g=-g),(m=u-i)<0&&(m=-m)},exclusion:function(){p=o+t*(255-o-o)/255,g=c+n*(255-c-c)/255,m=u+i*(255-u-u)/255},hue:function(){setSat(t,n,i,getSat(o,c,u)),setLum(p,g,m,getLum(o,c,u))},saturation:function(){setSat(o,c,u,getSat(t,n,i)),setLum(p,g,m,getLum(o,c,u))},luminosity:function(){setLum(o,c,u,getLum(t,n,i))},color:function(){setLum(t,n,i,getLum(o,c,u))},add:function(){p=v(o+t,255),g=v(c+n,255),m=v(u+i,255)},subtract:function(){p=_(o-t,0),g=_(c-n,0),m=_(u-i,0)},average:function(){p=(o+t)/2,g=(c+n)/2,m=(u+i)/2},negation:function(){p=255-y(255-t-o),g=255-y(255-n-c),m=255-y(255-i-u)}},x=this.nativeModes=h.each(["source-over","source-in","source-out","source-atop","destination-over","destination-in","destination-out","destination-atop","lighter","darker","copy","xor"],(function(t){this[t]=!0}),{}),S=mt.getContext(1,1,{willReadFrequently:!0});S&&(h.each(w,(function(t,n){var i="darken"===n,r=!1;S.save();try{S.fillStyle=i?"#300":"#a00",S.fillRect(0,0,1,1),S.globalCompositeOperation=n,S.globalCompositeOperation===n&&(S.fillStyle=i?"#a00":"#300",S.fillRect(0,0,1,1),r=S.getImageData(0,0,1,1).data[0]!==i?170:51)}catch(dr){}S.restore(),x[n]=r})),mt.release(S)),this.process=function(h,v,_,y,S){var C=v.canvas,k="normal"===h;if(k||x[h])_.save(),_.setTransform(1,0,0,1,0,0),_.globalAlpha=y,k||(_.globalCompositeOperation=h),_.drawImage(C,S.x,S.y),_.restore();else{var P=w[h];if(!P)return;for(var I=_.getImageData(S.x,S.y,C.width,C.height),M=I.data,E=v.getImageData(0,0,C.width,C.height).data,T=0,O=M.length;T<O;T+=4){t=E[T],o=M[T],n=E[T+1],c=M[T+1],i=E[T+2],u=M[T+2],r=E[T+3],d=M[T+3],P();var D=r*y/255,N=1-D;M[T]=D*p+N*o,M[T+1]=D*g+N*c,M[T+2]=D*m+N*u,M[T+3]=r*y+N*d}_.putImageData(I,S.x,S.y)}}},_t=new function(){var t="http://www.w3.org/2000/svg",n="http://www.w3.org/2000/xmlns",i="http://www.w3.org/1999/xlink",r={href:i,xlink:n,xmlns:n+"/","xmlns:xlink":n+"/"};function set(t,n,i){for(var o in n){var h=n[o],c=r[o];"number"==typeof h&&i&&(h=i.number(h)),c?t.setAttributeNS(c,o,h):t.setAttribute(o,h)}return t}return{svg:t,xmlns:n,xlink:i,create:function create2(n,i,r){return set(o.createElementNS(t,n),i,r)},get:function get(t,n){var i=r[n],o=i?t.getAttributeNS(i,n):t.getAttribute(n);return"null"===o?null:o},set:set}},yt=h.each({fillColor:["fill","color"],fillRule:["fill-rule","string"],strokeColor:["stroke","color"],strokeWidth:["stroke-width","number"],strokeCap:["stroke-linecap","string"],strokeJoin:["stroke-linejoin","string"],strokeScaling:["vector-effect","lookup",{true:"none",false:"non-scaling-stroke"},function(t,n){return!n&&(t instanceof W||t instanceof O||t instanceof Z)}],miterLimit:["stroke-miterlimit","number"],dashArray:["stroke-dasharray","array"],dashOffset:["stroke-dashoffset","number"],fontFamily:["font-family","string"],fontWeight:["font-weight","string"],fontSize:["font-size","number"],justification:["text-anchor","lookup",{left:"start",center:"middle",right:"end"}],opacity:["opacity","number"],blendMode:["mix-blend-mode","style"]},(function(t,n){var i=h.capitalize(n),r=t[2];this[n]={type:t[1],property:n,attribute:t[0],toSVG:r,fromSVG:r&&h.each(r,(function(t,n){this[t]=n}),{}),exportFilter:t[3],get:"get"+i,set:"set"+i}}),{});new function(){var n;function getTransform(t,i,r){var o,c=new h,u=t.getTranslation();i&&(t.isInvertible()?(o=(t=t._shiftless())._inverseTransform(u),u=null):o=new _,c[r?"cx":"x"]=o.x,c[r?"cy":"y"]=o.y);if(!t.isIdentity()){var d=t.decompose();if(d){var p=[],g=d.rotation,v=d.scaling,y=d.skewing;u&&!u.isZero()&&p.push("translate("+n.point(u)+")"),g&&p.push("rotate("+n.number(g)+")"),m.isZero(v.x-1)&&m.isZero(v.y-1)||p.push("scale("+n.point(v)+")"),y.x&&p.push("skewX("+n.number(y.x)+")"),y.y&&p.push("skewY("+n.number(y.y)+")"),c.transform=p.join(" ")}else c.transform="matrix("+t.getValues().join(",")+")"}return c}function exportGroup(t,i){for(var r=getTransform(t._matrix),o=t._children,h=_t.create("g",r,n),c=0,u=o.length;c<u;c++){var d=o[c],p=exportSVG(d,i);if(p)if(d.isClipMask()){var g=_t.create("clipPath");g.appendChild(p),setDefinition(d,g,"clip"),_t.set(h,{"clip-path":"url(#"+g.id+")"})}else h.appendChild(p)}return h}function exportShape(t){var i=t._type,r=t._radius,o=getTransform(t._matrix,!0,"rectangle"!==i);if("rectangle"===i){i="rect";var h=t._size,c=h.width,u=h.height;o.x-=c/2,o.y-=u/2,o.width=c,o.height=u,r.isZero()&&(r=null)}return r&&("circle"===i?o.r=r:(o.rx=r.width,o.ry=r.height)),_t.create(i,o,n)}var i,r={Group:exportGroup,Layer:exportGroup,Raster:function exportRaster(t,i){var r=getTransform(t._matrix,!0),o=t.getSize(),h=t.getImage();return r.x-=o.width/2,r.y-=o.height/2,r.width=o.width,r.height=o.height,r.href=0==i.embedImages&&h&&h.src||t.toDataURL(),_t.create("image",r,n)},Path:function exportPath(t,i){var r=i.matchShapes;if(r){var o=t.toShape(!1);if(o)return exportShape(o)}var h,c=t._segments,u=c.length,d=getTransform(t._matrix);if(r&&u>=2&&!t.hasHandles())if(u>2){h=t._closed?"polygon":"polyline";for(var p=[],g=0;g<u;g++)p.push(n.point(c[g]._point));d.points=p.join(" ")}else{h="line";var m=c[0]._point,v=c[1]._point;d.set({x1:m.x,y1:m.y,x2:v.x,y2:v.y})}else h="path",d.d=t.getPathData(null,i.precision);return _t.create(h,d,n)},Shape:exportShape,CompoundPath:function exportCompoundPath(t,i){var r=getTransform(t._matrix),o=t.getPathData(null,i.precision);return o&&(r.d=o),_t.create("path",r,n)},SymbolItem:function exportSymbolItem(t,i){var r=getTransform(t._matrix,!0),o=t._definition,h=getDefinition(o,"symbol"),c=o._item,u=c.getStrokeBounds();return h||((h=_t.create("symbol",{viewBox:n.rectangle(u)})).appendChild(exportSVG(c,i)),setDefinition(o,h,"symbol")),r.href="#"+h.id,r.x+=u.x,r.y+=u.y,r.width=u.width,r.height=u.height,r.overflow="visible",_t.create("use",r,n)},PointText:function exportText(t){var i=_t.create("text",getTransform(t._matrix,!0),n);return i.textContent=t._content,i}};function applyStyle(t,i,r){var o={},c=!r&&t.getParent(),u=[];return null!=t._name&&(o.id=t._name),h.each(yt,(function(i){var r=i.get,d=i.type,p=t[r]();if(i.exportFilter?i.exportFilter(t,p):!c||!h.equals(c[r](),p)){if("color"===d&&null!=p){var g=p.getAlpha();g<1&&(o[i.attribute+"-opacity"]=g)}"style"===d?u.push(i.attribute+": "+p):o[i.attribute]=null==p?"none":"color"===d?p.gradient?function exportGradient(t){var i=getDefinition(t,"color");if(!i){var r,o=t.getGradient(),h=o._radial,c=t.getOrigin(),u=t.getDestination();if(h){r={cx:c.x,cy:c.y,r:c.getDistance(u)};var d=t.getHighlight();d&&(r.fx=d.x,r.fy=d.y)}else r={x1:c.x,y1:c.y,x2:u.x,y2:u.y};r.gradientUnits="userSpaceOnUse",i=_t.create((h?"radial":"linear")+"Gradient",r,n);for(var p=o._stops,g=0,m=p.length;g<m;g++){var v=p[g],_=v._color,y=_.getAlpha(),w=v._offset;r={offset:null==w?g/(m-1):w},_&&(r["stop-color"]=_.toCSS(!0)),y<1&&(r["stop-opacity"]=y),i.appendChild(_t.create("stop",r,n))}setDefinition(t,i,"color")}return"url(#"+i.id+")"}(p):p.toCSS(!0):"array"===d?p.join(","):"lookup"===d?i.toSVG[p]:p}})),u.length&&(o.style=u.join(";")),1===o.opacity&&delete o.opacity,t._visible||(o.visibility="hidden"),_t.set(i,o,n)}function getDefinition(t,n){return i||(i={ids:{},svgs:{}}),t&&i.svgs[n+"-"+(t._id||t.__id||(t.__id=v.get("svg")))]}function setDefinition(t,n,r){i||getDefinition();var o=i.ids[r]=(i.ids[r]||0)+1;n.id=r+"-"+o,i.svgs[r+"-"+(t._id||t.__id)]=n}function exportDefinitions(n,r){var o=n,h=null;if(i){for(var c in o="svg"===n.nodeName.toLowerCase()&&n,i.svgs)h||(o||(o=_t.create("svg")).appendChild(n),h=o.insertBefore(_t.create("defs"),o.firstChild)),h.appendChild(i.svgs[c]);i=null}return r.asString?(new t.XMLSerializer).serializeToString(o):o}function exportSVG(t,n,i){var o=r[t._class],h=o&&o(t,n);if(h){var c=n.onExport;c&&(h=c(t,h,n)||h);var u=JSON.stringify(t._data);u&&"{}"!==u&&"null"!==u&&h.setAttribute("data-paper-data",u)}return h&&applyStyle(t,h,i)}function setOptions(t){return t||(t={}),n=new g(t.precision),t}M.inject({exportSVG:function(t){return exportDefinitions(exportSVG(this,t=setOptions(t),!0),t)}}),I.inject({exportSVG:function(t){t=setOptions(t);var i=this._children,r=this.getView(),o=h.pick(t.bounds,"view"),c=t.matrix||"view"===o&&r._matrix,u=c&&k.read([c]),d="view"===o?new S([0,0],r.getViewSize()):"content"===o?M._getBounds(i,u,{stroke:!0}).rect:S.read([o],0,{readNull:!0}),p={version:"1.1",xmlns:_t.svg,"xmlns:xlink":_t.xlink};d&&(p.width=d.width,p.height=d.height,(d.x||0===d.x||d.y||0===d.y)&&(p.viewBox=n.rectangle(d)));var g=_t.create("svg",p,n),m=g;u&&!u.isIdentity()&&(m=g.appendChild(_t.create("g",getTransform(u),n)));for(var v=0,_=i.length;v<_;v++)m.appendChild(exportSVG(i[v],t,!0));return exportDefinitions(g,t)}})},new function(){var n,c={};function getValue(t,i,r,o,h,c){var u=_t.get(t,i)||c,d=null==u?o?null:r?"":0:r?u:parseFloat(u);return/%\s*$/.test(u)?d/100*(h?1:n[/x|^width/.test(i)?"width":"height"]):d}function getPoint(t,n,i,r,o,h,c){return n=getValue(t,n||"x",!1,r,o,h),i=getValue(t,i||"y",!1,r,o,c),!r||null!=n&&null!=i?new _(n,i):null}function getSize(t,n,i,r,o){return n=getValue(t,n||"width",!1,r,o),i=getValue(t,i||"height",!1,r,o),!r||null!=n&&null!=i?new w(n,i):null}function convertValue(t,n,i){return"none"===t?null:"number"===n?parseFloat(t):"array"===n?t?t.split(/[\s,]+/g).map(parseFloat):[]:"color"===n?getDefinition(t)||t:"lookup"===n?i[t]:t}function importGroup(t,n,i,r){var o=t.childNodes,h="clippath"===n,c="defs"===n,u=new E,d=u._project,p=d._currentStyle,g=[];if(h||c||(u=applyAttributes(u,t,r),d._currentStyle=u._style.clone()),r)for(var m=t.querySelectorAll("defs"),v=0,_=m.length;v<_;v++)importNode(m[v],i,!1);for(v=0,_=o.length;v<_;v++){var y,w=o[v];1!==w.nodeType||/^defs$/i.test(w.nodeName)||!(y=importNode(w,i,!1))||y instanceof j||g.push(y)}return u.addChildren(g),h&&(u=applyAttributes(u.reduce(),t,r)),d._currentStyle=p,(h||c)&&(u.remove(),u=null),u}function importPoly(t,n){for(var i=t.getAttribute("points").match(/[+-]?(?:\d*\.\d+|\d+\.?)(?:[eE][+-]?\d+)?/g),r=[],o=0,h=i.length;o<h;o+=2)r.push(new _(parseFloat(i[o]),parseFloat(i[o+1])));var c=new Y(r);return"polygon"===n&&c.closePath(),c}function importGradient(t,n){var i,r=(getValue(t,"href",!0)||"").substring(1),o="radialgradient"===n;if(r)(i=c[r].getGradient())._radial^o&&((i=i.clone())._radial=o);else{for(var h=t.childNodes,u=[],d=0,p=h.length;d<p;d++){var g=h[d];1===g.nodeType&&u.push(applyAttributes(new nt,g))}i=new et(u,o)}var m,v,_,y="userSpaceOnUse"!==getValue(t,"gradientUnits",!0);return o?(v=(m=getPoint(t,"cx","cy",!1,y,"50%","50%")).add(getValue(t,"r",!1,!1,y,"50%"),0),_=getPoint(t,"fx","fy",!0,y)):(m=getPoint(t,"x1","y1",!1,y,"0%","0%"),v=getPoint(t,"x2","y2",!1,y,"100%","0%")),applyAttributes(new tt(i,m,v,_),t)._scaleToBounds=y,null}var u={"#document":function(t,n,i,r){for(var o=t.childNodes,h=0,c=o.length;h<c;h++){var u=o[h];if(1===u.nodeType)return importNode(u,i,r)}},g:importGroup,svg:importGroup,clippath:importGroup,polygon:importPoly,polyline:importPoly,path:function importPath(t){return W.create(t.getAttribute("d"))},lineargradient:importGradient,radialgradient:importGradient,image:function(t){var n=new D(getValue(t,"href",!0));return n.on("load",(function(){var n=getSize(t);this.setSize(n);var i=getPoint(t).add(n.divide(2));this._matrix.append((new k).translate(i))})),n},symbol:function(t,n,i,r){return new j(importGroup(t,n,i,r),!0)},defs:importGroup,use:function(t){var n=(getValue(t,"href",!0)||"").substring(1),i=c[n],r=getPoint(t);return i?i instanceof j?i.place(r):i.clone().translate(r):null},circle:function(t){return new O.Circle(getPoint(t,"cx","cy"),getValue(t,"r"))},ellipse:function(t){return new O.Ellipse({center:getPoint(t,"cx","cy"),radius:getSize(t,"rx","ry")})},rect:function(t){return new O.Rectangle(new S(getPoint(t),getSize(t)),getSize(t,"rx","ry"))},line:function(t){return new Y.Line(getPoint(t,"x1","y1"),getPoint(t,"x2","y2"))},text:function(t){var n=new Q(getPoint(t).add(getPoint(t,"dx","dy")));return n.setContent(t.textContent.trim()||""),n},switch:importGroup};function applyTransform(t,n,i,r){if(t.transform){for(var o=(r.getAttribute(i)||"").split(/\)\s*/g),h=new k,c=0,u=o.length;c<u;c++){var d=o[c];if(!d)break;for(var p=d.split(/\(\s*/),g=p[0],m=p[1].split(/[\s,]+/g),v=0,_=m.length;v<_;v++)m[v]=parseFloat(m[v]);switch(g){case"matrix":h.append(new k(m[0],m[1],m[2],m[3],m[4],m[5]));break;case"rotate":h.rotate(m[0],m[1]||0,m[2]||0);break;case"translate":h.translate(m[0],m[1]||0);break;case"scale":h.scale(m);break;case"skewX":h.skew(m[0],0);break;case"skewY":h.skew(0,m[0])}}t.transform(h)}}function applyOpacity(t,n,i){var r="fill-opacity"===i?"getFillColor":"getStrokeColor",o=t[r]&&t[r]();o&&o.setAlpha(parseFloat(n))}var d=h.set(h.each(yt,(function(t){this[t.attribute]=function(n,i){if(n[t.set]&&(n[t.set](convertValue(i,t.type,t.fromSVG)),"color"===t.type)){var r=n[t.get]();if(r&&r._scaleToBounds){var o=n.getBounds();r.transform((new k).translate(o.getPoint()).scale(o.getSize()))}}}}),{}),{id:function(t,n){c[n]=t,t.setName&&t.setName(n)},"clip-path":function(t,n){var i=getDefinition(n);if(i){if((i=i.clone()).setClipMask(!0),!(t instanceof E))return new E(i,t);t.insertChild(0,i)}},gradientTransform:applyTransform,transform:applyTransform,"fill-opacity":applyOpacity,"stroke-opacity":applyOpacity,visibility:function(t,n){t.setVisible&&t.setVisible("visible"===n)},display:function(t,n){t.setVisible&&t.setVisible(null!==n)},"stop-color":function(t,n){t.setColor&&t.setColor(n)},"stop-opacity":function(t,n){t._color&&t._color.setAlpha(parseFloat(n))},offset:function(t,n){if(t.setOffset){var i=n.match(/(.*)%$/);t.setOffset(i?i[1]/100:parseFloat(n))}},viewBox:function(t,n,i,r,o){var h,c=new S(convertValue(n,"array")),u=getSize(r,null,null,!0);if(t instanceof E){var d=u?u.divide(c.getSize()):1,p=(new k).scale(d).translate(c.getPoint().negate());h=t}else t instanceof j&&(u&&c.setSize(u),h=t._item);if(h){if("visible"!==getAttribute(r,"overflow",o)){var g=new O.Rectangle(c);g.setClipMask(!0),h.addChild(g)}p&&h.transform(p)}}});function getAttribute(t,n,r){var o=t.attributes[n],c=o&&o.value;if(!c&&t.style){var u=h.camelize(n);(c=t.style[u])||r.node[u]===r.parent[u]||(c=r.node[u])}return c?"none"===c?null:c:i}function applyAttributes(t,n,r){var o=n.parentNode,c={node:rt.getStyles(n)||{},parent:!r&&!/^defs$/i.test(o.tagName)&&rt.getStyles(o)||{}};return h.each(d,(function(r,o){var h=getAttribute(n,o,c);t=h!==i&&r(t,h,o,n,c)||t})),t}function getDefinition(t){var n=t&&t.match(/\((?:["'#]*)([^"')]+)/),i=n&&n[1],o=i&&c[r?i.replace(r.location.href.split("#")[0]+"#",""):i];return o&&o._scaleToBounds&&((o=o.clone())._scaleToBounds=!0),o}function importNode(t,i,r){var d,p,g,m=t.nodeName.toLowerCase(),v="#document"!==m,_=o.body;r&&v&&(n=wt.getView().getSize(),n=getSize(t,null,null,!0)||n,d=_t.create("svg",{style:"stroke-width: 1px; stroke-miterlimit: 10"}),p=t.parentNode,g=t.nextSibling,d.appendChild(t),_.appendChild(d));var y=wt.settings,w=y.applyMatrix,x=y.insertItems;y.applyMatrix=!1,y.insertItems=!1;var S=u[m],C=S&&S(t,m,i,r)||null;if(y.insertItems=x,y.applyMatrix=w,C){!v||C instanceof E||(C=applyAttributes(C,t,r));var k=i.onImport,P=v&&t.getAttribute("data-paper-data");k&&(C=k(t,C,i)||C),i.expandShapes&&C instanceof O&&(C.remove(),C=C.toPath()),P&&(C._data=JSON.parse(P))}return d&&(_.removeChild(d),p&&(g?p.insertBefore(t,g):p.appendChild(t))),r&&(c={},C&&h.pick(i.applyMatrix,w)&&C.matrix.apply(!0,!0)),C}function importSVG(n,r,h){if(!n)return null;r="function"==typeof r?{onLoad:r}:r||{};var c=wt,u=null;function onLoad(o){try{var d="object"==typeof o?o:(new t.DOMParser).parseFromString(o.trim(),"image/svg+xml");if(!d.nodeName)throw d=null,new Error("Unsupported SVG source: "+n);wt=c,u=importNode(d,r,!0),r&&!1===r.insert||h._insertItem(i,u);var p=r.onLoad;p&&p(u,o)}catch(dr){onError(dr)}}function onError(t,n){var i=r.onError;if(!i)throw new Error(t);i(t,n)}if("string"!=typeof n||/^[\s\S]*</.test(n)){if("undefined"!=typeof File&&n instanceof File){var d=new FileReader;return d.onload=function(){onLoad(d.result)},d.onerror=function(){onError(d.error)},d.readAsText(n)}onLoad(n)}else{var p=o.getElementById(n);p?onLoad(p):Http_request({url:n,async:!0,onLoad:onLoad,onError:onError})}return u}M.inject({importSVG:function(t,n){return importSVG(t,n,this)}}),I.inject({importSVG:function(t,n){return this.activate(),importSVG(t,n,this)}})},h.exports.PaperScript=function(){var n,i,c=this,d=c.acorn;if(!d&&void 0!==ve)try{d=ye()}catch(dr){}d||(d=n=i={},function(t,r){"object"==typeof n&&"object"==typeof i?r(n):"function"==typeof define&&define.amd?define(["exports"],r):r(t.acorn||(t.acorn={}))}(this,(function(t){var n,i,r,o;t.version="0.5.0",t.parse=function(t,o){return i=String(t),r=i.length,setOptions(o),initTokenState(),function parseTopLevel(t){x=S=c,n.locations&&(C=new line_loc_t);k=I=null,P=[],readToken();var i=t||startNode(),r=!0;t||(i.body=[]);for(;m!==j;){var o=parseStatement();i.body.push(o),r&&isUseStrict(o)&&setStrict(!0),r=!1}return finishNode(i,"Program")}(n.program)};var h=t.defaultOptions={ecmaVersion:5,strictSemicolons:!1,allowTrailingCommas:!0,forbidReserved:!1,allowReturnOutsideFunction:!1,locations:!1,onComment:null,ranges:!1,program:null,sourceFile:null,directSourceFile:null};function setOptions(t){for(var i in n=t||{},h)Object.prototype.hasOwnProperty.call(n,i)||(n[i]=h[i]);o=n.sourceFile||null}var c,u,d,p,g,m,v,_,y,w,x,S,C,k,P,I,M=t.getLineInfo=function(t,n){for(var i=1,r=0;;){Qt.lastIndex=r;var o=Qt.exec(t);if(!(o&&o.index<n))break;++i,r=o.index+o[0].length}return{line:i,column:n-r}};function raise(t,n){var r=M(i,t);n+=" ("+r.line+":"+r.column+")";var o=new SyntaxError(n);throw o.pos=t,o.loc=r,o.raisedAt=c,o}t.tokenize=function(t,o){i=String(t),r=i.length,setOptions(o),initTokenState();var h={};function getToken(t){return S=d,readToken(t),h.start=u,h.end=d,h.startLoc=p,h.endLoc=g,h.type=m,h.value=v,h}return getToken.jumpTo=function(t,r){var o;if(c=t,n.locations)for(y=1,w=Qt.lastIndex=0;(o=Qt.exec(i))&&o.index<t;)++y,w=o.index+o[0].length;_=r,skipSpace()},getToken};var E=[],T={type:"num"},O={type:"regexp"},D={type:"string"},N={type:"name"},j={type:"eof"},V={keyword:"break"},U={keyword:"case",beforeExpr:!0},z={keyword:"catch"},F={keyword:"continue"},q={keyword:"debugger"},W={keyword:"default"},Y={keyword:"do",isLoop:!0},H={keyword:"else",beforeExpr:!0},X={keyword:"finally"},J={keyword:"for",isLoop:!0},Z={keyword:"function"},Q={keyword:"if"},tt={keyword:"return",beforeExpr:!0},et={keyword:"switch"},nt={keyword:"throw",beforeExpr:!0},it={keyword:"try"},rt={keyword:"var"},st={keyword:"while",isLoop:!0},ot={keyword:"with"},ht={keyword:"new",beforeExpr:!0},lt={keyword:"this"},ct={keyword:"null",atomValue:null},ut={keyword:"true",atomValue:!0},dt={keyword:"false",atomValue:!1},pt={keyword:"in",binop:7,beforeExpr:!0},ft={break:V,case:U,catch:z,continue:F,debugger:q,default:W,do:Y,else:H,finally:X,for:J,function:Z,if:Q,return:tt,switch:et,throw:nt,try:it,var:rt,while:st,with:ot,null:ct,true:ut,false:dt,new:ht,in:pt,instanceof:{keyword:"instanceof",binop:7,beforeExpr:!0},this:lt,typeof:{keyword:"typeof",prefix:!0,beforeExpr:!0},void:{keyword:"void",prefix:!0,beforeExpr:!0},delete:{keyword:"delete",prefix:!0,beforeExpr:!0}},gt={type:"[",beforeExpr:!0},mt={type:"]"},vt={type:"{",beforeExpr:!0},_t={type:"}"},yt={type:"(",beforeExpr:!0},wt={type:")"},bt={type:",",beforeExpr:!0},xt={type:";",beforeExpr:!0},St={type:":",beforeExpr:!0},Ct={type:"."},kt={type:"?",beforeExpr:!0},Pt={binop:10,beforeExpr:!0},It={isAssign:!0,beforeExpr:!0},Mt={isAssign:!0,beforeExpr:!0},Et={postfix:!0,prefix:!0,isUpdate:!0},At={prefix:!0,beforeExpr:!0},Tt={binop:1,beforeExpr:!0},Ot={binop:2,beforeExpr:!0},Lt={binop:3,beforeExpr:!0},Dt={binop:4,beforeExpr:!0},Nt={binop:5,beforeExpr:!0},Rt={binop:6,beforeExpr:!0},jt={binop:7,beforeExpr:!0},Vt={binop:8,beforeExpr:!0},Ut={binop:9,prefix:!0,beforeExpr:!0},zt={binop:10,beforeExpr:!0};for(var Bt in t.tokTypes={bracketL:gt,bracketR:mt,braceL:vt,braceR:_t,parenL:yt,parenR:wt,comma:bt,semi:xt,colon:St,dot:Ct,question:kt,slash:Pt,eq:It,name:N,eof:j,num:T,regexp:O,string:D},ft)t.tokTypes["_"+Bt]=ft[Bt];function makePredicate(t){t=t.split(" ");var n="",i=[];t:for(var r=0;r<t.length;++r){for(var o=0;o<i.length;++o)if(i[o][0].length==t[r].length){i[o].push(t[r]);continue t}i.push([t[r]])}function compareTo(t){if(1==t.length)return n+="return str === "+JSON.stringify(t[0])+";";n+="switch(str){";for(var i=0;i<t.length;++i)n+="case "+JSON.stringify(t[i])+":";n+="return true}return false;"}if(i.length>3){i.sort((function(t,n){return n.length-t.length})),n+="switch(str.length){";for(r=0;r<i.length;++r){var h=i[r];n+="case "+h[0].length+":",compareTo(h)}n+="}"}else compareTo(t);return new Function("str",n)}var Ft,qt=makePredicate("abstract boolean byte char class double enum export extends final float goto implements import int interface long native package private protected public short static super synchronized throws transient volatile"),Wt=makePredicate("class enum extends super const export import"),Yt=makePredicate("implements interface let package private protected public static yield"),Ht=makePredicate("eval arguments"),Kt=makePredicate("break case catch continue debugger default do else finally for function if return switch throw try var while with null true false instanceof typeof void delete new in this"),$t=/[\u1680\u180e\u2000-\u200a\u202f\u205f\u3000\ufeff]/,Gt="ªµºÀ-ÖØ-öø-ˁˆ-ˑˠ-ˤˬˮͰ-ʹͶͷͺ-ͽΆΈ-ΊΌΎ-ΡΣ-ϵϷ-ҁҊ-ԧԱ-Ֆՙա-ևא-תװ-ײؠ-يٮٯٱ-ۓەۥۦۮۯۺ-ۼۿܐܒ-ܯݍ-ޥޱߊ-ߪߴߵߺࠀ-ࠕࠚࠤࠨࡀ-ࡘࢠࢢ-ࢬऄ-हऽॐक़-ॡॱ-ॷॹ-ॿঅ-ঌএঐও-নপ-রলশ-হঽৎড়ঢ়য়-ৡৰৱਅ-ਊਏਐਓ-ਨਪ-ਰਲਲ਼ਵਸ਼ਸਹਖ਼-ੜਫ਼ੲ-ੴઅ-ઍએ-ઑઓ-નપ-રલળવ-હઽૐૠૡଅ-ଌଏଐଓ-ନପ-ରଲଳଵ-ହଽଡ଼ଢ଼ୟ-ୡୱஃஅ-ஊஎ-ஐஒ-கஙசஜஞடணதந-பம-ஹௐఅ-ఌఎ-ఐఒ-నప-ళవ-హఽౘౙౠౡಅ-ಌಎ-ಐಒ-ನಪ-ಳವ-ಹಽೞೠೡೱೲഅ-ഌഎ-ഐഒ-ഺഽൎൠൡൺ-ൿඅ-ඖක-නඳ-රලව-ෆก-ะาำเ-ๆກຂຄງຈຊຍດ-ທນ-ຟມ-ຣລວສຫອ-ະາຳຽເ-ໄໆໜ-ໟༀཀ-ཇཉ-ཬྈ-ྌက-ဪဿၐ-ၕၚ-ၝၡၥၦၮ-ၰၵ-ႁႎႠ-ჅჇჍა-ჺჼ-ቈቊ-ቍቐ-ቖቘቚ-ቝበ-ኈኊ-ኍነ-ኰኲ-ኵኸ-ኾዀዂ-ዅወ-ዖዘ-ጐጒ-ጕጘ-ፚᎀ-ᎏᎠ-Ᏼᐁ-ᙬᙯ-ᙿᚁ-ᚚᚠ-ᛪᛮ-ᛰᜀ-ᜌᜎ-ᜑᜠ-ᜱᝀ-ᝑᝠ-ᝬᝮ-ᝰក-ឳៗៜᠠ-ᡷᢀ-ᢨᢪᢰ-ᣵᤀ-ᤜᥐ-ᥭᥰ-ᥴᦀ-ᦫᧁ-ᧇᨀ-ᨖᨠ-ᩔᪧᬅ-ᬳᭅ-ᭋᮃ-ᮠᮮᮯᮺ-ᯥᰀ-ᰣᱍ-ᱏᱚ-ᱽᳩ-ᳬᳮ-ᳱᳵᳶᴀ-ᶿḀ-ἕἘ-Ἕἠ-ὅὈ-Ὅὐ-ὗὙὛὝὟ-ώᾀ-ᾴᾶ-ᾼιῂ-ῄῆ-ῌῐ-ΐῖ-Ίῠ-Ῥῲ-ῴῶ-ῼⁱⁿₐ-ₜℂℇℊ-ℓℕℙ-ℝℤΩℨK-ℭℯ-ℹℼ-ℿⅅ-ⅉⅎⅠ-ↈⰀ-Ⱞⰰ-ⱞⱠ-ⳤⳫ-ⳮⳲⳳⴀ-ⴥⴧⴭⴰ-ⵧⵯⶀ-ⶖⶠ-ⶦⶨ-ⶮⶰ-ⶶⶸ-ⶾⷀ-ⷆⷈ-ⷎⷐ-ⷖⷘ-ⷞⸯ々-〇〡-〩〱-〵〸-〼ぁ-ゖゝ-ゟァ-ヺー-ヿㄅ-ㄭㄱ-ㆎㆠ-ㆺㇰ-ㇿ㐀-䶵一-鿌ꀀ-ꒌꓐ-ꓽꔀ-ꘌꘐ-ꘟꘪꘫꙀ-ꙮꙿ-ꚗꚠ-ꛯꜗ-ꜟꜢ-ꞈꞋ-ꞎꞐ-ꞓꞠ-Ɦꟸ-ꠁꠃ-ꠅꠇ-ꠊꠌ-ꠢꡀ-ꡳꢂ-ꢳꣲ-ꣷꣻꤊ-ꤥꤰ-ꥆꥠ-ꥼꦄ-ꦲꧏꨀ-ꨨꩀ-ꩂꩄ-ꩋꩠ-ꩶꩺꪀ-ꪯꪱꪵꪶꪹ-ꪽꫀꫂꫛ-ꫝꫠ-ꫪꫲ-ꫴꬁ-ꬆꬉ-ꬎꬑ-ꬖꬠ-ꬦꬨ-ꬮꯀ-ꯢ가-힣ힰ-ퟆퟋ-ퟻ豈-舘並-龎ﬀ-ﬆﬓ-ﬗיִײַ-ﬨשׁ-זּטּ-לּמּנּסּףּפּצּ-ﮱﯓ-ﴽﵐ-ﶏﶒ-ﷇﷰ-ﷻﹰ-ﹴﹶ-ﻼＡ-Ｚａ-ｚｦ-ﾾￂ-ￇￊ-ￏￒ-ￗￚ-ￜ",Xt=new RegExp("["+Gt+"]"),Jt=new RegExp("["+Gt+"̀-ͯ҃-֑҇-ׇֽֿׁׂׅׄؐ-ؚؠ-ىٲ-ۓۧ-ۨۻ-ۼܰ-݊ࠀ-ࠔࠛ-ࠣࠥ-ࠧࠩ-࠭ࡀ-ࡗࣤ-ࣾऀ-ःऺ-़ा-ॏ॑-ॗॢ-ॣ०-९ঁ-ঃ়া-ৄেৈৗয়-ৠਁ-ਃ਼ਾ-ੂੇੈੋ-੍ੑ੦-ੱੵઁ-ઃ઼ા-ૅે-ૉો-્ૢ-ૣ૦-૯ଁ-ଃ଼ା-ୄେୈୋ-୍ୖୗୟ-ୠ୦-୯ஂா-ூெ-ைொ-்ௗ௦-௯ఁ-ఃె-ైొ-్ౕౖౢ-ౣ౦-౯ಂಃ಼ಾ-ೄೆ-ೈೊ-್ೕೖೢ-ೣ೦-೯ംഃെ-ൈൗൢ-ൣ൦-൯ංඃ්ා-ුූෘ-ෟෲෳิ-ฺเ-ๅ๐-๙ິ-ູ່-ໍ໐-໙༘༙༠-༩༹༵༷ཁ-ཇཱ-྄྆-྇ྍ-ྗྙ-ྼ࿆က-ဩ၀-၉ၧ-ၭၱ-ၴႂ-ႍႏ-ႝ፝-፟ᜎ-ᜐᜠ-ᜰᝀ-ᝐᝲᝳក-ឲ៝០-៩᠋-᠍᠐-᠙ᤠ-ᤫᤰ-᤻ᥑ-ᥭᦰ-ᧀᧈ-ᧉ᧐-᧙ᨀ-ᨕᨠ-ᩓ᩠-᩿᩼-᪉᪐-᪙ᭆ-ᭋ᭐-᭙᭫-᭳᮰-᮹᯦-᯳ᰀ-ᰢ᱀-᱉ᱛ-ᱽ᳐-᳒ᴀ-ᶾḁ-ἕ‌‍‿⁀⁔⃐-⃥⃜⃡-⃰ⶁ-ⶖⷠ-ⷿ〡-〨゙゚Ꙁ-ꙭꙴ-꙽ꚟ꛰-꛱ꟸ-ꠀ꠆ꠋꠣ-ꠧꢀ-ꢁꢴ-꣄꣐-꣙ꣳ-ꣷ꤀-꤉ꤦ-꤭ꤰ-ꥅꦀ-ꦃ꦳-꧀ꨀ-ꨧꩀ-ꩁꩌ-ꩍ꩐-꩙ꩻꫠ-ꫩꫲ-ꫳꯀ-ꯡ꯬꯭꯰-꯹ﬠ-ﬨ︀-️︠-︦︳︴﹍-﹏０-９＿]"),Zt=/[\n\r\u2028\u2029]/,Qt=/\r\n|[\n\r\u2028\u2029]/g,te=t.isIdentifierStart=function(t){return t<65?36===t:t<91||(t<97?95===t:t<123||t>=170&&Xt.test(String.fromCharCode(t)))},ne=t.isIdentifierChar=function(t){return t<48?36===t:t<58||!(t<65)&&(t<91||(t<97?95===t:t<123||t>=170&&Jt.test(String.fromCharCode(t))))};function line_loc_t(){this.line=y,this.column=c-w}function initTokenState(){y=1,c=w=0,_=!0,skipSpace()}function finishToken(t,i){d=c,n.locations&&(g=new line_loc_t),m=t,skipSpace(),v=i,_=t.beforeExpr}function skipBlockComment(){var t,r=n.onComment&&n.locations&&new line_loc_t,o=c,h=i.indexOf("*/",c+=2);if(-1===h&&raise(c-2,"Unterminated comment"),c=h+2,n.locations)for(Qt.lastIndex=o;(t=Qt.exec(i))&&t.index<c;)++y,w=t.index+t[0].length;n.onComment&&n.onComment(!0,i.slice(o+2,h),o,c,r,n.locations&&new line_loc_t)}function skipLineComment(){for(var t=c,o=n.onComment&&n.locations&&new line_loc_t,h=i.charCodeAt(c+=2);c<r&&10!==h&&13!==h&&8232!==h&&8233!==h;)++c,h=i.charCodeAt(c);n.onComment&&n.onComment(!1,i.slice(t+2,c),t,c,o,n.locations&&new line_loc_t)}function skipSpace(){for(;c<r;){var t=i.charCodeAt(c);if(32===t)++c;else if(13===t){++c,10===(o=i.charCodeAt(c))&&++c,n.locations&&(++y,w=c)}else if(10===t||8232===t||8233===t)++c,n.locations&&(++y,w=c);else if(t>8&&t<14)++c;else if(47===t){var o;if(42===(o=i.charCodeAt(c+1)))skipBlockComment();else{if(47!==o)break;skipLineComment()}}else if(160===t)++c;else{if(!(t>=5760&&$t.test(String.fromCharCode(t))))break;++c}}}function getTokenFromCode(t){switch(t){case 46:return function readToken_dot(){var t=i.charCodeAt(c+1);return t>=48&&t<=57?readNumber(!0):(++c,finishToken(Ct))}();case 40:return++c,finishToken(yt);case 41:return++c,finishToken(wt);case 59:return++c,finishToken(xt);case 44:return++c,finishToken(bt);case 91:return++c,finishToken(gt);case 93:return++c,finishToken(mt);case 123:return++c,finishToken(vt);case 125:return++c,finishToken(_t);case 58:return++c,finishToken(St);case 63:return++c,finishToken(kt);case 48:var o=i.charCodeAt(c+1);if(120===o||88===o)return function readHexNumber(){c+=2;var t=readInt(16);null==t&&raise(u+2,"Expected hexadecimal number");te(i.charCodeAt(c))&&raise(c,"Identifier directly after number");return finishToken(T,t)}();case 49:case 50:case 51:case 52:case 53:case 54:case 55:case 56:case 57:return readNumber(!1);case 34:case 39:return function readString(t){c++;for(var o="";;){c>=r&&raise(u,"Unterminated string constant");var h=i.charCodeAt(c);if(h===t)return++c,finishToken(D,o);if(92===h){h=i.charCodeAt(++c);var d=/^[0-7]+/.exec(i.slice(c,c+3));for(d&&(d=d[0]);d&&parseInt(d,8)>255;)d=d.slice(0,-1);if("0"===d&&(d=null),++c,d)I&&raise(c-2,"Octal literal in strict mode"),o+=String.fromCharCode(parseInt(d,8)),c+=d.length-1;else switch(h){case 110:o+="\n";break;case 114:o+="\r";break;case 120:o+=String.fromCharCode(readHexChar(2));break;case 117:o+=String.fromCharCode(readHexChar(4));break;case 85:o+=String.fromCharCode(readHexChar(8));break;case 116:o+="\t";break;case 98:o+="\b";break;case 118:o+="\v";break;case 102:o+="\f";break;case 48:o+="\0";break;case 13:10===i.charCodeAt(c)&&++c;case 10:n.locations&&(w=c,++y);break;default:o+=String.fromCharCode(h)}}else 13!==h&&10!==h&&8232!==h&&8233!==h||raise(u,"Unterminated string constant"),o+=String.fromCharCode(h),++c}}(t);case 47:return function readToken_slash(){var t=i.charCodeAt(c+1);return _?(++c,readRegexp()):61===t?finishOp(Mt,2):finishOp(Pt,1)}();case 37:case 42:return function readToken_mult_modulo(){return 61===i.charCodeAt(c+1)?finishOp(Mt,2):finishOp(zt,1)}();case 124:case 38:return function readToken_pipe_amp(t){var n=i.charCodeAt(c+1);return n===t?finishOp(124===t?Tt:Ot,2):61===n?finishOp(Mt,2):finishOp(124===t?Lt:Nt,1)}(t);case 94:return function readToken_caret(){return 61===i.charCodeAt(c+1)?finishOp(Mt,2):finishOp(Dt,1)}();case 43:case 45:return function readToken_plus_min(t){var n=i.charCodeAt(c+1);return n===t?45==n&&62==i.charCodeAt(c+2)&&Zt.test(i.slice(S,c))?(c+=3,skipLineComment(),skipSpace(),readToken()):finishOp(Et,2):61===n?finishOp(Mt,2):finishOp(Ut,1)}(t);case 60:case 62:return function readToken_lt_gt(t){var n=i.charCodeAt(c+1),r=1;return n===t?(r=62===t&&62===i.charCodeAt(c+2)?3:2,61===i.charCodeAt(c+r)?finishOp(Mt,r+1):finishOp(Vt,r)):33==n&&60==t&&45==i.charCodeAt(c+2)&&45==i.charCodeAt(c+3)?(c+=4,skipLineComment(),skipSpace(),readToken()):(61===n&&(r=61===i.charCodeAt(c+2)?3:2),finishOp(jt,r))}(t);case 61:case 33:return function readToken_eq_excl(t){return 61===i.charCodeAt(c+1)?finishOp(Rt,61===i.charCodeAt(c+2)?3:2):finishOp(61===t?It:At,1)}(t);case 126:return finishOp(At,1)}return!1}function readToken(t){if(t?c=u+1:u=c,n.locations&&(p=new line_loc_t),t)return readRegexp();if(c>=r)return finishToken(j);var o=i.charCodeAt(c);if(te(o)||92===o)return readWord();var h=getTokenFromCode(o);if(!1===h){var d=String.fromCharCode(o);if("\\"===d||Xt.test(d))return readWord();raise(c,"Unexpected character '"+d+"'")}return h}function finishOp(t,n){var r=i.slice(c,c+n);c+=n,finishToken(t,r)}function readRegexp(){for(var t,n,o=c;;){c>=r&&raise(o,"Unterminated regular expression");var h=i.charAt(c);if(Zt.test(h)&&raise(o,"Unterminated regular expression"),t)t=!1;else{if("["===h)n=!0;else if("]"===h&&n)n=!1;else if("/"===h&&!n)break;t="\\"===h}++c}var u=i.slice(o,c);++c;var d=readWord1();d&&!/^[gmsiy]*$/.test(d)&&raise(o,"Invalid regexp flag");try{var p=new RegExp(u,d)}catch(dr){dr instanceof SyntaxError&&raise(o,dr.message),raise(dr)}return finishToken(O,p)}function readInt(t,n){for(var r=c,o=0,h=0,u=null==n?1/0:n;h<u;++h){var d,p=i.charCodeAt(c);if((d=p>=97?p-97+10:p>=65?p-65+10:p>=48&&p<=57?p-48:1/0)>=t)break;++c,o=o*t+d}return c===r||null!=n&&c-r!==n?null:o}function readNumber(t){var n=c,r=!1,o=48===i.charCodeAt(c);t||null!==readInt(10)||raise(n,"Invalid number"),46===i.charCodeAt(c)&&(++c,readInt(10),r=!0);var h=i.charCodeAt(c);69!==h&&101!==h||(43!==(h=i.charCodeAt(++c))&&45!==h||++c,null===readInt(10)&&raise(n,"Invalid number"),r=!0),te(i.charCodeAt(c))&&raise(c,"Identifier directly after number");var u,d=i.slice(n,c);return r?u=parseFloat(d):o&&1!==d.length?/[89]/.test(d)||I?raise(n,"Invalid number"):u=parseInt(d,8):u=parseInt(d,10),finishToken(T,u)}function readHexChar(t){var n=readInt(16,t);return null===n&&raise(u,"Bad character escape sequence"),n}function readWord1(){Ft=!1;for(var t,n=!0,r=c;;){var o=i.charCodeAt(c);if(ne(o))Ft&&(t+=i.charAt(c)),++c;else{if(92!==o)break;Ft||(t=i.slice(r,c)),Ft=!0,117!=i.charCodeAt(++c)&&raise(c,"Expecting Unicode escape sequence \\uXXXX"),++c;var h=readHexChar(4),u=String.fromCharCode(h);u||raise(c-1,"Invalid Unicode escape"),(n?te(h):ne(h))||raise(c-4,"Invalid Unicode escape"),t+=u}n=!1}return Ft?t:i.slice(r,c)}function readWord(){var t=readWord1(),n=N;return!Ft&&Kt(t)&&(n=ft[t]),finishToken(n,t)}function next(){x=u,S=d,C=g,readToken()}function setStrict(t){if(I=t,c=u,n.locations)for(;c<w;)w=i.lastIndexOf("\n",w-2)+1,--y;skipSpace(),readToken()}function node_t(){this.type=null,this.start=u,this.end=null}function node_loc_t(){this.start=p,this.end=null,null!==o&&(this.source=o)}function startNode(){var t=new node_t;return n.locations&&(t.loc=new node_loc_t),n.directSourceFile&&(t.sourceFile=n.directSourceFile),n.ranges&&(t.range=[u,0]),t}function startNodeFrom(t){var i=new node_t;return i.start=t.start,n.locations&&(i.loc=new node_loc_t,i.loc.start=t.loc.start),n.ranges&&(i.range=[t.range[0],0]),i}function finishNode(t,i){return t.type=i,t.end=S,n.locations&&(t.loc.end=C),n.ranges&&(t.range[1]=S),t}function isUseStrict(t){return n.ecmaVersion>=5&&"ExpressionStatement"===t.type&&"Literal"===t.expression.type&&"use strict"===t.expression.value}function eat(t){if(m===t)return next(),!0}function canInsertSemicolon(){return!n.strictSemicolons&&(m===j||m===_t||Zt.test(i.slice(S,u)))}function semicolon(){eat(xt)||canInsertSemicolon()||unexpected()}function expect(t){m===t?next():unexpected()}function unexpected(){raise(u,"Unexpected token")}function checkLVal(t){"Identifier"!==t.type&&"MemberExpression"!==t.type&&raise(t.start,"Assigning to rvalue"),I&&"Identifier"===t.type&&Ht(t.name)&&raise(t.start,"Assigning to "+t.name+" in strict mode")}var re={kind:"loop"},oe={kind:"switch"};function parseStatement(){(m===Pt||m===Mt&&"/="==v)&&readToken(!0);var t=m,r=startNode();switch(t){case V:case F:next();var o=t===V;eat(xt)||canInsertSemicolon()?r.label=null:m!==N?unexpected():(r.label=parseIdent(),semicolon());for(var h=0;h<P.length;++h){var c=P[h];if(null==r.label||c.name===r.label.name){if(null!=c.kind&&(o||"loop"===c.kind))break;if(r.label&&o)break}}return h===P.length&&raise(r.start,"Unsyntactic "+t.keyword),finishNode(r,o?"BreakStatement":"ContinueStatement");case q:return next(),semicolon(),finishNode(r,"DebuggerStatement");case Y:return next(),P.push(re),r.body=parseStatement(),P.pop(),expect(st),r.test=parseParenExpression(),semicolon(),finishNode(r,"DoWhileStatement");case J:if(next(),P.push(re),expect(yt),m===xt)return parseFor(r,null);if(m===rt){var d=startNode();return next(),parseVar(d,!0),finishNode(d,"VariableDeclaration"),1===d.declarations.length&&eat(pt)?parseForIn(r,d):parseFor(r,d)}d=parseExpression(!1,!0);return eat(pt)?(checkLVal(d),parseForIn(r,d)):parseFor(r,d);case Z:return next(),parseFunction(r,!0);case Q:return next(),r.test=parseParenExpression(),r.consequent=parseStatement(),r.alternate=eat(H)?parseStatement():null,finishNode(r,"IfStatement");case tt:return k||n.allowReturnOutsideFunction||raise(u,"'return' outside of function"),next(),eat(xt)||canInsertSemicolon()?r.argument=null:(r.argument=parseExpression(),semicolon()),finishNode(r,"ReturnStatement");case et:next(),r.discriminant=parseParenExpression(),r.cases=[],expect(vt),P.push(oe);for(var p,g;m!=_t;)if(m===U||m===W){var _=m===U;p&&finishNode(p,"SwitchCase"),r.cases.push(p=startNode()),p.consequent=[],next(),_?p.test=parseExpression():(g&&raise(x,"Multiple default clauses"),g=!0,p.test=null),expect(St)}else p||unexpected(),p.consequent.push(parseStatement());return p&&finishNode(p,"SwitchCase"),next(),P.pop(),finishNode(r,"SwitchStatement");case nt:return next(),Zt.test(i.slice(S,u))&&raise(S,"Illegal newline after throw"),r.argument=parseExpression(),semicolon(),finishNode(r,"ThrowStatement");case it:if(next(),r.block=parseBlock(),r.handler=null,m===z){var y=startNode();next(),expect(yt),y.param=parseIdent(),I&&Ht(y.param.name)&&raise(y.param.start,"Binding "+y.param.name+" in strict mode"),expect(wt),y.guard=null,y.body=parseBlock(),r.handler=finishNode(y,"CatchClause")}return r.guardedHandlers=E,r.finalizer=eat(X)?parseBlock():null,r.handler||r.finalizer||raise(r.start,"Missing catch or finally clause"),finishNode(r,"TryStatement");case rt:return next(),parseVar(r),semicolon(),finishNode(r,"VariableDeclaration");case st:return next(),r.test=parseParenExpression(),P.push(re),r.body=parseStatement(),P.pop(),finishNode(r,"WhileStatement");case ot:return I&&raise(u,"'with' in strict mode"),next(),r.object=parseParenExpression(),r.body=parseStatement(),finishNode(r,"WithStatement");case vt:return parseBlock();case xt:return next(),finishNode(r,"EmptyStatement");default:var w=v,C=parseExpression();if(t===N&&"Identifier"===C.type&&eat(St)){for(h=0;h<P.length;++h)P[h].name===w&&raise(C.start,"Label '"+w+"' is already declared");var M=m.isLoop?"loop":m===et?"switch":null;return P.push({name:w,kind:M}),r.body=parseStatement(),P.pop(),r.label=C,finishNode(r,"LabeledStatement")}return r.expression=C,semicolon(),finishNode(r,"ExpressionStatement")}}function parseParenExpression(){expect(yt);var t=parseExpression();return expect(wt),t}function parseBlock(t){var n,i=startNode(),r=!0,o=!1;for(i.body=[],expect(vt);!eat(_t);){var h=parseStatement();i.body.push(h),r&&t&&isUseStrict(h)&&(n=o,setStrict(o=!0)),r=!1}return o&&!n&&setStrict(!1),finishNode(i,"BlockStatement")}function parseFor(t,n){return t.init=n,expect(xt),t.test=m===xt?null:parseExpression(),expect(xt),t.update=m===wt?null:parseExpression(),expect(wt),t.body=parseStatement(),P.pop(),finishNode(t,"ForStatement")}function parseForIn(t,n){return t.left=n,t.right=parseExpression(),expect(wt),t.body=parseStatement(),P.pop(),finishNode(t,"ForInStatement")}function parseVar(t,n){for(t.declarations=[],t.kind="var";;){var i=startNode();if(i.id=parseIdent(),I&&Ht(i.id.name)&&raise(i.id.start,"Binding "+i.id.name+" in strict mode"),i.init=eat(It)?parseExpression(!0,n):null,t.declarations.push(finishNode(i,"VariableDeclarator")),!eat(bt))break}return t}function parseExpression(t,n){var i=parseMaybeAssign(n);if(!t&&m===bt){var r=startNodeFrom(i);for(r.expressions=[i];eat(bt);)r.expressions.push(parseMaybeAssign(n));return finishNode(r,"SequenceExpression")}return i}function parseMaybeAssign(t){var n=function parseMaybeConditional(t){var n=function parseExprOps(t){return parseExprOp(parseMaybeUnary(),-1,t)}(t);if(eat(kt)){var i=startNodeFrom(n);return i.test=n,i.consequent=parseExpression(!0),expect(St),i.alternate=parseExpression(!0,t),finishNode(i,"ConditionalExpression")}return n}(t);if(m.isAssign){var i=startNodeFrom(n);return i.operator=v,i.left=n,next(),i.right=parseMaybeAssign(t),checkLVal(n),finishNode(i,"AssignmentExpression")}return n}function parseExprOp(t,n,i){var r=m.binop;if(null!=r&&(!i||m!==pt)&&r>n){var o=startNodeFrom(t);o.left=t,o.operator=v;var h=m;return next(),o.right=parseExprOp(parseMaybeUnary(),r,i),parseExprOp(finishNode(o,h===Tt||h===Ot?"LogicalExpression":"BinaryExpression"),n,i)}return t}function parseMaybeUnary(){if(m.prefix){var t=startNode(),n=m.isUpdate;return t.operator=v,t.prefix=!0,_=!0,next(),t.argument=parseMaybeUnary(),n?checkLVal(t.argument):I&&"delete"===t.operator&&"Identifier"===t.argument.type&&raise(t.start,"Deleting local variable in strict mode"),finishNode(t,n?"UpdateExpression":"UnaryExpression")}for(var i=function parseExprSubscripts(){return parseSubscripts(parseExprAtom())}();m.postfix&&!canInsertSemicolon();){(t=startNodeFrom(i)).operator=v,t.prefix=!1,t.argument=i,checkLVal(i),next(),i=finishNode(t,"UpdateExpression")}return i}function parseSubscripts(t,n){var i;return eat(Ct)?((i=startNodeFrom(t)).object=t,i.property=parseIdent(!0),i.computed=!1,parseSubscripts(finishNode(i,"MemberExpression"),n)):eat(gt)?((i=startNodeFrom(t)).object=t,i.property=parseExpression(),i.computed=!0,expect(mt),parseSubscripts(finishNode(i,"MemberExpression"),n)):!n&&eat(yt)?((i=startNodeFrom(t)).callee=t,i.arguments=parseExprList(wt,!1),parseSubscripts(finishNode(i,"CallExpression"),n)):t}function parseExprAtom(){switch(m){case lt:var t=startNode();return next(),finishNode(t,"ThisExpression");case N:return parseIdent();case T:case D:case O:return(t=startNode()).value=v,t.raw=i.slice(u,d),next(),finishNode(t,"Literal");case ct:case ut:case dt:return(t=startNode()).value=m.atomValue,t.raw=m.keyword,next(),finishNode(t,"Literal");case yt:var r=p,o=u;next();var h=parseExpression();return h.start=o,h.end=d,n.locations&&(h.loc.start=r,h.loc.end=g),n.ranges&&(h.range=[o,d]),expect(wt),h;case gt:t=startNode();return next(),t.elements=parseExprList(mt,!0,!0),finishNode(t,"ArrayExpression");case vt:return function parseObj(){var t=startNode(),i=!0,r=!1;t.properties=[],next();for(;!eat(_t);){if(i)i=!1;else if(expect(bt),n.allowTrailingCommas&&eat(_t))break;var o,h={key:parsePropertyName()},c=!1;if(eat(St)?(h.value=parseExpression(!0),o=h.kind="init"):n.ecmaVersion>=5&&"Identifier"===h.key.type&&("get"===h.key.name||"set"===h.key.name)?(c=r=!0,o=h.kind=h.key.name,h.key=parsePropertyName(),m!==yt&&unexpected(),h.value=parseFunction(startNode(),!1)):unexpected(),"Identifier"===h.key.type&&(I||r))for(var u=0;u<t.properties.length;++u){var d=t.properties[u];if(d.key.name===h.key.name){var p=o==d.kind||c&&"init"===d.kind||"init"===o&&("get"===d.kind||"set"===d.kind);p&&!I&&"init"===o&&"init"===d.kind&&(p=!1),p&&raise(h.key.start,"Redefinition of property")}}t.properties.push(h)}return finishNode(t,"ObjectExpression")}();case Z:t=startNode();return next(),parseFunction(t,!1);case ht:return function parseNew(){var t=startNode();next(),t.callee=parseSubscripts(parseExprAtom(),!0),eat(yt)?t.arguments=parseExprList(wt,!1):t.arguments=E;return finishNode(t,"NewExpression")}();default:unexpected()}}function parsePropertyName(){return m===T||m===D?parseExprAtom():parseIdent(!0)}function parseFunction(t,n){m===N?t.id=parseIdent():n?unexpected():t.id=null,t.params=[];var i=!0;for(expect(yt);!eat(wt);)i?i=!1:expect(bt),t.params.push(parseIdent());var r=k,o=P;if(k=!0,P=[],t.body=parseBlock(!0),k=r,P=o,I||t.body.body.length&&isUseStrict(t.body.body[0]))for(var h=t.id?-1:0;h<t.params.length;++h){var c=h<0?t.id:t.params[h];if((Yt(c.name)||Ht(c.name))&&raise(c.start,"Defining '"+c.name+"' in strict mode"),h>=0)for(var u=0;u<h;++u)c.name===t.params[u].name&&raise(c.start,"Argument name clash in strict mode")}return finishNode(t,n?"FunctionDeclaration":"FunctionExpression")}function parseExprList(t,i,r){for(var o=[],h=!0;!eat(t);){if(h)h=!1;else if(expect(bt),i&&n.allowTrailingCommas&&eat(t))break;r&&m===bt?o.push(null):o.push(parseExpression(!0))}return o}function parseIdent(t){var r=startNode();return t&&"everywhere"==n.forbidReserved&&(t=!1),m===N?(!t&&(n.forbidReserved&&(3===n.ecmaVersion?qt:Wt)(v)||I&&Yt(v))&&-1==i.slice(u,d).indexOf("\\")&&raise(u,"The keyword '"+v+"' is reserved"),r.name=v):t&&m.keyword?r.name=m.keyword:unexpected(),_=!1,next(),finishNode(r,"Identifier")}})),d.version||(d=null));function parse2(t,n){return(c.acorn||d).parse(t,n)}var p={"+":"__add","-":"__subtract","*":"__multiply","/":"__divide","%":"__modulo","==":"__equals","!=":"__equals"},g={"-":"__negate","+":"__self"},m=h.each(["add","subtract","multiply","divide","modulo","equals","negate"],(function(t){this["__"+t]="#"+t}),{__self:function(){return this}});function __$__(t,n,i){var r=p[n];if(t&&t[r]){var o=t[r](i);return"!="===n?!o:o}switch(n){case"+":return t+i;case"-":return t-i;case"*":return t*i;case"/":return t/i;case"%":return t%i;case"==":return t==i;case"!=":return t!=i}}function $__(t,n){var i=g[t];if(n&&n[i])return n[i]();switch(t){case"+":return+n;case"-":return-n}}function compile(n,i){if(!n)return"";var h=[];function getOffset(t){for(var n=0,i=h.length;n<i;n++){var r=h[n];if(r[0]>=t)break;t+=r[1]}return t}function getCode(t){return n.substring(getOffset(t.range[0]),getOffset(t.range[1]))}function replaceCode(t,i){for(var r=getOffset(t.range[0]),o=getOffset(t.range[1]),c=0,u=h.length-1;u>=0;u--)if(r>h[u][0]){c=u+1;break}h.splice(c,0,[r,i.length-o+r]),n=n.substring(0,r)+i+n.substring(o)}function handleOverloading(t,i){switch(t.type){case"UnaryExpression":if(t.operator in g&&"Literal"!==t.argument.type){var r=getCode(t.argument);replaceCode(t,'$__("'+t.operator+'", '+r+")")}break;case"BinaryExpression":if(t.operator in p&&"Literal"!==t.left.type){var o=getCode(t.left),h=getCode(t.right),c=function getBetween(t,i){return n.substring(getOffset(t.range[1]),getOffset(i.range[0]))}(t.left,t.right),u=t.operator;replaceCode(t,"__$__("+o+","+c.replace(new RegExp("\\"+u),'"'+u+'"')+", "+h+")")}break;case"UpdateExpression":case"AssignmentExpression":var d=i&&i.type;if(!("ForStatement"===d||"BinaryExpression"===d&&/^[=!<>]/.test(i.operator)||"MemberExpression"===d&&i.computed))if("UpdateExpression"===t.type){var m=(r=getCode(t.argument))+" = "+(v="__$__("+r+', "'+t.operator[0]+'", 1)');t.prefix?m="("+m+")":"AssignmentExpression"!==d&&"VariableDeclarator"!==d&&"BinaryExpression"!==d||(getCode(i.left||i.id)===r&&(m=v),m=r+"; "+m),replaceCode(t,m)}else if(/^.=$/.test(t.operator)&&"Literal"!==t.left.type){o=getCode(t.left),h=getCode(t.right);var v=o+" = __$__("+o+', "'+t.operator[0]+'", '+h+")";replaceCode(t,/^\(.*\)$/.test(getCode(t))?"("+v+")":v)}}}var c,u=(i=i||{}).url||"",d=i.sourceMaps,m=i.paperFeatures||{},v=i.source||n,_=i.offset||0,y=wt.agent,w=y.versionNumber,x=!1,S=/\r\n|\n|\r/gm;if(d&&(y.chrome&&w>=30||y.webkit&&w>=537.76||y.firefox&&w>=23||y.node)){if(y.node)_-=2;else if(r&&u&&!r.location.href.indexOf(u)){var C=o.getElementsByTagName("html")[0].innerHTML;_=C.substr(0,C.indexOf(n)+1).match(S).length+1}var k=["AA"+function encodeVLQ(t){var n="";for(t=(Math.abs(t)<<1)+(t<0?1:0);t||!n;){var i=31&t;(t>>=5)&&(i|=32),n+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"[i]}return n}((x=_>0&&!(y.chrome&&w>=36||y.safari&&w>=600||y.firefox&&w>=40||y.node))?0:_)+"A"];k.length=(n.match(S)||[]).length+1+(x?_:0),c={version:3,file:u,names:[],mappings:k.join(";AACA"),sourceRoot:"",sources:[u],sourcesContent:[v]}}return!1===m.operatorOverloading&&!1===m.moduleExports||function walkAST(t,n,i){if(t){for(var r in t)if("range"!==r&&"loc"!==r){var o=t[r];if(Array.isArray(o))for(var h=0,c=o.length;h<c;h++)walkAST(o[h],t,i);else o&&"object"==typeof o&&walkAST(o,t,i)}!1!==i.operatorOverloading&&handleOverloading(t,n),!1!==i.moduleExports&&function handleExports(t){switch(t.type){case"ExportDefaultDeclaration":replaceCode({range:[t.start,t.declaration.start]},"module.exports = ");break;case"ExportNamedDeclaration":var n=t.declaration,i=t.specifiers;if(n){var r=n.declarations;r&&(r.forEach((function(t){replaceCode(t,"module.exports."+getCode(t))})),replaceCode({range:[t.start,n.start+n.kind.length]},""))}else if(i){var o=i.map((function(t){var n=getCode(t);return"module.exports."+n+" = "+n+"; "})).join("");o&&replaceCode(t,o)}}}(t)}}(parse2(n,{ranges:!0,preserveParens:!0,sourceType:"module"}),null,m),c&&(x&&(n=new Array(_+1).join("\n")+n),/^(inline|both)$/.test(d)&&(n+="\n//# sourceMappingURL=data:application/json;base64,"+t.btoa(unescape(encodeURIComponent(JSON.stringify(c))))),n+="\n//# sourceURL="+(u||"paperscript")),{url:u,source:v,code:n,map:c}}function execute(t,n,i){wt=n;var r,c=n.getView(),u=/\btool\.\w+|\s+on(?:Key|Mouse)(?:Up|Down|Move|Drag)\b/.test(t)&&!/\bnew\s+Tool\b/.test(t)?new ft:null,d=u?u._events:[],p=["onFrame","onResize"].concat(d),g=[],m=[],v="object"==typeof t?t:compile(t,i);function expose(n,i){for(var r in n)!i&&/^_/.test(r)||!new RegExp("([\\b\\s\\W]|^)"+r.replace(/\$/g,"\\$")+"\\b").test(t)||(g.push(r),m.push(n[r]))}t=v.code,expose({__$__:__$__,$__:$__,paper:n,tool:u},!0),expose(n),t="var module = { exports: {} }; "+t,(S=h.each(p,(function(n){new RegExp("\\s+"+n+"\\b").test(t)&&(g.push(n),this.push("module.exports."+n+" = "+n+";"))}),[]).join("\n"))&&(t+="\n"+S),t+="\nreturn module.exports;";var y=wt.agent;if(o&&(y.chrome||y.firefox&&y.versionNumber<40)){var w=o.createElement("script"),x=o.head||o.getElementsByTagName("head")[0];y.firefox&&(t="\n"+t),w.appendChild(o.createTextNode("document.__paperscript__ = function("+g+") {"+t+"\n}")),x.appendChild(w),r=o.__paperscript__,delete o.__paperscript__,x.removeChild(w)}else r=Function(g,t);var S,C=(S=r&&r.apply(n,m))||{};return h.each(d,(function(t){var n=C[t];n&&(u[t]=n)})),c&&(C.onResize&&c.setOnResize(C.onResize),c.emit("resize",{size:c.size,delta:new _}),C.onFrame&&c.setOnFrame(C.onFrame),c.requestUpdate()),S}function loadScript(t){if(/^text\/(?:x-|)paperscript$/.test(t.type)&&"true"!==u.getAttribute(t,"ignore")){var n=u.getAttribute(t,"canvas"),i=o.getElementById(n),r=t.src||t.getAttribute("data-src"),h=u.hasAttribute(t,"async"),c="data-paper-scope";if(!i)throw new Error('Unable to find canvas with id "'+n+'"');var d=u.get(i.getAttribute(c))||(new u).setup(i);return i.setAttribute(c,d._id),r?Http_request({url:r,async:h,mimeType:"text/plain",onLoad:function(t){execute(t,d,r)}}):execute(t.innerHTML,d,t.baseURI),t.setAttribute("data-paper-ignore","true"),d}}function loadAll(){h.each(o&&o.getElementsByTagName("script"),loadScript)}return _.inject(m),w.inject(m),tt.inject(m),r&&("complete"===o.readyState?setTimeout(loadAll):st.add(r,{load:loadAll})),{compile:compile,execute:execute,load:function load(t){return t?loadScript(t):loadAll()},parse:parse2,calculateBinary:__$__,calculateUnary:$__}}.call(this);var wt=new(u.inject(h.exports,{Base:h,Numerical:m,Key:ut,DomEvent:st,DomElement:rt,document:o,window:r,Symbol:j,PlacedSymbol:N}));return wt.agent.node&&we()(wt),"function"==typeof define&&define.amd?define("paper",wt):"object"==typeof n&&n&&(n.exports=wt),wt}).call(t,"object"==typeof self?self:null)}}),xe=__commonJS({"../../node_modules/.pnpm/lodash@4.17.21/node_modules/lodash/lodash.js"(t,n){(function(){var i,r="Expected a function",o="__lodash_hash_undefined__",h="__lodash_placeholder__",c=16,u=32,d=64,p=128,g=256,m=1/0,v=9007199254740991,_=NaN,y=4294967295,w=[["ary",p],["bind",1],["bindKey",2],["curry",8],["curryRight",c],["flip",512],["partial",u],["partialRight",d],["rearg",g]],x="[object Arguments]",S="[object Array]",C="[object Boolean]",k="[object Date]",P="[object Error]",I="[object Function]",M="[object GeneratorFunction]",E="[object Map]",T="[object Number]",O="[object Object]",D="[object Promise]",N="[object RegExp]",j="[object Set]",V="[object String]",U="[object Symbol]",z="[object WeakMap]",F="[object ArrayBuffer]",q="[object DataView]",W="[object Float32Array]",Y="[object Float64Array]",H="[object Int8Array]",X="[object Int16Array]",J="[object Int32Array]",Z="[object Uint8Array]",Q="[object Uint8ClampedArray]",tt="[object Uint16Array]",et="[object Uint32Array]",nt=/\b__p \+= '';/g,it=/\b(__p \+=) '' \+/g,rt=/(__e\(.*?\)|\b__t\)) \+\n'';/g,st=/&(?:amp|lt|gt|quot|#39);/g,ot=/[&<>"']/g,ht=RegExp(st.source),lt=RegExp(ot.source),ct=/<%-([\s\S]+?)%>/g,ut=/<%([\s\S]+?)%>/g,dt=/<%=([\s\S]+?)%>/g,pt=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,ft=/^\w*$/,gt=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,mt=/[\\^$.*+?()[\]{}|]/g,vt=RegExp(mt.source),_t=/^\s+/,yt=/\s/,wt=/\{(?:\n\/\* \[wrapped with .+\] \*\/)?\n?/,bt=/\{\n\/\* \[wrapped with (.+)\] \*/,xt=/,? & /,St=/[^\x00-\x2f\x3a-\x40\x5b-\x60\x7b-\x7f]+/g,Ct=/[()=,{}\[\]\/\s]/,kt=/\\(\\)?/g,Pt=/\$\{([^\\}]*(?:\\.[^\\}]*)*)\}/g,It=/\w*$/,Mt=/^[-+]0x[0-9a-f]+$/i,Et=/^0b[01]+$/i,At=/^\[object .+?Constructor\]$/,Tt=/^0o[0-7]+$/i,Ot=/^(?:0|[1-9]\d*)$/,Lt=/[\xc0-\xd6\xd8-\xf6\xf8-\xff\u0100-\u017f]/g,Dt=/($^)/,Nt=/['\n\r\u2028\u2029\\]/g,Rt="\\ud800-\\udfff",jt="\\u0300-\\u036f\\ufe20-\\ufe2f\\u20d0-\\u20ff",Vt="\\u2700-\\u27bf",Ut="a-z\\xdf-\\xf6\\xf8-\\xff",zt="A-Z\\xc0-\\xd6\\xd8-\\xde",Bt="\\ufe0e\\ufe0f",Ft="\\xac\\xb1\\xd7\\xf7\\x00-\\x2f\\x3a-\\x40\\x5b-\\x60\\x7b-\\xbf\\u2000-\\u206f \\t\\x0b\\f\\xa0\\ufeff\\n\\r\\u2028\\u2029\\u1680\\u180e\\u2000\\u2001\\u2002\\u2003\\u2004\\u2005\\u2006\\u2007\\u2008\\u2009\\u200a\\u202f\\u205f\\u3000",qt="['’]",Wt="["+Rt+"]",Yt="["+Ft+"]",Ht="["+jt+"]",Kt="\\d+",$t="["+Vt+"]",Gt="["+Ut+"]",Xt="[^"+Rt+Ft+Kt+Vt+Ut+zt+"]",Jt="\\ud83c[\\udffb-\\udfff]",Zt="[^"+Rt+"]",Qt="(?:\\ud83c[\\udde6-\\uddff]){2}",te="[\\ud800-\\udbff][\\udc00-\\udfff]",ne="["+zt+"]",re="\\u200d",oe="(?:"+Gt+"|"+Xt+")",le="(?:"+ne+"|"+Xt+")",pe="(?:['’](?:d|ll|m|re|s|t|ve))?",fe="(?:['’](?:D|LL|M|RE|S|T|VE))?",ve="(?:"+Ht+"|"+Jt+")"+"?",_e="["+Bt+"]?",ye=_e+ve+("(?:"+re+"(?:"+[Zt,Qt,te].join("|")+")"+_e+ve+")*"),we="(?:"+[$t,Qt,te].join("|")+")"+ye,be="(?:"+[Zt+Ht+"?",Ht,Qt,te,Wt].join("|")+")",xe=RegExp(qt,"g"),Se=RegExp(Ht,"g"),Ce=RegExp(Jt+"(?="+Jt+")|"+be+ye,"g"),ke=RegExp([ne+"?"+Gt+"+"+pe+"(?="+[Yt,ne,"$"].join("|")+")",le+"+"+fe+"(?="+[Yt,ne+oe,"$"].join("|")+")",ne+"?"+oe+"+"+pe,ne+"+"+fe,"\\d*(?:1ST|2ND|3RD|(?![123])\\dTH)(?=\\b|[a-z_])","\\d*(?:1st|2nd|3rd|(?![123])\\dth)(?=\\b|[A-Z_])",Kt,we].join("|"),"g"),Pe=RegExp("["+re+Rt+jt+Bt+"]"),Ie=/[a-z][A-Z]|[A-Z]{2}[a-z]|[0-9][a-zA-Z]|[a-zA-Z][0-9]|[^a-zA-Z0-9 ]/,Me=["Array","Buffer","DataView","Date","Error","Float32Array","Float64Array","Function","Int8Array","Int16Array","Int32Array","Map","Math","Object","Promise","RegExp","Set","String","Symbol","TypeError","Uint8Array","Uint8ClampedArray","Uint16Array","Uint32Array","WeakMap","_","clearTimeout","isFinite","parseInt","setTimeout"],Ee=-1,Ae={};Ae[W]=Ae[Y]=Ae[H]=Ae[X]=Ae[J]=Ae[Z]=Ae[Q]=Ae[tt]=Ae[et]=!0,Ae[x]=Ae[S]=Ae[F]=Ae[C]=Ae[q]=Ae[k]=Ae[P]=Ae[I]=Ae[E]=Ae[T]=Ae[O]=Ae[N]=Ae[j]=Ae[V]=Ae[z]=!1;var Te={};Te[x]=Te[S]=Te[F]=Te[q]=Te[C]=Te[k]=Te[W]=Te[Y]=Te[H]=Te[X]=Te[J]=Te[E]=Te[T]=Te[O]=Te[N]=Te[j]=Te[V]=Te[U]=Te[Z]=Te[Q]=Te[tt]=Te[et]=!0,Te[P]=Te[I]=Te[z]=!1;var Oe={"\\":"\\","'":"'","\n":"n","\r":"r","\u2028":"u2028","\u2029":"u2029"},Le=parseFloat,De=parseInt,Ne="object"==typeof global&&global&&global.Object===Object&&global,Re="object"==typeof self&&self&&self.Object===Object&&self,je=Ne||Re||Function("return this")(),Ve="object"==typeof t&&t&&!t.nodeType&&t,Ue=Ve&&"object"==typeof n&&n&&!n.nodeType&&n,ze=Ue&&Ue.exports===Ve,Be=ze&&Ne.process,Fe=function(){try{var t=Ue&&Ue.require&&Ue.require("util").types;return t||Be&&Be.binding&&Be.binding("util")}catch(dr){}}(),qe=Fe&&Fe.isArrayBuffer,We=Fe&&Fe.isDate,Ye=Fe&&Fe.isMap,He=Fe&&Fe.isRegExp,Ke=Fe&&Fe.isSet,$e=Fe&&Fe.isTypedArray;function apply(t,n,i){switch(i.length){case 0:return t.call(n);case 1:return t.call(n,i[0]);case 2:return t.call(n,i[0],i[1]);case 3:return t.call(n,i[0],i[1],i[2])}return t.apply(n,i)}function arrayAggregator(t,n,i,r){for(var o=-1,h=null==t?0:t.length;++o<h;){var c=t[o];n(r,c,i(c),t)}return r}function arrayEach(t,n){for(var i=-1,r=null==t?0:t.length;++i<r&&!1!==n(t[i],i,t););return t}function arrayEachRight(t,n){for(var i=null==t?0:t.length;i--&&!1!==n(t[i],i,t););return t}function arrayEvery(t,n){for(var i=-1,r=null==t?0:t.length;++i<r;)if(!n(t[i],i,t))return!1;return!0}function arrayFilter(t,n){for(var i=-1,r=null==t?0:t.length,o=0,h=[];++i<r;){var c=t[i];n(c,i,t)&&(h[o++]=c)}return h}function arrayIncludes(t,n){return!!(null==t?0:t.length)&&baseIndexOf(t,n,0)>-1}function arrayIncludesWith(t,n,i){for(var r=-1,o=null==t?0:t.length;++r<o;)if(i(n,t[r]))return!0;return!1}function arrayMap(t,n){for(var i=-1,r=null==t?0:t.length,o=Array(r);++i<r;)o[i]=n(t[i],i,t);return o}function arrayPush(t,n){for(var i=-1,r=n.length,o=t.length;++i<r;)t[o+i]=n[i];return t}function arrayReduce(t,n,i,r){var o=-1,h=null==t?0:t.length;for(r&&h&&(i=t[++o]);++o<h;)i=n(i,t[o],o,t);return i}function arrayReduceRight(t,n,i,r){var o=null==t?0:t.length;for(r&&o&&(i=t[--o]);o--;)i=n(i,t[o],o,t);return i}function arraySome(t,n){for(var i=-1,r=null==t?0:t.length;++i<r;)if(n(t[i],i,t))return!0;return!1}var Ge=baseProperty("length");function baseFindKey(t,n,i){var r;return i(t,(function(t,i,o){if(n(t,i,o))return r=i,!1})),r}function baseFindIndex(t,n,i,r){for(var o=t.length,h=i+(r?1:-1);r?h--:++h<o;)if(n(t[h],h,t))return h;return-1}function baseIndexOf(t,n,i){return n==n?function strictIndexOf(t,n,i){var r=i-1,o=t.length;for(;++r<o;)if(t[r]===n)return r;return-1}(t,n,i):baseFindIndex(t,baseIsNaN,i)}function baseIndexOfWith(t,n,i,r){for(var o=i-1,h=t.length;++o<h;)if(r(t[o],n))return o;return-1}function baseIsNaN(t){return t!=t}function baseMean(t,n){var i=null==t?0:t.length;return i?baseSum(t,n)/i:_}function baseProperty(t){return function(n){return null==n?i:n[t]}}function basePropertyOf(t){return function(n){return null==t?i:t[n]}}function baseReduce(t,n,i,r,o){return o(t,(function(t,o,h){i=r?(r=!1,t):n(i,t,o,h)})),i}function baseSum(t,n){for(var r,o=-1,h=t.length;++o<h;){var c=n(t[o]);c!==i&&(r=r===i?c:r+c)}return r}function baseTimes(t,n){for(var i=-1,r=Array(t);++i<t;)r[i]=n(i);return r}function baseTrim(t){return t?t.slice(0,trimmedEndIndex(t)+1).replace(_t,""):t}function baseUnary(t){return function(n){return t(n)}}function baseValues(t,n){return arrayMap(n,(function(n){return t[n]}))}function cacheHas(t,n){return t.has(n)}function charsStartIndex(t,n){for(var i=-1,r=t.length;++i<r&&baseIndexOf(n,t[i],0)>-1;);return i}function charsEndIndex(t,n){for(var i=t.length;i--&&baseIndexOf(n,t[i],0)>-1;);return i}var Xe=basePropertyOf({"À":"A","Á":"A","Â":"A","Ã":"A","Ä":"A","Å":"A","à":"a","á":"a","â":"a","ã":"a","ä":"a","å":"a","Ç":"C","ç":"c","Ð":"D","ð":"d","È":"E","É":"E","Ê":"E","Ë":"E","è":"e","é":"e","ê":"e","ë":"e","Ì":"I","Í":"I","Î":"I","Ï":"I","ì":"i","í":"i","î":"i","ï":"i","Ñ":"N","ñ":"n","Ò":"O","Ó":"O","Ô":"O","Õ":"O","Ö":"O","Ø":"O","ò":"o","ó":"o","ô":"o","õ":"o","ö":"o","ø":"o","Ù":"U","Ú":"U","Û":"U","Ü":"U","ù":"u","ú":"u","û":"u","ü":"u","Ý":"Y","ý":"y","ÿ":"y","Æ":"Ae","æ":"ae","Þ":"Th","þ":"th","ß":"ss","Ā":"A","Ă":"A","Ą":"A","ā":"a","ă":"a","ą":"a","Ć":"C","Ĉ":"C","Ċ":"C","Č":"C","ć":"c","ĉ":"c","ċ":"c","č":"c","Ď":"D","Đ":"D","ď":"d","đ":"d","Ē":"E","Ĕ":"E","Ė":"E","Ę":"E","Ě":"E","ē":"e","ĕ":"e","ė":"e","ę":"e","ě":"e","Ĝ":"G","Ğ":"G","Ġ":"G","Ģ":"G","ĝ":"g","ğ":"g","ġ":"g","ģ":"g","Ĥ":"H","Ħ":"H","ĥ":"h","ħ":"h","Ĩ":"I","Ī":"I","Ĭ":"I","Į":"I","İ":"I","ĩ":"i","ī":"i","ĭ":"i","į":"i","ı":"i","Ĵ":"J","ĵ":"j","Ķ":"K","ķ":"k","ĸ":"k","Ĺ":"L","Ļ":"L","Ľ":"L","Ŀ":"L","Ł":"L","ĺ":"l","ļ":"l","ľ":"l","ŀ":"l","ł":"l","Ń":"N","Ņ":"N","Ň":"N","Ŋ":"N","ń":"n","ņ":"n","ň":"n","ŋ":"n","Ō":"O","Ŏ":"O","Ő":"O","ō":"o","ŏ":"o","ő":"o","Ŕ":"R","Ŗ":"R","Ř":"R","ŕ":"r","ŗ":"r","ř":"r","Ś":"S","Ŝ":"S","Ş":"S","Š":"S","ś":"s","ŝ":"s","ş":"s","š":"s","Ţ":"T","Ť":"T","Ŧ":"T","ţ":"t","ť":"t","ŧ":"t","Ũ":"U","Ū":"U","Ŭ":"U","Ů":"U","Ű":"U","Ų":"U","ũ":"u","ū":"u","ŭ":"u","ů":"u","ű":"u","ų":"u","Ŵ":"W","ŵ":"w","Ŷ":"Y","ŷ":"y","Ÿ":"Y","Ź":"Z","Ż":"Z","Ž":"Z","ź":"z","ż":"z","ž":"z","Ĳ":"IJ","ĳ":"ij","Œ":"Oe","œ":"oe","ŉ":"'n","ſ":"s"}),Je=basePropertyOf({"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"});function escapeStringChar(t){return"\\"+Oe[t]}function hasUnicode(t){return Pe.test(t)}function mapToArray(t){var n=-1,i=Array(t.size);return t.forEach((function(t,r){i[++n]=[r,t]})),i}function overArg(t,n){return function(i){return t(n(i))}}function replaceHolders(t,n){for(var i=-1,r=t.length,o=0,c=[];++i<r;){var u=t[i];u!==n&&u!==h||(t[i]=h,c[o++]=i)}return c}function setToArray(t){var n=-1,i=Array(t.size);return t.forEach((function(t){i[++n]=t})),i}function stringSize(t){return hasUnicode(t)?function unicodeSize(t){var n=Ce.lastIndex=0;for(;Ce.test(t);)++n;return n}(t):Ge(t)}function stringToArray(t){return hasUnicode(t)?function unicodeToArray(t){return t.match(Ce)||[]}(t):function asciiToArray(t){return t.split("")}(t)}function trimmedEndIndex(t){for(var n=t.length;n--&&yt.test(t.charAt(n)););return n}var Ze=basePropertyOf({"&amp;":"&","&lt;":"<","&gt;":">","&quot;":'"',"&#39;":"'"});var Qe=function runInContext2(t){var n,yt=(t=null==t?je:Qe.defaults(je.Object(),t,Qe.pick(je,Me))).Array,Rt=t.Date,jt=t.Error,Vt=t.Function,Ut=t.Math,zt=t.Object,Bt=t.RegExp,Ft=t.String,qt=t.TypeError,Wt=yt.prototype,Yt=Vt.prototype,Ht=zt.prototype,Kt=t["__core-js_shared__"],$t=Yt.toString,Gt=Ht.hasOwnProperty,Xt=0,Jt=(n=/[^.]+$/.exec(Kt&&Kt.keys&&Kt.keys.IE_PROTO||""))?"Symbol(src)_1."+n:"",Zt=Ht.toString,Qt=$t.call(zt),te=je._,ne=Bt("^"+$t.call(Gt).replace(mt,"\\</head>").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),re=ze?t.Buffer:i,oe=t.Symbol,le=t.Uint8Array,pe=re?re.allocUnsafe:i,fe=overArg(zt.getPrototypeOf,zt),ve=zt.create,_e=Ht.propertyIsEnumerable,ye=Wt.splice,we=oe?oe.isConcatSpreadable:i,be=oe?oe.iterator:i,Ce=oe?oe.toStringTag:i,Pe=function(){try{var t=getNative(zt,"defineProperty");return t({},"",{}),t}catch(dr){}}(),Oe=t.clearTimeout!==je.clearTimeout&&t.clearTimeout,Ne=Rt&&Rt.now!==je.Date.now&&Rt.now,Re=t.setTimeout!==je.setTimeout&&t.setTimeout,Ve=Ut.ceil,Ue=Ut.floor,Be=zt.getOwnPropertySymbols,Fe=re?re.isBuffer:i,Ge=t.isFinite,tn=Wt.join,en=overArg(zt.keys,zt),nn=Ut.max,rn=Ut.min,sn=Rt.now,an=t.parseInt,hn=Ut.random,ln=Wt.reverse,cn=getNative(t,"DataView"),un=getNative(t,"Map"),dn=getNative(t,"Promise"),pn=getNative(t,"Set"),fn=getNative(t,"WeakMap"),gn=getNative(zt,"create"),mn=fn&&new fn,vn={},_n=toSource(cn),yn=toSource(un),wn=toSource(dn),bn=toSource(pn),xn=toSource(fn),Sn=oe?oe.prototype:i,Cn=Sn?Sn.valueOf:i,kn=Sn?Sn.toString:i;function lodash(t){if(isObjectLike(t)&&!Ei(t)&&!(t instanceof LazyWrapper)){if(t instanceof LodashWrapper)return t;if(Gt.call(t,"__wrapped__"))return wrapperClone(t)}return new LodashWrapper(t)}var Pn=function(){function object(){}return function(t){if(!isObject(t))return{};if(ve)return ve(t);object.prototype=t;var n=new object;return object.prototype=i,n}}();function baseLodash(){}function LodashWrapper(t,n){this.__wrapped__=t,this.__actions__=[],this.__chain__=!!n,this.__index__=0,this.__values__=i}function LazyWrapper(t){this.__wrapped__=t,this.__actions__=[],this.__dir__=1,this.__filtered__=!1,this.__iteratees__=[],this.__takeCount__=y,this.__views__=[]}function Hash(t){var n=-1,i=null==t?0:t.length;for(this.clear();++n<i;){var r=t[n];this.set(r[0],r[1])}}function ListCache(t){var n=-1,i=null==t?0:t.length;for(this.clear();++n<i;){var r=t[n];this.set(r[0],r[1])}}function MapCache(t){var n=-1,i=null==t?0:t.length;for(this.clear();++n<i;){var r=t[n];this.set(r[0],r[1])}}function SetCache(t){var n=-1,i=null==t?0:t.length;for(this.__data__=new MapCache;++n<i;)this.add(t[n])}function Stack(t){var n=this.__data__=new ListCache(t);this.size=n.size}function arrayLikeKeys(t,n){var i=Ei(t),r=!i&&Mi(t),o=!i&&!r&&Ti(t),h=!i&&!r&&!o&&Ri(t),c=i||r||o||h,u=c?baseTimes(t.length,Ft):[],d=u.length;for(var p in t)!n&&!Gt.call(t,p)||c&&("length"==p||o&&("offset"==p||"parent"==p)||h&&("buffer"==p||"byteLength"==p||"byteOffset"==p)||isIndex(p,d))||u.push(p);return u}function arraySample(t){var n=t.length;return n?t[baseRandom(0,n-1)]:i}function arraySampleSize(t,n){return shuffleSelf(copyArray(t),baseClamp(n,0,t.length))}function arrayShuffle(t){return shuffleSelf(copyArray(t))}function assignMergeValue(t,n,r){(r!==i&&!eq(t[n],r)||r===i&&!(n in t))&&baseAssignValue(t,n,r)}function assignValue(t,n,r){var o=t[n];Gt.call(t,n)&&eq(o,r)&&(r!==i||n in t)||baseAssignValue(t,n,r)}function assocIndexOf(t,n){for(var i=t.length;i--;)if(eq(t[i][0],n))return i;return-1}function baseAggregator(t,n,i,r){return In(t,(function(t,o,h){n(r,t,i(t),h)})),r}function baseAssign(t,n){return t&&copyObject(n,keys2(n),t)}function baseAssignValue(t,n,i){"__proto__"==n&&Pe?Pe(t,n,{configurable:!0,enumerable:!0,value:i,writable:!0}):t[n]=i}function baseAt(t,n){for(var r=-1,o=n.length,h=yt(o),c=null==t;++r<o;)h[r]=c?i:get(t,n[r]);return h}function baseClamp(t,n,r){return t==t&&(r!==i&&(t=t<=r?t:r),n!==i&&(t=t>=n?t:n)),t}function baseClone(t,n,r,o,h,c){var u,d=1&n,p=2&n,g=4&n;if(r&&(u=h?r(t,o,h,c):r(t)),u!==i)return u;if(!isObject(t))return t;var m=Ei(t);if(m){if(u=function initCloneArray(t){var n=t.length,i=new t.constructor(n);n&&"string"==typeof t[0]&&Gt.call(t,"index")&&(i.index=t.index,i.input=t.input);return i}(t),!d)return copyArray(t,u)}else{var v=Un(t),_=v==I||v==M;if(Ti(t))return cloneBuffer(t,d);if(v==O||v==x||_&&!h){if(u=p||_?{}:initCloneObject(t),!d)return p?function copySymbolsIn(t,n){return copyObject(t,Vn(t),n)}(t,function baseAssignIn(t,n){return t&&copyObject(n,keysIn(n),t)}(u,t)):function copySymbols(t,n){return copyObject(t,jn(t),n)}(t,baseAssign(u,t))}else{if(!Te[v])return h?t:{};u=function initCloneByTag(t,n,i){var r=t.constructor;switch(n){case F:return cloneArrayBuffer(t);case C:case k:return new r(+t);case q:return function cloneDataView(t,n){var i=n?cloneArrayBuffer(t.buffer):t.buffer;return new t.constructor(i,t.byteOffset,t.byteLength)}(t,i);case W:case Y:case H:case X:case J:case Z:case Q:case tt:case et:return cloneTypedArray(t,i);case E:return new r;case T:case V:return new r(t);case N:return function cloneRegExp(t){var n=new t.constructor(t.source,It.exec(t));return n.lastIndex=t.lastIndex,n}(t);case j:return new r;case U:return function cloneSymbol(t){return Cn?zt(Cn.call(t)):{}}(t)}}(t,v,d)}}c||(c=new Stack);var y=c.get(t);if(y)return y;c.set(t,u),Ni(t)?t.forEach((function(i){u.add(baseClone(i,n,r,i,t,c))})):Li(t)&&t.forEach((function(i,o){u.set(o,baseClone(i,n,r,o,t,c))}));var w=m?i:(g?p?getAllKeysIn:getAllKeys:p?keysIn:keys2)(t);return arrayEach(w||t,(function(i,o){w&&(i=t[o=i]),assignValue(u,o,baseClone(i,n,r,o,t,c))})),u}function baseConformsTo(t,n,r){var o=r.length;if(null==t)return!o;for(t=zt(t);o--;){var h=r[o],c=n[h],u=t[h];if(u===i&&!(h in t)||!c(u))return!1}return!0}function baseDelay(t,n,o){if("function"!=typeof t)throw new qt(r);return Fn((function(){t.apply(i,o)}),n)}function baseDifference(t,n,i,r){var o=-1,h=arrayIncludes,c=!0,u=t.length,d=[],p=n.length;if(!u)return d;i&&(n=arrayMap(n,baseUnary(i))),r?(h=arrayIncludesWith,c=!1):n.length>=200&&(h=cacheHas,c=!1,n=new SetCache(n));t:for(;++o<u;){var g=t[o],m=null==i?g:i(g);if(g=r||0!==g?g:0,c&&m==m){for(var v=p;v--;)if(n[v]===m)continue t;d.push(g)}else h(n,m,r)||d.push(g)}return d}lodash.templateSettings={escape:ct,evaluate:ut,interpolate:dt,variable:"",imports:{_:lodash}},lodash.prototype=baseLodash.prototype,lodash.prototype.constructor=lodash,LodashWrapper.prototype=Pn(baseLodash.prototype),LodashWrapper.prototype.constructor=LodashWrapper,LazyWrapper.prototype=Pn(baseLodash.prototype),LazyWrapper.prototype.constructor=LazyWrapper,Hash.prototype.clear=function hashClear(){this.__data__=gn?gn(null):{},this.size=0},Hash.prototype.delete=function hashDelete(t){var n=this.has(t)&&delete this.__data__[t];return this.size-=n?1:0,n},Hash.prototype.get=function hashGet(t){var n=this.__data__;if(gn){var r=n[t];return r===o?i:r}return Gt.call(n,t)?n[t]:i},Hash.prototype.has=function hashHas(t){var n=this.__data__;return gn?n[t]!==i:Gt.call(n,t)},Hash.prototype.set=function hashSet(t,n){var r=this.__data__;return this.size+=this.has(t)?0:1,r[t]=gn&&n===i?o:n,this},ListCache.prototype.clear=function listCacheClear(){this.__data__=[],this.size=0},ListCache.prototype.delete=function listCacheDelete(t){var n=this.__data__,i=assocIndexOf(n,t);return!(i<0)&&(i==n.length-1?n.pop():ye.call(n,i,1),--this.size,!0)},ListCache.prototype.get=function listCacheGet(t){var n=this.__data__,r=assocIndexOf(n,t);return r<0?i:n[r][1]},ListCache.prototype.has=function listCacheHas(t){return assocIndexOf(this.__data__,t)>-1},ListCache.prototype.set=function listCacheSet(t,n){var i=this.__data__,r=assocIndexOf(i,t);return r<0?(++this.size,i.push([t,n])):i[r][1]=n,this},MapCache.prototype.clear=function mapCacheClear(){this.size=0,this.__data__={hash:new Hash,map:new(un||ListCache),string:new Hash}},MapCache.prototype.delete=function mapCacheDelete(t){var n=getMapData(this,t).delete(t);return this.size-=n?1:0,n},MapCache.prototype.get=function mapCacheGet(t){return getMapData(this,t).get(t)},MapCache.prototype.has=function mapCacheHas(t){return getMapData(this,t).has(t)},MapCache.prototype.set=function mapCacheSet(t,n){var i=getMapData(this,t),r=i.size;return i.set(t,n),this.size+=i.size==r?0:1,this},SetCache.prototype.add=SetCache.prototype.push=function setCacheAdd(t){return this.__data__.set(t,o),this},SetCache.prototype.has=function setCacheHas(t){return this.__data__.has(t)},Stack.prototype.clear=function stackClear(){this.__data__=new ListCache,this.size=0},Stack.prototype.delete=function stackDelete(t){var n=this.__data__,i=n.delete(t);return this.size=n.size,i},Stack.prototype.get=function stackGet(t){return this.__data__.get(t)},Stack.prototype.has=function stackHas(t){return this.__data__.has(t)},Stack.prototype.set=function stackSet(t,n){var i=this.__data__;if(i instanceof ListCache){var r=i.__data__;if(!un||r.length<199)return r.push([t,n]),this.size=++i.size,this;i=this.__data__=new MapCache(r)}return i.set(t,n),this.size=i.size,this};var In=createBaseEach(baseForOwn),Mn=createBaseEach(baseForOwnRight,!0);function baseEvery(t,n){var i=!0;return In(t,(function(t,r,o){return i=!!n(t,r,o)})),i}function baseExtremum(t,n,r){for(var o=-1,h=t.length;++o<h;){var c=t[o],u=n(c);if(null!=u&&(d===i?u==u&&!isSymbol(u):r(u,d)))var d=u,p=c}return p}function baseFilter(t,n){var i=[];return In(t,(function(t,r,o){n(t,r,o)&&i.push(t)})),i}function baseFlatten(t,n,i,r,o){var h=-1,c=t.length;for(i||(i=isFlattenable),o||(o=[]);++h<c;){var u=t[h];n>0&&i(u)?n>1?baseFlatten(u,n-1,i,r,o):arrayPush(o,u):r||(o[o.length]=u)}return o}var En=createBaseFor(),An=createBaseFor(!0);function baseForOwn(t,n){return t&&En(t,n,keys2)}function baseForOwnRight(t,n){return t&&An(t,n,keys2)}function baseFunctions(t,n){return arrayFilter(n,(function(n){return isFunction(t[n])}))}function baseGet(t,n){for(var r=0,o=(n=castPath(n,t)).length;null!=t&&r<o;)t=t[toKey(n[r++])];return r&&r==o?t:i}function baseGetAllKeys(t,n,i){var r=n(t);return Ei(t)?r:arrayPush(r,i(t))}function baseGetTag(t){return null==t?t===i?"[object Undefined]":"[object Null]":Ce&&Ce in zt(t)?function getRawTag(t){var n=Gt.call(t,Ce),r=t[Ce];try{t[Ce]=i;var o=!0}catch(dr){}var h=Zt.call(t);o&&(n?t[Ce]=r:delete t[Ce]);return h}(t):function objectToString(t){return Zt.call(t)}(t)}function baseGt(t,n){return t>n}function baseHas(t,n){return null!=t&&Gt.call(t,n)}function baseHasIn(t,n){return null!=t&&n in zt(t)}function baseIntersection(t,n,r){for(var o=r?arrayIncludesWith:arrayIncludes,h=t[0].length,c=t.length,u=c,d=yt(c),p=1/0,g=[];u--;){var m=t[u];u&&n&&(m=arrayMap(m,baseUnary(n))),p=rn(m.length,p),d[u]=!r&&(n||h>=120&&m.length>=120)?new SetCache(u&&m):i}m=t[0];var v=-1,_=d[0];t:for(;++v<h&&g.length<p;){var y=m[v],w=n?n(y):y;if(y=r||0!==y?y:0,!(_?cacheHas(_,w):o(g,w,r))){for(u=c;--u;){var x=d[u];if(!(x?cacheHas(x,w):o(t[u],w,r)))continue t}_&&_.push(w),g.push(y)}}return g}function baseInvoke(t,n,r){var o=null==(t=parent(t,n=castPath(n,t)))?t:t[toKey(last2(n))];return null==o?i:apply(o,t,r)}function baseIsArguments(t){return isObjectLike(t)&&baseGetTag(t)==x}function baseIsEqual(t,n,r,o,h){return t===n||(null==t||null==n||!isObjectLike(t)&&!isObjectLike(n)?t!=t&&n!=n:function baseIsEqualDeep(t,n,r,o,h,c){var u=Ei(t),d=Ei(n),p=u?S:Un(t),g=d?S:Un(n),m=(p=p==x?O:p)==O,v=(g=g==x?O:g)==O,_=p==g;if(_&&Ti(t)){if(!Ti(n))return!1;u=!0,m=!1}if(_&&!m)return c||(c=new Stack),u||Ri(t)?equalArrays(t,n,r,o,h,c):function equalByTag(t,n,i,r,o,h,c){switch(i){case q:if(t.byteLength!=n.byteLength||t.byteOffset!=n.byteOffset)return!1;t=t.buffer,n=n.buffer;case F:return!(t.byteLength!=n.byteLength||!h(new le(t),new le(n)));case C:case k:case T:return eq(+t,+n);case P:return t.name==n.name&&t.message==n.message;case N:case V:return t==n+"";case E:var u=mapToArray;case j:var d=1&r;if(u||(u=setToArray),t.size!=n.size&&!d)return!1;var p=c.get(t);if(p)return p==n;r|=2,c.set(t,n);var g=equalArrays(u(t),u(n),r,o,h,c);return c.delete(t),g;case U:if(Cn)return Cn.call(t)==Cn.call(n)}return!1}(t,n,p,r,o,h,c);if(!(1&r)){var y=m&&Gt.call(t,"__wrapped__"),w=v&&Gt.call(n,"__wrapped__");if(y||w){var I=y?t.value():t,M=w?n.value():n;return c||(c=new Stack),h(I,M,r,o,c)}}if(!_)return!1;return c||(c=new Stack),function equalObjects(t,n,r,o,h,c){var u=1&r,d=getAllKeys(t),p=d.length,g=getAllKeys(n),m=g.length;if(p!=m&&!u)return!1;var v=p;for(;v--;){var _=d[v];if(!(u?_ in n:Gt.call(n,_)))return!1}var y=c.get(t),w=c.get(n);if(y&&w)return y==n&&w==t;var x=!0;c.set(t,n),c.set(n,t);var S=u;for(;++v<p;){var C=t[_=d[v]],k=n[_];if(o)var P=u?o(k,C,_,n,t,c):o(C,k,_,t,n,c);if(!(P===i?C===k||h(C,k,r,o,c):P)){x=!1;break}S||(S="constructor"==_)}if(x&&!S){var I=t.constructor,M=n.constructor;I==M||!("constructor"in t)||!("constructor"in n)||"function"==typeof I&&I instanceof I&&"function"==typeof M&&M instanceof M||(x=!1)}return c.delete(t),c.delete(n),x}(t,n,r,o,h,c)}(t,n,r,o,baseIsEqual,h))}function baseIsMatch(t,n,r,o){var h=r.length,c=h,u=!o;if(null==t)return!c;for(t=zt(t);h--;){var d=r[h];if(u&&d[2]?d[1]!==t[d[0]]:!(d[0]in t))return!1}for(;++h<c;){var p=(d=r[h])[0],g=t[p],m=d[1];if(u&&d[2]){if(g===i&&!(p in t))return!1}else{var v=new Stack;if(o)var _=o(g,m,p,t,n,v);if(!(_===i?baseIsEqual(m,g,3,o,v):_))return!1}}return!0}function baseIsNative(t){return!(!isObject(t)||function isMasked(t){return!!Jt&&Jt in t}(t))&&(isFunction(t)?ne:At).test(toSource(t))}function baseIteratee(t){return"function"==typeof t?t:null==t?identity:"object"==typeof t?Ei(t)?baseMatchesProperty(t[0],t[1]):baseMatches(t):property(t)}function baseKeys(t){if(!isPrototype(t))return en(t);var n=[];for(var i in zt(t))Gt.call(t,i)&&"constructor"!=i&&n.push(i);return n}function baseKeysIn(t){if(!isObject(t))return function nativeKeysIn(t){var n=[];if(null!=t)for(var i in zt(t))n.push(i);return n}(t);var n=isPrototype(t),i=[];for(var r in t)("constructor"!=r||!n&&Gt.call(t,r))&&i.push(r);return i}function baseLt(t,n){return t<n}function baseMap(t,n){var i=-1,r=isArrayLike(t)?yt(t.length):[];return In(t,(function(t,o,h){r[++i]=n(t,o,h)})),r}function baseMatches(t){var n=getMatchData(t);return 1==n.length&&n[0][2]?matchesStrictComparable(n[0][0],n[0][1]):function(i){return i===t||baseIsMatch(i,t,n)}}function baseMatchesProperty(t,n){return isKey(t)&&isStrictComparable(n)?matchesStrictComparable(toKey(t),n):function(r){var o=get(r,t);return o===i&&o===n?hasIn(r,t):baseIsEqual(n,o,3)}}function baseMerge(t,n,r,o,h){t!==n&&En(n,(function(c,u){if(h||(h=new Stack),isObject(c))!function baseMergeDeep(t,n,r,o,h,c,u){var d=safeGet(t,r),p=safeGet(n,r),g=u.get(p);if(g)return void assignMergeValue(t,r,g);var m=c?c(d,p,r+"",t,n,u):i,v=m===i;if(v){var _=Ei(p),y=!_&&Ti(p),w=!_&&!y&&Ri(p);m=p,_||y||w?Ei(d)?m=d:isArrayLikeObject(d)?m=copyArray(d):y?(v=!1,m=cloneBuffer(p,!0)):w?(v=!1,m=cloneTypedArray(p,!0)):m=[]:isPlainObject(p)||Mi(p)?(m=d,Mi(d)?m=toPlainObject(d):isObject(d)&&!isFunction(d)||(m=initCloneObject(p))):v=!1}v&&(u.set(p,m),h(m,p,o,c,u),u.delete(p));assignMergeValue(t,r,m)}(t,n,u,r,baseMerge,o,h);else{var d=o?o(safeGet(t,u),c,u+"",t,n,h):i;d===i&&(d=c),assignMergeValue(t,u,d)}}),keysIn)}function baseNth(t,n){var r=t.length;if(r)return isIndex(n+=n<0?r:0,r)?t[n]:i}function baseOrderBy(t,n,i){n=n.length?arrayMap(n,(function(t){return Ei(t)?function(n){return baseGet(n,1===t.length?t[0]:t)}:t})):[identity];var r=-1;n=arrayMap(n,baseUnary(getIteratee()));var o=baseMap(t,(function(t,i,o){return{criteria:arrayMap(n,(function(n){return n(t)})),index:++r,value:t}}));return function baseSortBy(t,n){var i=t.length;for(t.sort(n);i--;)t[i]=t[i].value;return t}(o,(function(t,n){return function compareMultiple(t,n,i){var r=-1,o=t.criteria,h=n.criteria,c=o.length,u=i.length;for(;++r<c;){var d=compareAscending(o[r],h[r]);if(d)return r>=u?d:d*("desc"==i[r]?-1:1)}return t.index-n.index}(t,n,i)}))}function basePickBy(t,n,i){for(var r=-1,o=n.length,h={};++r<o;){var c=n[r],u=baseGet(t,c);i(u,c)&&baseSet(h,castPath(c,t),u)}return h}function basePullAll(t,n,i,r){var o=r?baseIndexOfWith:baseIndexOf,h=-1,c=n.length,u=t;for(t===n&&(n=copyArray(n)),i&&(u=arrayMap(t,baseUnary(i)));++h<c;)for(var d=0,p=n[h],g=i?i(p):p;(d=o(u,g,d,r))>-1;)u!==t&&ye.call(u,d,1),ye.call(t,d,1);return t}function basePullAt(t,n){for(var i=t?n.length:0,r=i-1;i--;){var o=n[i];if(i==r||o!==h){var h=o;isIndex(o)?ye.call(t,o,1):baseUnset(t,o)}}return t}function baseRandom(t,n){return t+Ue(hn()*(n-t+1))}function baseRepeat(t,n){var i="";if(!t||n<1||n>v)return i;do{n%2&&(i+=t),(n=Ue(n/2))&&(t+=t)}while(n);return i}function baseRest(t,n){return qn(overRest(t,n,identity),t+"")}function baseSample(t){return arraySample(values(t))}function baseSampleSize(t,n){var i=values(t);return shuffleSelf(i,baseClamp(n,0,i.length))}function baseSet(t,n,r,o){if(!isObject(t))return t;for(var h=-1,c=(n=castPath(n,t)).length,u=c-1,d=t;null!=d&&++h<c;){var p=toKey(n[h]),g=r;if("__proto__"===p||"constructor"===p||"prototype"===p)return t;if(h!=u){var m=d[p];(g=o?o(m,p,d):i)===i&&(g=isObject(m)?m:isIndex(n[h+1])?[]:{})}assignValue(d,p,g),d=d[p]}return t}var Tn=mn?function(t,n){return mn.set(t,n),t}:identity,On=Pe?function(t,n){return Pe(t,"toString",{configurable:!0,enumerable:!1,value:constant(n),writable:!0})}:identity;function baseShuffle(t){return shuffleSelf(values(t))}function baseSlice(t,n,i){var r=-1,o=t.length;n<0&&(n=-n>o?0:o+n),(i=i>o?o:i)<0&&(i+=o),o=n>i?0:i-n>>>0,n>>>=0;for(var h=yt(o);++r<o;)h[r]=t[r+n];return h}function baseSome(t,n){var i;return In(t,(function(t,r,o){return!(i=n(t,r,o))})),!!i}function baseSortedIndex(t,n,i){var r=0,o=null==t?r:t.length;if("number"==typeof n&&n==n&&o<=2147483647){for(;r<o;){var h=r+o>>>1,c=t[h];null!==c&&!isSymbol(c)&&(i?c<=n:c<n)?r=h+1:o=h}return o}return baseSortedIndexBy(t,n,identity,i)}function baseSortedIndexBy(t,n,r,o){var h=0,c=null==t?0:t.length;if(0===c)return 0;for(var u=(n=r(n))!=n,d=null===n,p=isSymbol(n),g=n===i;h<c;){var m=Ue((h+c)/2),v=r(t[m]),_=v!==i,y=null===v,w=v==v,x=isSymbol(v);if(u)var S=o||w;else S=g?w&&(o||_):d?w&&_&&(o||!y):p?w&&_&&!y&&(o||!x):!y&&!x&&(o?v<=n:v<n);S?h=m+1:c=m}return rn(c,4294967294)}function baseSortedUniq(t,n){for(var i=-1,r=t.length,o=0,h=[];++i<r;){var c=t[i],u=n?n(c):c;if(!i||!eq(u,d)){var d=u;h[o++]=0===c?0:c}}return h}function baseToNumber(t){return"number"==typeof t?t:isSymbol(t)?_:+t}function baseToString(t){if("string"==typeof t)return t;if(Ei(t))return arrayMap(t,baseToString)+"";if(isSymbol(t))return kn?kn.call(t):"";var n=t+"";return"0"==n&&1/t==-1/0?"-0":n}function baseUniq(t,n,i){var r=-1,o=arrayIncludes,h=t.length,c=!0,u=[],d=u;if(i)c=!1,o=arrayIncludesWith;else if(h>=200){var p=n?null:Nn(t);if(p)return setToArray(p);c=!1,o=cacheHas,d=new SetCache}else d=n?[]:u;t:for(;++r<h;){var g=t[r],m=n?n(g):g;if(g=i||0!==g?g:0,c&&m==m){for(var v=d.length;v--;)if(d[v]===m)continue t;n&&d.push(m),u.push(g)}else o(d,m,i)||(d!==u&&d.push(m),u.push(g))}return u}function baseUnset(t,n){return null==(t=parent(t,n=castPath(n,t)))||delete t[toKey(last2(n))]}function baseUpdate(t,n,i,r){return baseSet(t,n,i(baseGet(t,n)),r)}function baseWhile(t,n,i,r){for(var o=t.length,h=r?o:-1;(r?h--:++h<o)&&n(t[h],h,t););return i?baseSlice(t,r?0:h,r?h+1:o):baseSlice(t,r?h+1:0,r?o:h)}function baseWrapperValue(t,n){var i=t;return i instanceof LazyWrapper&&(i=i.value()),arrayReduce(n,(function(t,n){return n.func.apply(n.thisArg,arrayPush([t],n.args))}),i)}function baseXor(t,n,i){var r=t.length;if(r<2)return r?baseUniq(t[0]):[];for(var o=-1,h=yt(r);++o<r;)for(var c=t[o],u=-1;++u<r;)u!=o&&(h[o]=baseDifference(h[o]||c,t[u],n,i));return baseUniq(baseFlatten(h,1),n,i)}function baseZipObject(t,n,r){for(var o=-1,h=t.length,c=n.length,u={};++o<h;){var d=o<c?n[o]:i;r(u,t[o],d)}return u}function castArrayLikeObject(t){return isArrayLikeObject(t)?t:[]}function castFunction(t){return"function"==typeof t?t:identity}function castPath(t,n){return Ei(t)?t:isKey(t,n)?[t]:Wn(toString(t))}var Ln=baseRest;function castSlice(t,n,r){var o=t.length;return r=r===i?o:r,!n&&r>=o?t:baseSlice(t,n,r)}var Dn=Oe||function(t){return je.clearTimeout(t)};function cloneBuffer(t,n){if(n)return t.slice();var i=t.length,r=pe?pe(i):new t.constructor(i);return t.copy(r),r}function cloneArrayBuffer(t){var n=new t.constructor(t.byteLength);return new le(n).set(new le(t)),n}function cloneTypedArray(t,n){var i=n?cloneArrayBuffer(t.buffer):t.buffer;return new t.constructor(i,t.byteOffset,t.length)}function compareAscending(t,n){if(t!==n){var r=t!==i,o=null===t,h=t==t,c=isSymbol(t),u=n!==i,d=null===n,p=n==n,g=isSymbol(n);if(!d&&!g&&!c&&t>n||c&&u&&p&&!d&&!g||o&&u&&p||!r&&p||!h)return 1;if(!o&&!c&&!g&&t<n||g&&r&&h&&!o&&!c||d&&r&&h||!u&&h||!p)return-1}return 0}function composeArgs(t,n,i,r){for(var o=-1,h=t.length,c=i.length,u=-1,d=n.length,p=nn(h-c,0),g=yt(d+p),m=!r;++u<d;)g[u]=n[u];for(;++o<c;)(m||o<h)&&(g[i[o]]=t[o]);for(;p--;)g[u++]=t[o++];return g}function composeArgsRight(t,n,i,r){for(var o=-1,h=t.length,c=-1,u=i.length,d=-1,p=n.length,g=nn(h-u,0),m=yt(g+p),v=!r;++o<g;)m[o]=t[o];for(var _=o;++d<p;)m[_+d]=n[d];for(;++c<u;)(v||o<h)&&(m[_+i[c]]=t[o++]);return m}function copyArray(t,n){var i=-1,r=t.length;for(n||(n=yt(r));++i<r;)n[i]=t[i];return n}function copyObject(t,n,r,o){var h=!r;r||(r={});for(var c=-1,u=n.length;++c<u;){var d=n[c],p=o?o(r[d],t[d],d,r,t):i;p===i&&(p=t[d]),h?baseAssignValue(r,d,p):assignValue(r,d,p)}return r}function createAggregator(t,n){return function(i,r){var o=Ei(i)?arrayAggregator:baseAggregator,h=n?n():{};return o(i,t,getIteratee(r,2),h)}}function createAssigner(t){return baseRest((function(n,r){var o=-1,h=r.length,c=h>1?r[h-1]:i,u=h>2?r[2]:i;for(c=t.length>3&&"function"==typeof c?(h--,c):i,u&&isIterateeCall(r[0],r[1],u)&&(c=h<3?i:c,h=1),n=zt(n);++o<h;){var d=r[o];d&&t(n,d,o,c)}return n}))}function createBaseEach(t,n){return function(i,r){if(null==i)return i;if(!isArrayLike(i))return t(i,r);for(var o=i.length,h=n?o:-1,c=zt(i);(n?h--:++h<o)&&!1!==r(c[h],h,c););return i}}function createBaseFor(t){return function(n,i,r){for(var o=-1,h=zt(n),c=r(n),u=c.length;u--;){var d=c[t?u:++o];if(!1===i(h[d],d,h))break}return n}}function createCaseFirst(t){return function(n){var r=hasUnicode(n=toString(n))?stringToArray(n):i,o=r?r[0]:n.charAt(0),h=r?castSlice(r,1).join(""):n.slice(1);return o[t]()+h}}function createCompounder(t){return function(n){return arrayReduce(words(deburr(n).replace(xe,"")),t,"")}}function createCtor(t){return function(){var n=arguments;switch(n.length){case 0:return new t;case 1:return new t(n[0]);case 2:return new t(n[0],n[1]);case 3:return new t(n[0],n[1],n[2]);case 4:return new t(n[0],n[1],n[2],n[3]);case 5:return new t(n[0],n[1],n[2],n[3],n[4]);case 6:return new t(n[0],n[1],n[2],n[3],n[4],n[5]);case 7:return new t(n[0],n[1],n[2],n[3],n[4],n[5],n[6])}var i=Pn(t.prototype),r=t.apply(i,n);return isObject(r)?r:i}}function createFind(t){return function(n,r,o){var h=zt(n);if(!isArrayLike(n)){var c=getIteratee(r,3);n=keys2(n),r=function(t){return c(h[t],t,h)}}var u=t(n,r,o);return u>-1?h[c?n[u]:u]:i}}function createFlow(t){return flatRest((function(n){var o=n.length,h=o,c=LodashWrapper.prototype.thru;for(t&&n.reverse();h--;){var u=n[h];if("function"!=typeof u)throw new qt(r);if(c&&!d&&"wrapper"==getFuncName(u))var d=new LodashWrapper([],!0)}for(h=d?h:o;++h<o;){var p=getFuncName(u=n[h]),g="wrapper"==p?Rn(u):i;d=g&&isLaziable(g[0])&&424==g[1]&&!g[4].length&&1==g[9]?d[getFuncName(g[0])].apply(d,g[3]):1==u.length&&isLaziable(u)?d[p]():d.thru(u)}return function(){var t=arguments,i=t[0];if(d&&1==t.length&&Ei(i))return d.plant(i).value();for(var r=0,h=o?n[r].apply(this,t):i;++r<o;)h=n[r].call(this,h);return h}}))}function createHybrid(t,n,r,o,h,c,u,d,g,m){var v=n&p,_=1&n,y=2&n,w=24&n,x=512&n,S=y?i:createCtor(t);return function wrapper(){for(var p=arguments.length,C=yt(p),k=p;k--;)C[k]=arguments[k];if(w)var P=getHolder(wrapper),I=function countHolders(t,n){for(var i=t.length,r=0;i--;)t[i]===n&&++r;return r}(C,P);if(o&&(C=composeArgs(C,o,h,w)),c&&(C=composeArgsRight(C,c,u,w)),p-=I,w&&p<m){var M=replaceHolders(C,P);return createRecurry(t,n,createHybrid,wrapper.placeholder,r,C,M,d,g,m-p)}var E=_?r:this,T=y?E[t]:t;return p=C.length,d?C=function reorder(t,n){var r=t.length,o=rn(n.length,r),h=copyArray(t);for(;o--;){var c=n[o];t[o]=isIndex(c,r)?h[c]:i}return t}(C,d):x&&p>1&&C.reverse(),v&&g<p&&(C.length=g),this&&this!==je&&this instanceof wrapper&&(T=S||createCtor(T)),T.apply(E,C)}}function createInverter(t,n){return function(i,r){return function baseInverter(t,n,i,r){return baseForOwn(t,(function(t,o,h){n(r,i(t),o,h)})),r}(i,t,n(r),{})}}function createMathOperation(t,n){return function(r,o){var h;if(r===i&&o===i)return n;if(r!==i&&(h=r),o!==i){if(h===i)return o;"string"==typeof r||"string"==typeof o?(r=baseToString(r),o=baseToString(o)):(r=baseToNumber(r),o=baseToNumber(o)),h=t(r,o)}return h}}function createOver(t){return flatRest((function(n){return n=arrayMap(n,baseUnary(getIteratee())),baseRest((function(i){var r=this;return t(n,(function(t){return apply(t,r,i)}))}))}))}function createPadding(t,n){var r=(n=n===i?" ":baseToString(n)).length;if(r<2)return r?baseRepeat(n,t):n;var o=baseRepeat(n,Ve(t/stringSize(n)));return hasUnicode(n)?castSlice(stringToArray(o),0,t).join(""):o.slice(0,t)}function createRange(t){return function(n,r,o){return o&&"number"!=typeof o&&isIterateeCall(n,r,o)&&(r=o=i),n=toFinite(n),r===i?(r=n,n=0):r=toFinite(r),function baseRange(t,n,i,r){for(var o=-1,h=nn(Ve((n-t)/(i||1)),0),c=yt(h);h--;)c[r?h:++o]=t,t+=i;return c}(n,r,o=o===i?n<r?1:-1:toFinite(o),t)}}function createRelationalOperation(t){return function(n,i){return"string"==typeof n&&"string"==typeof i||(n=toNumber(n),i=toNumber(i)),t(n,i)}}function createRecurry(t,n,r,o,h,c,p,g,m,v){var _=8&n;n|=_?u:d,4&(n&=~(_?d:u))||(n&=-4);var y=[t,n,h,_?c:i,_?p:i,_?i:c,_?i:p,g,m,v],w=r.apply(i,y);return isLaziable(t)&&Bn(w,y),w.placeholder=o,setWrapToString(w,t,n)}function createRound(t){var n=Ut[t];return function(t,i){if(t=toNumber(t),(i=null==i?0:rn(toInteger(i),292))&&Ge(t)){var r=(toString(t)+"e").split("e");return+((r=(toString(n(r[0]+"e"+(+r[1]+i)))+"e").split("e"))[0]+"e"+(+r[1]-i))}return n(t)}}var Nn=pn&&1/setToArray(new pn([,-0]))[1]==m?function(t){return new pn(t)}:noop;function createToPairs(t){return function(n){var i=Un(n);return i==E?mapToArray(n):i==j?function setToPairs(t){var n=-1,i=Array(t.size);return t.forEach((function(t){i[++n]=[t,t]})),i}(n):function baseToPairs(t,n){return arrayMap(n,(function(n){return[n,t[n]]}))}(n,t(n))}}function createWrap(t,n,o,m,v,_,y,w){var x=2&n;if(!x&&"function"!=typeof t)throw new qt(r);var S=m?m.length:0;if(S||(n&=-97,m=v=i),y=y===i?y:nn(toInteger(y),0),w=w===i?w:toInteger(w),S-=v?v.length:0,n&d){var C=m,k=v;m=v=i}var P=x?i:Rn(t),I=[t,n,o,m,v,C,k,_,y,w];if(P&&function mergeData(t,n){var i=t[1],r=n[1],o=i|r,c=o<131,u=r==p&&8==i||r==p&&i==g&&t[7].length<=n[8]||384==r&&n[7].length<=n[8]&&8==i;if(!c&&!u)return t;1&r&&(t[2]=n[2],o|=1&i?0:4);var d=n[3];if(d){var m=t[3];t[3]=m?composeArgs(m,d,n[4]):d,t[4]=m?replaceHolders(t[3],h):n[4]}d=n[5],d&&(m=t[5],t[5]=m?composeArgsRight(m,d,n[6]):d,t[6]=m?replaceHolders(t[5],h):n[6]);d=n[7],d&&(t[7]=d);r&p&&(t[8]=null==t[8]?n[8]:rn(t[8],n[8]));null==t[9]&&(t[9]=n[9]);return t[0]=n[0],t[1]=o,t}(I,P),t=I[0],n=I[1],o=I[2],m=I[3],v=I[4],!(w=I[9]=I[9]===i?x?0:t.length:nn(I[9]-S,0))&&24&n&&(n&=-25),n&&1!=n)M=8==n||n==c?function createCurry(t,n,r){var o=createCtor(t);return function wrapper(){for(var h=arguments.length,c=yt(h),u=h,d=getHolder(wrapper);u--;)c[u]=arguments[u];var p=h<3&&c[0]!==d&&c[h-1]!==d?[]:replaceHolders(c,d);return(h-=p.length)<r?createRecurry(t,n,createHybrid,wrapper.placeholder,i,c,p,i,i,r-h):apply(this&&this!==je&&this instanceof wrapper?o:t,this,c)}}(t,n,w):n!=u&&33!=n||v.length?createHybrid.apply(i,I):function createPartial(t,n,i,r){var o=1&n,h=createCtor(t);return function wrapper(){for(var n=-1,c=arguments.length,u=-1,d=r.length,p=yt(d+c),g=this&&this!==je&&this instanceof wrapper?h:t;++u<d;)p[u]=r[u];for(;c--;)p[u++]=arguments[++n];return apply(g,o?i:this,p)}}(t,n,o,m);else var M=function createBind(t,n,i){var r=1&n,o=createCtor(t);return function wrapper(){return(this&&this!==je&&this instanceof wrapper?o:t).apply(r?i:this,arguments)}}(t,n,o);return setWrapToString((P?Tn:Bn)(M,I),t,n)}function customDefaultsAssignIn(t,n,r,o){return t===i||eq(t,Ht[r])&&!Gt.call(o,r)?n:t}function customDefaultsMerge(t,n,r,o,h,c){return isObject(t)&&isObject(n)&&(c.set(n,t),baseMerge(t,n,i,customDefaultsMerge,c),c.delete(n)),t}function customOmitClone(t){return isPlainObject(t)?i:t}function equalArrays(t,n,r,o,h,c){var u=1&r,d=t.length,p=n.length;if(d!=p&&!(u&&p>d))return!1;var g=c.get(t),m=c.get(n);if(g&&m)return g==n&&m==t;var v=-1,_=!0,y=2&r?new SetCache:i;for(c.set(t,n),c.set(n,t);++v<d;){var w=t[v],x=n[v];if(o)var S=u?o(x,w,v,n,t,c):o(w,x,v,t,n,c);if(S!==i){if(S)continue;_=!1;break}if(y){if(!arraySome(n,(function(t,n){if(!cacheHas(y,n)&&(w===t||h(w,t,r,o,c)))return y.push(n)}))){_=!1;break}}else if(w!==x&&!h(w,x,r,o,c)){_=!1;break}}return c.delete(t),c.delete(n),_}function flatRest(t){return qn(overRest(t,i,flatten),t+"")}function getAllKeys(t){return baseGetAllKeys(t,keys2,jn)}function getAllKeysIn(t){return baseGetAllKeys(t,keysIn,Vn)}var Rn=mn?function(t){return mn.get(t)}:noop;function getFuncName(t){for(var n=t.name+"",i=vn[n],r=Gt.call(vn,n)?i.length:0;r--;){var o=i[r],h=o.func;if(null==h||h==t)return o.name}return n}function getHolder(t){return(Gt.call(lodash,"placeholder")?lodash:t).placeholder}function getIteratee(){var t=lodash.iteratee||iteratee;return t=t===iteratee?baseIteratee:t,arguments.length?t(arguments[0],arguments[1]):t}function getMapData(t,n){var i=t.__data__;return function isKeyable(t){var n=typeof t;return"string"==n||"number"==n||"symbol"==n||"boolean"==n?"__proto__"!==t:null===t}(n)?i["string"==typeof n?"string":"hash"]:i.map}function getMatchData(t){for(var n=keys2(t),i=n.length;i--;){var r=n[i],o=t[r];n[i]=[r,o,isStrictComparable(o)]}return n}function getNative(t,n){var r=function getValue(t,n){return null==t?i:t[n]}(t,n);return baseIsNative(r)?r:i}var jn=Be?function(t){return null==t?[]:(t=zt(t),arrayFilter(Be(t),(function(n){return _e.call(t,n)})))}:stubArray,Vn=Be?function(t){for(var n=[];t;)arrayPush(n,jn(t)),t=fe(t);return n}:stubArray,Un=baseGetTag;function hasPath(t,n,i){for(var r=-1,o=(n=castPath(n,t)).length,h=!1;++r<o;){var c=toKey(n[r]);if(!(h=null!=t&&i(t,c)))break;t=t[c]}return h||++r!=o?h:!!(o=null==t?0:t.length)&&isLength(o)&&isIndex(c,o)&&(Ei(t)||Mi(t))}function initCloneObject(t){return"function"!=typeof t.constructor||isPrototype(t)?{}:Pn(fe(t))}function isFlattenable(t){return Ei(t)||Mi(t)||!!(we&&t&&t[we])}function isIndex(t,n){var i=typeof t;return!!(n=null==n?v:n)&&("number"==i||"symbol"!=i&&Ot.test(t))&&t>-1&&t%1==0&&t<n}function isIterateeCall(t,n,i){if(!isObject(i))return!1;var r=typeof n;return!!("number"==r?isArrayLike(i)&&isIndex(n,i.length):"string"==r&&n in i)&&eq(i[n],t)}function isKey(t,n){if(Ei(t))return!1;var i=typeof t;return!("number"!=i&&"symbol"!=i&&"boolean"!=i&&null!=t&&!isSymbol(t))||(ft.test(t)||!pt.test(t)||null!=n&&t in zt(n))}function isLaziable(t){var n=getFuncName(t),i=lodash[n];if("function"!=typeof i||!(n in LazyWrapper.prototype))return!1;if(t===i)return!0;var r=Rn(i);return!!r&&t===r[0]}(cn&&Un(new cn(new ArrayBuffer(1)))!=q||un&&Un(new un)!=E||dn&&Un(dn.resolve())!=D||pn&&Un(new pn)!=j||fn&&Un(new fn)!=z)&&(Un=function(t){var n=baseGetTag(t),r=n==O?t.constructor:i,o=r?toSource(r):"";if(o)switch(o){case _n:return q;case yn:return E;case wn:return D;case bn:return j;case xn:return z}return n});var zn=Kt?isFunction:stubFalse;function isPrototype(t){var n=t&&t.constructor;return t===("function"==typeof n&&n.prototype||Ht)}function isStrictComparable(t){return t==t&&!isObject(t)}function matchesStrictComparable(t,n){return function(r){return null!=r&&(r[t]===n&&(n!==i||t in zt(r)))}}function overRest(t,n,r){return n=nn(n===i?t.length-1:n,0),function(){for(var i=arguments,o=-1,h=nn(i.length-n,0),c=yt(h);++o<h;)c[o]=i[n+o];o=-1;for(var u=yt(n+1);++o<n;)u[o]=i[o];return u[n]=r(c),apply(t,this,u)}}function parent(t,n){return n.length<2?t:baseGet(t,baseSlice(n,0,-1))}function safeGet(t,n){if(("constructor"!==n||"function"!=typeof t[n])&&"__proto__"!=n)return t[n]}var Bn=shortOut(Tn),Fn=Re||function(t,n){return je.setTimeout(t,n)},qn=shortOut(On);function setWrapToString(t,n,i){var r=n+"";return qn(t,function insertWrapDetails(t,n){var i=n.length;if(!i)return t;var r=i-1;return n[r]=(i>1?"& ":"")+n[r],n=n.join(i>2?", ":" "),t.replace(wt,"{\n/* [wrapped with "+n+"] */\n")}(r,function updateWrapDetails(t,n){return arrayEach(w,(function(i){var r="_."+i[0];n&i[1]&&!arrayIncludes(t,r)&&t.push(r)})),t.sort()}(function getWrapDetails(t){var n=t.match(bt);return n?n[1].split(xt):[]}(r),i)))}function shortOut(t){var n=0,r=0;return function(){var o=sn(),h=16-(o-r);if(r=o,h>0){if(++n>=800)return arguments[0]}else n=0;return t.apply(i,arguments)}}function shuffleSelf(t,n){var r=-1,o=t.length,h=o-1;for(n=n===i?o:n;++r<n;){var c=baseRandom(r,h),u=t[c];t[c]=t[r],t[r]=u}return t.length=n,t}var Wn=function memoizeCapped(t){var n=memoize(t,(function(t){return 500===i.size&&i.clear(),t})),i=n.cache;return n}((function(t){var n=[];return 46===t.charCodeAt(0)&&n.push(""),t.replace(gt,(function(t,i,r,o){n.push(r?o.replace(kt,"$1"):i||t)})),n}));function toKey(t){if("string"==typeof t||isSymbol(t))return t;var n=t+"";return"0"==n&&1/t==-1/0?"-0":n}function toSource(t){if(null!=t){try{return $t.call(t)}catch(dr){}try{return t+""}catch(dr){}}return""}function wrapperClone(t){if(t instanceof LazyWrapper)return t.clone();var n=new LodashWrapper(t.__wrapped__,t.__chain__);return n.__actions__=copyArray(t.__actions__),n.__index__=t.__index__,n.__values__=t.__values__,n}var Yn=baseRest((function(t,n){return isArrayLikeObject(t)?baseDifference(t,baseFlatten(n,1,isArrayLikeObject,!0)):[]})),Hn=baseRest((function(t,n){var r=last2(n);return isArrayLikeObject(r)&&(r=i),isArrayLikeObject(t)?baseDifference(t,baseFlatten(n,1,isArrayLikeObject,!0),getIteratee(r,2)):[]})),Kn=baseRest((function(t,n){var r=last2(n);return isArrayLikeObject(r)&&(r=i),isArrayLikeObject(t)?baseDifference(t,baseFlatten(n,1,isArrayLikeObject,!0),i,r):[]}));function findIndex(t,n,i){var r=null==t?0:t.length;if(!r)return-1;var o=null==i?0:toInteger(i);return o<0&&(o=nn(r+o,0)),baseFindIndex(t,getIteratee(n,3),o)}function findLastIndex(t,n,r){var o=null==t?0:t.length;if(!o)return-1;var h=o-1;return r!==i&&(h=toInteger(r),h=r<0?nn(o+h,0):rn(h,o-1)),baseFindIndex(t,getIteratee(n,3),h,!0)}function flatten(t){return(null==t?0:t.length)?baseFlatten(t,1):[]}function head(t){return t&&t.length?t[0]:i}var $n=baseRest((function(t){var n=arrayMap(t,castArrayLikeObject);return n.length&&n[0]===t[0]?baseIntersection(n):[]})),Gn=baseRest((function(t){var n=last2(t),r=arrayMap(t,castArrayLikeObject);return n===last2(r)?n=i:r.pop(),r.length&&r[0]===t[0]?baseIntersection(r,getIteratee(n,2)):[]})),Xn=baseRest((function(t){var n=last2(t),r=arrayMap(t,castArrayLikeObject);return(n="function"==typeof n?n:i)&&r.pop(),r.length&&r[0]===t[0]?baseIntersection(r,i,n):[]}));function last2(t){var n=null==t?0:t.length;return n?t[n-1]:i}var Jn=baseRest(pullAll);function pullAll(t,n){return t&&t.length&&n&&n.length?basePullAll(t,n):t}var Zn=flatRest((function(t,n){var i=null==t?0:t.length,r=baseAt(t,n);return basePullAt(t,arrayMap(n,(function(t){return isIndex(t,i)?+t:t})).sort(compareAscending)),r}));function reverse(t){return null==t?t:ln.call(t)}var Qn=baseRest((function(t){return baseUniq(baseFlatten(t,1,isArrayLikeObject,!0))})),ti=baseRest((function(t){var n=last2(t);return isArrayLikeObject(n)&&(n=i),baseUniq(baseFlatten(t,1,isArrayLikeObject,!0),getIteratee(n,2))})),ei=baseRest((function(t){var n=last2(t);return n="function"==typeof n?n:i,baseUniq(baseFlatten(t,1,isArrayLikeObject,!0),i,n)}));function unzip(t){if(!t||!t.length)return[];var n=0;return t=arrayFilter(t,(function(t){if(isArrayLikeObject(t))return n=nn(t.length,n),!0})),baseTimes(n,(function(n){return arrayMap(t,baseProperty(n))}))}function unzipWith(t,n){if(!t||!t.length)return[];var r=unzip(t);return null==n?r:arrayMap(r,(function(t){return apply(n,i,t)}))}var ni=baseRest((function(t,n){return isArrayLikeObject(t)?baseDifference(t,n):[]})),ii=baseRest((function(t){return baseXor(arrayFilter(t,isArrayLikeObject))})),ri=baseRest((function(t){var n=last2(t);return isArrayLikeObject(n)&&(n=i),baseXor(arrayFilter(t,isArrayLikeObject),getIteratee(n,2))})),si=baseRest((function(t){var n=last2(t);return n="function"==typeof n?n:i,baseXor(arrayFilter(t,isArrayLikeObject),i,n)})),ai=baseRest(unzip);var oi=baseRest((function(t){var n=t.length,r=n>1?t[n-1]:i;return r="function"==typeof r?(t.pop(),r):i,unzipWith(t,r)}));function chain(t){var n=lodash(t);return n.__chain__=!0,n}function thru(t,n){return n(t)}var hi=flatRest((function(t){var n=t.length,r=n?t[0]:0,o=this.__wrapped__,interceptor=function(n){return baseAt(n,t)};return!(n>1||this.__actions__.length)&&o instanceof LazyWrapper&&isIndex(r)?((o=o.slice(r,+r+(n?1:0))).__actions__.push({func:thru,args:[interceptor],thisArg:i}),new LodashWrapper(o,this.__chain__).thru((function(t){return n&&!t.length&&t.push(i),t}))):this.thru(interceptor)}));var li=createAggregator((function(t,n,i){Gt.call(t,i)?++t[i]:baseAssignValue(t,i,1)}));var ci=createFind(findIndex),ui=createFind(findLastIndex);function forEach2(t,n){return(Ei(t)?arrayEach:In)(t,getIteratee(n,3))}function forEachRight(t,n){return(Ei(t)?arrayEachRight:Mn)(t,getIteratee(n,3))}var di=createAggregator((function(t,n,i){Gt.call(t,i)?t[i].push(n):baseAssignValue(t,i,[n])}));var pi=baseRest((function(t,n,i){var r=-1,o="function"==typeof n,h=isArrayLike(t)?yt(t.length):[];return In(t,(function(t){h[++r]=o?apply(n,t,i):baseInvoke(t,n,i)})),h})),fi=createAggregator((function(t,n,i){baseAssignValue(t,i,n)}));function map2(t,n){return(Ei(t)?arrayMap:baseMap)(t,getIteratee(n,3))}var gi=createAggregator((function(t,n,i){t[i?0:1].push(n)}),(function(){return[[],[]]}));var mi=baseRest((function(t,n){if(null==t)return[];var i=n.length;return i>1&&isIterateeCall(t,n[0],n[1])?n=[]:i>2&&isIterateeCall(n[0],n[1],n[2])&&(n=[n[0]]),baseOrderBy(t,baseFlatten(n,1),[])})),vi=Ne||function(){return je.Date.now()};function ary(t,n,r){return n=r?i:n,n=t&&null==n?t.length:n,createWrap(t,p,i,i,i,i,n)}function before(t,n){var o;if("function"!=typeof n)throw new qt(r);return t=toInteger(t),function(){return--t>0&&(o=n.apply(this,arguments)),t<=1&&(n=i),o}}var _i=baseRest((function(t,n,i){var r=1;if(i.length){var o=replaceHolders(i,getHolder(_i));r|=u}return createWrap(t,r,n,i,o)})),yi=baseRest((function(t,n,i){var r=3;if(i.length){var o=replaceHolders(i,getHolder(yi));r|=u}return createWrap(n,r,t,i,o)}));function debounce(t,n,o){var h,c,u,d,p,g,m=0,v=!1,_=!1,y=!0;if("function"!=typeof t)throw new qt(r);function invokeFunc(n){var r=h,o=c;return h=c=i,m=n,d=t.apply(o,r)}function shouldInvoke(t){var r=t-g;return g===i||r>=n||r<0||_&&t-m>=u}function timerExpired(){var t=vi();if(shouldInvoke(t))return trailingEdge(t);p=Fn(timerExpired,function remainingWait(t){var i=n-(t-g);return _?rn(i,u-(t-m)):i}(t))}function trailingEdge(t){return p=i,y&&h?invokeFunc(t):(h=c=i,d)}function debounced(){var t=vi(),r=shouldInvoke(t);if(h=arguments,c=this,g=t,r){if(p===i)return function leadingEdge(t){return m=t,p=Fn(timerExpired,n),v?invokeFunc(t):d}(g);if(_)return Dn(p),p=Fn(timerExpired,n),invokeFunc(g)}return p===i&&(p=Fn(timerExpired,n)),d}return n=toNumber(n)||0,isObject(o)&&(v=!!o.leading,u=(_="maxWait"in o)?nn(toNumber(o.maxWait)||0,n):u,y="trailing"in o?!!o.trailing:y),debounced.cancel=function cancel(){p!==i&&Dn(p),m=0,h=g=c=p=i},debounced.flush=function flush(){return p===i?d:trailingEdge(vi())},debounced}var wi=baseRest((function(t,n){return baseDelay(t,1,n)})),bi=baseRest((function(t,n,i){return baseDelay(t,toNumber(n)||0,i)}));function memoize(t,n){if("function"!=typeof t||null!=n&&"function"!=typeof n)throw new qt(r);var memoized=function(){var i=arguments,r=n?n.apply(this,i):i[0],o=memoized.cache;if(o.has(r))return o.get(r);var h=t.apply(this,i);return memoized.cache=o.set(r,h)||o,h};return memoized.cache=new(memoize.Cache||MapCache),memoized}function negate(t){if("function"!=typeof t)throw new qt(r);return function(){var n=arguments;switch(n.length){case 0:return!t.call(this);case 1:return!t.call(this,n[0]);case 2:return!t.call(this,n[0],n[1]);case 3:return!t.call(this,n[0],n[1],n[2])}return!t.apply(this,n)}}memoize.Cache=MapCache;var xi=Ln((function(t,n){var i=(n=1==n.length&&Ei(n[0])?arrayMap(n[0],baseUnary(getIteratee())):arrayMap(baseFlatten(n,1),baseUnary(getIteratee()))).length;return baseRest((function(r){for(var o=-1,h=rn(r.length,i);++o<h;)r[o]=n[o].call(this,r[o]);return apply(t,this,r)}))})),Si=baseRest((function(t,n){var r=replaceHolders(n,getHolder(Si));return createWrap(t,u,i,n,r)})),Ci=baseRest((function(t,n){var r=replaceHolders(n,getHolder(Ci));return createWrap(t,d,i,n,r)})),ki=flatRest((function(t,n){return createWrap(t,g,i,i,i,n)}));function eq(t,n){return t===n||t!=t&&n!=n}var Pi=createRelationalOperation(baseGt),Ii=createRelationalOperation((function(t,n){return t>=n})),Mi=baseIsArguments(function(){return arguments}())?baseIsArguments:function(t){return isObjectLike(t)&&Gt.call(t,"callee")&&!_e.call(t,"callee")},Ei=yt.isArray,Ai=qe?baseUnary(qe):function baseIsArrayBuffer(t){return isObjectLike(t)&&baseGetTag(t)==F};function isArrayLike(t){return null!=t&&isLength(t.length)&&!isFunction(t)}function isArrayLikeObject(t){return isObjectLike(t)&&isArrayLike(t)}var Ti=Fe||stubFalse,Oi=We?baseUnary(We):function baseIsDate(t){return isObjectLike(t)&&baseGetTag(t)==k};function isError(t){if(!isObjectLike(t))return!1;var n=baseGetTag(t);return n==P||"[object DOMException]"==n||"string"==typeof t.message&&"string"==typeof t.name&&!isPlainObject(t)}function isFunction(t){if(!isObject(t))return!1;var n=baseGetTag(t);return n==I||n==M||"[object AsyncFunction]"==n||"[object Proxy]"==n}function isInteger2(t){return"number"==typeof t&&t==toInteger(t)}function isLength(t){return"number"==typeof t&&t>-1&&t%1==0&&t<=v}function isObject(t){var n=typeof t;return null!=t&&("object"==n||"function"==n)}function isObjectLike(t){return null!=t&&"object"==typeof t}var Li=Ye?baseUnary(Ye):function baseIsMap(t){return isObjectLike(t)&&Un(t)==E};function isNumber(t){return"number"==typeof t||isObjectLike(t)&&baseGetTag(t)==T}function isPlainObject(t){if(!isObjectLike(t)||baseGetTag(t)!=O)return!1;var n=fe(t);if(null===n)return!0;var i=Gt.call(n,"constructor")&&n.constructor;return"function"==typeof i&&i instanceof i&&$t.call(i)==Qt}var Di=He?baseUnary(He):function baseIsRegExp(t){return isObjectLike(t)&&baseGetTag(t)==N};var Ni=Ke?baseUnary(Ke):function baseIsSet(t){return isObjectLike(t)&&Un(t)==j};function isString(t){return"string"==typeof t||!Ei(t)&&isObjectLike(t)&&baseGetTag(t)==V}function isSymbol(t){return"symbol"==typeof t||isObjectLike(t)&&baseGetTag(t)==U}var Ri=$e?baseUnary($e):function baseIsTypedArray(t){return isObjectLike(t)&&isLength(t.length)&&!!Ae[baseGetTag(t)]};var ji=createRelationalOperation(baseLt),Vi=createRelationalOperation((function(t,n){return t<=n}));function toArray(t){if(!t)return[];if(isArrayLike(t))return isString(t)?stringToArray(t):copyArray(t);if(be&&t[be])return function iteratorToArray(t){for(var n,i=[];!(n=t.next()).done;)i.push(n.value);return i}(t[be]());var n=Un(t);return(n==E?mapToArray:n==j?setToArray:values)(t)}function toFinite(t){return t?(t=toNumber(t))===m||t===-1/0?17976931348623157e292*(t<0?-1:1):t==t?t:0:0===t?t:0}function toInteger(t){var n=toFinite(t),i=n%1;return n==n?i?n-i:n:0}function toLength(t){return t?baseClamp(toInteger(t),0,y):0}function toNumber(t){if("number"==typeof t)return t;if(isSymbol(t))return _;if(isObject(t)){var n="function"==typeof t.valueOf?t.valueOf():t;t=isObject(n)?n+"":n}if("string"!=typeof t)return 0===t?t:+t;t=baseTrim(t);var i=Et.test(t);return i||Tt.test(t)?De(t.slice(2),i?2:8):Mt.test(t)?_:+t}function toPlainObject(t){return copyObject(t,keysIn(t))}function toString(t){return null==t?"":baseToString(t)}var Ui=createAssigner((function(t,n){if(isPrototype(n)||isArrayLike(n))copyObject(n,keys2(n),t);else for(var i in n)Gt.call(n,i)&&assignValue(t,i,n[i])})),zi=createAssigner((function(t,n){copyObject(n,keysIn(n),t)})),Bi=createAssigner((function(t,n,i,r){copyObject(n,keysIn(n),t,r)})),Fi=createAssigner((function(t,n,i,r){copyObject(n,keys2(n),t,r)})),qi=flatRest(baseAt);var Wi=baseRest((function(t,n){t=zt(t);var r=-1,o=n.length,h=o>2?n[2]:i;for(h&&isIterateeCall(n[0],n[1],h)&&(o=1);++r<o;)for(var c=n[r],u=keysIn(c),d=-1,p=u.length;++d<p;){var g=u[d],m=t[g];(m===i||eq(m,Ht[g])&&!Gt.call(t,g))&&(t[g]=c[g])}return t})),Yi=baseRest((function(t){return t.push(i,customDefaultsMerge),apply(Xi,i,t)}));function get(t,n,r){var o=null==t?i:baseGet(t,n);return o===i?r:o}function hasIn(t,n){return null!=t&&hasPath(t,n,baseHasIn)}var Hi=createInverter((function(t,n,i){null!=n&&"function"!=typeof n.toString&&(n=Zt.call(n)),t[n]=i}),constant(identity)),Ki=createInverter((function(t,n,i){null!=n&&"function"!=typeof n.toString&&(n=Zt.call(n)),Gt.call(t,n)?t[n].push(i):t[n]=[i]}),getIteratee),$i=baseRest(baseInvoke);function keys2(t){return isArrayLike(t)?arrayLikeKeys(t):baseKeys(t)}function keysIn(t){return isArrayLike(t)?arrayLikeKeys(t,!0):baseKeysIn(t)}var Gi=createAssigner((function(t,n,i){baseMerge(t,n,i)})),Xi=createAssigner((function(t,n,i,r){baseMerge(t,n,i,r)})),Ji=flatRest((function(t,n){var i={};if(null==t)return i;var r=!1;n=arrayMap(n,(function(n){return n=castPath(n,t),r||(r=n.length>1),n})),copyObject(t,getAllKeysIn(t),i),r&&(i=baseClone(i,7,customOmitClone));for(var o=n.length;o--;)baseUnset(i,n[o]);return i}));var Zi=flatRest((function(t,n){return null==t?{}:function basePick(t,n){return basePickBy(t,n,(function(n,i){return hasIn(t,i)}))}(t,n)}));function pickBy(t,n){if(null==t)return{};var i=arrayMap(getAllKeysIn(t),(function(t){return[t]}));return n=getIteratee(n),basePickBy(t,i,(function(t,i){return n(t,i[0])}))}var Qi=createToPairs(keys2),tr=createToPairs(keysIn);function values(t){return null==t?[]:baseValues(t,keys2(t))}var er=createCompounder((function(t,n,i){return n=n.toLowerCase(),t+(i?capitalize(n):n)}));function capitalize(t){return hr(toString(t).toLowerCase())}function deburr(t){return(t=toString(t))&&t.replace(Lt,Xe).replace(Se,"")}var nr=createCompounder((function(t,n,i){return t+(i?"-":"")+n.toLowerCase()})),ir=createCompounder((function(t,n,i){return t+(i?" ":"")+n.toLowerCase()})),rr=createCaseFirst("toLowerCase");var sr=createCompounder((function(t,n,i){return t+(i?"_":"")+n.toLowerCase()}));var ar=createCompounder((function(t,n,i){return t+(i?" ":"")+hr(n)}));var or=createCompounder((function(t,n,i){return t+(i?" ":"")+n.toUpperCase()})),hr=createCaseFirst("toUpperCase");function words(t,n,r){return t=toString(t),(n=r?i:n)===i?function hasUnicodeWord(t){return Ie.test(t)}(t)?function unicodeWords(t){return t.match(ke)||[]}(t):function asciiWords(t){return t.match(St)||[]}(t):t.match(n)||[]}var lr=baseRest((function(t,n){try{return apply(t,i,n)}catch(dr){return isError(dr)?dr:new jt(dr)}})),cr=flatRest((function(t,n){return arrayEach(n,(function(n){n=toKey(n),baseAssignValue(t,n,_i(t[n],t))})),t}));function constant(t){return function(){return t}}var ur=createFlow(),pr=createFlow(!0);function identity(t){return t}function iteratee(t){return baseIteratee("function"==typeof t?t:baseClone(t,1))}var fr=baseRest((function(t,n){return function(i){return baseInvoke(i,t,n)}})),gr=baseRest((function(t,n){return function(i){return baseInvoke(t,i,n)}}));function mixin(t,n,i){var r=keys2(n),o=baseFunctions(n,r);null!=i||isObject(n)&&(o.length||!r.length)||(i=n,n=t,t=this,o=baseFunctions(n,keys2(n)));var h=!(isObject(i)&&"chain"in i&&!i.chain),c=isFunction(t);return arrayEach(o,(function(i){var r=n[i];t[i]=r,c&&(t.prototype[i]=function(){var n=this.__chain__;if(h||n){var i=t(this.__wrapped__);return(i.__actions__=copyArray(this.__actions__)).push({func:r,args:arguments,thisArg:t}),i.__chain__=n,i}return r.apply(t,arrayPush([this.value()],arguments))})})),t}function noop(){}var mr=createOver(arrayMap),vr=createOver(arrayEvery),_r=createOver(arraySome);function property(t){return isKey(t)?baseProperty(toKey(t)):function basePropertyDeep(t){return function(n){return baseGet(n,t)}}(t)}var yr=createRange(),wr=createRange(!0);function stubArray(){return[]}function stubFalse(){return!1}var br=createMathOperation((function(t,n){return t+n}),0),xr=createRound("ceil"),Sr=createMathOperation((function(t,n){return t/n}),1),Cr=createRound("floor");var kr,Pr=createMathOperation((function(t,n){return t*n}),1),Ir=createRound("round"),Mr=createMathOperation((function(t,n){return t-n}),0);return lodash.after=function after(t,n){if("function"!=typeof n)throw new qt(r);return t=toInteger(t),function(){if(--t<1)return n.apply(this,arguments)}},lodash.ary=ary,lodash.assign=Ui,lodash.assignIn=zi,lodash.assignInWith=Bi,lodash.assignWith=Fi,lodash.at=qi,lodash.before=before,lodash.bind=_i,lodash.bindAll=cr,lodash.bindKey=yi,lodash.castArray=function castArray(){if(!arguments.length)return[];var t=arguments[0];return Ei(t)?t:[t]},lodash.chain=chain,lodash.chunk=function chunk8(t,n,r){n=(r?isIterateeCall(t,n,r):n===i)?1:nn(toInteger(n),0);var o=null==t?0:t.length;if(!o||n<1)return[];for(var h=0,c=0,u=yt(Ve(o/n));h<o;)u[c++]=baseSlice(t,h,h+=n);return u},lodash.compact=function compact(t){for(var n=-1,i=null==t?0:t.length,r=0,o=[];++n<i;){var h=t[n];h&&(o[r++]=h)}return o},lodash.concat=function concat(){var t=arguments.length;if(!t)return[];for(var n=yt(t-1),i=arguments[0],r=t;r--;)n[r-1]=arguments[r];return arrayPush(Ei(i)?copyArray(i):[i],baseFlatten(n,1))},lodash.cond=function cond(t){var n=null==t?0:t.length,i=getIteratee();return t=n?arrayMap(t,(function(t){if("function"!=typeof t[1])throw new qt(r);return[i(t[0]),t[1]]})):[],baseRest((function(i){for(var r=-1;++r<n;){var o=t[r];if(apply(o[0],this,i))return apply(o[1],this,i)}}))},lodash.conforms=function conforms(t){return function baseConforms(t){var n=keys2(t);return function(i){return baseConformsTo(i,t,n)}}(baseClone(t,1))},lodash.constant=constant,lodash.countBy=li,lodash.create=function create2(t,n){var i=Pn(t);return null==n?i:baseAssign(i,n)},lodash.curry=function curry(t,n,r){var o=createWrap(t,8,i,i,i,i,i,n=r?i:n);return o.placeholder=curry.placeholder,o},lodash.curryRight=function curryRight(t,n,r){var o=createWrap(t,c,i,i,i,i,i,n=r?i:n);return o.placeholder=curryRight.placeholder,o},lodash.debounce=debounce,lodash.defaults=Wi,lodash.defaultsDeep=Yi,lodash.defer=wi,lodash.delay=bi,lodash.difference=Yn,lodash.differenceBy=Hn,lodash.differenceWith=Kn,lodash.drop=function drop(t,n,r){var o=null==t?0:t.length;return o?baseSlice(t,(n=r||n===i?1:toInteger(n))<0?0:n,o):[]},lodash.dropRight=function dropRight(t,n,r){var o=null==t?0:t.length;return o?baseSlice(t,0,(n=o-(n=r||n===i?1:toInteger(n)))<0?0:n):[]},lodash.dropRightWhile=function dropRightWhile(t,n){return t&&t.length?baseWhile(t,getIteratee(n,3),!0,!0):[]},lodash.dropWhile=function dropWhile(t,n){return t&&t.length?baseWhile(t,getIteratee(n,3),!0):[]},lodash.fill=function fill(t,n,r,o){var h=null==t?0:t.length;return h?(r&&"number"!=typeof r&&isIterateeCall(t,n,r)&&(r=0,o=h),function baseFill(t,n,r,o){var h=t.length;for((r=toInteger(r))<0&&(r=-r>h?0:h+r),(o=o===i||o>h?h:toInteger(o))<0&&(o+=h),o=r>o?0:toLength(o);r<o;)t[r++]=n;return t}(t,n,r,o)):[]},lodash.filter=function filter(t,n){return(Ei(t)?arrayFilter:baseFilter)(t,getIteratee(n,3))},lodash.flatMap=function flatMap(t,n){return baseFlatten(map2(t,n),1)},lodash.flatMapDeep=function flatMapDeep(t,n){return baseFlatten(map2(t,n),m)},lodash.flatMapDepth=function flatMapDepth(t,n,r){return r=r===i?1:toInteger(r),baseFlatten(map2(t,n),r)},lodash.flatten=flatten,lodash.flattenDeep=function flattenDeep2(t){return(null==t?0:t.length)?baseFlatten(t,m):[]},lodash.flattenDepth=function flattenDepth(t,n){return(null==t?0:t.length)?baseFlatten(t,n=n===i?1:toInteger(n)):[]},lodash.flip=function flip(t){return createWrap(t,512)},lodash.flow=ur,lodash.flowRight=pr,lodash.fromPairs=function fromPairs(t){for(var n=-1,i=null==t?0:t.length,r={};++n<i;){var o=t[n];r[o[0]]=o[1]}return r},lodash.functions=function functions(t){return null==t?[]:baseFunctions(t,keys2(t))},lodash.functionsIn=function functionsIn(t){return null==t?[]:baseFunctions(t,keysIn(t))},lodash.groupBy=di,lodash.initial=function initial(t){return(null==t?0:t.length)?baseSlice(t,0,-1):[]},lodash.intersection=$n,lodash.intersectionBy=Gn,lodash.intersectionWith=Xn,lodash.invert=Hi,lodash.invertBy=Ki,lodash.invokeMap=pi,lodash.iteratee=iteratee,lodash.keyBy=fi,lodash.keys=keys2,lodash.keysIn=keysIn,lodash.map=map2,lodash.mapKeys=function mapKeys(t,n){var i={};return n=getIteratee(n,3),baseForOwn(t,(function(t,r,o){baseAssignValue(i,n(t,r,o),t)})),i},lodash.mapValues=function mapValues(t,n){var i={};return n=getIteratee(n,3),baseForOwn(t,(function(t,r,o){baseAssignValue(i,r,n(t,r,o))})),i},lodash.matches=function matches(t){return baseMatches(baseClone(t,1))},lodash.matchesProperty=function matchesProperty(t,n){return baseMatchesProperty(t,baseClone(n,1))},lodash.memoize=memoize,lodash.merge=Gi,lodash.mergeWith=Xi,lodash.method=fr,lodash.methodOf=gr,lodash.mixin=mixin,lodash.negate=negate,lodash.nthArg=function nthArg(t){return t=toInteger(t),baseRest((function(n){return baseNth(n,t)}))},lodash.omit=Ji,lodash.omitBy=function omitBy(t,n){return pickBy(t,negate(getIteratee(n)))},lodash.once=function once(t){return before(2,t)},lodash.orderBy=function orderBy(t,n,r,o){return null==t?[]:(Ei(n)||(n=null==n?[]:[n]),Ei(r=o?i:r)||(r=null==r?[]:[r]),baseOrderBy(t,n,r))},lodash.over=mr,lodash.overArgs=xi,lodash.overEvery=vr,lodash.overSome=_r,lodash.partial=Si,lodash.partialRight=Ci,lodash.partition=gi,lodash.pick=Zi,lodash.pickBy=pickBy,lodash.property=property,lodash.propertyOf=function propertyOf(t){return function(n){return null==t?i:baseGet(t,n)}},lodash.pull=Jn,lodash.pullAll=pullAll,lodash.pullAllBy=function pullAllBy(t,n,i){return t&&t.length&&n&&n.length?basePullAll(t,n,getIteratee(i,2)):t},lodash.pullAllWith=function pullAllWith(t,n,r){return t&&t.length&&n&&n.length?basePullAll(t,n,i,r):t},lodash.pullAt=Zn,lodash.range=yr,lodash.rangeRight=wr,lodash.rearg=ki,lodash.reject=function reject(t,n){return(Ei(t)?arrayFilter:baseFilter)(t,negate(getIteratee(n,3)))},lodash.remove=function remove(t,n){var i=[];if(!t||!t.length)return i;var r=-1,o=[],h=t.length;for(n=getIteratee(n,3);++r<h;){var c=t[r];n(c,r,t)&&(i.push(c),o.push(r))}return basePullAt(t,o),i},lodash.rest=function rest(t,n){if("function"!=typeof t)throw new qt(r);return baseRest(t,n=n===i?n:toInteger(n))},lodash.reverse=reverse,lodash.sampleSize=function sampleSize(t,n,r){return n=(r?isIterateeCall(t,n,r):n===i)?1:toInteger(n),(Ei(t)?arraySampleSize:baseSampleSize)(t,n)},lodash.set=function set(t,n,i){return null==t?t:baseSet(t,n,i)},lodash.setWith=function setWith(t,n,r,o){return o="function"==typeof o?o:i,null==t?t:baseSet(t,n,r,o)},lodash.shuffle=function shuffle(t){return(Ei(t)?arrayShuffle:baseShuffle)(t)},lodash.slice=function slice(t,n,r){var o=null==t?0:t.length;return o?(r&&"number"!=typeof r&&isIterateeCall(t,n,r)?(n=0,r=o):(n=null==n?0:toInteger(n),r=r===i?o:toInteger(r)),baseSlice(t,n,r)):[]},lodash.sortBy=mi,lodash.sortedUniq=function sortedUniq(t){return t&&t.length?baseSortedUniq(t):[]},lodash.sortedUniqBy=function sortedUniqBy(t,n){return t&&t.length?baseSortedUniq(t,getIteratee(n,2)):[]},lodash.split=function split(t,n,r){return r&&"number"!=typeof r&&isIterateeCall(t,n,r)&&(n=r=i),(r=r===i?y:r>>>0)?(t=toString(t))&&("string"==typeof n||null!=n&&!Di(n))&&!(n=baseToString(n))&&hasUnicode(t)?castSlice(stringToArray(t),0,r):t.split(n,r):[]},lodash.spread=function spread(t,n){if("function"!=typeof t)throw new qt(r);return n=null==n?0:nn(toInteger(n),0),baseRest((function(i){var r=i[n],o=castSlice(i,0,n);return r&&arrayPush(o,r),apply(t,this,o)}))},lodash.tail=function tail(t){var n=null==t?0:t.length;return n?baseSlice(t,1,n):[]},lodash.take=function take(t,n,r){return t&&t.length?baseSlice(t,0,(n=r||n===i?1:toInteger(n))<0?0:n):[]},lodash.takeRight=function takeRight(t,n,r){var o=null==t?0:t.length;return o?baseSlice(t,(n=o-(n=r||n===i?1:toInteger(n)))<0?0:n,o):[]},lodash.takeRightWhile=function takeRightWhile(t,n){return t&&t.length?baseWhile(t,getIteratee(n,3),!1,!0):[]},lodash.takeWhile=function takeWhile(t,n){return t&&t.length?baseWhile(t,getIteratee(n,3)):[]},lodash.tap=function tap(t,n){return n(t),t},lodash.throttle=function throttle(t,n,i){var o=!0,h=!0;if("function"!=typeof t)throw new qt(r);return isObject(i)&&(o="leading"in i?!!i.leading:o,h="trailing"in i?!!i.trailing:h),debounce(t,n,{leading:o,maxWait:n,trailing:h})},lodash.thru=thru,lodash.toArray=toArray,lodash.toPairs=Qi,lodash.toPairsIn=tr,lodash.toPath=function toPath(t){return Ei(t)?arrayMap(t,toKey):isSymbol(t)?[t]:copyArray(Wn(toString(t)))},lodash.toPlainObject=toPlainObject,lodash.transform=function transform(t,n,i){var r=Ei(t),o=r||Ti(t)||Ri(t);if(n=getIteratee(n,4),null==i){var h=t&&t.constructor;i=o?r?new h:[]:isObject(t)&&isFunction(h)?Pn(fe(t)):{}}return(o?arrayEach:baseForOwn)(t,(function(t,r,o){return n(i,t,r,o)})),i},lodash.unary=function unary(t){return ary(t,1)},lodash.union=Qn,lodash.unionBy=ti,lodash.unionWith=ei,lodash.uniq=function uniq(t){return t&&t.length?baseUniq(t):[]},lodash.uniqBy=function uniqBy(t,n){return t&&t.length?baseUniq(t,getIteratee(n,2)):[]},lodash.uniqWith=function uniqWith(t,n){return n="function"==typeof n?n:i,t&&t.length?baseUniq(t,i,n):[]},lodash.unset=function unset(t,n){return null==t||baseUnset(t,n)},lodash.unzip=unzip,lodash.unzipWith=unzipWith,lodash.update=function update(t,n,i){return null==t?t:baseUpdate(t,n,castFunction(i))},lodash.updateWith=function updateWith(t,n,r,o){return o="function"==typeof o?o:i,null==t?t:baseUpdate(t,n,castFunction(r),o)},lodash.values=values,lodash.valuesIn=function valuesIn(t){return null==t?[]:baseValues(t,keysIn(t))},lodash.without=ni,lodash.words=words,lodash.wrap=function wrap(t,n){return Si(castFunction(n),t)},lodash.xor=ii,lodash.xorBy=ri,lodash.xorWith=si,lodash.zip=ai,lodash.zipObject=function zipObject(t,n){return baseZipObject(t||[],n||[],assignValue)},lodash.zipObjectDeep=function zipObjectDeep(t,n){return baseZipObject(t||[],n||[],baseSet)},lodash.zipWith=oi,lodash.entries=Qi,lodash.entriesIn=tr,lodash.extend=zi,lodash.extendWith=Bi,mixin(lodash,lodash),lodash.add=br,lodash.attempt=lr,lodash.camelCase=er,lodash.capitalize=capitalize,lodash.ceil=xr,lodash.clamp=function clamp(t,n,r){return r===i&&(r=n,n=i),r!==i&&(r=(r=toNumber(r))==r?r:0),n!==i&&(n=(n=toNumber(n))==n?n:0),baseClamp(toNumber(t),n,r)},lodash.clone=function clone(t){return baseClone(t,4)},lodash.cloneDeep=function cloneDeep2(t){return baseClone(t,5)},lodash.cloneDeepWith=function cloneDeepWith(t,n){return baseClone(t,5,n="function"==typeof n?n:i)},lodash.cloneWith=function cloneWith(t,n){return baseClone(t,4,n="function"==typeof n?n:i)},lodash.conformsTo=function conformsTo(t,n){return null==n||baseConformsTo(t,n,keys2(n))},lodash.deburr=deburr,lodash.defaultTo=function defaultTo(t,n){return null==t||t!=t?n:t},lodash.divide=Sr,lodash.endsWith=function endsWith(t,n,r){t=toString(t),n=baseToString(n);var o=t.length,h=r=r===i?o:baseClamp(toInteger(r),0,o);return(r-=n.length)>=0&&t.slice(r,h)==n},lodash.eq=eq,lodash.escape=function escape2(t){return(t=toString(t))&&lt.test(t)?t.replace(ot,Je):t},lodash.escapeRegExp=function escapeRegExp(t){return(t=toString(t))&&vt.test(t)?t.replace(mt,"\\</head>"):t},lodash.every=function every2(t,n,r){var o=Ei(t)?arrayEvery:baseEvery;return r&&isIterateeCall(t,n,r)&&(n=i),o(t,getIteratee(n,3))},lodash.find=ci,lodash.findIndex=findIndex,lodash.findKey=function findKey(t,n){return baseFindKey(t,getIteratee(n,3),baseForOwn)},lodash.findLast=ui,lodash.findLastIndex=findLastIndex,lodash.findLastKey=function findLastKey(t,n){return baseFindKey(t,getIteratee(n,3),baseForOwnRight)},lodash.floor=Cr,lodash.forEach=forEach2,lodash.forEachRight=forEachRight,lodash.forIn=function forIn(t,n){return null==t?t:En(t,getIteratee(n,3),keysIn)},lodash.forInRight=function forInRight(t,n){return null==t?t:An(t,getIteratee(n,3),keysIn)},lodash.forOwn=function forOwn(t,n){return t&&baseForOwn(t,getIteratee(n,3))},lodash.forOwnRight=function forOwnRight(t,n){return t&&baseForOwnRight(t,getIteratee(n,3))},lodash.get=get,lodash.gt=Pi,lodash.gte=Ii,lodash.has=function has(t,n){return null!=t&&hasPath(t,n,baseHas)},lodash.hasIn=hasIn,lodash.head=head,lodash.identity=identity,lodash.includes=function includes(t,n,i,r){t=isArrayLike(t)?t:values(t),i=i&&!r?toInteger(i):0;var o=t.length;return i<0&&(i=nn(o+i,0)),isString(t)?i<=o&&t.indexOf(n,i)>-1:!!o&&baseIndexOf(t,n,i)>-1},lodash.indexOf=function indexOf(t,n,i){var r=null==t?0:t.length;if(!r)return-1;var o=null==i?0:toInteger(i);return o<0&&(o=nn(r+o,0)),baseIndexOf(t,n,o)},lodash.inRange=function inRange(t,n,r){return n=toFinite(n),r===i?(r=n,n=0):r=toFinite(r),function baseInRange(t,n,i){return t>=rn(n,i)&&t<nn(n,i)}(t=toNumber(t),n,r)},lodash.invoke=$i,lodash.isArguments=Mi,lodash.isArray=Ei,lodash.isArrayBuffer=Ai,lodash.isArrayLike=isArrayLike,lodash.isArrayLikeObject=isArrayLikeObject,lodash.isBoolean=function isBoolean(t){return!0===t||!1===t||isObjectLike(t)&&baseGetTag(t)==C},lodash.isBuffer=Ti,lodash.isDate=Oi,lodash.isElement=function isElement(t){return isObjectLike(t)&&1===t.nodeType&&!isPlainObject(t)},lodash.isEmpty=function isEmpty2(t){if(null==t)return!0;if(isArrayLike(t)&&(Ei(t)||"string"==typeof t||"function"==typeof t.splice||Ti(t)||Ri(t)||Mi(t)))return!t.length;var n=Un(t);if(n==E||n==j)return!t.size;if(isPrototype(t))return!baseKeys(t).length;for(var i in t)if(Gt.call(t,i))return!1;return!0},lodash.isEqual=function isEqual(t,n){return baseIsEqual(t,n)},lodash.isEqualWith=function isEqualWith(t,n,r){var o=(r="function"==typeof r?r:i)?r(t,n):i;return o===i?baseIsEqual(t,n,i,r):!!o},lodash.isError=isError,lodash.isFinite=function isFinite2(t){return"number"==typeof t&&Ge(t)},lodash.isFunction=isFunction,lodash.isInteger=isInteger2,lodash.isLength=isLength,lodash.isMap=Li,lodash.isMatch=function isMatch(t,n){return t===n||baseIsMatch(t,n,getMatchData(n))},lodash.isMatchWith=function isMatchWith(t,n,r){return r="function"==typeof r?r:i,baseIsMatch(t,n,getMatchData(n),r)},lodash.isNaN=function isNaN2(t){return isNumber(t)&&t!=+t},lodash.isNative=function isNative(t){if(zn(t))throw new jt("Unsupported core-js use. Try https://npms.io/search?q=ponyfill.");return baseIsNative(t)},lodash.isNil=function isNil(t){return null==t},lodash.isNull=function isNull(t){return null===t},lodash.isNumber=isNumber,lodash.isObject=isObject,lodash.isObjectLike=isObjectLike,lodash.isPlainObject=isPlainObject,lodash.isRegExp=Di,lodash.isSafeInteger=function isSafeInteger(t){return isInteger2(t)&&t>=-9007199254740991&&t<=v},lodash.isSet=Ni,lodash.isString=isString,lodash.isSymbol=isSymbol,lodash.isTypedArray=Ri,lodash.isUndefined=function isUndefined(t){return t===i},lodash.isWeakMap=function isWeakMap(t){return isObjectLike(t)&&Un(t)==z},lodash.isWeakSet=function isWeakSet(t){return isObjectLike(t)&&"[object WeakSet]"==baseGetTag(t)},lodash.join=function join(t,n){return null==t?"":tn.call(t,n)},lodash.kebabCase=nr,lodash.last=last2,lodash.lastIndexOf=function lastIndexOf(t,n,r){var o=null==t?0:t.length;if(!o)return-1;var h=o;return r!==i&&(h=(h=toInteger(r))<0?nn(o+h,0):rn(h,o-1)),n==n?function strictLastIndexOf(t,n,i){for(var r=i+1;r--;)if(t[r]===n)return r;return r}(t,n,h):baseFindIndex(t,baseIsNaN,h,!0)},lodash.lowerCase=ir,lodash.lowerFirst=rr,lodash.lt=ji,lodash.lte=Vi,lodash.max=function max2(t){return t&&t.length?baseExtremum(t,identity,baseGt):i},lodash.maxBy=function maxBy(t,n){return t&&t.length?baseExtremum(t,getIteratee(n,2),baseGt):i},lodash.mean=function mean(t){return baseMean(t,identity)},lodash.meanBy=function meanBy(t,n){return baseMean(t,getIteratee(n,2))},lodash.min=function min2(t){return t&&t.length?baseExtremum(t,identity,baseLt):i},lodash.minBy=function minBy(t,n){return t&&t.length?baseExtremum(t,getIteratee(n,2),baseLt):i},lodash.stubArray=stubArray,lodash.stubFalse=stubFalse,lodash.stubObject=function stubObject(){return{}},lodash.stubString=function stubString(){return""},lodash.stubTrue=function stubTrue(){return!0},lodash.multiply=Pr,lodash.nth=function nth(t,n){return t&&t.length?baseNth(t,toInteger(n)):i},lodash.noConflict=function noConflict(){return je._===this&&(je._=te),this},lodash.noop=noop,lodash.now=vi,lodash.pad=function pad(t,n,i){t=toString(t);var r=(n=toInteger(n))?stringSize(t):0;if(!n||r>=n)return t;var o=(n-r)/2;return createPadding(Ue(o),i)+t+createPadding(Ve(o),i)},lodash.padEnd=function padEnd(t,n,i){t=toString(t);var r=(n=toInteger(n))?stringSize(t):0;return n&&r<n?t+createPadding(n-r,i):t},lodash.padStart=function padStart(t,n,i){t=toString(t);var r=(n=toInteger(n))?stringSize(t):0;return n&&r<n?createPadding(n-r,i)+t:t},lodash.parseInt=function parseInt2(t,n,i){return i||null==n?n=0:n&&(n=+n),an(toString(t).replace(_t,""),n||0)},lodash.random=function random(t,n,r){if(r&&"boolean"!=typeof r&&isIterateeCall(t,n,r)&&(n=r=i),r===i&&("boolean"==typeof n?(r=n,n=i):"boolean"==typeof t&&(r=t,t=i)),t===i&&n===i?(t=0,n=1):(t=toFinite(t),n===i?(n=t,t=0):n=toFinite(n)),t>n){var o=t;t=n,n=o}if(r||t%1||n%1){var h=hn();return rn(t+h*(n-t+Le("1e-"+((h+"").length-1))),n)}return baseRandom(t,n)},lodash.reduce=function reduce(t,n,i){var r=Ei(t)?arrayReduce:baseReduce,o=arguments.length<3;return r(t,getIteratee(n,4),i,o,In)},lodash.reduceRight=function reduceRight(t,n,i){var r=Ei(t)?arrayReduceRight:baseReduce,o=arguments.length<3;return r(t,getIteratee(n,4),i,o,Mn)},lodash.repeat=function repeat(t,n,r){return n=(r?isIterateeCall(t,n,r):n===i)?1:toInteger(n),baseRepeat(toString(t),n)},lodash.replace=function replace(){var t=arguments,n=toString(t[0]);return t.length<3?n:n.replace(t[1],t[2])},lodash.result=function result(t,n,r){var o=-1,h=(n=castPath(n,t)).length;for(h||(h=1,t=i);++o<h;){var c=null==t?i:t[toKey(n[o])];c===i&&(o=h,c=r),t=isFunction(c)?c.call(t):c}return t},lodash.round=Ir,lodash.runInContext=runInContext2,lodash.sample=function sample(t){return(Ei(t)?arraySample:baseSample)(t)},lodash.size=function size2(t){if(null==t)return 0;if(isArrayLike(t))return isString(t)?stringSize(t):t.length;var n=Un(t);return n==E||n==j?t.size:baseKeys(t).length},lodash.snakeCase=sr,lodash.some=function some2(t,n,r){var o=Ei(t)?arraySome:baseSome;return r&&isIterateeCall(t,n,r)&&(n=i),o(t,getIteratee(n,3))},lodash.sortedIndex=function sortedIndex(t,n){return baseSortedIndex(t,n)},lodash.sortedIndexBy=function sortedIndexBy(t,n,i){return baseSortedIndexBy(t,n,getIteratee(i,2))},lodash.sortedIndexOf=function sortedIndexOf(t,n){var i=null==t?0:t.length;if(i){var r=baseSortedIndex(t,n);if(r<i&&eq(t[r],n))return r}return-1},lodash.sortedLastIndex=function sortedLastIndex(t,n){return baseSortedIndex(t,n,!0)},lodash.sortedLastIndexBy=function sortedLastIndexBy(t,n,i){return baseSortedIndexBy(t,n,getIteratee(i,2),!0)},lodash.sortedLastIndexOf=function sortedLastIndexOf(t,n){if(null==t?0:t.length){var i=baseSortedIndex(t,n,!0)-1;if(eq(t[i],n))return i}return-1},lodash.startCase=ar,lodash.startsWith=function startsWith(t,n,i){return t=toString(t),i=null==i?0:baseClamp(toInteger(i),0,t.length),n=baseToString(n),t.slice(i,i+n.length)==n},lodash.subtract=Mr,lodash.sum=function sum(t){return t&&t.length?baseSum(t,identity):0},lodash.sumBy=function sumBy(t,n){return t&&t.length?baseSum(t,getIteratee(n,2)):0},lodash.template=function template(t,n,r){var o=lodash.templateSettings;r&&isIterateeCall(t,n,r)&&(n=i),t=toString(t),n=Bi({},n,o,customDefaultsAssignIn);var h,c,u=Bi({},n.imports,o.imports,customDefaultsAssignIn),d=keys2(u),p=baseValues(u,d),g=0,m=n.interpolate||Dt,v="__p += '",_=Bt((n.escape||Dt).source+"|"+m.source+"|"+(m===dt?Pt:Dt).source+"|"+(n.evaluate||Dt).source+"|$","g"),y="//# sourceURL="+(Gt.call(n,"sourceURL")?(n.sourceURL+"").replace(/\s/g," "):"lodash.templateSources["+ ++Ee+"]")+"\n";t.replace(_,(function(n,i,r,o,u,d){return r||(r=o),v+=t.slice(g,d).replace(Nt,escapeStringChar),i&&(h=!0,v+="' +\n__e("+i+") +\n'"),u&&(c=!0,v+="';\n"+u+";\n__p += '"),r&&(v+="' +\n((__t = ("+r+")) == null ? '' : __t) +\n'"),g=d+n.length,n})),v+="';\n";var w=Gt.call(n,"variable")&&n.variable;if(w){if(Ct.test(w))throw new jt("Invalid `variable` option passed into `_.template`")}else v="with (obj) {\n"+v+"\n}\n";v=(c?v.replace(nt,""):v).replace(it,"$1").replace(rt,"$1;"),v="function("+(w||"obj")+") {\n"+(w?"":"obj || (obj = {});\n")+"var __t, __p = ''"+(h?", __e = _.escape":"")+(c?", __j = Array.prototype.join;\nfunction print() { __p += __j.call(arguments, '') }\n":";\n")+v+"return __p\n}";var x=lr((function(){return Vt(d,y+"return "+v).apply(i,p)}));if(x.source=v,isError(x))throw x;return x},lodash.times=function times(t,n){if((t=toInteger(t))<1||t>v)return[];var i=y,r=rn(t,y);n=getIteratee(n),t-=y;for(var o=baseTimes(r,n);++i<t;)n(i);return o},lodash.toFinite=toFinite,lodash.toInteger=toInteger,lodash.toLength=toLength,lodash.toLower=function toLower(t){return toString(t).toLowerCase()},lodash.toNumber=toNumber,lodash.toSafeInteger=function toSafeInteger(t){return t?baseClamp(toInteger(t),-9007199254740991,v):0===t?t:0},lodash.toString=toString,lodash.toUpper=function toUpper(t){return toString(t).toUpperCase()},lodash.trim=function trim(t,n,r){if((t=toString(t))&&(r||n===i))return baseTrim(t);if(!t||!(n=baseToString(n)))return t;var o=stringToArray(t),h=stringToArray(n);return castSlice(o,charsStartIndex(o,h),charsEndIndex(o,h)+1).join("")},lodash.trimEnd=function trimEnd(t,n,r){if((t=toString(t))&&(r||n===i))return t.slice(0,trimmedEndIndex(t)+1);if(!t||!(n=baseToString(n)))return t;var o=stringToArray(t);return castSlice(o,0,charsEndIndex(o,stringToArray(n))+1).join("")},lodash.trimStart=function trimStart(t,n,r){if((t=toString(t))&&(r||n===i))return t.replace(_t,"");if(!t||!(n=baseToString(n)))return t;var o=stringToArray(t);return castSlice(o,charsStartIndex(o,stringToArray(n))).join("")},lodash.truncate=function truncate(t,n){var r=30,o="...";if(isObject(n)){var h="separator"in n?n.separator:h;r="length"in n?toInteger(n.length):r,o="omission"in n?baseToString(n.omission):o}var c=(t=toString(t)).length;if(hasUnicode(t)){var u=stringToArray(t);c=u.length}if(r>=c)return t;var d=r-stringSize(o);if(d<1)return o;var p=u?castSlice(u,0,d).join(""):t.slice(0,d);if(h===i)return p+o;if(u&&(d+=p.length-d),Di(h)){if(t.slice(d).search(h)){var g,m=p;for(h.global||(h=Bt(h.source,toString(It.exec(h))+"g")),h.lastIndex=0;g=h.exec(m);)var v=g.index;p=p.slice(0,v===i?d:v)}}else if(t.indexOf(baseToString(h),d)!=d){var _=p.lastIndexOf(h);_>-1&&(p=p.slice(0,_))}return p+o},lodash.unescape=function unescape2(t){return(t=toString(t))&&ht.test(t)?t.replace(st,Ze):t},lodash.uniqueId=function uniqueId(t){var n=++Xt;return toString(t)+n},lodash.upperCase=or,lodash.upperFirst=hr,lodash.each=forEach2,lodash.eachRight=forEachRight,lodash.first=head,mixin(lodash,(kr={},baseForOwn(lodash,(function(t,n){Gt.call(lodash.prototype,n)||(kr[n]=t)})),kr),{chain:!1}),lodash.VERSION="4.17.21",arrayEach(["bind","bindKey","curry","curryRight","partial","partialRight"],(function(t){lodash[t].placeholder=lodash})),arrayEach(["drop","take"],(function(t,n){LazyWrapper.prototype[t]=function(r){r=r===i?1:nn(toInteger(r),0);var o=this.__filtered__&&!n?new LazyWrapper(this):this.clone();return o.__filtered__?o.__takeCount__=rn(r,o.__takeCount__):o.__views__.push({size:rn(r,y),type:t+(o.__dir__<0?"Right":"")}),o},LazyWrapper.prototype[t+"Right"]=function(n){return this.reverse()[t](n).reverse()}})),arrayEach(["filter","map","takeWhile"],(function(t,n){var i=n+1,r=1==i||3==i;LazyWrapper.prototype[t]=function(t){var n=this.clone();return n.__iteratees__.push({iteratee:getIteratee(t,3),type:i}),n.__filtered__=n.__filtered__||r,n}})),arrayEach(["head","last"],(function(t,n){var i="take"+(n?"Right":"");LazyWrapper.prototype[t]=function(){return this[i](1).value()[0]}})),arrayEach(["initial","tail"],(function(t,n){var i="drop"+(n?"":"Right");LazyWrapper.prototype[t]=function(){return this.__filtered__?new LazyWrapper(this):this[i](1)}})),LazyWrapper.prototype.compact=function(){return this.filter(identity)},LazyWrapper.prototype.find=function(t){return this.filter(t).head()},LazyWrapper.prototype.findLast=function(t){return this.reverse().find(t)},LazyWrapper.prototype.invokeMap=baseRest((function(t,n){return"function"==typeof t?new LazyWrapper(this):this.map((function(i){return baseInvoke(i,t,n)}))})),LazyWrapper.prototype.reject=function(t){return this.filter(negate(getIteratee(t)))},LazyWrapper.prototype.slice=function(t,n){t=toInteger(t);var r=this;return r.__filtered__&&(t>0||n<0)?new LazyWrapper(r):(t<0?r=r.takeRight(-t):t&&(r=r.drop(t)),n!==i&&(r=(n=toInteger(n))<0?r.dropRight(-n):r.take(n-t)),r)},LazyWrapper.prototype.takeRightWhile=function(t){return this.reverse().takeWhile(t).reverse()},LazyWrapper.prototype.toArray=function(){return this.take(y)},baseForOwn(LazyWrapper.prototype,(function(t,n){var r=/^(?:filter|find|map|reject)|While$/.test(n),o=/^(?:head|last)$/.test(n),h=lodash[o?"take"+("last"==n?"Right":""):n],c=o||/^find/.test(n);h&&(lodash.prototype[n]=function(){var n=this.__wrapped__,u=o?[1]:arguments,d=n instanceof LazyWrapper,p=u[0],g=d||Ei(n),interceptor=function(t){var n=h.apply(lodash,arrayPush([t],u));return o&&m?n[0]:n};g&&r&&"function"==typeof p&&1!=p.length&&(d=g=!1);var m=this.__chain__,v=!!this.__actions__.length,_=c&&!m,y=d&&!v;if(!c&&g){n=y?n:new LazyWrapper(this);var w=t.apply(n,u);return w.__actions__.push({func:thru,args:[interceptor],thisArg:i}),new LodashWrapper(w,m)}return _&&y?t.apply(this,u):(w=this.thru(interceptor),_?o?w.value()[0]:w.value():w)})})),arrayEach(["pop","push","shift","sort","splice","unshift"],(function(t){var n=Wt[t],i=/^(?:push|sort|unshift)$/.test(t)?"tap":"thru",r=/^(?:pop|shift)$/.test(t);lodash.prototype[t]=function(){var t=arguments;if(r&&!this.__chain__){var o=this.value();return n.apply(Ei(o)?o:[],t)}return this[i]((function(i){return n.apply(Ei(i)?i:[],t)}))}})),baseForOwn(LazyWrapper.prototype,(function(t,n){var i=lodash[n];if(i){var r=i.name+"";Gt.call(vn,r)||(vn[r]=[]),vn[r].push({name:n,func:i})}})),vn[createHybrid(i,2).name]=[{name:"wrapper",func:i}],LazyWrapper.prototype.clone=function lazyClone(){var t=new LazyWrapper(this.__wrapped__);return t.__actions__=copyArray(this.__actions__),t.__dir__=this.__dir__,t.__filtered__=this.__filtered__,t.__iteratees__=copyArray(this.__iteratees__),t.__takeCount__=this.__takeCount__,t.__views__=copyArray(this.__views__),t},LazyWrapper.prototype.reverse=function lazyReverse(){if(this.__filtered__){var t=new LazyWrapper(this);t.__dir__=-1,t.__filtered__=!0}else(t=this.clone()).__dir__*=-1;return t},LazyWrapper.prototype.value=function lazyValue(){var t=this.__wrapped__.value(),n=this.__dir__,i=Ei(t),r=n<0,o=i?t.length:0,h=function getView(t,n,i){var r=-1,o=i.length;for(;++r<o;){var h=i[r],c=h.size;switch(h.type){case"drop":t+=c;break;case"dropRight":n-=c;break;case"take":n=rn(n,t+c);break;case"takeRight":t=nn(t,n-c)}}return{start:t,end:n}}(0,o,this.__views__),c=h.start,u=h.end,d=u-c,p=r?u:c-1,g=this.__iteratees__,m=g.length,v=0,_=rn(d,this.__takeCount__);if(!i||!r&&o==d&&_==d)return baseWrapperValue(t,this.__actions__);var y=[];t:for(;d--&&v<_;){for(var w=-1,x=t[p+=n];++w<m;){var S=g[w],C=S.iteratee,k=S.type,P=C(x);if(2==k)x=P;else if(!P){if(1==k)continue t;break t}}y[v++]=x}return y},lodash.prototype.at=hi,lodash.prototype.chain=function wrapperChain(){return chain(this)},lodash.prototype.commit=function wrapperCommit(){return new LodashWrapper(this.value(),this.__chain__)},lodash.prototype.next=function wrapperNext(){this.__values__===i&&(this.__values__=toArray(this.value()));var t=this.__index__>=this.__values__.length;return{done:t,value:t?i:this.__values__[this.__index__++]}},lodash.prototype.plant=function wrapperPlant(t){for(var n,r=this;r instanceof baseLodash;){var o=wrapperClone(r);o.__index__=0,o.__values__=i,n?h.__wrapped__=o:n=o;var h=o;r=r.__wrapped__}return h.__wrapped__=t,n},lodash.prototype.reverse=function wrapperReverse(){var t=this.__wrapped__;if(t instanceof LazyWrapper){var n=t;return this.__actions__.length&&(n=new LazyWrapper(this)),(n=n.reverse()).__actions__.push({func:thru,args:[reverse],thisArg:i}),new LodashWrapper(n,this.__chain__)}return this.thru(reverse)},lodash.prototype.toJSON=lodash.prototype.valueOf=lodash.prototype.value=function wrapperValue(){return baseWrapperValue(this.__wrapped__,this.__actions__)},lodash.prototype.first=lodash.prototype.head,be&&(lodash.prototype[be]=function wrapperToIterator(){return this}),lodash}();"function"==typeof define&&"object"==typeof define.amd&&define.amd?(je._=Qe,define((function(){return Qe}))):Ue?((Ue.exports=Qe)._=Qe,Ve._=Qe):je._=Qe}).call(t)}}),Se=__toESM(be());function $(t,n,i,r=t=>t){return t*r(.5-n*(.5-i))}function l(t,n){return[t[0]+n[0],t[1]+n[1]]}function a(t,n){return[t[0]-n[0],t[1]-n[1]]}function b(t,n){return[t[0]*n,t[1]*n]}function R(t){return[t[1],-t[0]]}function B(t,n){return t[0]*n[0]+t[1]*n[1]}function ue(t,n){return t[0]===n[0]&&t[1]===n[1]}function A(t,n){return function de(t){return t[0]*t[0]+t[1]*t[1]}(a(t,n))}function G(t){return function he(t,n){return[t[0]/n,t[1]/n]}(t,function ge(t){return Math.hypot(t[0],t[1])}(t))}function ie(t,n){return Math.hypot(t[1]-n[1],t[0]-n[0])}function L(t,n,i){let r=Math.sin(i),o=Math.cos(i),h=t[0]-n[0],c=t[1]-n[1],u=h*r+c*o;return[h*o-c*r+n[0],u+n[1]]}function K(t,n,i){return l(t,b(a(n,t),i))}function ee(t,n,i){return l(t,b(n,i))}var{min:Ce,PI:ke}=Math,Pe=.275,Ie=ke+1e-4;function ae(t,n={}){return function ce(t,n={}){let{size:i=16,smoothing:r=.5,thinning:o=.5,simulatePressure:h=!0,easing:c=t=>t,start:u={},end:d={},last:p=!1}=n,{cap:g=!0,easing:m=t=>t*(2-t)}=u,{cap:v=!0,easing:_=t=>--t*t*t+1}=d;if(0===t.length||i<=0)return[];let y,w=t[t.length-1].runningLength,x=!1===u.taper?0:!0===u.taper?Math.max(i,w):u.taper,S=!1===d.taper?0:!0===d.taper?Math.max(i,w):d.taper,C=Math.pow(i*r,2),k=[],P=[],I=t.slice(0,10).reduce(((t,n)=>{let r=n.pressure;if(h){let o=Ce(1,n.distance/i),h=Ce(1,1-o);r=Ce(1,t+o*Pe*(h-t))}return(t+r)/2}),t[0].pressure),M=$(i,o,t[t.length-1].pressure,c),E=t[0].vector,T=t[0].point,O=T,D=T,N=O,j=!1;for(let q=0;q<t.length;q++){let{pressure:n}=t[q],{point:r,vector:u,distance:d,runningLength:p}=t[q];if(q<t.length-1&&w-p<3)continue;if(o){if(h){let t=Ce(1,d/i),r=Ce(1,1-t);n=Ce(1,I+t*Pe*(r-I))}M=$(i,o,n,c)}else M=i/2;void 0===y&&(y=M);let g=p<x?m(p/x):1,v=w-p<S?_((w-p)/S):1;M=Math.max(.01,M*Math.min(g,v));let V=(q<t.length-1?t[q+1]:t[q]).vector,U=q<t.length-1?B(u,V):1,z=null!==U&&U<0;if(B(u,E)<0&&!j||z){let t=b(R(E),M);for(let n=1/13,i=0;i<=1;i+=n)D=L(a(r,t),r,Ie*i),k.push(D),N=L(l(r,t),r,Ie*-i),P.push(N);T=D,O=N,z&&(j=!0);continue}if(j=!1,q===t.length-1){let t=b(R(u),M);k.push(a(r,t)),P.push(l(r,t));continue}let F=b(R(K(V,u,U)),M);D=a(r,F),(q<=1||A(T,D)>C)&&(k.push(D),T=D),N=l(r,F),(q<=1||A(O,N)>C)&&(P.push(N),O=N),I=n,E=u}let V=t[0].point.slice(0,2),U=t.length>1?t[t.length-1].point.slice(0,2):l(t[0].point,[1,1]),z=[],F=[];if(1===t.length){if(!x&&!S||p){let t=ee(V,G(R(a(V,U))),-(y||M)),n=[];for(let i=1/13,r=i;r<=1;r+=i)n.push(L(t,V,2*Ie*r));return n}}else{if(!(x||S&&1===t.length))if(g)for(let t=1/13,i=t;i<=1;i+=t){let t=L(P[0],V,Ie*i);z.push(t)}else{let t=a(k[0],P[0]),n=b(t,.5),i=b(t,.51);z.push(a(V,n),a(V,i),l(V,i),l(V,n))}let n=R(function se(t){return[-t[0],-t[1]]}(t[t.length-1].vector));if(S||x&&1===t.length)F.push(U);else if(v){let t=ee(U,n,M);for(let n=1/29,i=n;i<1;i+=n)F.push(L(t,U,3*Ie*i))}else F.push(l(U,b(n,M)),l(U,b(n,.99*M)),a(U,b(n,.99*M)),a(U,b(n,M)))}return k.concat(F,P.reverse(),z)}(function me(t,n={}){var i;let{streamline:r=.5,size:o=16,last:h=!1}=n;if(0===t.length)return[];let c=.15+.85*(1-r),u=Array.isArray(t[0])?t:t.map((({x:t,y:n,pressure:i=.5})=>[t,n,i]));if(2===u.length){let t=u[1];u=u.slice(0,-1);for(let n=1;n<5;n++)u.push(K(u[0],t,n/4))}1===u.length&&(u=[...u,[...l(u[0],[1,1]),...u[0].slice(2)]]);let d=[{point:[u[0][0],u[0][1]],pressure:u[0][2]>=0?u[0][2]:.25,vector:[1,1],distance:0,runningLength:0}],p=!1,g=0,m=d[0],v=u.length-1;for(let _=1;_<u.length;_++){let t=h&&_===v?u[_].slice(0,2):K(m.point,u[_],c);if(ue(m.point,t))continue;let n=ie(t,m.point);if(g+=n,_<v&&!p){if(g<o)continue;p=!0}m={point:t,pressure:u[_][2]>=0?u[_][2]:.5,vector:G(a(m.point,t)),distance:n,runningLength:g},d.push(m)}return d[0].vector=(null==(i=d[1])?void 0:i.vector)||[0,0],d}(t,n),n)}var Me=__toESM(xe()),Ee=(t=class{constructor(n,i){__publicField(this,"shadowEmitter",null),__publicField(this,"root"),__publicField(this,"scope"),__publicField(this,"handlePropChange",(n=>{var i,r;if(this.item)for(const o of n)if(o.target===this.root){const n=this.vectorKeys().concat([t.KEYS.pointsMatrix]);for(const[h,c]of o.changes.keys.entries())if("update"===c.action){if(this.styleKeys().include.indexOf(h)>=0)return void this.onStyleKeyUpdate(h);n.indexOf(h)>=0?this.onVectorUpdate():h===t.KEYS.strokeColor?this.item.strokeColor=new this.scope.Color(this.strokeColor):h===t.KEYS.fillColor?this.item.fillColor=new this.scope.Color(this.fillColor):h===t.KEYS.strokeWidth?this.item.strokeWidth=this.strokeWidth:h===t.KEYS.dashArray?this.item.dashArray=this.dashArray:h===t.KEYS.shadow&&(""!==this.shadow?null==(i=this.shadowEmitter)||i.emit("translateIn",[this.uuid],this.shadow):null==(r=this.shadowEmitter)||r.emit("translateOut",[this.uuid],c.oldValue))}}else o.target===this.root.get(t.KEYS.points)&&this.onVectorUpdate()})),this.scope=i,this.root=n,this.root.has(t.KEYS.pointsMatrix)||this.root.set(t.KEYS.pointsMatrix,[1,0,0,1,0,0]),this.root.observeDeep(this.handlePropChange)}get index(){return this.root.get(t.KEYS.index)}get uuid(){return this.root.get(t.KEYS.uuid)}get type(){return this.root.get("type")}get strokeWidth(){return this.root.get(t.KEYS.strokeWidth)}set strokeWidth(n){this.root.set(t.KEYS.strokeWidth,n)}get strokeColor(){return this.root.get(t.KEYS.strokeColor)}set strokeColor(n){this.root.set(t.KEYS.strokeColor,n)}get fillColor(){return this.root.get(t.KEYS.fillColor)}set fillColor(n){this.root.set(t.KEYS.fillColor,n)}get dashArray(){return this.root.get(t.KEYS.dashArray)}set dashArray(n){this.root.set(t.KEYS.dashArray,n)}get pointsMatrix(){return this.root.get(t.KEYS.pointsMatrix)||[1,0,0,1,0,0]}get points(){return this.root.get(t.KEYS.points).toArray()}set ownerId(n){this.root.set(t.KEYS.ownerId,n)}get ownerId(){return this.root.get(t.KEYS.ownerId)}get ctrlId(){return this.root.get(t.KEYS.ctrlId)}set ctrlId(n){this.root.set(t.KEYS.ctrlId,n)}get shadow(){var n;return null!=(n=this.root.get(t.KEYS.shadow))?n:""}set shadow(n){this.root.set(t.KEYS.shadow,n)}createPaperElement(){this.createPaperItem(),this.item&&(this.item.data.uuid=this.uuid,this.item.data.index=this.index,this.item.data.type=this.root.get("type"),this.item.data.ownerId=this.ownerId,this.item.applyMatrix=!1)}appendPoints(n){this.root.get(t.KEYS.points).push(n)}setPoints(n){if(this.root.doc)this.root.doc.transact((()=>{const i=this.root.get(t.KEYS.points);i.delete(0,i.length),i.push(n)}));else{const i=this.root.get(t.KEYS.points)||new YArray;i.delete(0,i.length),i.push(n),this.root.set(t.KEYS.points,i)}}appendPointsMatrix(n){const i=new this.scope.Matrix(this.pointsMatrix),r=n.appended(i);this.root.set(t.KEYS.pointsMatrix,[r.a,r.b,r.c,r.d,r.tx,r.ty])}rotateByOffset(n,i,r){const o=new this.scope.Matrix(this.pointsMatrix),h=new this.scope.Matrix;h.rotate(n,i,r);let c=h.appended(o);const u=[0,180,90,-180,-90].find((t=>Math.abs(t-c.rotation)<2));if(void 0!==u){const t=u-c.rotation,n=new this.scope.Matrix;n.rotate(t,i,r),c=n.appended(c)}return this.root.set(t.KEYS.pointsMatrix,[c.a,c.b,c.c,c.d,c.tx,c.ty]),c.rotation}getStyleKeys(){const t=this.styleKeys();return Array.from(new Set(["dashArray","strokeColor","fillColor","strokeWidth"].filter((n=>t.exclude.indexOf(n)<0)).concat(t.include)))}},__publicField(t,"KEYS",{index:"index",uuid:"uuid",strokeWidth:"strokeWidth",strokeColor:"strokeColor",fillColor:"fillColor",dashArray:"dashArray",pointsMatrix:"pointsMatrix",points:"points",ownerId:"ownerId",ctrlId:"ctrlId",shadow:"shadow"}),t),Ae=["horizontal","four-corner","four","eight"],Te=class _EditorConfig{constructor(){__publicField(this,"resizeModel",(()=>"eight")),__publicField(this,"uniformScale",(()=>!1)),__publicField(this,"controlPoints",[])}merge(t){const n=new _EditorConfig,i=Ae.findIndex((t=>t===this.resizeModel())),r=Ae.findIndex((n=>n===t.resizeModel()));return n.resizeModel=()=>Ae[Math.max(i,r)],n.uniformScale=this.uniformScale||t.uniformScale,n.controlPoints=[],n}},Oe=class extends Ee{constructor(t,n){super(t,n),__publicField(this,"item",null),this.root.has("type")||this.root.set("type","curve"),this.root.has("points")||this.root.set("points",new YArray)}average(t,n){return(t+n)/2}parsePoints(t){return ae((0,Me.chunk)(t,2),{size:this.strokeWidth,smoothing:0,thinning:.5,streamline:.5,simulatePressure:!0,start:{taper:10,cap:!0},end:{taper:10,cap:!0}})}matrixedPoints(){return(0,Me.chunk)(this.points,2).map((([t,n])=>new this.scope.Point(t,n))).map((t=>t.transform(new this.scope.Matrix(this.pointsMatrix)))).reduce(((t,n)=>(t.push(n.x),t.push(n.y),t)),[])}createPath(t){const n=new this.scope.Path,i=t.length;if(i<4)return n;let r=new this.scope.Point(0,0),o=new this.scope.Point(0,0),h=t[0],c=t[1];const u=t[2];o=new this.scope.Point(h[0],h[1]),n.moveTo(o),r=new this.scope.Point(c[0],c[1]),o=new this.scope.Point(this.average(c[0],u[0]),this.average(c[1],u[1])),n.quadraticCurveTo(r,o);for(let d=2,p=i-1;d<p;d++)h=t[d],c=t[d+1],r=o.multiply(2).subtract(r),o=new this.scope.Point(this.average(h[0],c[0]),this.average(h[1],c[1])),n.quadraticCurveTo(r,o);return n}getNextSegments(){const t=this.parsePoints(this.matrixedPoints());return this.createPath(t).segments}onVectorUpdate(){this.item&&(this.item.removeSegments(),this.item.addSegments(this.getNextSegments()),this.item.simplify(2.5))}createPaperItem(){this.item=new this.scope.Path,this.item.strokeCap="round",this.item.strokeJoin="round",this.item.strokeScaling=!1,this.item.strokeColor=new this.scope.Color(this.strokeColor),this.item.fillColor=new this.scope.Color(this.strokeColor),this.item.addSegments(this.getNextSegments())}editorConfig(){return new Te}vectorKeys(){return["strokeWidth"]}styleKeys(){return{include:["strokeColor"],exclude:["fillColor","dashArray"]}}onStyleKeyUpdate(t){this.item&&"strokeColor"===t&&(this.item.strokeColor=new this.scope.Color(this.strokeColor),this.item.fillColor=new this.scope.Color(this.strokeColor))}},Le=class extends Ee{constructor(t,n){if(super(t,n),__publicField(this,"item",null),this.root.has("type")||this.root.set("type","selector"),!this.root.has("points")){const t=new YArray;t.push([0,0,0,0,0]),this.root.set("points",t)}}createPaperRect(){const t=this.scope,n=new t.Rectangle(new t.Point(this.points[0],this.points[1]),new t.Size(this.points[2],this.points[3]));return new t.Path.Rectangle(n,new t.Point(this.points[4],this.points[4]))}onVectorUpdate(){if(!this.item)return;this.item.removeSegments();const t=this.createPaperRect();this.item.addSegments(t.segments)}createPaperItem(){this.item=this.createPaperRect(),this.item.strokeColor=new this.scope.Color(new this.scope.Color("#2196f3"))}editorConfig(){return new Te}vectorKeys(){return[]}styleKeys(){return{include:[],exclude:[]}}onStyleKeyUpdate(t){}},De=__toESM(xe());function serializePath(t){return t.segments.reduce(((t,n)=>(t.push(...function serializeSegment(t){return[t.point.x,t.point.y,t.handleIn.x,t.handleIn.y,t.handleOut.x,t.handleOut.y]}(n)),t)),[])}function deserializePath(t,n,i){const r=(0,De.chunk)(t,6),o=new n.Path;return o.segments=r.map((t=>function deserializeSegment(t,n,i){const r=new n.Segment(new n.Point(t[0],t[1]),new n.Point(t[2],t[3]),new n.Point(t[4],t[5]));return r.transform(i),r}(t,n,i))),o}var Ne=class{constructor(){__publicField(this,"callbacks",[]),__publicField(this,"lastTime",0),__publicField(this,"fps",45),__publicField(this,"handleCallbacks",(()=>{let t=this.callbacks;this.callbacks=[];for(let n=0,i=t.length;n<i;n++)t[n]()})),__publicField(this,"addCallback",(t=>{this.callbacks.push(t)})),__publicField(this,"handleFrame",(t=>{t-this.lastTime>1e3/this.fps&&(this.handleCallbacks(),this.lastTime=t),window.requestAnimationFrame(this.handleFrame)})),window.requestAnimationFrame(this.handleFrame)}};function requestAnimationFrameHook(t){const n=new Ne;t.DomEvent.requestAnimationFrame=n.addCallback}var Re=class extends Ee{constructor(t,n,i){super(t,n),__publicField(this,"item",null),this.root.has("type")||this.root.set("type",i),this.root.has("points")||this.root.set("points",new YArray)}onVectorUpdate(){if(!this.item)return;const t=new this.scope.Matrix(this.pointsMatrix);this.item.removeSegments();const n=deserializePath(this.points,this.scope,t);this.item.addSegments(n.segments),this.item.closePath()}createPaperItem(){const t=new this.scope.Matrix(this.pointsMatrix);this.item=deserializePath(this.points,this.scope,t),this.item.strokeColor=new this.scope.Color(this.strokeColor),this.item.dashArray=this.dashArray,this.item.strokeWidth=this.strokeWidth,this.fillColor&&this.fillColor.length>0&&(this.item.fillColor=new this.scope.Color(this.fillColor)),this.item.closePath()}editorConfig(){return new Te}vectorKeys(){return[]}styleKeys(){return{include:[],exclude:[]}}onStyleKeyUpdate(t){}},je=__toESM(xe()),Ve=class{constructor(t,n,i,r){__publicField(this,"modelGetter"),__publicField(this,"scope"),__publicField(this,"tool"),__publicField(this,"shadowEmitter"),__publicField(this,"enableToolEvent"),__publicField(this,"eventAvailable",!1),__publicField(this,"onMouseDownSelf",(t=>{this.eventAvailable=this.enableToolEvent(),this.eventAvailable&&(this.shadowEmitter.setActive(!0),this.onMouseDown(t))})),__publicField(this,"onMouseDragSelf",(t=>{this.eventAvailable&&this.onMouseDrag(t)})),__publicField(this,"onMouseUpSelf",(t=>{this.eventAvailable&&(this.onMouseUp(t),this.shadowEmitter.setActive(!1))})),this.modelGetter=n,this.enableToolEvent=t,this.scope=r,this.shadowEmitter=i,this.tool=new r.Tool,this.tool.onMouseDown=this.onMouseDownSelf,this.tool.onMouseDrag=this.onMouseDragSelf,this.tool.onMouseUp=this.onMouseUpSelf}},Ue=__toESM(xe()),ze=class extends Ve{constructor(t,n,i,r){super(t,n,i,r),__publicField(this,"elementModel",null),__publicField(this,"from",null),__publicField(this,"to",null),this.tool.minDistance=1}onMouseDown(t){this.elementModel=this.modelGetter().createLinePath(!0),this.from=t.point.clone(),this.to=t.point.clone()}onMouseDrag(t){if(this.from&&this.elementModel){this.to=t.point.clone();const n=new this.scope.Path.Line(this.from,this.to),i=new Array(Be).fill(0).map(((t,i)=>{const r=i/(Be-1)*n.length,o=n.getPointAt(r);return[o.x,o.y]}));this.elementModel.setPoints((0,Ue.flattenDeep)(i))}}onMouseUp(t){this.elementModel&&(this.elementModel.shadow="")}},Be=5,Fe=class extends Ee{constructor(t,n){super(t,n),__publicField(this,"controlledPoints",[]),__publicField(this,"item",null),this.root.has("type")||this.root.set("type","arrow"),this.root.has("points")||this.root.set("points",new YArray),this.root.has("headArrow")||this.root.set("headArrow","none"),this.root.has("tailArrow")||this.root.set("tailArrow","normal")}get arrowSize(){return 5*this.strokeWidth+15}get headArrow(){return this.root.get("headArrow")}set headArrow(t){this.root.set("headArrow",t)}get tailArrow(){return this.root.get("tailArrow")}set tailArrow(t){this.root.set("tailArrow",t)}onVectorUpdate(){if(!this.item)return;this.item.removeChildren();const t=this.renderLine();this.item.addChildren(t)}renderLine(){const t=new this.scope.Matrix(this.pointsMatrix),n=(0,je.chunk)(this.points,2).map((n=>new this.scope.Point(n[0],n[1]).transform(t))),i=new this.scope.Path;i.moveTo(n[0]),n.slice(1).forEach((t=>{i.lineTo(t)})),i.smooth({type:"catmull-rom"}),i.strokeCap="butt";const[r,o]=this.createArrow(i);return i.strokeColor=new this.scope.Color(this.strokeColor),[r,i,o].forEach((t=>{t.strokeColor=new this.scope.Color(this.strokeColor),t.dashArray=this.dashArray,t.strokeWidth=this.strokeWidth})),[r,i,o]}createPaperItem(){this.item=new this.scope.Group,this.item.addChildren(this.renderLine())}createArrow(t){let[n,i]=[new this.scope.Path,new this.scope.Path];if(!t)return[n,i];const r=this.root.get("headArrow"),o=this.root.get("tailArrow"),h=Math.min(this.arrowSize,t.length/5);if("none"!==o){const n=t.getPointAt(t.length-1);if(n){const r=new this.scope.Point(n.x-h,n.y-h/2),o=new this.scope.Point(n.x-h,n.y+h/2),c=n.subtract(null==t?void 0:t.getPointAt(t.length-2)).angle;i.add(r,n,o),i.rotate(c,n),i.strokeJoin="miter"}}if("none"!==r){const i=t.getPointAt(0);if(i){const r=t.getPointAt(1).subtract(i).angle;n.add(new this.scope.Point(i.x+h,i.y-h/2),i,new this.scope.Point(i.x+h,i.y+h/2)),n.rotate(r,i),n.strokeJoin="miter"}}return[n,i]}editorConfig(){const t=new Te;return t.resizeModel=()=>"horizontal",0===this.controlledPoints.length?(this.controlledPoints.push(...new Array(Be).fill(0).map(((t,n)=>new qe(`line-${n}`,this,{index:n,total:Be},this.scope)))),t.controlPoints=this.controlledPoints):t.controlPoints=this.controlledPoints,t}vectorKeys(){return[]}styleKeys(){return{include:["headArrow","tailArrow","strokeWidth"],exclude:["fillColor"]}}onStyleKeyUpdate(t){this.onVectorUpdate()}},qe=class{constructor(t,n,i,r){__publicField(this,"position",null),__publicField(this,"name"),__publicField(this,"model"),__publicField(this,"options"),__publicField(this,"scope"),this.name=t,this.model=n,this.options=i,this.scope=r}getPosition(){if(!this.model.item)return new this.model.scope.Point(0,0);const t=new this.model.scope.Matrix(this.model.pointsMatrix),n=this.options.index/(Be-1);if(this.position)return this.model.scope.project.view.projectToView(this.position.transform(t));const i={x:this.model.points[0],y:this.model.points[1]},r={x:this.model.points[this.model.points.length-2],y:this.model.points[this.model.points.length-1]},o=new this.scope.Path.Line(i,r);return this.position=o.getPointAt(o.length*n),this.model.scope.project.view.projectToView(this.position.transform(t))}onPositionChange(t){if(!this.model.item)return;const n=new this.model.scope.Matrix(this.model.pointsMatrix),i=t.transform(n.inverted()),r=this.model.points;this.position=i;const o=(0,je.cloneDeep)(r);o[2*this.options.index]=i.x,o[2*this.options.index+1]=i.y,this.model.setPoints(o)}},We=class extends Ee{constructor(t,n){super(t,n),__publicField(this,"item",null),__publicField(this,"handleTextPropChange",(t=>{var n;if(this.item)for(const[i,r]of t.changes.keys.entries())"update"!==r.action&&"add"!==r.action||("content"===i?(this.item.content=null!=(n=this.root.get("content"))?n:"",this.updateTextPosition()):"font-size"===i&&(this.item.fontSize=this.fontSize,this.updateTextPosition()))})),this.root.has("type")||this.root.set("type","point-text"),this.root.has(Ee.KEYS.points)||this.root.set(Ee.KEYS.points,new YArray),this.root.observe(this.handleTextPropChange),this.root.has("font-size")&&setTimeout((()=>{this.updateTextPosition()}),60)}set content(t){this.root.set("content",t)}get content(){return this.root.get("content")}get fontSize(){return this.root.get("font-size")}set fontSize(t){this.root.set("font-size",t)}get fontFamily(){return this.root.get("font-family")}set fontFamily(t){this.root.set("font-family",t)}getInternalMeasurement(){if(!this.item)return null;const t=this.item.internalBounds,n=new this.scope.Matrix(this.pointsMatrix),i=new this.scope.Point(this.points[0],this.points[1]).transform(n),r=new this.scope.Point(this.points[0]+t.width,this.points[1]).transform(n);let o=r.getDistance(i)/t.width;o=Number.isNaN(o)?1:o;const h=r.subtract(i).angle;return{scaleX:o,topLeft:i,topRight:r,angle:h,bounds:t}}updateTextPosition(){const t=this.getInternalMeasurement();if(!this.item||!t)return;const{scaleX:n,topLeft:i,angle:r,bounds:o}=t,h=this.fontSize*n;this.item.position.x=i.x+o.width/2,this.item.position.y=i.y+o.height/2,this.item.rotation=0,this.item.fontSize=h,this.item.rotate(r,[i.x,i.y])}editorConfig(){const t=new Te;return t.resizeModel=()=>"horizontal",t.uniformScale=()=>!0,t}createPaperItem(){this.item=new this.scope.PointText(new this.scope.Point(0,0)),this.item.content=this.content||"",this.item.strokeColor=new this.scope.Color(this.strokeColor),this.item.fillColor=new this.scope.Color(this.strokeColor),this.item.fontFamily=this.fontFamily,this.item.fontSize=this.fontSize,this.updateTextPosition()}onVectorUpdate(){this.updateTextPosition()}vectorKeys(){return[]}styleKeys(){return{include:["fontSize","fontFamily","strokeColor"],exclude:["fillColor","dashArray"]}}onStyleKeyUpdate(t){this.item&&"strokeColor"===t&&(this.item.strokeColor=new this.scope.Color(this.strokeColor),this.item.fillColor=new this.scope.Color(this.strokeColor))}},Ye=class extends Ee{constructor(t,n){super(t,n),__publicField(this,"item",null),this.root.has("type")||this.root.set("type","triangle"),this.root.has("points")||this.root.set("points",new YArray)}createPaperItem(){this.item=new this.scope.Path,this.item.strokeCap="butt",this.item.strokeJoin="round",this.item.strokeColor=new this.scope.Color(this.strokeColor),this.item.dashArray=this.dashArray,this.item.strokeWidth=this.strokeWidth,this.fillColor&&this.fillColor.length>0&&(this.item.fillColor=new this.scope.Color(this.fillColor)),this.onVectorUpdate()}onVectorUpdate(){if(!this.item)return;const t=new this.scope.Matrix(this.pointsMatrix),n=new this.scope.Point(this.points[0],this.points[1]).transform(t),i=new this.scope.Point(this.points[2],this.points[3]).transform(t),r=new this.scope.Point(this.points[4],this.points[5]).transform(t);this.item.removeSegments(),this.item.moveTo(n),this.item.lineTo(i),this.item.lineTo(r),this.item.closePath()}editorConfig(){const t=new Te;return t.controlPoints.push({name:"triangle",getPosition:()=>{const t=new this.scope.Point(this.points[0],this.points[1]),n=new this.scope.Matrix(this.pointsMatrix);return this.scope.project.view.projectToView(t.transform(n))},onPositionChange:t=>{if(!this.item)return;const n=new this.scope.Matrix(this.pointsMatrix),i=t.transform(n.inverted()),r=this.points;this.setPoints([i.x,i.y,r[2],r[3],r[4],r[5]])}}),t}vectorKeys(){return[]}styleKeys(){return{include:[],exclude:[]}}onStyleKeyUpdate(t){}},He=class extends Ee{constructor(t,n){if(super(t,n),__publicField(this,"item",null),this.root.has("type")||this.root.set("type","rectangle"),!this.root.has("points")){const t=new YArray;t.push([0,0,0,0]),this.root.set("points",t)}this.root.has("radius")||this.root.set("radius",0)}createSegments(){const[t,n,i,r]=this.points,o=new this.scope.Matrix(this.pointsMatrix),h=this.maxRadiusLength(),c=this.root.get("radius")*h,u=c-Math.sin(Math.PI/4)*c;let d=new this.scope.Point(t,n).transform(o),p=new this.scope.Point(i,n).transform(o),g=new this.scope.Point(i,r).transform(o),m=new this.scope.Point(t,r).transform(o);const v=o.scaling.y>0?1:-1,_=o.scaling.x>0?1:-1,y=new this.scope.Path.Line(d,g),w=y.getPointAt(y.length/2),x=new this.scope.Matrix;x.rotate(-o.rotation,w),d=d.transform(x),p=p.transform(x),g=g.transform(x),m=m.transform(x);const S=new this.scope.Matrix;S.rotate(o.rotation,w);const C=d.add([0,v*c]).transform(S),k=d.add([_*u,v*u]).transform(S),P=d.add([_*c,0]).transform(S),I=p.add([_*-c,0]).transform(S),M=p.add([_*-u,v*u]).transform(S),E=p.add([0,v*c]).transform(S),T=g.add([0,v*-c]).transform(S),O=g.add([_*-u,v*-u]).transform(S),D=g.add([_*-c,0]).transform(S),N=m.add([_*c,0]).transform(S),j=m.add([_*u,v*-u]).transform(S),V=m.add([0,v*-c]).transform(S),U=new this.scope.Path;return U.moveTo(C),U.arcTo(k,P),U.lineTo(I),U.arcTo(M,E),U.lineTo(T),U.arcTo(O,D),U.lineTo(N),U.arcTo(j,V),U.segments}createPaperItem(){this.item=new this.scope.Path,this.item.addSegments(this.createSegments()),this.item.closePath(),this.item.strokeColor=new this.scope.Color(this.strokeColor),this.item.dashArray=this.dashArray,this.item.strokeWidth=this.strokeWidth,this.fillColor&&this.fillColor.length>0&&(this.item.fillColor=new this.scope.Color(this.fillColor))}onVectorUpdate(){this.item&&(this.item.removeSegments(),this.item.addSegments(this.createSegments()),this.item.closePath())}maxRadiusLength(){const t=new this.scope.Matrix(this.pointsMatrix),n=this.points,i=new this.scope.Point(n[0],n[1]).transform(t),r=new this.scope.Point(n[2],n[1]).transform(t),o=new this.scope.Point(n[0],n[3]).transform(t),h=i.getDistance(r),c=i.getDistance(o);return Math.min(h,c)/2}editorConfig(){const t=new Te;return t.resizeModel=()=>new this.scope.Matrix(this.pointsMatrix).rotation%90!=0?"four-corner":"eight",t.uniformScale=()=>!(new this.scope.Matrix(this.pointsMatrix).rotation%90==0),t.controlPoints.push({name:"rect-radius",getPosition:()=>{const t=new this.scope.Matrix(this.pointsMatrix),n=this.points,i=this.root.get("radius")*this.maxRadiusLength();let r=new this.scope.Point(n[0],n[1]).transform(t);const o=new this.scope.Point(n[2],n[3]).transform(t),h=new this.scope.Path.Line(r,o),c=h.getPointAt(h.length/2),u=new this.scope.Matrix;u.rotate(-t.rotation,c),r=r.transform(u);const d=t.scaling.x>0?1:-1,p=new this.scope.Matrix;return p.rotate(t.rotation,c),r=r.add([d*i,0]).transform(p),this.scope.project.view.projectToView(r)},onPositionChange:t=>{if(!this.item)return;const n=this.points,i=new this.scope.Matrix(this.pointsMatrix),r=Math.min(n[2]-n[0],n[3]-n[1])/2;let o=(t.transform(i.inverted()).x-this.points[0])/r;o=Math.max(o,0),o=Math.min(o,1),this.root.set("radius",o)}}),t}vectorKeys(){return["radius"]}styleKeys(){return{include:[],exclude:[]}}onStyleKeyUpdate(t){}},Ke="elementsUndoOrigin",$e=__toESM(xe()),Ge=class extends Ee{constructor(t,n){super(t,n),__publicField(this,"item",null),__publicField(this,"sliceBegin",0),this.root.has("type")||this.root.set("type","eraser"),this.root.has("points")||this.root.set("points",new YArray)}average(t,n){return(t+n)/2}createPath(t){const n=new this.scope.Path,i=t.length;if(i<4)return n;let r=new this.scope.Point(0,0),o=new this.scope.Point(0,0),h=t[0],c=t[1];const u=t[2];o=new this.scope.Point(h[0],h[1]),n.moveTo(o),r=new this.scope.Point(c[0],c[1]),o=new this.scope.Point(this.average(c[0],u[0]),this.average(c[1],u[1])),n.quadraticCurveTo(r,o);for(let d=2,p=i-1;d<p;d++)h=t[d],c=t[d+1],r=o.multiply(2).subtract(r),o=new this.scope.Point(this.average(h[0],c[0]),this.average(h[1],c[1])),n.quadraticCurveTo(r,o);return n}parsePoints(t){return ae(t,{size:this.strokeWidth,smoothing:0,thinning:.5,streamline:.5,simulatePressure:!0,start:{taper:!0,cap:!0},end:{taper:0,cap:!0}})}matrixedPoints(){const t=new this.scope.Matrix(this.pointsMatrix);return(0,$e.chunk)(this.points,2).slice(this.sliceBegin).map((([n,i])=>t.transform([n,i]))).map((t=>[t.x,t.y]))}getNextSegments(){const t=this.parsePoints(this.matrixedPoints());return this.createPath(t).segments}onVectorUpdate(){this.item&&(this.item.removeSegments(),this.item.addSegments(this.getNextSegments()))}createPaperItem(){this.item=new this.scope.Path,this.item.strokeCap="round",this.item.strokeJoin="round",this.item.strokeScaling=!1,this.item.strokeColor=new this.scope.Color(this.strokeColor),this.item.fillColor=new this.scope.Color(this.strokeColor),this.item.addSegments(this.getNextSegments());let t=!1;this.item.onFrame=()=>{this.points&&(this.points.length/2-this.sliceBegin>=10&&!t&&(t=!0),this.points.length/2<=this.sliceBegin&&(t=!1),t&&(this.sliceBegin+=1,this.onVectorUpdate()))}}editorConfig(){return new Te}vectorKeys(){return[]}styleKeys(){return{include:[],exclude:[]}}onStyleKeyUpdate(t){}},Xe=__toESM(xe()),Je=class extends Ee{constructor(t,n,i,r){super(n,i),__publicField(this,"item",null),__publicField(this,"clientId"),__publicField(this,"sliceBegin",0),__publicField(this,"displayStrokeWidth",8),__publicField(this,"cachedPoints",null),this.clientId=t,this.root.has("type")||this.root.set("type","laser"),this.root.has("points")||this.root.set("points",new YArray),this.root.has("removed")||this.root.set("removed",!1),this.root.observe((t=>{if(this.item)for(const[n]of t.changes.keys.entries())"removed"===n&&(null==this.cachedPoints&&(this.cachedPoints=this.points),this.item.onFrame=t=>{if(this.displayStrokeWidth=Math.max(.1,this.displayStrokeWidth-=8/30),t.count>=20){const t=this.cachedPoints||this.points;this.sliceBegin+=Math.ceil(t.length/2/20)}this.onVectorUpdate(),t.count>=30&&this.ownerId===this.clientId&&r(this.uuid)})}))}beginRemoveAnimate(){this.root.set("removed",!0)}average(t,n){return(t+n)/2}createPath(t){const n=new this.scope.Path,i=t.length;if(i<4)return n;let r=new this.scope.Point(0,0),o=new this.scope.Point(0,0),h=t[0],c=t[1];const u=t[2];o=new this.scope.Point(h[0],h[1]),n.moveTo(o),r=new this.scope.Point(c[0],c[1]),o=new this.scope.Point(this.average(c[0],u[0]),this.average(c[1],u[1])),n.quadraticCurveTo(r,o);for(let d=2,p=i-1;d<p;d++)h=t[d],c=t[d+1],r=o.multiply(2).subtract(r),o=new this.scope.Point(this.average(h[0],c[0]),this.average(h[1],c[1])),n.quadraticCurveTo(r,o);return n}parsePoints(t){return ae(t,{size:this.displayStrokeWidth,smoothing:0,thinning:.5,streamline:0,simulatePressure:!0,start:{taper:0,cap:!0},end:{taper:0,cap:!0}})}matrixedPoints(){const t=new this.scope.Matrix(this.pointsMatrix),n=this.cachedPoints||this.points;return(0,Xe.chunk)(n,2).slice(this.sliceBegin).map((([n,i])=>t.transform([n,i]))).map((t=>[t.x,t.y]))}getNextSegments(){const t=this.parsePoints(this.matrixedPoints());return this.createPath(t).segments}onVectorUpdate(){this.item&&(this.item.removeSegments(),this.item.addSegments(this.getNextSegments()))}createPaperItem(){this.item=new this.scope.Path,this.item.strokeCap="round",this.item.strokeJoin="round",this.item.strokeScaling=!1,this.item.strokeColor=new this.scope.Color(this.strokeColor),this.item.fillColor=new this.scope.Color(this.strokeColor),this.item.addSegments(this.getNextSegments())}editorConfig(){return new Te}vectorKeys(){return[]}styleKeys(){return{include:[],exclude:[]}}onStyleKeyUpdate(t){}},Ze=class extends It{constructor(t,n){super(),__publicField(this,"requestUserMap"),__publicField(this,"userManager"),__publicField(this,"observers",new Map),__publicField(this,"handleUserLeave",(t=>{const n=this.observers.get(t.id);n&&this.requestUserMap(t.id).unobserve(n)})),__publicField(this,"handleUserJoin",(t=>{this.addObserve(t.id)})),this.userManager=t,this.requestUserMap=n,this.createModel(this.userManager.selfId),this.userManager.userIdList().forEach((t=>{this.addObserve(t)})),this.userManager.on("join",this.handleUserJoin),this.userManager.on("leave",this.handleUserLeave)}addObserve(t){const observer=n=>{this.handleUserPermissionChange(t,n)};this.observers.set(t,observer),this.requestUserMap(t).observe(observer)}createModel(t){const n=this.requestUserMap(t);n.has("permission")||n.set("permission",0)}handleUserPermissionChange(t,n){for(const[i,r]of n.changes.keys.entries())if("permission"===i&&("add"===r.action||"update"===r.action)){const n=this.requestUserMap(t).get("permission");this.emit("change",t,this.resolveFlags(n),n)}}resolveFlags(t){return[4,2,16,8,32,1].filter((n=>!!(n&t)))}getPermissionValue(t){var n;return null!=(n=this.requestUserMap(null!=t?t:this.userManager.selfId).get("permission"))?n:0}getPermissionFlags(t){var n;const i=null!=(n=this.requestUserMap(null!=t?t:this.userManager.selfId).get("permission"))?n:0;return this.resolveFlags(i)}hasPermission(t,n){var i;return!!((null!=(i=this.requestUserMap(null!=n?n:this.userManager.selfId).get("permission"))?i:0)&t)}addPermission(t,n){var i;const r=null!=(i=this.requestUserMap(null!=n?n:this.userManager.selfId).get("permission"))?i:0;this.requestUserMap(null!=n?n:this.userManager.selfId).set("permission",r|t)}removePermission(t,n){var i;const r=null!=(i=this.requestUserMap(null!=n?n:this.userManager.selfId).get("permission"))?i:0;this.requestUserMap(null!=n?n:this.userManager.selfId).set("permission",r&~t)}},Qe=__toESM(xe()),tn=class extends Ee{constructor(t,n){super(t,n),__publicField(this,"item",null),this.root.has("type")||this.root.set("type","line"),this.root.has("points")||this.root.set("points",new YArray)}onVectorUpdate(){if(!this.item)return;this.item.removeSegments();const t=this.renderLine();this.item.addSegments(t.segments)}renderLine(){var t;const n=new this.scope.Matrix(this.pointsMatrix),i=(0,Qe.chunk)(this.points,2).map((t=>new this.scope.Point(t[0],t[1]).transform(n))),r=new this.scope.Path;return r.moveTo(i[0]),r.lineTo(null!=(t=i[1])?t:i[0]),r}createPaperItem(){this.item=this.renderLine(),this.item.strokeJoin="bevel",this.item.strokeColor=new this.scope.Color(this.strokeColor),this.item.dashArray=this.dashArray,this.item.strokeWidth=this.strokeWidth}editorConfig(){const t=new Te;return t.resizeModel=()=>"horizontal",t.controlPoints.push({name:"line-start",getPosition:()=>{const t=new this.scope.Matrix(this.pointsMatrix),n=this.points,i=new this.scope.Point(n[0],n[1]);return this.scope.project.view.projectToView(i.transform(t))},onPositionChange:t=>{if(!this.item)return;const n=new this.scope.Matrix(this.pointsMatrix),i=t.transform(n.inverted());this.setPoints([i.x,i.y,this.points[2],this.points[3]])}}),t.controlPoints.push({name:"line-end",getPosition:()=>{const t=new this.scope.Matrix(this.pointsMatrix),n=this.points,i=new this.scope.Point(n[2],n[3]);return this.scope.project.view.projectToView(i.transform(t))},onPositionChange:t=>{if(!this.item)return;const n=new this.scope.Matrix(this.pointsMatrix),i=t.transform(n.inverted());this.setPoints([this.points[0],this.points[1],i.x,i.y])}}),t}vectorKeys(){return[]}styleKeys(){return{include:[],exclude:["fillColor"]}}onStyleKeyUpdate(t){if(!this.item)return;this.item.removeSegments();const n=this.renderLine();this.item.addSegments(n.segments)}},en=class extends It{constructor(t,n,i,r,o,h,c){var u;super(),__publicField(this,"scope"),__publicField(this,"toolbarModel"),__publicField(this,"userManager"),__publicField(this,"elementModels"),__publicField(this,"elements"),__publicField(this,"layerId"),__publicField(this,"maxIndex",-1),__publicField(this,"hasPermission"),__publicField(this,"shadowEmitter"),__publicField(this,"onElementsChange",(t=>{for(const[n,i]of t.changes.keys.entries())if("add"===i.action){const t=this.elements.get(n);if(t){const n=this.convertToModel(t);n&&this.emit("elementInsert",[n])}}else"delete"===i.action&&this.emit("elementRemove",n,this.layerId)})),this.hasPermission=c,this.shadowEmitter=n,this.layerId=t,this.userManager=h,this.elements=i,this.scope=r,this.toolbarModel=o,this.elementModels=new Map;for(const d of this.elements.keys()){const t=null==(u=this.elements.get(d))?void 0:u.get("type");"eraser"!==t&&"laser"!==t||this.elements.delete(d)}this.flushRenderables(),this.elements.observe(this.onElementsChange)}get uuid(){return v4$2()}flushRenderables(){this.emit("elementClear");const t=Array.from(this.elements.values()).map((t=>this.convertToModel(t))).filter((t=>!!t));this.maxIndex=t.reduce(((t,n)=>Math.max(t,n.index)),-1);const n=[];t.forEach((t=>{""!==t.shadow&&n.push(t.uuid)})),setTimeout((()=>{this.emit("elementInsert",t),n.forEach((t=>{var n;null==(n=this.elements.get(t))||n.set(Ee.KEYS.shadow,"")}))}))}convertToModel(t){const n=t.get("type");let i=null;return"curve"===n?i=new Oe(t,this.scope):["ellipse"].indexOf(n)>=0?i=new Re(t,this.scope,n):"selector"===n?i=new Le(t,this.scope):"arrow"===n?i=new Fe(t,this.scope):"line"===n?i=new tn(t,this.scope):"point-text"===n?i=new We(t,this.scope):"triangle"===n?i=new Ye(t,this.scope):"rectangle"===n?i=new He(t,this.scope):"eraser"===n?i=new Ge(t,this.scope):"laser"===n&&(i=new Je(this.userManager.selfId,t,this.scope,(t=>{this.removeElementItem(t)}))),i&&(i.shadowEmitter=this.shadowEmitter,this.elementModels.set(i.uuid,i)),i}initElement(t,n=!1){n&&(t.shadow="layer"),t.strokeWidth=this.toolbarModel.strokeWidth,t.strokeColor=this.toolbarModel.strokeColor,t.fillColor=this.toolbarModel.fillColor,t.ownerId=this.userManager.selfId,t.shadowEmitter=this.shadowEmitter}removeElementItem(t){this.elements.delete(t)}addElementToDoc(t){var n;null==(n=this.elements.doc)||n.transact((()=>{const n=this.uuid;t.set(Ee.KEYS.index,++this.maxIndex),t.set(Ee.KEYS.uuid,n),this.elements.set(n,t)}),Ke)}createCurve(t=!1){if(!this.hasPermission(1))return null;const n=new Oe(new YMap,this.scope);return this.initElement(n,t),this.addElementToDoc(n.root),n}createLaserPointer(){if(!this.hasPermission(1))return null;const t=new Je(this.userManager.selfId,new YMap,this.scope,(t=>{this.removeElementItem(t)}));return t.strokeWidth=8,t.strokeColor="#F44336",t.fillColor="#F44336",t.ownerId=this.userManager.selfId,t.shadow="layer",this.addElementToDoc(t.root),t}createEraser(){if(!this.hasPermission(8)&&!this.hasPermission(16))return null;const t=new Ge(new YMap,this.scope);return t.strokeWidth=12,t.strokeColor="#9E9E9E",t.fillColor="#9E9E9E",t.ownerId=this.userManager.selfId,t.shadow="layer",this.addElementToDoc(t.root),t}createTriangle(t){if(!this.hasPermission(1))return null;const n=new Ye(new YMap,this.scope);return this.initElement(n,t),n.dashArray=this.toolbarModel.dashArray,this.addElementToDoc(n.root),n}createRectangle(t){if(!this.hasPermission(1))return null;const n=new He(new YMap,this.scope);return this.initElement(n,t),n.dashArray=this.toolbarModel.dashArray,this.addElementToDoc(n.root),n}createSegmentedPath(t,n){if(!this.hasPermission(1))return null;const i=new Re(new YMap,this.scope,t);return this.initElement(i,n),i.dashArray=this.toolbarModel.dashArray,this.addElementToDoc(i.root),i}createSelector(t=!1){if(!this.hasPermission(2)&&!this.hasPermission(16))return null;const n=new Le(new YMap,this.scope);return n.shadow="layer",this.addElementToDoc(n.root),n}createStraightLine(t){if(!this.hasPermission(1))return null;const n=new tn(new YMap,this.scope);return this.initElement(n,t),n.dashArray=this.toolbarModel.dashArray,this.addElementToDoc(n.root),n}createLinePath(t){if(!this.hasPermission(1))return null;const n=new Fe(new YMap,this.scope);return this.initElement(n,t),n.dashArray=this.toolbarModel.dashArray,this.addElementToDoc(n.root),n}createPointText(t,n,i){if(!this.hasPermission(1))return null;const r=new We(new YMap,this.scope);return r.setPoints([t,n]),r.fontSize=this.toolbarModel.fontSize,r.fontFamily=this.toolbarModel.fontFamily,this.initElement(r,i),this.addElementToDoc(r.root),r}clearElement(){this.elements.doc.transact((()=>{const t=[];for(const n of this.elements.keys()){const i=this.elements.get(n);if(i){const r=i.get("type");["eraser","selector"].indexOf(r)>=0&&t.push(n)}}t.forEach((t=>this.elements.delete(t)))}))}dispose(){this.elements.clear()}},nn=__toESM(xe());function Point(t,n){this.X=t,this.Y=n}function Rectangle(t,n,i,r){this.X=t,this.Y=n,this.Width=i,this.Height=r}function Unistroke(t,n){this.Name=t,this.Points=function Resample(t,n){for(var i=function PathLength(t){for(var n=0,i=1;i<t.length;i++)n+=Distance(t[i-1],t[i]);return n}(t)/(n-1),r=0,o=new Array(t[0]),h=1;h<t.length;h++){var c=Distance(t[h-1],t[h]);if(r+c>=i){var u=new Point(t[h-1].X+(i-r)/c*(t[h].X-t[h-1].X),t[h-1].Y+(i-r)/c*(t[h].Y-t[h-1].Y));o[o.length]=u,t.splice(h,0,u),r=0}else r+=c}o.length==n-1&&(o[o.length]=new Point(t[t.length-1].X,t[t.length-1].Y));return o}(n,rn);var i=function IndicativeAngle(t){var n=Centroid(t);return Math.atan2(n.Y-t[0].Y,n.X-t[0].X)}(this.Points);this.Points=RotateBy(this.Points,-i),this.Points=function ScaleTo(t,n){for(var i=function BoundingBox(t){for(var n=1/0,i=-1/0,r=1/0,o=-1/0,h=0;h<t.length;h++)n=Math.min(n,t[h].X),r=Math.min(r,t[h].Y),i=Math.max(i,t[h].X),o=Math.max(o,t[h].Y);return new Rectangle(n,r,i-n,o-r)}(t),r=new Array,o=0;o<t.length;o++){var h=t[o].X*(n/i.Width),c=t[o].Y*(n/i.Height);r[r.length]=new Point(h,c)}return r}(this.Points,sn),this.Points=function TranslateTo(t,n){for(var i=Centroid(t),r=new Array,o=0;o<t.length;o++){var h=t[o].X+n.X-i.X,c=t[o].Y+n.Y-i.Y;r[r.length]=new Point(h,c)}return r}(this.Points,an),this.Vector=function Vectorize(t){for(var n=0,i=new Array,r=0;r<t.length;r++)i[i.length]=t[r].X,i[i.length]=t[r].Y,n+=t[r].X*t[r].X+t[r].Y*t[r].Y;var o=Math.sqrt(n);for(r=0;r<i.length;r++)i[r]/=o;return i}(this.Points)}function Result(t,n,i){this.Name=t,this.Score=n,this.Time=i}var rn=64,sn=250,an=new Point(0,0),hn=.5*Math.sqrt(sn*sn+sn*sn),ln=Deg2Rad(45),cn=Deg2Rad(2),un=.5*(-1+Math.sqrt(5));function DollarRecognizer(){this.Unistrokes=new Array(3),this.Unistrokes[0]=new Unistroke("triangle",new Array(new Point(137,139),new Point(135,141),new Point(133,144),new Point(132,146),new Point(130,149),new Point(128,151),new Point(126,155),new Point(123,160),new Point(120,166),new Point(116,171),new Point(112,177),new Point(107,183),new Point(102,188),new Point(100,191),new Point(95,195),new Point(90,199),new Point(86,203),new Point(82,206),new Point(80,209),new Point(75,213),new Point(73,213),new Point(70,216),new Point(67,219),new Point(64,221),new Point(61,223),new Point(60,225),new Point(62,226),new Point(65,225),new Point(67,226),new Point(74,226),new Point(77,227),new Point(85,229),new Point(91,230),new Point(99,231),new Point(108,232),new Point(116,233),new Point(125,233),new Point(134,234),new Point(145,233),new Point(153,232),new Point(160,233),new Point(170,234),new Point(177,235),new Point(179,236),new Point(186,237),new Point(193,238),new Point(198,239),new Point(200,237),new Point(202,239),new Point(204,238),new Point(206,234),new Point(205,230),new Point(202,222),new Point(197,216),new Point(192,207),new Point(186,198),new Point(179,189),new Point(174,183),new Point(170,178),new Point(164,171),new Point(161,168),new Point(154,160),new Point(148,155),new Point(143,150),new Point(138,148),new Point(136,148))),this.Unistrokes[1]=new Unistroke("rectangle",new Array(new Point(78,149),new Point(78,153),new Point(78,157),new Point(78,160),new Point(79,162),new Point(79,164),new Point(79,167),new Point(79,169),new Point(79,173),new Point(79,178),new Point(79,183),new Point(80,189),new Point(80,193),new Point(80,198),new Point(80,202),new Point(81,208),new Point(81,210),new Point(81,216),new Point(82,222),new Point(82,224),new Point(82,227),new Point(83,229),new Point(83,231),new Point(85,230),new Point(88,232),new Point(90,233),new Point(92,232),new Point(94,233),new Point(99,232),new Point(102,233),new Point(106,233),new Point(109,234),new Point(117,235),new Point(123,236),new Point(126,236),new Point(135,237),new Point(142,238),new Point(145,238),new Point(152,238),new Point(154,239),new Point(165,238),new Point(174,237),new Point(179,236),new Point(186,235),new Point(191,235),new Point(195,233),new Point(197,233),new Point(200,233),new Point(201,235),new Point(201,233),new Point(199,231),new Point(198,226),new Point(198,220),new Point(196,207),new Point(195,195),new Point(195,181),new Point(195,173),new Point(195,163),new Point(194,155),new Point(192,145),new Point(192,143),new Point(192,138),new Point(191,135),new Point(191,133),new Point(191,130),new Point(190,128),new Point(188,129),new Point(186,129),new Point(181,132),new Point(173,131),new Point(162,131),new Point(151,132),new Point(149,132),new Point(138,132),new Point(136,132),new Point(122,131),new Point(120,131),new Point(109,130),new Point(107,130),new Point(90,132),new Point(81,133),new Point(76,133))),this.Unistrokes[2]=new Unistroke("circle",new Array(new Point(127,141),new Point(124,140),new Point(120,139),new Point(118,139),new Point(116,139),new Point(111,140),new Point(109,141),new Point(104,144),new Point(100,147),new Point(96,152),new Point(93,157),new Point(90,163),new Point(87,169),new Point(85,175),new Point(83,181),new Point(82,190),new Point(82,195),new Point(83,200),new Point(84,205),new Point(88,213),new Point(91,216),new Point(96,219),new Point(103,222),new Point(108,224),new Point(111,224),new Point(120,224),new Point(133,223),new Point(142,222),new Point(152,218),new Point(160,214),new Point(167,210),new Point(173,204),new Point(178,198),new Point(179,196),new Point(182,188),new Point(182,177),new Point(178,167),new Point(170,150),new Point(163,138),new Point(152,130),new Point(143,129),new Point(140,131),new Point(129,136),new Point(126,139))),this.Unistrokes[3]=new Unistroke("arrow",new Array(new Point(68,222),new Point(70,220),new Point(73,218),new Point(75,217),new Point(77,215),new Point(80,213),new Point(82,212),new Point(84,210),new Point(87,209),new Point(89,208),new Point(92,206),new Point(95,204),new Point(101,201),new Point(106,198),new Point(112,194),new Point(118,191),new Point(124,187),new Point(127,186),new Point(132,183),new Point(138,181),new Point(141,180),new Point(146,178),new Point(154,173),new Point(159,171),new Point(161,170),new Point(166,167),new Point(168,167),new Point(171,166),new Point(174,164),new Point(177,162),new Point(180,160),new Point(182,158),new Point(183,156),new Point(181,154),new Point(178,153),new Point(171,153),new Point(164,153),new Point(160,153),new Point(150,154),new Point(147,155),new Point(141,157),new Point(137,158),new Point(135,158),new Point(137,158),new Point(140,157),new Point(143,156),new Point(151,154),new Point(160,152),new Point(170,149),new Point(179,147),new Point(185,145),new Point(192,144),new Point(196,144),new Point(198,144),new Point(200,144),new Point(201,147),new Point(199,149),new Point(194,157),new Point(191,160),new Point(186,167),new Point(180,176),new Point(177,179),new Point(171,187),new Point(169,189),new Point(165,194),new Point(164,196))),this.Recognize=function(t,n){for(var i=Date.now(),r=new Unistroke("",t),o=-1,h=1/0,c=0;c<this.Unistrokes.length;c++){var u;(u=n?OptimalCosineDistance(this.Unistrokes[c].Vector,r.Vector):DistanceAtBestAngle(r.Points,this.Unistrokes[c],-ln,+ln,cn))<h&&(h=u,o=c)}var d=Date.now();return-1==o?new Result("No match.",0,d-i):new Result(this.Unistrokes[o].Name,n?1-h:1-h/hn,d-i)},this.AddGesture=function(t,n){this.Unistrokes[this.Unistrokes.length]=new Unistroke(t,n);for(var i=0,r=0;r<this.Unistrokes.length;r++)this.Unistrokes[r].Name==t&&i++;return i},this.DeleteUserGestures=function(){return this.Unistrokes.length=16,16}}function RotateBy(t,n){for(var i=Centroid(t),r=Math.cos(n),o=Math.sin(n),h=new Array,c=0;c<t.length;c++){var u=(t[c].X-i.X)*r-(t[c].Y-i.Y)*o+i.X,d=(t[c].X-i.X)*o+(t[c].Y-i.Y)*r+i.Y;h[h.length]=new Point(u,d)}return h}function OptimalCosineDistance(t,n){for(var i=0,r=0,o=0;o<t.length;o+=2)i+=t[o]*n[o]+t[o+1]*n[o+1],r+=t[o]*n[o+1]-t[o+1]*n[o];var h=Math.atan(r/i);return Math.acos(i*Math.cos(h)+r*Math.sin(h))}function DistanceAtBestAngle(t,n,i,r,o){for(var h=un*i+(1-un)*r,c=DistanceAtAngle(t,n,h),u=(1-un)*i+un*r,d=DistanceAtAngle(t,n,u);Math.abs(r-i)>o;)c<d?(r=u,u=h,d=c,c=DistanceAtAngle(t,n,h=un*i+(1-un)*r)):(i=h,h=u,c=d,d=DistanceAtAngle(t,n,u=(1-un)*i+un*r));return Math.min(c,d)}function DistanceAtAngle(t,n,i){return function PathDistance(t,n){for(var i=0,r=0;r<t.length;r++)i+=Distance(t[r],n[r]);return i/t.length}(RotateBy(t,i),n.Points)}function Centroid(t){for(var n=0,i=0,r=0;r<t.length;r++)n+=t[r].X,i+=t[r].Y;return new Point(n/=t.length,i/=t.length)}function Distance(t,n){var i=n.X-t.X,r=n.Y-t.Y;return Math.sqrt(i*i+r*r)}function Deg2Rad(t){return t*Math.PI/180}var dn=class{constructor(){__publicField(this,"dollar",new DollarRecognizer)}recognize(t){let n=Number.MAX_VALUE,i=-Number.MAX_VALUE,r=Number.MAX_VALUE,o=-Number.MAX_VALUE;const h=this.dollar.Recognize((0,nn.chunk)(t,2).map((t=>(n=Math.min(n,t[0]),i=Math.max(i,t[0]),r=Math.min(r,t[1]),o=Math.max(o,t[1]),new Point(t[0],t[1])))),!0);return h.Score>.7?{shape:h.Name,minX:n,minY:r,maxX:i,maxY:o}:null}},pn=class extends Ve{constructor(t,n,i,r){super(t,n,i,r),__publicField(this,"elementModel",null),__publicField(this,"recognizer",new dn),__publicField(this,"pointCount",0),this.tool.minDistance=1}onMouseDown(t){this.pointCount=0,this.elementModel=this.modelGetter().createCurve(!0)}onMouseDrag(t){this.pointCount>1024||this.elementModel&&(this.pointCount+=1,this.elementModel.appendPoints([Math.round(t.point.x),Math.round(t.point.y)]))}onMouseUp(t){if(this.pointCount<3&&this.elementModel&&this.modelGetter().removeElementItem(this.elementModel.uuid),this.elementModel&&(this.elementModel.shadow=""),this.elementModel&&t.event.metaKey){const t=this.recognizer.recognize(this.elementModel.points);if(t)if(this.modelGetter().removeElementItem(this.elementModel.uuid),/^rectangle/.test(t.shape)){const n=this.modelGetter().createRectangle(!1);null==n||n.setPoints([t.minX,t.minY,t.maxX,t.maxY])}else if(/^circle/.test(t.shape)){const n=this.modelGetter().createSegmentedPath("ellipse",!1),i=new this.scope.Rectangle(new this.scope.Point(t.minX,t.minY),new this.scope.Point(t.maxX,t.maxY)),r=serializePath(new this.scope.Path.Ellipse(i));null==n||n.setPoints(r)}else if(/^triangle/.test(t.shape)){const n=this.modelGetter().createTriangle(!1);null==n||n.setPoints([t.minX+(t.maxX-t.minX)/2,t.minY,t.minX,t.maxY,t.maxX,t.maxY])}else if(/^arrow/.test(t.shape)){const n=this.modelGetter().createLinePath(!1);null==n||n.setPoints([t.minX,(t.maxY+t.minY)/2,t.maxX,(t.maxY+t.minY)/2])}}}},fn=class extends Ve{constructor(t,n,i,r){super(t,n,i,r),__publicField(this,"elementModel",null),__publicField(this,"from",null),__publicField(this,"to",null),this.tool.minDistance=1}onMouseDown(t){this.elementModel=this.modelGetter().createRectangle(!0),this.from=t.point.clone(),this.to=t.point.clone()}onMouseDrag(t){this.from&&this.elementModel&&(this.to=t.point.clone(),this.elementModel.setPoints([this.from.x,this.from.y,this.to.x,this.to.y]))}onMouseUp(t){this.elementModel&&(this.elementModel.shadow=""),this.elementModel&&this.from&&this.from.getDistance(t.point)<3&&this.modelGetter().removeElementItem(this.elementModel.uuid)}},gn={tool:"tool",fontSize:"fontSize",fontFamily:"fontFamily",strokeColor:"strokeColor",fillColor:"fillColor",strokeWidth:"strokeWidth",dashArray:"dashArray"},mn=class extends It{constructor(t,n){super(),__publicField(this,"root"),__publicField(this,"handleRootUpdate",(t=>{for(const[n,i]of t.changes.keys.entries())Object.keys(gn).indexOf(n)>=0&&("add"===i.action||"update"===i.action)&&this.emit("update",{tool:this.currentTool,fontSize:this.fontSize,fontFamily:this.fontFamily,strokeColor:this.strokeColor,fillColor:this.fillColor,strokeWidth:this.strokeWidth,dashArray:this.dashArray})})),this.root=t,this.root.observe(this.handleRootUpdate),Object.keys(n).forEach((t=>{this.root.has(t)||this.root.set(t,n[t])}))}get currentTool(){return this.root.get(gn.tool)}set currentTool(t){this.root.set(gn.tool,t)}get fontSize(){return this.root.get(gn.fontSize)}set fontSize(t){this.root.set(gn.fontSize,t)}get dashArray(){return this.root.get(gn.dashArray)}set dashArray(t){this.root.set(gn.dashArray,t)}get fontFamily(){return this.root.get(gn.fontFamily)}set fontFamily(t){this.root.set(gn.fontFamily,t)}get strokeColor(){return this.root.get(gn.strokeColor)}set strokeColor(t){this.root.set(gn.strokeColor,t)}get fillColor(){return this.root.get(gn.fillColor)}set fillColor(t){this.root.set(gn.fillColor,t)}get strokeWidth(){return this.root.get(gn.strokeWidth)}set strokeWidth(t){this.root.set(gn.strokeWidth,t)}},vn=class extends Ve{constructor(t,n,i,r,o){super(t,n,i,r),__publicField(this,"elementModel",null),__publicField(this,"from",null),__publicField(this,"to",null),__publicField(this,"selectElementsModel"),__publicField(this,"selectElements",new Map),this.selectElementsModel=o}onMouseDown(t){var n;this.from=null,this.to=null,this.elementModel=this.modelGetter().createSelector(),this.from=t.point.clone(),this.to=t.point.clone();const i=new this.scope.Rectangle(this.from,this.to);null==(n=this.elementModel)||n.setPoints([i.topLeft.x,i.topLeft.y,i.size.width,i.size.height]),this.selectElements.clear()}onMouseDrag(t){if(this.from&&this.elementModel){this.to=t.point.clone();const n=new this.scope.Rectangle(this.from,this.to);this.elementModel.setPoints([n.topLeft.x,n.topLeft.y,n.size.width,n.size.height]),this.selectElementsModel.clearSelectElementForSelf(),this.scope.project.activeLayer.children.forEach((t=>{t.data.type&&["selector","eraser","laser"].indexOf(t.data.type)<0&&(n.contains(t.bounds)?this.selectElements.set(t.data.uuid,t.data.ownerId):this.selectElements.delete(t.data.uuid))}))}}onMouseUp(t){this.elementModel&&this.modelGetter().removeElementItem(this.elementModel.uuid);const n=Array.from(this.selectElements.keys()).reduce(((t,n)=>(t.push({elementId:n,ownerId:this.selectElements.get(n)}),t)),[]),i=this.scope.project.hitTest(t.point);i&&i.item.data.uuid&&n.push({elementId:i.item.data.uuid,ownerId:i.item.data.ownerId}),this.selectElements.clear(),this.selectElementsModel.addSelectElementForSelf(n)}},_n="themeColor",yn="currentPage",wn="selectElements",bn="viewMatrix",xn="cameraMode",Sn=class extends It{constructor(t,n,i){super(),__publicField(this,"requestUserMap"),__publicField(this,"userManager"),__publicField(this,"hasPermission"),__publicField(this,"observers",new Map),__publicField(this,"handleUserLeave",(t=>{const n=this.observers.get(t.id);n&&this.requestUserMap(t.id).unobserveDeep(n)})),__publicField(this,"handleUserJoin",(t=>{const observer=n=>{this.handleUserSelectElementsChange(t.id,n)};this.requestUserMap(t.id).observeDeep(observer),this.observers.set(t.id,observer)})),__publicField(this,"handleUserSelectElementsChange",((t,n)=>{for(const i of n)if(i.target.get("inner-map-id")===wn){const n=Array.from(i.target.keys()).filter((t=>"inner-map-id"!==t));this.emit("elementsChange",t,Array.from(n))}})),this.hasPermission=i,this.userManager=t,this.requestUserMap=n,this.createModel(this.userManager.selfId),this.userManager.userIdList().forEach((t=>{const observer=n=>{this.handleUserSelectElementsChange(t,n)};this.requestUserMap(t).observeDeep(observer),this.observers.set(t,observer)})),this.userManager.on("join",this.handleUserJoin),this.userManager.on("leave",this.handleUserLeave)}get hasEditSelfPermission(){return this.hasPermission(2)}get hasEditOthersPermission(){return this.hasPermission(4)}createModel(t){const n=this.requestUserMap(t);if(!n.has(wn)){const t=new YMap;t.set("inner-map-id",wn),n.set(wn,t)}}addSelectElementForSelf(t){const{hasEditSelfPermission:n,hasEditOthersPermission:i}=this,r=this.requestUserMap(this.userManager.selfId).get(wn),o=new Set;for(const h of this.userManager.userIdList())if(h!==this.userManager.selfId){const t=this.requestUserMap(h).get("trashedElements"),n=this.requestUserMap(h).get(wn);Array.from(t.keys()).forEach((t=>o.add(t))),Array.from(n.keys()).forEach((t=>o.add(t)))}r.doc.transact((()=>{for(const h of t)(h.ownerId!==this.userManager.selfId||n)&&(h.ownerId===this.userManager.selfId||i)&&(o.has(h.elementId)||r.has(h.elementId)||r.set(h.elementId,h.elementId))}))}clearSelectElementForSelf(){var t;const n=this.requestUserMap(this.userManager.selfId).get(wn);null==(t=n.doc)||t.transact((()=>{n.clear(),n.set("inner-map-id",wn)}))}dispose(){this.userManager.userIdList().forEach((t=>{const n=this.observers.get(t);n&&this.requestUserMap(t).unobserveDeep(n)})),this.observers.clear(),this.userManager.off("leave",this.handleUserLeave),this.userManager.off("join",this.handleUserJoin)}},Cn=class extends It{constructor(t){super(),__publicField(this,"rootView"),__publicField(this,"content"),__publicField(this,"camera"),__publicField(this,"originX",0),__publicField(this,"originY",0),__publicField(this,"rotation",0),__publicField(this,"scale",1),__publicField(this,"handleContentInput",(()=>{var t;this.emit("change",null!=(t=this.content.textContent)?t:""),this.translateCaretIntoView()})),__publicField(this,"handleContentKeydown",(t=>{/^Arrow/.test(t.key)&&setTimeout((()=>{this.translateCaretIntoView()}),50)})),__publicField(this,"handleContentBlur",(()=>{var t;this.emit("done",null!=(t=this.content.textContent)?t:"")})),__publicField(this,"handleRootClick",(t=>{var n;t.target===this.rootView&&(t.stopPropagation(),t.preventDefault(),this.emit("done",null!=(n=this.content.textContent)?n:""))})),this.camera=t,this.rootView=document.createElement("div"),this.rootView.style.cssText="position:absolute;width:100%;height:100%;top:0;left:0;overflow:hidden;",this.content=document.createElement("div"),this.content.setAttribute("spellcheck","false"),this.content.textContent="",this.content.setAttribute("contenteditable","plaintext-only"),this.content.style.cssText="white-space: nowrap;border:1px solid red;text-wrap:nowrap;caret-color:red;line-height:1.2em;position:absolute;z-index:2;color:transparent;outline:none;",this.content.style.transformOrigin="0 0",this.rootView.appendChild(this.content),this.content.addEventListener("input",this.handleContentInput),this.content.addEventListener("blur",this.handleContentBlur),this.content.addEventListener("keydown",this.handleContentKeydown),this.rootView.addEventListener("pointerdown",this.handleRootClick),this.camera.on("zoom",(t=>{this.scale=t.scaling.x,this.updateMatrixStyle()}))}translateCaretIntoView(){const t=window.getSelection();if(t){const n=t.getRangeAt(0).getBoundingClientRect(),i=this.rootView.getBoundingClientRect(),r=this.content.getBoundingClientRect(),o=33;Math.abs(n.x-(i.x+i.width))<=12?this.camera.translate(-r.width,0):Math.abs(n.x-(i.x+i.width))<=o?this.camera.translate(2*-o,0):n.x<0?this.camera.translate(-n.x+2*o,0):n.x<=o&&this.camera.translate(2*o,0)}}setContent(t){this.content.textContent=t}updateMatrixStyle(){const t=this.camera.scope.project.view.projectToView([this.originX,this.originY]);this.content.style.top=`${t.y}px`,this.content.style.left=`${t.x}px`,this.content.style.transform=`rotate(${this.rotation}deg) scale(${this.scale})`}setOrigin(t,n){this.originX=t,this.originY=n,this.updateMatrixStyle()}setRotate(t){this.rotation=t,this.updateMatrixStyle()}setFontSize(t){this.content.style.fontSize=`${t}px`}setFontFamily(t){this.content.style.fontFamily=t}focus(){this.content.focus()}setCaret(){var t,n;const i=document.createRange(),r=window.getSelection();i.setStart(this.content.childNodes[0],null!=(n=null==(t=this.content.textContent)?void 0:t.length)?n:0),r&&(r.removeAllRanges(),r.addRange(i))}dispose(){this.removeAllListeners("done"),this.removeAllListeners("change"),this.content.removeEventListener("input",this.handleContentInput),this.content.removeEventListener("blur",this.handleContentBlur),this.rootView.removeEventListener("pointerdown",this.handleRootClick)}},kn={tl:"cursor:nw-resize;top:-3px;left:-3px",t:"cursor:n-resize;top:-3px;left:50%;translate:-50%;",tr:"cursor:ne-resize;top:-3px;right:-3px",l:"cursor:w-resize;top:50%;left:-3px",r:"cursor:e-resize;top:50%;right:-3px",bl:"cursor:sw-resize;bottom:-3px;left:-3px",b:"cursor:s-resize;bottom:-3px;left:50%;translate:-50%;",br:"cursor:se-resize;bottom:-3px;right:-3px"},Pn=class extends It{constructor(t,n){super(),__publicField(this,"minX",0),__publicField(this,"minY",0),__publicField(this,"maxX",0),__publicField(this,"maxY",0),__publicField(this,"binding"),__publicField(this,"scope"),this.binding=t,this.scope=n}get width(){return this.maxX-this.minX}get height(){return this.maxY-this.minY}get midX(){return this.minX+this.width/2}get midY(){return this.minY+this.height/2}updateBinding(){const t=Math.min(this.minX,this.maxX),n=Math.max(this.minX,this.maxX),i=Math.min(this.minY,this.maxY),r=Math.max(this.minY,this.maxY);this.binding.style.left=`${t}px`,this.binding.style.top=`${i}px`,this.binding.style.width=n-t+"px",this.binding.style.height=r-i+"px"}pageCenter(){const t=this.binding.getBoundingClientRect();return[t.x+t.width/2,t.y+t.height/2]}update(t,n,i,r){this.minX=t,this.minY=n,this.maxX=i,this.maxY=r,this.updateBinding()}translate(t,n){const i=new this.scope.Matrix;this.minX+=t,this.minY+=n,this.maxX+=t,this.maxY+=n,this.updateBinding();const r=this.scope.project.view.zoom;i.translate(t/r,n/r),this.emit("matrix",i)}offsetBy(t,n,i,r){const o=new this.scope.Matrix,h=this.width,c=this.height;"tl"===t?(r>0&&(i=n/r),this.minY+=i,this.minX+=n,o.scale(this.width/h,this.height/c,this.scope.project.view.viewToProject(new this.scope.Point(this.maxX,this.maxY)))):"t"===t?(n=r>0?i*r:0,this.minX+=n,this.minY+=i,o.scale(this.width/h,this.height/c,this.scope.project.view.viewToProject(new this.scope.Point(this.maxX,this.maxY)))):"tr"===t?(r>0&&(i=-1*n/r),this.minY+=i,this.maxX+=n,o.scale(this.width/h,this.height/c,this.scope.project.view.viewToProject(new this.scope.Point(this.minX,this.maxY)))):"l"===t?(i=r>0?n/r:0,this.minY+=i,this.minX+=n,o.scale(this.width/h,this.height/c,this.scope.project.view.viewToProject(new this.scope.Point(this.maxX,this.maxY)))):"r"===t?(i=r>0?-1*n/r:0,this.maxX+=n,this.minY+=i,o.scale(this.width/h,this.height/c,this.scope.project.view.viewToProject(new this.scope.Point(this.minX,this.maxY)))):"bl"===t?(r>0&&(i=-1*n/r),this.minX+=n,this.maxY+=i,o.scale(this.width/h,this.height/c,this.scope.project.view.viewToProject(new this.scope.Point(this.maxX,this.minY)))):"b"===t?(n=r>0?-1*i*r:0,this.minX+=n,this.maxY+=i,o.scale(this.width/h,this.height/c,this.scope.project.view.viewToProject(new this.scope.Point(this.maxX,this.minY)))):"br"===t&&(r>0&&(i=n/r),this.maxY+=i,this.maxX+=n,o.scale(this.width/h,this.height/c,this.scope.project.view.viewToProject(new this.scope.Point(this.minX,this.minY)))),this.updateBinding(),this.emit("matrix",o)}reset(){const t=Math.min(this.minX,this.maxX),n=Math.max(this.minX,this.maxX),i=Math.min(this.minY,this.maxY),r=Math.max(this.minY,this.maxY);this.minX=t,this.maxX=n,this.minY=i,this.maxY=r}},In=class extends It{constructor(t,n,i,r,o,h){super(),__publicField(this,"rootView"),__publicField(this,"frame"),__publicField(this,"rotator"),__publicField(this,"scope"),__publicField(this,"shadowScope"),__publicField(this,"shadowContainer"),__publicField(this,"ctrlUserMap"),__publicField(this,"viewerId"),__publicField(this,"ctrlId"),__publicField(this,"ctrlNickName"),__publicField(this,"editMode",null),__publicField(this,"editCtrlName",null),__publicField(this,"editAnchor",null),__publicField(this,"lastEditPoint",null),__publicField(this,"bounds"),__publicField(this,"targets",[]),__publicField(this,"editorConfig",null),__publicField(this,"aspectRatio",-1),__publicField(this,"uniformScale",!1),__publicField(this,"camera"),__publicField(this,"canvasElement"),__publicField(this,"resizeObserver"),__publicField(this,"anchors",[]),__publicField(this,"title",null),__publicField(this,"shadowEmitter"),__publicField(this,"handleMatrix",(t=>{var n;if(this.shadowContainer){const i=t.appended(null!=(n=this.shadowContainer.data.shadowMatrix)?n:new this.shadowScope.Matrix);this.shadowContainer.data.shadowMatrix=i,this.shadowContainer.transform(this.shadowContainer.matrix.inverted()),this.shadowContainer.matrix=i}else this.targets.forEach((n=>n.appendPointsMatrix(t)))})),__publicField(this,"handlePointerDown",(t=>{var n;if(!t.target)return;this.shadowEmitter.setActive(!0),this.translateShadow();const i=t.target,r=i.getAttribute("data-anchor");r&&(t.preventDefault(),(t.metaKey||(null==(n=this.editorConfig)?void 0:n.uniformScale()))&&(this.uniformScale=!0),this.uniformScale&&(this.aspectRatio=this.bounds.width/this.bounds.height),this.editMode="matrix",this.editAnchor=r,this.lastEditPoint={x:t.pageX,y:t.pageY},this.hiddenCtrlPoints()),i.getAttribute("data-rotator")&&(t.preventDefault(),this.editMode="rotate",this.lastEditPoint={x:t.pageX,y:t.pageY},this.rootView.style.opacity="0"),i===this.frame&&(t.preventDefault(),this.editMode="translate",this.lastEditPoint={x:t.pageX,y:t.pageY},this.hiddenCtrlPoints()),i===this.rootView&&this.emit("clear");const o=i.getAttribute("data-ctrl-name");o&&(t.preventDefault(),this.editMode="ctrl-point",this.editCtrlName=o,this.lastEditPoint={x:t.offsetX,y:t.offsetY})})),__publicField(this,"handlePointerMove",(t=>{if(t.preventDefault(),t.target){if("matrix"===this.editMode&&this.editAnchor&&this.lastEditPoint){const n=t.pageX-this.lastEditPoint.x;let i=t.pageY-this.lastEditPoint.y;this.bounds.offsetBy(this.editAnchor,n,i,this.uniformScale?this.aspectRatio:-1),this.lastEditPoint={x:t.pageX,y:t.pageY}}if("rotate"===this.editMode&&this.lastEditPoint){const n=this.bounds.pageCenter(),i=new this.scope.Point(this.lastEditPoint.x,this.lastEditPoint.y).subtract(new this.scope.Point(n)),r=new this.scope.Point(t.pageX,t.pageY).subtract(new this.scope.Point(n)),o=new this.scope.Point(this.bounds.midX,this.bounds.midY),h=this.scope.project.view.viewToProject(o);this.targets.forEach((t=>{t.item&&t.rotateByOffset(r.angle-i.angle,h.x,h.y)})),this.lastEditPoint={x:t.pageX,y:t.pageY}}if("translate"===this.editMode&&this.lastEditPoint){const n=t.pageX-this.lastEditPoint.x;let i=t.pageY-this.lastEditPoint.y;this.bounds.translate(n,i),this.updateBoundsByShadow(),this.lastEditPoint={x:t.pageX,y:t.pageY}}if("ctrl-point"===this.editMode&&this.editorConfig){const n=this.editorConfig.controlPoints.find((t=>t.name===this.editCtrlName)),i=this.rootView.querySelector(`[data-ctrl-name="${this.editCtrlName}"]`);if(n&&i){const i=this.scope.project.view.getEventPoint(t);n.onPositionChange(i),this.updateBoundsByShadow(),this.updateControlPointsPosition()}}}})),__publicField(this,"handlePointerUp",(t=>{t.preventDefault(),this.resetShadow(),this.shadowEmitter.setActive(!1),this.updateBounds(),"rotate"===this.editMode&&(this.applyConfig(this.editorConfig),this.rootView.style.opacity="1"),"matrix"===this.editMode&&this.bounds.reset(),this.editMode=null,this.editAnchor=null,this.lastEditPoint=null,this.uniformScale=!1})),__publicField(this,"handleFrameDBClick",(t=>{t.target===this.frame&&1===this.targets.length&&"point-text"===this.targets[0].type&&(this.frame.style.display="none",this.createTextEditor(this.targets[0]))})),__publicField(this,"updateBounds",(()=>{let t=Number.MAX_VALUE,n=-Number.MAX_VALUE,i=Number.MAX_VALUE,r=-Number.MAX_VALUE;for(const c of this.targets){if(!c.item)continue;const o=c.item.bounds;t=Math.min(o.topLeft.x,t),n=Math.max(o.bottomRight.x,n),i=Math.min(o.topLeft.y,i),r=Math.max(o.bottomRight.y,r)}const o=new this.scope.Point(t,i).transform(this.scope.project.view.matrix),h=new this.scope.Point(n,r).transform(this.scope.project.view.matrix);this.bounds.update(o.x,o.y,h.x,h.y),this.updateControlPointsPosition()})),this.shadowEmitter=i,this.shadowScope=n,this.shadowContainer=new n.Group,this.shadowContainer.applyMatrix=!1,this.shadowContainer.data.uuid=`shadow-container-${h.ctrlId}`,this.canvasElement=r,this.camera=o,this.scope=t,this.ctrlUserMap=h.ctrlUserMap,this.viewerId=h.viewerId,this.ctrlId=h.ctrlId,this.ctrlNickName=h.ctrlNickName,this.rootView=document.createElement("div"),this.rootView.style.cssText="position:absolute;display:none;width:100%;height:100%;top:50%;left:50%;transform:translate(-50%,-50%);",this.frame=document.createElement("div"),this.frame.style.position="absolute",this.frame.style.padding="8px",this.frame.style.transform="translate(-8px, -8px)",this.rootView.appendChild(this.frame),this.bounds=new Pn(this.frame,this.scope),this.bounds.on("matrix",this.handleMatrix),this.rotator=document.createElement("div"),this.rotator.setAttribute("data-rotator","true"),this.viewerId===this.ctrlId?(this.frame.style.cursor="all-scroll",this.rootView.addEventListener("pointerdown",this.handlePointerDown),this.rootView.addEventListener("pointermove",this.handlePointerMove),this.rootView.addEventListener("pointerup",this.handlePointerUp),this.createAnchor(),this.frame.appendChild(this.rotator),this.frame.addEventListener("dblclick",this.handleFrameDBClick)):(this.title=document.createElement("div"),this.title.textContent=`${this.ctrlNickName}`,this.title.style.cssText="color:#fff;font-size:12px;padding: 0.2em 0.4em;border-radius: 0.4em;position: absolute;top: 0%;left: 0;margin: -0.4em;transform: translate(-100%, -100%);",this.frame.appendChild(this.title),this.rootView.style.pointerEvents="none"),this.resizeObserver=new ResizeObserver((()=>{this.alignRootView()})),this.resizeObserver.observe(this.canvasElement),this.alignRootView()}alignRootView(){const t=this.canvasElement.getBoundingClientRect();this.rootView.style.width=`${t.width}px`,this.rootView.style.height=`${t.height}px`}hiddenCtrlPoints(){var t;null==(t=this.editorConfig)||t.controlPoints.forEach((t=>{const n=this.rootView.querySelector(`[data-ctrl-name="${t.name}"]`);n&&(n.style.opacity="0")}))}createTextEditor(t){const n=t.getInternalMeasurement();if(!n)return;const i=new Cn(this.camera);i.setOrigin(n.topLeft.x,n.topLeft.y),i.setRotate(n.angle),i.setContent(t.content),i.setFontFamily(t.fontFamily),i.setFontSize(t.fontSize*n.scaleX),this.rootView.appendChild(i.rootView),this.camera.triggerZoom(),t.shadow="layer",i.on("change",(n=>{t.content=n})),i.on("done",(()=>{t.shadow="",i.dispose(),this.rootView.removeChild(i.rootView)})),setTimeout((()=>{i.focus(),i.setCaret()}),30)}createAnchor(){Object.keys(kn).forEach((t=>{const n=document.createElement("div");n.setAttribute("data-anchor",t),n.style.cssText=`width:6px;height:6px;position:absolute;${kn[t]}`,this.frame.appendChild(n),this.anchors.push(n)}))}setAnchorsVisiblity(t,n){t.forEach((t=>{const i=document.querySelector(`[data-anchor='${t}']`);i&&(i.style.display=n?"block":"none")}))}updateControlPointsPosition(){this.editorConfig&&this.editorConfig.controlPoints.forEach((t=>{const n=t.getPosition(),i=this.rootView.querySelector(`[data-ctrl-name="${t.name}"]`);i&&(i.style.top=`${n.y}px`,i.style.left=`${n.x}px`,i.style.opacity="1")}))}createControlPoint(t){const n=document.createElement("div");n.setAttribute("data-ctrl-name",t.name);const i=t.getPosition();n.style.cssText=`position:absolute;top:${i.y}px;left:${i.x}px;width:8px;height:8px;background:#FFC107;border-radius:50%;padding:4px;background-clip:content-box;transform:translate(-8px,-8px);`,this.rootView.appendChild(n)}removeAllControlPoints(){const t=this.rootView.querySelectorAll("[data-ctrl-name]");Array.from(t).forEach((t=>{this.rootView.removeChild(t)}))}applyConfig(t){if(this.editorConfig=t,this.setAnchorsVisiblity(["tl","t","tr","l","r","bl","b","br"],!0),t&&("four"===t.resizeModel()?this.setAnchorsVisiblity(["tl","tr","bl","br"],!1):"four-corner"===t.resizeModel()?this.setAnchorsVisiblity(["t","l","r","b"],!1):"horizontal"===t.resizeModel()&&this.setAnchorsVisiblity(["tl","t","tr","bl","b","br"],!1),this.removeAllControlPoints(),this.viewerId===this.ctrlId))for(const n of t.controlPoints)this.createControlPoint(n)}setTargets(t){if(t.length<=0)return;this.frame.style.display="block",this.targets=t;let n=null;for(const i of t)i.item&&(n=n?n.merge(i.editorConfig()):i.editorConfig());this.applyConfig(n),this.updateBounds()}updateBoundsByShadow(){let t=Number.MAX_VALUE,n=-Number.MAX_VALUE,i=Number.MAX_VALUE,r=-Number.MAX_VALUE;const o=this.shadowContainer.bounds;t=Math.min(o.topLeft.x,t),n=Math.max(o.bottomRight.x,n),i=Math.min(o.topLeft.y,i),r=Math.max(o.bottomRight.y,r);const h=new this.shadowScope.Point(t,i).transform(this.shadowScope.project.view.matrix),c=new this.shadowScope.Point(n,r).transform(this.shadowScope.project.view.matrix);this.bounds.update(h.x,h.y,c.x,c.y)}translateShadow(){this.shadowContainer.removeChildren(),this.shadowContainer.remove(),this.shadowScope.project.activeLayer.addChild(this.shadowContainer),this.targets.forEach((t=>{t.shadow=this.shadowContainer.data.uuid}))}resetShadow(){const t=this.shadowContainer.data.shadowMatrix;this.targets.forEach((n=>{n.shadow="",t&&n.appendPointsMatrix(t)})),this.shadowContainer.transform(this.shadowContainer.matrix.inverted()),this.shadowContainer.data.shadowMatrix=null}hidden(){this.resetShadow(),this.rootView.style.display="none",this.targets=[],this.editorConfig=null,this.ctrlId!==this.viewerId&&this.scope.project.view.off("frame",this.updateBounds)}show(){const t=this.ctrlUserMap.get(_n);this.frame.style.border=`1px solid ${t}`,this.rotator.style.cssText=`cursor:grab;position:absolute;width:8px;height:8px;border-radius:50%;border:1px solid ${t};top:-22px;left:50%;translate:-50%;`,this.anchors.forEach((n=>{n.style.background=t})),this.title&&(this.title.style.background=t),this.ctrlId!==this.viewerId&&this.scope.project.view.on("frame",this.updateBounds),this.rootView.style.display="block"}dispose(){this.resizeObserver.disconnect()}},Mn=class extends Ve{constructor(t,n,i,r,o,h,c,u){super(t,n,i,r),__publicField(this,"from",null),__publicField(this,"to",null),__publicField(this,"rootView"),__publicField(this,"canvasElement"),__publicField(this,"elementModel",null),__publicField(this,"toolbarModel"),__publicField(this,"camera"),this.rootView=o,this.canvasElement=h,this.toolbarModel=c,this.camera=u}onMouseDown(t){this.from=t.point.clone()}onMouseDrag(t){}onMouseUp(t){this.to=t.point.clone(),this.from&&this.to&&this.from.getDistance(this.to)<100&&this.createPointEditor(t.point.x,t.point.y)}createPointEditor(t,n){if(this.elementModel=this.modelGetter().createPointText(t,n,!0),null===this.elementModel)return;const i=window.document.createElement("div"),r=this.canvasElement.getBoundingClientRect();i.style.cssText=`position:absolute;transform:translate(-50%, -50%);top:50%;left:50%;width:${r.width}px;height:${r.height}px;`;const o=new Cn(this.camera);o.setOrigin(t,n),i.appendChild(o.rootView),this.rootView.appendChild(i),o.setFontSize(this.toolbarModel.fontSize),o.setFontFamily(this.toolbarModel.fontFamily),this.camera.triggerZoom(),o.on("caretOutRight",(()=>{console.log("caretOutRight")})),o.on("change",(t=>{this.elementModel&&(this.elementModel.content=t)})),o.on("done",(()=>{this.elementModel&&(this.elementModel.content&&0!==this.elementModel.content.length?this.elementModel.shadow="":this.modelGetter().removeElementItem(this.elementModel.uuid)),o.dispose(),this.rootView.removeChild(i)})),setTimeout((()=>{o.focus()}),30)}},En=class extends It{constructor(t,n){super(),__publicField(this,"element"),__publicField(this,"scope"),__publicField(this,"lastVector",null),__publicField(this,"lastPoint",null),__publicField(this,"onTouchStart",(t=>{if(!(t.touches.length>1))return;t.preventDefault(),t.stopPropagation(),t.stopImmediatePropagation();const n=new this.scope.Point(t.touches[0].pageX,t.touches[0].pageY),i=new this.scope.Point(t.touches[1].pageX,t.touches[1].pageY);this.lastVector=i.subtract(n),this.lastPoint=n})),__publicField(this,"onTouchMove",(t=>{if(this.lastVector&&this.lastPoint&&2===t.touches.length){t.preventDefault(),t.stopPropagation(),t.stopImmediatePropagation();const n=new this.scope.Point(t.touches[0].pageX,t.touches[0].pageY),i=new this.scope.Point(t.touches[1].pageX,t.touches[1].pageY),r=i.subtract(n);Math.abs(this.lastVector.length-r.length)<5?this.emit("offset",n.x-this.lastPoint.x,n.y-this.lastPoint.y):this.emit("scale",r.length/this.lastVector.length,new this.scope.Point({x:(i.x+n.x)/2,y:(i.y+n.y)/2})),this.lastPoint=n,this.lastVector=r}else if(2===t.touches.length){t.preventDefault(),t.stopPropagation(),t.stopImmediatePropagation();const n=new this.scope.Point(t.touches[0].pageX,t.touches[0].pageY),i=new this.scope.Point(t.touches[1].pageX,t.touches[1].pageY);this.lastVector=i.subtract(n),this.lastPoint=n}else this.lastVector=null,this.lastPoint=null})),__publicField(this,"onTouchEnd",(()=>{this.lastVector=null,this.lastPoint=null})),this.element=t,this.scope=n,this.element.addEventListener("touchstart",this.onTouchStart),this.element.addEventListener("touchmove",this.onTouchMove),this.element.addEventListener("touchend",this.onTouchEnd)}},An=class extends It{constructor(t,n,i,r,o,h,c,u){super(),__publicField(this,"scope"),__publicField(this,"dom"),__publicField(this,"lastTriggerTime",0),__publicField(this,"lastDelta",{x:0,y:0}),__publicField(this,"requestUserMap"),__publicField(this,"userManager"),__publicField(this,"observers",new Map),__publicField(this,"whiteboardAttrsMap"),__publicField(this,"paperSize"),__publicField(this,"domSize"),__publicField(this,"hasPermission"),__publicField(this,"gesture"),__publicField(this,"inherentScale",1),__publicField(this,"handleMainCameraChange",(t=>{const n=this.requestUserMap(this.userManager.selfId);if("main"===n.get(xn))for(const[i,r]of t.changes.keys.entries())if(i===bn&&("add"===r.action||"update"===r.action)){const t=this.whiteboardAttrsMap.get(bn),i=new this.scope.Matrix(t);n.set(bn,t),this.emit("zoom",this.inherentMatrix.appended(i))}})),__publicField(this,"handleUserLeave",(t=>{const n=this.observers.get(t.id);n&&this.requestUserMap(t.id).unobserve(n)})),__publicField(this,"handleUserJoin",(t=>{const observer=n=>{this.handleViewMatrixUpdate(t.id,n)};this.requestUserMap(t.id).observe(observer),this.observers.set(t.id,observer)})),__publicField(this,"handleViewMatrixUpdate",((t,n)=>{const i=this.requestUserMap(this.userManager.selfId).get(xn);for(const[r,o]of n.changes.keys.entries())if("update"===o.action)if(r===bn){if(t!==this.userManager.selfId&&i===t){const n=this.requestUserMap(t).get(bn),i=new this.scope.Matrix(n);this.requestUserMap(this.userManager.selfId).set(bn,n),this.emit("zoom",this.inherentMatrix.appended(i))}else if(t===this.userManager.selfId&&"free"===i){const n=this.requestUserMap(t).get(bn),i=new this.scope.Matrix(n);this.emit("zoom",this.inherentMatrix.appended(i))}}else r===yn?"update"!==o.action&&"add"!==o.action||this.emit("userPageChange",t,this.requestUserMap(t).get(yn)):r===xn&&("update"!==o.action&&"add"!==o.action||this.emit("userViewModeChange",t,this.requestUserMap(t).get(xn)))})),__publicField(this,"handleWheel",(t=>{t.preventDefault(),t.stopImmediatePropagation(),t.stopPropagation();const n=this.domSize(),i=this.paperSize(),r=t.deltaY/n[1]*i[1],o=t.deltaX/n[0]*i[0];if(Date.now()-this.lastTriggerTime<32)return this.lastDelta.y+=r,void(this.lastDelta.x+=o);if(t.ctrlKey){const n=120*Math.sign(t.wheelDelta||100),i=this.scope.project.view.getEventPoint(t),o=r+this.lastDelta.y,h=new this.scope.Matrix;let c=1;c=o>0?Math.max(1-Math.abs(o/n),1e-8):1+Math.abs(o/n),h.scale(c,i),this.appendViewMatrix(h)}else{const n=this.lastDelta.x+t.deltaX,i=this.lastDelta.y+t.deltaY,r=new this.scope.Matrix;r.translate({x:-n*window.devicePixelRatio,y:-i*window.devicePixelRatio}),this.appendViewMatrix(r)}this.lastTriggerTime=Date.now(),this.lastDelta={x:0,y:0}})),this.hasPermission=o,this.paperSize=c,this.domSize=u,this.whiteboardAttrsMap=r,this.scope=i,this.requestUserMap=h,this.userManager=n,this.dom=t,this.dom.addEventListener("wheel",this.handleWheel,{passive:!1,capture:!0}),this.dom.addEventListener("touchstart",(t=>{t.preventDefault()}),{passive:!1}),this.createModel(this.userManager.selfId),this.userManager.userIdList().forEach((t=>{const observer=n=>{this.handleViewMatrixUpdate(t,n)};this.requestUserMap(t).observe(observer),this.observers.set(t,observer)})),this.userManager.on("join",this.handleUserJoin),this.userManager.on("leave",this.handleUserLeave),this.whiteboardAttrsMap.has(bn)||this.whiteboardAttrsMap.set(bn,[1,0,0,1,0,0]),this.whiteboardAttrsMap.observe(this.handleMainCameraChange),this.gesture=new En(this.dom,this.scope),this.gesture.on("offset",((t,n)=>{const i=new this.scope.Matrix;i.translate({x:t*this.translateScale,y:n*this.translateScale}),this.appendViewMatrix(i)})),this.gesture.on("scale",((t,n)=>{const i=new this.scope.Matrix,r=this.scope.project.view.viewToProject(n);i.scale(t,r),this.appendViewMatrix(i)}))}get inherentMatrix(){const t=new this.scope.Matrix;return t.scale(this.inherentScale,[0,0]),t}get translateScale(){return 1/this.scope.project.view.matrix.scaling.x}updateInherentScale(t){this.inherentScale=t}getActiveMatrix(){const t=this.requestUserMap(this.userManager.selfId).get(xn);let n;return n="main"===t?this.whiteboardAttrsMap.get(bn):"free"===t?this.requestUserMap(this.userManager.selfId).get(bn):this.requestUserMap(t).get(bn),new this.scope.Matrix(n)}triggerZoom(){this.emit("zoom",this.inherentMatrix.appended(this.getActiveMatrix()))}resetViewMatrixToFlow(t){const n=this.requestUserMap(t).get(bn),i=new this.scope.Matrix(n);this.emit("zoom",this.inherentMatrix.appended(i))}resetViewMatrixToMain(){const t=this.whiteboardAttrsMap.get(bn),n=new this.scope.Matrix(t);this.emit("zoom",this.inherentMatrix.appended(n))}createModel(t){const n=this.requestUserMap(t);n.has(bn)||n.set(bn,[1,0,0,1,0,0]),n.has(xn)||n.set(xn,"main")}appendViewMatrix(t){const n=this.requestUserMap(this.userManager.selfId),i=n.get(xn);if("free"===i||"main"===i){const i=n.get(bn),r=new this.scope.Matrix(i).appended(t);r.scaling.x<=3&&r.scaling.x>=.3&&n.set(bn,[r.a,r.b,r.c,r.d,r.tx,r.ty])}if("main"===i&&this.hasPermission(32)){const n=this.whiteboardAttrsMap.get(bn),i=new this.scope.Matrix(n).appended(t);i.scaling.x<=3&&i.scaling.x>=.3&&this.whiteboardAttrsMap.set(bn,[i.a,i.b,i.c,i.d,i.tx,i.ty])}}translate(t,n){const i=new this.scope.Matrix;i.translate({x:t,y:n}),this.appendViewMatrix(i)}},Tn=class extends Ve{constructor(t,n,i,r){super(t,n,i,r),__publicField(this,"elementModel",null),__publicField(this,"from",null),__publicField(this,"to",null),this.tool.minDistance=1}onMouseDown(t){this.elementModel=this.modelGetter().createSegmentedPath("ellipse",!0),this.from=t.point.clone(),this.to=t.point.clone()}onMouseDrag(t){if(this.from&&this.elementModel){this.to=t.point.clone();const n=new this.scope.Rectangle(this.from,this.to),i=serializePath(new this.scope.Path.Ellipse(n));this.elementModel.setPoints(i)}}onMouseUp(t){this.elementModel&&this.from&&this.from.getDistance(t.point)<3?this.modelGetter().removeElementItem(this.elementModel.uuid):this.elementModel&&(this.elementModel.shadow="")}},On=class extends Ve{constructor(t,n,i,r){super(t,n,i,r),__publicField(this,"elementModel",null),__publicField(this,"from",null),__publicField(this,"to",null),this.tool.minDistance=1}onMouseDown(t){this.elementModel=this.modelGetter().createTriangle(!0),this.from=t.point.clone(),this.to=t.point.clone()}onMouseDrag(t){this.from&&this.elementModel&&(this.to=t.point.clone(),this.elementModel.setPoints([(this.to.x-this.from.x)/2+this.from.x,this.from.y,this.to.x,this.to.y,this.from.x,this.to.y]))}onMouseUp(t){this.elementModel&&this.from&&this.from.getDistance(t.point)<3&&this.modelGetter().removeElementItem(this.elementModel.uuid),this.elementModel&&(this.elementModel.shadow="")}},Ln=class extends It{constructor(t){super(),__publicField(this,"view"),__publicField(this,"selfUserId"),__publicField(this,"permissions"),__publicField(this,"tool"),__publicField(this,"fontSize"),__publicField(this,"dashArray"),__publicField(this,"fontFamily"),__publicField(this,"strokeColor"),__publicField(this,"fillColor"),__publicField(this,"strokeWidth"),__publicField(this,"getElementAttribute"),__publicField(this,"setElementAttribute"),__publicField(this,"getCurrentTool"),__publicField(this,"setCurrentTool"),__publicField(this,"setCanvasBackgroundColor"),__publicField(this,"setThemeColor"),__publicField(this,"gotoPage"),__publicField(this,"addPage"),__publicField(this,"deletePage"),__publicField(this,"pageList"),__publicField(this,"currentPageId"),__publicField(this,"clonePage"),__publicField(this,"clearPage"),__publicField(this,"setFreeModelUserPage"),__publicField(this,"indexedNavigation"),__publicField(this,"setViewModeToFree"),__publicField(this,"setViewModeToFlow"),__publicField(this,"setViewModeToMain"),__publicField(this,"getViewModel"),__publicField(this,"undo"),__publicField(this,"redo"),__publicField(this,"rasterize"),__publicField(this,"setInputType"),__publicField(this,"insertImage"),this.view=t}},Dn=class extends Ve{constructor(t,n,i,r,o){super(t,n,i,r),__publicField(this,"elementModel",null),__publicField(this,"trashedElementsModel"),__publicField(this,"pointCount",0),this.trashedElementsModel=o,this.tool.minDistance=1}onMouseDown(t){this.pointCount=0,this.elementModel=this.modelGetter().createEraser()}onMouseDrag(t){this.pointCount>1024||(this.elementModel&&(this.pointCount+=1,this.elementModel.appendPoints([t.point.x,t.point.y])),this.scope.project.activeLayer.children.forEach((n=>{n.data.type&&["selector","eraser","laser"].indexOf(n.data.type)<0&&n.hitTest(t.point,{segments:!0,stroke:!0,fill:!0,tolerance:5})&&this.trashedElementsModel.addTrashedElementForSelf(n.data.uuid,n.data.ownerId)})))}onMouseUp(t){this.elementModel&&this.modelGetter().removeElementItem(this.elementModel.uuid),this.trashedElementsModel.removeAllTrashedElementsForSelf()}},Nn=class extends It{constructor(t,n,i){super(),__publicField(this,"requestUserMap"),__publicField(this,"userManager"),__publicField(this,"hasPermission"),__publicField(this,"observers",new Map),__publicField(this,"handleUserLeave",(t=>{const n=this.observers.get(t.id);n&&this.requestUserMap(t.id).unobserveDeep(n)})),__publicField(this,"handleUserJoin",(t=>{const observer=n=>{this.handleUserTrashElementsChange(t.id,n)};this.requestUserMap(t.id).observeDeep(observer),this.observers.set(t.id,observer)})),this.hasPermission=i,this.userManager=t,this.requestUserMap=n,this.createModel(this.userManager.selfId),this.userManager.userIdList().forEach((t=>{const observer=n=>{this.handleUserTrashElementsChange(t,n)};this.requestUserMap(t).observeDeep(observer),this.observers.set(t,observer)})),this.userManager.on("join",this.handleUserJoin),this.userManager.on("leave",this.handleUserLeave)}get hasDeleteSelfPermission(){return this.hasPermission(8)}get hasDeleteOthersPermission(){return this.hasPermission(16)}handleUserTrashElementsChange(t,n){for(const i of n)if("trashedElements"===i.target.get("inner-map-id")){const n=Array.from(i.target.keys()).filter((t=>"inner-map-id"!==t));this.emit("elementsChange",t,n)}}createModel(t){const n=this.requestUserMap(t);if(!n.has("trashedElements")){const t=new YMap;t.set("inner-map-id","trashedElements"),n.set("trashedElements",t)}}addTrashedElementForSelf(t,n){if(n===this.userManager.selfId&&!this.hasDeleteSelfPermission)return;if(n!==this.userManager.selfId&&!this.hasDeleteOthersPermission)return;const i=this.requestUserMap(this.userManager.selfId).get("trashedElements");for(const r of this.userManager.userIdList())if(r!==this.userManager.selfId){const n=this.requestUserMap(r).get("trashedElements");if(this.requestUserMap(r).get(wn).has(t)||n.has(t))return}i.has(t)||i.set(t,t)}removeAllTrashedElementsForSelf(){var t;const n=this.requestUserMap(this.userManager.selfId).get("trashedElements");for(const i of n.entries())this.emit("removeElementForSelf",this.userManager.selfId,i[0]);null==(t=n.doc)||t.transact((()=>{n.clear(),n.set("inner-map-id","trashedElements")}))}dispose(){this.userManager.userIdList().forEach((t=>{const n=this.observers.get(t);n&&this.requestUserMap(t).unobserveDeep(n)})),this.observers.clear(),this.userManager.off("leave",this.handleUserLeave),this.userManager.off("join",this.handleUserJoin)}},Rn=class extends Ve{constructor(t,n,i,r){super(t,n,i,r),__publicField(this,"elementModel",null),__publicField(this,"pointCount",0),this.tool.minDistance=5}onMouseDown(t){this.pointCount=0,this.elementModel=this.modelGetter().createLaserPointer()}onMouseDrag(t){this.pointCount>1024||this.elementModel&&(this.pointCount+=1,this.elementModel.appendPoints([t.point.x,t.point.y]))}onMouseUp(t){this.elementModel&&this.elementModel.beginRemoveAnimate()}},jn=class extends It{constructor(t,n,i,r,o){super(),__publicField(this,"whiteboardAttrsMap"),__publicField(this,"pageMap"),__publicField(this,"requestUserMap"),__publicField(this,"userManager"),__publicField(this,"observers",new Map),__publicField(this,"hasPermission"),__publicField(this,"handleUserLeave",(t=>{const n=this.observers.get(t.id);n&&this.requestUserMap(t.id).unobserve(n)})),__publicField(this,"handleUserJoin",(t=>{this.createCurrentPageObserver(t.id)})),__publicField(this,"handleMainPageChange",(t=>{for(const[n,i]of t.changes.keys.entries())if(n===yn){const t=this.requestUserMap(this.userManager.selfId).get(xn);if(("update"===i.action||"add"===i.action)&&"main"===t){const t=this.whiteboardAttrsMap.get(yn);if(!this.pageMap.has(t)&&"_i_"!==t)return void log(`main page {${t}} not found.`,{},"error");this.requestUserMap(this.userManager.selfId).set(yn,t),this.emit("switchPage",t)}}})),__publicField(this,"handleUserCurrentPageChange",((t,n)=>{for(const[i,r]of n.changes.keys.entries())if(i===yn){const n=this.requestUserMap(this.userManager.selfId).get(xn);if("update"===r.action||"add"===r.action)if(t!==this.userManager.selfId&&n===t){const n=this.requestUserMap(t).get(yn);this.requestUserMap(this.userManager.selfId).set(yn,n),this.emit("switchPage",n)}else if(t===this.userManager.selfId&&"free"===n){const n=this.requestUserMap(t).get(yn);this.emit("switchPage",n)}}})),__publicField(this,"handlePageMapChange",(()=>{this.emit("pagesChange",Array.from(this.pageMap.keys()))})),this.hasPermission=o,this.pageMap=r,this.userManager=n,this.requestUserMap=i,this.whiteboardAttrsMap=t,this.userManager.userIdList().forEach((t=>{this.createCurrentPageObserver(t)})),this.userManager.on("join",this.handleUserJoin),this.userManager.on("leave",this.handleUserLeave),this.whiteboardAttrsMap.observe(this.handleMainPageChange),this.pageMap.observe(this.handlePageMapChange)}createCurrentPageObserver(t){const observer=n=>{this.handleUserCurrentPageChange(t,n)};this.requestUserMap(t).observe(observer),this.observers.set(t,observer)}getCurrentPage(t){var n,i,r;const o=this.requestUserMap(t).get(xn);return"main"===o?null!=(n=this.whiteboardAttrsMap.get(yn))?n:null:"free"===o?null!=(i=this.requestUserMap(t).get(yn))?i:null:null!=(r=this.requestUserMap(o).get(yn))?r:null}pageList(){return Array.from(this.pageMap.keys())}modifyDetect(t){if("_i_"===t)return!0;return"main"!==this.requestUserMap(this.userManager.selfId).get(xn)?(console.warn("cannot modify pages in non-main view mode."),!1):!!this.hasPermission(32)||(console.warn("cannot modify pages without WhiteboardPermissionFlag.mainView."),!1)}addPage(t){return!!this.modifyDetect(t)&&(!this.pageMap.has(t)&&(this.pageMap.set(t,""),!0))}deletePage(t,n){if(this.modifyDetect("")&&(this.pageMap.delete(t),n)){this.whiteboardAttrsMap.get(yn)===t&&this.whiteboardAttrsMap.set(yn,n)}}setUserPage(t,n){if(this.pageList().indexOf(t)<0||!this.hasPermission(64))return;const i=this.requestUserMap(n);"free"===i.get(xn)&&i.set(yn,t)}gotoPage(t){if(this.pageList().indexOf(t)<0)return;const n=this.requestUserMap(this.userManager.selfId),i=n.get(xn);"free"!==i&&"main"!==i||n.set(yn,t),"main"===i&&this.hasPermission(32)&&this.whiteboardAttrsMap.set(yn,t)}},delay=t=>new Promise((n=>setTimeout(n,t)));async function waitUntil(t,n){let i=Date.now();for(;!t()&&Date.now()-i<n;)await delay(50),i=Date.now()}var Vn,Un,zn=class extends It{constructor(t,n,i,r){super(),__publicField(this,"idPool",new Set),__publicField(this,"pageModel"),__publicField(this,"userMap"),__publicField(this,"indexedPageMap"),__publicField(this,"list",{}),__publicField(this,"hasPermission"),__publicField(this,"handleIndexedPageMapUpdate",(t=>{this.list=this.indexedPageMap.get("list");const n=this.pageModel.pageList().filter((t=>/^_i_/.test(t)&&Object.keys(this.list).indexOf(t)<0)),i=Object.keys(this.list).filter((t=>this.pageModel.pageList().indexOf(t)<0));this.indexedPageMap.doc.transact((()=>{i.forEach((t=>this.pageModel.addPage(t))),n.forEach((t=>this.pageModel.deletePage(t)))}))})),this.hasPermission=r,this.pageModel=t,this.userMap=n,this.indexedPageMap=i,this.pageModel.on("switchPage",(t=>{setTimeout((()=>{const n=this.getPageIndex(t);n>=0&&this.emit("activePageChange",n)}))})),this.pageModel.on("pagesChange",(()=>{this.emit("pageCountChange",this.pageCount)})),this.indexedPageMap.has("list")?(this.list=this.indexedPageMap.get("list"),Object.keys(this.list).forEach((t=>this.idPool.add(t)))):(this.list={_i_:{prev:"",next:""}},this.indexedPageMap.set("list",this.list),this.idPool.add("_i_")),this.indexedPageMap.observe(this.handleIndexedPageMapUpdate)}get idList(){return this.pageModel.pageList().filter((t=>/^_i_/.test(t)))}get head(){let t=Object.keys(this.list).find((t=>this.list[t]&&""===this.list[t].prev));if(!t)throw log("indexed navigation confusion",{list:JSON.stringify(this.list)},"error"),new Error("indexed navigation confusion");return t}get lastNodeId(){let t=this.head,n=this.list[t];for(;n&&n.next;)t=n.next,n=this.list[n.next];return t}getNextId(){const t=Array.from(this.idPool).filter((t=>this.idList.indexOf(t)<0));if(t.length>0)return t[0];let n=Math.random().toString(32).substring(3,5);for(;this.idPool.has(`_i_${n}`);)n=Math.random().toString(32).substring(3,5);const i=`_i_${n}`;return this.idPool.add(i),i}initIndexed(){return new Promise((t=>{setTimeout((()=>{0===this.pageModel.pageList().length?(this.pageModel.addPage("_i_"),t(!0)):t(!1)}))}))}get pageCount(){return this.idList.length}get currentPageIndex(){const t=this.userMap.get(yn);return this.getPageIndex(t)}getPageIndex(t){let n=0,i=this.head;for(;i!==t;){const t=this.list[i];if(!t)return-1;i=t.next,n+=1}return n}getPageId(t){const n=this.head;if(n){let i=0,r=n;for(;i<t;){i+=1;const t=this.list[r];if(!t||!t.next)return null;r=t.next}return r}return null}modifyDetect(){return"main"!==this.userMap.get(xn)?(console.warn("cannot modify pages in non-main view mode."),!1):!!this.hasPermission(32)||(console.warn("cannot modify pages without WhiteboardPermissionFlag.mainView."),!1)}pushPage(t=!0){return this.indexedPageMap.doc.transact((()=>{const n=this.getNextId();if(!this.pageModel.addPage(n))return;if(!this.modifyDetect())return;const i=this.lastNodeId;this.list[n]={prev:i,next:""};const r=this.list[i];this.list[i]={prev:r.prev,next:n},t&&this.pageModel.gotoPage(n),this.indexedPageMap.set("list",this.list)})),this.pageCount}insertPage(t,n=!0){const i=this.getPageId(t);if(!i)return this.pageCount;if("main"!==this.userMap.get(xn))return console.warn("cannot modify pages in non-main view mode."),this.pageCount;const r=this.list[i];if(!r)return this.pageCount;const o=this.list[r.next];if(!o)return this.pushPage(!0);const h=this.getNextId();return this.pageModel.addPage(h)?(this.list[h]={next:r.next,prev:i},this.list[i]={prev:r.prev,next:h},this.list[r.next]={prev:h,next:o.next},this.indexedPageMap.doc?this.indexedPageMap.doc.transact((()=>{this.indexedPageMap.set("list",this.list),n&&this.pageModel.gotoPage(h)})):(this.indexedPageMap.set("list",this.list),n&&this.pageModel.gotoPage(h)),this.pageCount):this.pageCount}prevPage(){const t=this.userMap.get(yn),n=this.list[t];if(!n||""===n.prev)return this.currentPageIndex;const i=this.getPageIndex(n.prev);return this.pageModel.gotoPage(n.prev),i}nextPage(){const t=this.userMap.get(yn),n=this.list[t];if(!n||""===n.next)return this.currentPageIndex;const i=this.getPageIndex(n.next);return this.pageModel.gotoPage(n.next),i}removePage(t){if(this.pageCount<=1)return this.pageCount;if("main"!==this.userMap.get(xn))return console.warn("cannot modify pages in non-main view mode."),this.pageCount;const n=this.getPageId(t);if(n){const t=this.list[n],i=this.list[t.prev],r=this.list[t.next],o=t.next||t.prev;delete this.list[n],i&&(this.list[t.prev]={prev:i.prev,next:t.next}),r&&(this.list[t.next]={prev:t.prev,next:r.next}),this.indexedPageMap.doc?this.indexedPageMap.doc.transact((()=>{this.pageModel.deletePage(n,o),this.indexedPageMap.set("list",this.list)})):(this.pageModel.deletePage(n,o),this.indexedPageMap.set("list",this.list))}return this.pageCount}gotoPage(t){const n=this.getPageId(t);n&&this.pageModel.gotoPage(n)}},Bn=class extends It{constructor(t){super(),__publicField(this,"userMap"),this.userMap=t}getActive(){return this.userMap.get("shadowActive")}setActive(t){return this.userMap.set("shadowActive",t)}},Fn=class extends Ve{constructor(t,n,i,r){super(t,n,i,r),__publicField(this,"elementModel",null),__publicField(this,"from",null),__publicField(this,"to",null),this.tool.minDistance=1}onMouseDown(t){this.elementModel=this.modelGetter().createStraightLine(!0),this.from=t.point.clone(),this.to=t.point.clone()}onMouseDrag(t){this.from&&this.elementModel&&(this.to=t.point.clone(),this.elementModel.setPoints([this.from.x,this.from.y,this.to.x,this.to.y]))}onMouseUp(t){this.elementModel&&(this.elementModel.shadow=""),this.elementModel&&this.from&&this.from.getDistance(t.point)<3&&this.modelGetter().removeElementItem(this.elementModel.uuid)}},qn=class extends Ve{constructor(t,n,i,r,o){super(t,n,i,r),__publicField(this,"camera"),__publicField(this,"downPoint",null),this.camera=o}onMouseDown(t){this.downPoint=t.point,this.shadowEmitter.emit("grabDown")}onMouseDrag(t){this.downPoint?this.camera.translate(t.point.x-this.downPoint.x,t.point.y-this.downPoint.y):this.downPoint=t.point}onMouseUp(){this.downPoint=null,this.shadowEmitter.emit("grabUp")}},Wn="whiteboard",Yn=(n=class extends qt{constructor(){super(),__publicField(this,"name",Wn),__publicField(this,"emitter"),__publicField(this,"toolbarModel"),__publicField(this,"selectElementsModel"),__publicField(this,"trashedElementsModel"),__publicField(this,"pageModel"),__publicField(this,"layers",new Map),__publicField(this,"undoManagers",new Map),__publicField(this,"rootElement",document.createElement("div")),__publicField(this,"paperScope",new Se.default.PaperScope),__publicField(this,"canvasElement",document.createElement("canvas")),__publicField(this,"shadowScope",new Se.default.PaperScope),__publicField(this,"shadowCanvasElement",document.createElement("canvas")),__publicField(this,"shadowEmitter"),__publicField(this,"tools"),__publicField(this,"editors",new Map),__publicField(this,"camera"),__publicField(this,"resizeObserver"),__publicField(this,"option"),__publicField(this,"permissions"),__publicField(this,"inputType","any"),__publicField(this,"isPenEvent",!1),__publicField(this,"hasPenInput",null),__publicField(this,"enableToolEvent",(()=>!("pen"===this.inputType&&!this.isPenEvent))),__publicField(this,"handlePageSwitch",(t=>{var n,i,r,o;for(const h of this.editors.values())h.hidden();this.selectElementsModel.clearSelectElementForSelf(),waitUntil((()=>this.layers.has(t)),3e3).then((()=>{if(this.layers.has(t)){for(const t of this.layers.entries())t[1].off("elementInsert",this.handleElementInsert),t[1].off("elementRemove",this.handleElementRemove),t[1].off("elementClear",this.handleElementClear);const n=this.layers.get(t);n.on("elementInsert",this.handleElementInsert),n.on("elementRemove",this.handleElementRemove),n.on("elementClear",this.handleElementClear),n.flushRenderables();const i=this.userManager.userIdList().filter((t=>t!==this.userId));for(const r of i)if(this.userMap(r).get(yn)===t){const t=Array.from(this.userMap(r).get(wn).keys()).filter((t=>"inner-map-id"!==t));t.length>0&&this.handleElementsSelect(r,t)}}})),waitUntil((()=>this.undoManagers.has(t)),3e3).then((()=>{if(this.undoManagers.has(t)){for(const t of this.undoManagers.entries())t[1].off("stack-item-added",this.handleStackItemAdded),t[1].off("stack-item-popped",this.handleStackItemPopped);this.undoManagers.get(t).on("stack-item-added",this.handleStackItemAdded),this.undoManagers.get(t).on("stack-item-popped",this.handleStackItemPopped)}})),this.emitter.emit("redoStackLength",null!=(i=null==(n=this.undoManager)?void 0:n.redoStack.length)?i:0),this.emitter.emit("undoStackLength",null!=(o=null==(r=this.undoManager)?void 0:r.undoStack.length)?o:0)})),__publicField(this,"hasPermission",(t=>this.permissions.hasPermission(t,this.userId))),__publicField(this,"handleStackItemAdded",(()=>{var t,n,i,r;this.selectElementsModel.clearSelectElementForSelf(),this.emitter.emit("redoStackLength",null!=(n=null==(t=this.undoManager)?void 0:t.redoStack.length)?n:0),this.emitter.emit("undoStackLength",null!=(r=null==(i=this.undoManager)?void 0:i.undoStack.length)?r:0)})),__publicField(this,"handleStackItemPopped",(()=>{var t,n,i,r;this.emitter.emit("redoStackLength",null!=(n=null==(t=this.undoManager)?void 0:t.redoStack.length)?n:0),this.emitter.emit("undoStackLength",null!=(r=null==(i=this.undoManager)?void 0:i.undoStack.length)?r:0)})),__publicField(this,"handleLayersChange",(t=>{for(let n=0,i=t.length;n<i;n++){const i=t[n];if(!this.layers.has(i)){const t=this.getMap(`layer/${i}/elements`),n=new en(i,this.shadowEmitter,t,this.paperScope,this.toolbarModel,this.userManager,this.hasPermission);this.layers.set(i,n)}if(!this.undoManagers.has(i)){const t=this.getMap(`layer/${i}/elements`),n=new UndoManager(t,{trackedOrigins:new Set([Ke])});this.undoManagers.set(i,n)}}for(let n of this.layers.entries())if(t.indexOf(n[0])<0){const t=this.layers.get(n[0]);this.layers.delete(n[0]),t&&t.dispose();const i=this.userMap(this.userId).get(xn),r=this.userMap(this.userId).get(yn);"free"===i&&n[0]===r&&(this.userMap(this.userId).set(xn,"main"),this.userMap(this.userId).set(yn,this.getMap("attrs").get(yn)))}})),__publicField(this,"getCurrentRenderableModel",(()=>{let t=this.userMap(this.userId).get(yn);return this.layers.has(t)||this.emitter.emit("error",20001,`target page: ${t} not found`),this.layers.get(t)})),__publicField(this,"handleElementClear",(()=>{this.paperScope.project.activeLayer.removeChildren()})),__publicField(this,"handleElementInsert",(t=>{for(const n of t){n.createPaperElement();const t=""===n.shadow?this.paperScope:this.shadowScope,i=t.project.activeLayer.children.find((t=>t.data.uuid===n.uuid));i&&i.remove(),this.insertElementToParent(n.item,t.project.activeLayer)}})),__publicField(this,"handleElementRemove",((t,n)=>{const i=this.layers.get(n);if(!i)return;const r=i.elementModels.get(t);r&&r.item&&r.item.remove(),i.elementModels.delete(t)})),__publicField(this,"handleRemoveTrashedElementForSelf",((t,n)=>{var i;const r=this.userMap(this.userId).get(yn);null==(i=this.layers.get(r))||i.removeElementItem(n)})),__publicField(this,"handleElementsTrash",((t,n)=>{const i=this.userMap(t).get(yn),r=this.userMap(this.userId).get(yn);i===r&&this.layers.has(i)&&n.forEach((t=>{const n=this.layers.get(i).elementModels.get(t);n&&n.item&&(n.item.opacity=.3)}))})),__publicField(this,"handleElementsSelect",((t,n)=>{var i;if(!this.editors.has(t)){const n=this.userManager.getUser(t),r=new In(this.paperScope,this.shadowScope,this.shadowEmitter,this.canvasElement,this.camera,{viewerId:this.userId,ctrlId:t,ctrlNickName:null!=(i=null==n?void 0:n.nickName)?i:"",ctrlUserMap:this.userMap(t)});r.on("clear",(()=>{this.selectElementsModel.clearSelectElementForSelf()})),this.editors.set(t,r),this.rootElement.appendChild(r.rootView)}const r=this.editors.get(t);if(0===n.length)return r.hidden(),void this.emitter.emit("elementDeselected",t);r.show();const o=this.userMap(t).get(yn),h=this.userMap(this.userId).get(yn);if(o!==h||!this.layers.has(o))return;const c=n.map((t=>this.layers.get(o).elementModels.get(t))).filter((t=>!!t));if(r.setTargets(c),1===c.length){let n=c[0];if(n.item){const i=this.paperScope.project.view.projectToView(n.item.bounds.topLeft),r=this.paperScope.project.view.projectToView(n.item.bounds.bottomRight);this.emitter.emit("elementSelected",t,o,n.uuid,n.getStyleKeys(),[i.x,i.y,r.x-i.x,r.y-i.y])}}c.length>1&&this.emitter.emit("elementDeselected",t)})),requestAnimationFrameHook(this.paperScope),requestAnimationFrameHook(this.shadowScope),this.rootElement.setAttribute("data-forge-app","whiteboard"),document.body.addEventListener("pointerdown",(t=>{this.isPenEvent="pen"===t.pointerType,"pen"===t.pointerType&&null===this.hasPenInput&&(this.hasPenInput=!0,this.inputType="pen",this.emitter.emit("inputTypeChange",this.inputType))}),{capture:!0}),this.emitter=new Ln(this.rootElement),this.emitter.getElementAttribute=(t,n,i)=>{const r=this.layers.get(t);if(r){const t=r.elementModels.get(n);if(t)return t[i]}},this.emitter.setElementAttribute=(t,n,i,r)=>{const o=this.layers.get(t);if(o){const t=o.elementModels.get(n);t&&(t[i]=r)}},this.emitter.getCurrentTool=()=>this.toolbarModel.currentTool,this.emitter.setCurrentTool=t=>{this.toolbarModel.currentTool=t},this.emitter.setThemeColor=t=>{this.userMap(this.userId).set(_n,t)},this.emitter.gotoPage=t=>{this.pageModel.gotoPage(t)},this.emitter.setFreeModelUserPage=(t,n)=>{this.pageModel.setUserPage(t,n)},this.emitter.addPage=t=>this.pageModel.addPage(t),this.emitter.deletePage=t=>this.pageModel.deletePage(t),this.emitter.pageList=()=>this.pageModel.pageList(),this.emitter.currentPageId=t=>{const n=null!=t?t:this.userId;return this.userMap(n).get(yn)},this.emitter.setViewModeToFree=t=>{const n=t?this.hasPermission(64)?t:null:this.userId;n&&this.userMap(n).set(xn,"free")},this.emitter.setViewModeToFlow=(t,n)=>{const i=n?this.hasPermission(64)?n:null:this.userId;if(i&&this.userManager.getUser(t)){this.userMap(i).set(xn,t);const n=this.userMap(t).get(yn);this.userMap(i).set(yn,n),this.handlePageSwitch(n),this.camera.resetViewMatrixToFlow(t)}},this.emitter.setViewModeToMain=t=>{const n=t?this.hasPermission(64)?t:null:this.userId;if(n){this.userMap(n).set(xn,"main");const t=this.getMap("attrs").get(yn);this.userMap(n).set(yn,t),this.handlePageSwitch(t),this.camera.resetViewMatrixToMain()}},this.emitter.getViewModel=t=>{const n=t||this.userId;return this.userMap(n).get(xn)},this.emitter.setCanvasBackgroundColor=t=>{this.canvasElement.style.background=t},this.emitter.clonePage=(t,n)=>{if(this.pageModel.pageList().indexOf(n)>=0)return;this.pageModel.addPage(n);const i=this.getMap(`layer/${t}/elements`),r=this.getMap(`layer/${n}/elements`);if(this.layers.has(n)||this.layers.set(n,new en(n,this.shadowEmitter,r,this.paperScope,this.toolbarModel,this.userManager,this.hasPermission)),!this.undoManagers.has(n)){const t=new UndoManager(r,{trackedOrigins:new Set([Ke])});this.undoManagers.set(n,t)}if(i)for(const o of i.keys())r.set(o,i.get(o).clone())},this.emitter.clearPage=()=>{const t=this.getCurrentRenderableModel();t.elements.doc.transact((()=>{t.elements.clear()}),Ke),t.elementModels.clear()},this.emitter.undo=()=>{var t;null==(t=this.undoManager)||t.undo()},this.emitter.redo=()=>{var t;null==(t=this.undoManager)||t.redo()},this.emitter.rasterize=t=>this.rasterize(t),this.emitter.setInputType=t=>{this.inputType=t,this.emitter.emit("inputTypeChange",this.inputType)};const t=this;Object.defineProperty(this.emitter,"tool",{get:()=>t.toolbarModel.currentTool,set(n){t.toolbarModel.currentTool=n}}),Object.defineProperty(this.emitter,"fontSize",{get:()=>t.toolbarModel.fontSize,set(n){t.toolbarModel.fontSize=n}}),Object.defineProperty(this.emitter,"fontFamily",{get:()=>t.toolbarModel.fontFamily,set(n){t.toolbarModel.fontFamily=n}}),Object.defineProperty(this.emitter,"strokeColor",{get:()=>t.toolbarModel.strokeColor,set(n){t.toolbarModel.strokeColor=n}}),Object.defineProperty(this.emitter,"fillColor",{get:()=>t.toolbarModel.fillColor,set(n){t.toolbarModel.fillColor=n}}),Object.defineProperty(this.emitter,"strokeWidth",{get:()=>t.toolbarModel.strokeWidth,set(n){t.toolbarModel.strokeWidth=n}}),Object.defineProperty(this.emitter,"dashArray",{get:()=>t.toolbarModel.dashArray,set(n){t.toolbarModel.dashArray=n}})}get undoManager(){var t;const n=this.pageModel.getCurrentPage(this.userId);return n&&null!=(t=this.undoManagers.get(n))?t:null}userMap(t){return this.getMap(`user/${t}`)}async initialize(t){var n;this.permissions=new Ze(this.userManager,(t=>this.userMap(t))),this.emitter.permissions=this.permissions,this.emitter.selfUserId=this.userId,this.option=t,this.userMap(this.userId).set(_n,"#009688"),this.shadowEmitter=new Bn(this.userMap(this.userId)),this.pageModel=new jn(this.getMap("attrs"),this.userManager,(t=>this.userMap(t)),this.getMap("pages"),this.hasPermission),this.pageModel.on("pagesChange",this.handleLayersChange),this.pageModel.on("switchPage",this.handlePageSwitch),this.camera=new An(this.rootElement,this.userManager,this.paperScope,this.getMap("attrs"),this.hasPermission,(t=>this.userMap(t)),(()=>[this.paperScope.project.view.size.width,this.paperScope.project.view.size.height]),(()=>{const t=this.canvasElement.getBoundingClientRect();return[t.width,t.height]})),this.camera.on("zoom",(t=>{this.paperScope.project.view.matrix=t,this.shadowScope.project.view.matrix=t,this.editors.forEach((t=>{t.updateBounds()}))})),this.camera.on("userPageChange",((t,n)=>{this.emitter.emit("activePageChange",t,n)})),this.camera.on("userViewModeChange",((t,n)=>{this.emitter.emit("userViewModeChange",t,n)})),this.rootElement.style.position="relative",this.rootElement.appendChild(this.canvasElement),this.toolbarModel=new mn(this.userMap(this.userId),Object.assign({tool:"grab",strokeColor:"#009688",fillColor:null,fontSize:24,fontFamily:"Courier New",strokeWidth:4,dashArray:[]},null!=(n=t.defaultToolbarStyle)?n:{})),this.trashedElementsModel=new Nn(this.userManager,(t=>this.userMap(t)),this.hasPermission),this.selectElementsModel=new Sn(this.userManager,(t=>this.userMap(t)),this.hasPermission),this.tools={curve:new pn(this.enableToolEvent,this.getCurrentRenderableModel,this.shadowEmitter,this.paperScope),rectangle:new fn(this.enableToolEvent,this.getCurrentRenderableModel,this.shadowEmitter,this.paperScope),selector:new vn(this.enableToolEvent,this.getCurrentRenderableModel,this.shadowEmitter,this.paperScope,this.selectElementsModel),arrow:new ze(this.enableToolEvent,this.getCurrentRenderableModel,this.shadowEmitter,this.paperScope),line:new Fn(this.enableToolEvent,this.getCurrentRenderableModel,this.shadowEmitter,this.paperScope),text:new Mn(this.enableToolEvent,this.getCurrentRenderableModel,this.shadowEmitter,this.paperScope,this.rootElement,this.canvasElement,this.toolbarModel,this.camera),ellipse:new Tn(this.enableToolEvent,this.getCurrentRenderableModel,this.shadowEmitter,this.paperScope),triangle:new On(this.enableToolEvent,this.getCurrentRenderableModel,this.shadowEmitter,this.paperScope),eraser:new Dn(this.enableToolEvent,this.getCurrentRenderableModel,this.shadowEmitter,this.paperScope,this.trashedElementsModel),laser:new Rn(this.enableToolEvent,this.getCurrentRenderableModel,this.shadowEmitter,this.paperScope),grab:new qn(this.enableToolEvent,this.getCurrentRenderableModel,this.shadowEmitter,this.paperScope,this.camera)},this.toolbarModel.on("update",(t=>{this.paperScope.tool=this.tools[t.tool].tool,this.emitter.emit("toolbarStyleChange",t)})),this.paperScope.tool=this.tools[this.toolbarModel.currentTool].tool,this.selectElementsModel.on("elementsChange",this.handleElementsSelect),this.trashedElementsModel.on("elementsChange",this.handleElementsTrash),this.trashedElementsModel.on("removeElementForSelf",this.handleRemoveTrashedElementForSelf),this.canvasElement.style.background="#FFEB3B",this.canvasElement.style.position="absolute",this.canvasElement.style.top="50%",this.canvasElement.style.left="50%",this.canvasElement.style.transform="translate(-50%, -50%)",this.paperScope.setup(this.canvasElement),this.paperScope.settings.insertItems=!1,this.shadowCanvasElement.style.position="absolute",this.shadowCanvasElement.style.top="50%",this.shadowCanvasElement.style.left="50%",this.shadowCanvasElement.style.transform="translate(-50%, -50%)",this.shadowCanvasElement.style.pointerEvents="none",this.rootElement.appendChild(this.shadowCanvasElement),this.shadowScope.setup(this.shadowCanvasElement),this.shadowScope.settings.insertItems=!1,this.resizeObserver=new ResizeObserver((()=>{const t=this.rootElement.getBoundingClientRect();let n=t.width,i=n*this.option.height/this.option.width;i>t.height&&(i=t.height,n=i*this.option.width/this.option.height),this.camera.updateInherentScale(n/this.option.width),this.paperScope.project.view.viewSize=new this.paperScope.Size(n,i),this.shadowScope.project.view.viewSize=new this.paperScope.Size(n,i),this.userMap(this.userId).set("viewSize",`${n}.${i}`),this.camera.triggerZoom()})),this.resizeObserver.observe(this.rootElement),this.getMap("attrs").has(yn)||this.getMap("attrs").set(yn,"_i_"),this.emitter.indexedNavigation=new zn(this.pageModel,this.userMap(this.userId),this.getMap("indexedNavigation"),this.hasPermission),this.emitter.indexedNavigation.initIndexed().then((t=>{if(t)this.userMap(this.userId).set(yn,"_i_");else{this.handleLayersChange(this.pageModel.pageList());const t=this.pageModel.getCurrentPage(this.userId);t?(this.userMap(this.userId).set(yn,t),this.handlePageSwitch(t)):(this.userMap(this.userId).set(yn,"_i_"),this.handlePageSwitch("_i_"))}})),this.shadowEmitter.on("translateOut",((t,n)=>{var i;const r=this.shadowScope.project.activeLayer;let o=null;o="layer"===n?r:null!=(i=r.children.find((t=>t.data.uuid===n)))?i:null,o&&t.forEach((t=>{const n=o.children.find((n=>n.data.uuid===t));if(n)n.remove(),this.insertElementToParent(n,this.paperScope.project.activeLayer);else{const n=this.pageModel.getCurrentPage(this.userId);if(n){const i=this.layers.get(n);if(i){const n=i.elementModels.get(t);n&&n.item&&this.insertElementToParent(n.item,this.paperScope.project.activeLayer)}}}}))})),this.shadowEmitter.on("translateIn",((t,n)=>{var i;let r=null;r="layer"===n?this.shadowScope.project.activeLayer:null!=(i=this.shadowScope.project.activeLayer.children.find((t=>t.data.uuid===n)))?i:null,r&&t.forEach((t=>{const n=this.paperScope.project.activeLayer.children.find((n=>n.data.uuid===t));n&&(n.remove(),this.insertElementToParent(n,r))}))})),this.shadowEmitter.on("grabDown",(()=>{this.emitter.emit("grabDown")})),this.shadowEmitter.on("grabUp",(()=>{this.emitter.emit("grabUp")})),this.clearElements()}clearElements(){if(this.userManager.userIdList().every((t=>!0!==this.userMap(t).get("shadowActive")))){const t=this.pageModel.getCurrentPage(this.userId);if(t){const n=this.layers.get(t);n&&n.clearElement()}}setTimeout((()=>this.clearElements()),1e4)}findElementIndex(t,n){const i=n.children;let r=0,o=i.length-1,h=i.length;for(;r<=o;){const n=Math.floor((r+o)/2);i[n].data.index>t?(h=n,o=n-1):r=n+1}return h}insertElementToParent(t,n){const i=n.children;for(let r=this.findElementIndex(t.data.index,n);r>=0;r--){const o=i[r-1];if(!o||o.data.index<t.data.index||o.data.uuid<t.data.uuid){n.insertChild(r,t);break}}}rasterize(t){var n;let i;i="string"==typeof t?t:"number"==typeof t?this.emitter.indexedNavigation.getPageId(t):this.pageModel.getCurrentPage(this.userId);const r=this.layers.get(i||"");if(!r)return Promise.resolve(null);const o=new Se.default.PaperScope,h=document.createElement("canvas");o.setup(h),o.view.matrix=this.paperScope.project.view.matrix.clone(),o.view.viewSize=this.paperScope.project.view.viewSize.clone();for(const c of Array.from(r.elements.keys())){let t=null;if(r.elementModels.has(c))t=null!=(n=r.elementModels.get(c))?n:null;else{let n=r.elements.get(c);n&&(t=r.convertToModel(n))}if(t&&(t.item||t.createPaperElement(),t.item)){const n=t.item.clone({insert:!1});o.project.activeLayer.addChild(n)}}return document.body.appendChild(o.view.element),new Promise((t=>{setTimeout((()=>{t(o.view.element.toDataURL("image/png"))}),32)}))}async dispose(){var t;this.selectElementsModel.dispose(),this.trashedElementsModel.dispose();for(const n of this.layers.keys())null==(t=this.layers.get(n))||t.dispose();this.paperScope.view.remove(),this.shadowScope.view.remove(),this.rootElement.removeChild(this.canvasElement),this.rootElement.removeChild(this.shadowCanvasElement),this.paperScope.project.clear(),this.shadowScope.project.clear(),this.resizeObserver.disconnect()}},__publicField(n,"applicationName",Wn),n),Hn={},Kn={},$n={};Vn=$n,Object.defineProperty(Vn,"__esModule",{value:!0}),Vn.parseBridgeMessage=Vn.bridgeMessageTemplate=Vn.ackTypeError=Vn.ackTypeSuccess=Vn.BridgeEventType=void 0,(Un=Vn.BridgeEventType||(Vn.BridgeEventType={})).req="req",Un.evt="evt",Un.ack="ack",Vn.ackTypeSuccess="success",Vn.ackTypeError="error",Vn.bridgeMessageTemplate=function bridgeMessageTemplate(t,n,i,r){return JSON.stringify({type:t,actionId:n,method:i,payload:r})},Vn.parseBridgeMessage=function parseBridgeMessage(t){try{const{type:n,actionId:i,method:r,payload:o}=JSON.parse(t);return{type:n,actionId:i,method:r,payload:o}}catch(n){return console.log(`parse bridge message ${t} failed: `,n),{type:"fail",actionId:"",method:"",payload:t}}};var Gn={},Xn={},Jn={};Object.defineProperty(Jn,"__esModule",{value:!0}),Jn.default=void 0,Jn.default="ffffffff-ffff-ffff-ffff-ffffffffffff";var Zn={};Object.defineProperty(Zn,"__esModule",{value:!0}),Zn.default=void 0,Zn.default="00000000-0000-0000-0000-000000000000";var Qn={},ti={},ei={};Object.defineProperty(ei,"__esModule",{value:!0}),ei.default=void 0,ei.default=/^(?:[0-9a-f]{8}-[0-9a-f]{4}-[1-8][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}|00000000-0000-0000-0000-000000000000|ffffffff-ffff-ffff-ffff-ffffffffffff)$/i,Object.defineProperty(ti,"__esModule",{value:!0}),ti.default=void 0;var ni=function _interopRequireDefault$c(t){return t&&t.__esModule?t:{default:t}}(ei);ti.default=function validate(t){return"string"==typeof t&&ni.default.test(t)},Object.defineProperty(Qn,"__esModule",{value:!0}),Qn.default=void 0;var ii=function _interopRequireDefault$b(t){return t&&t.__esModule?t:{default:t}}(ti);Qn.default=function parse(t){if(!(0,ii.default)(t))throw TypeError("Invalid UUID");var n,i=new Uint8Array(16);return i[0]=(n=parseInt(t.slice(0,8),16))>>>24,i[1]=n>>>16&255,i[2]=n>>>8&255,i[3]=255&n,i[4]=(n=parseInt(t.slice(9,13),16))>>>8,i[5]=255&n,i[6]=(n=parseInt(t.slice(14,18),16))>>>8,i[7]=255&n,i[8]=(n=parseInt(t.slice(19,23),16))>>>8,i[9]=255&n,i[10]=(n=parseInt(t.slice(24,36),16))/1099511627776&255,i[11]=n/4294967296&255,i[12]=n>>>24&255,i[13]=n>>>16&255,i[14]=n>>>8&255,i[15]=255&n,i};var ri={};Object.defineProperty(ri,"__esModule",{value:!0}),ri.default=void 0,ri.unsafeStringify=unsafeStringify;var si=function _interopRequireDefault$a(t){return t&&t.__esModule?t:{default:t}}(ti);for(var ai=[],oi=0;oi<256;++oi)ai.push((oi+256).toString(16).slice(1));function unsafeStringify(t,n=0){return(ai[t[n+0]]+ai[t[n+1]]+ai[t[n+2]]+ai[t[n+3]]+"-"+ai[t[n+4]]+ai[t[n+5]]+"-"+ai[t[n+6]]+ai[t[n+7]]+"-"+ai[t[n+8]]+ai[t[n+9]]+"-"+ai[t[n+10]]+ai[t[n+11]]+ai[t[n+12]]+ai[t[n+13]]+ai[t[n+14]]+ai[t[n+15]]).toLowerCase()}ri.default=function stringify(t,n=0){var i=unsafeStringify(t,n);if(!(0,si.default)(i))throw TypeError("Stringified UUID is invalid");return i};var hi,li={},ci={};Object.defineProperty(ci,"__esModule",{value:!0}),ci.default=function rng(){if(!hi&&!(hi="undefined"!=typeof crypto&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto)))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return hi(ui)};var ui=new Uint8Array(16);Object.defineProperty(li,"__esModule",{value:!0}),li.default=void 0;var di,pi,fi=function _interopRequireDefault$9(t){return t&&t.__esModule?t:{default:t}}(ci),gi=ri;var mi=0,vi=0;li.default=function v1(t,n,i){var r=n&&i||0,o=n||new Array(16),h=(t=t||{}).node,c=t.clockseq;if(t._v6||(h||(h=di),null==c&&(c=pi)),null==h||null==c){var u=t.random||(t.rng||fi.default)();null==h&&(h=[u[0],u[1],u[2],u[3],u[4],u[5]],di||t._v6||(h[0]|=1,di=h)),null==c&&(c=16383&(u[6]<<8|u[7]),void 0!==pi||t._v6||(pi=c))}var d=void 0!==t.msecs?t.msecs:Date.now(),p=void 0!==t.nsecs?t.nsecs:vi+1,g=d-mi+(p-vi)/1e4;if(g<0&&void 0===t.clockseq&&(c=c+1&16383),(g<0||d>mi)&&void 0===t.nsecs&&(p=0),p>=1e4)throw new Error("uuid.v1(): Can't create more than 10M uuids/sec");mi=d,vi=p,pi=c;var m=(1e4*(268435455&(d+=122192928e5))+p)%4294967296;o[r++]=m>>>24&255,o[r++]=m>>>16&255,o[r++]=m>>>8&255,o[r++]=255&m;var v=d/4294967296*1e4&268435455;o[r++]=v>>>8&255,o[r++]=255&v,o[r++]=v>>>24&15|16,o[r++]=v>>>16&255,o[r++]=c>>>8|128,o[r++]=255&c;for(var _=0;_<6;++_)o[r+_]=h[_];return n||(0,gi.unsafeStringify)(o)};var _i={};Object.defineProperty(_i,"__esModule",{value:!0}),_i.default=function v1ToV6(t){var n=function _v1ToV6(t,n=!1){return Uint8Array.of((15&t[6])<<4|t[7]>>4&15,(15&t[7])<<4|(240&t[4])>>4,(15&t[4])<<4|(240&t[5])>>4,(15&t[5])<<4|(240&t[0])>>4,(15&t[0])<<4|(240&t[1])>>4,(15&t[1])<<4|(240&t[2])>>4,96|15&t[2],t[3],t[8],t[9],t[10],t[11],t[12],t[13],t[14],t[15])}("string"==typeof t?(0,yi.default)(t):t);return"string"==typeof t?(0,wi.unsafeStringify)(n):n};var yi=function _interopRequireDefault$8(t){return t&&t.__esModule?t:{default:t}}(Qn),wi=ri;var bi={},xi={};Object.defineProperty(xi,"__esModule",{value:!0}),xi.URL=xi.DNS=void 0,xi.default=function v35(t,n,i){function generateUUID(t,r,o,h){var c;if("string"==typeof t&&(t=function stringToBytes(t){t=unescape(encodeURIComponent(t));for(var n=[],i=0;i<t.length;++i)n.push(t.charCodeAt(i));return n}(t)),"string"==typeof r&&(r=(0,Ci.default)(r)),16!==(null===(c=r)||void 0===c?void 0:c.length))throw TypeError("Namespace must be array-like (16 iterable integer values, 0-255)");var u=new Uint8Array(16+t.length);if(u.set(r),u.set(t,r.length),(u=i(u))[6]=15&u[6]|n,u[8]=63&u[8]|128,o){h=h||0;for(var d=0;d<16;++d)o[h+d]=u[d];return o}return(0,Si.unsafeStringify)(u)}try{generateUUID.name=t}catch(r){}return generateUUID.DNS=ki,generateUUID.URL=Pi,generateUUID};var Si=ri,Ci=function _interopRequireDefault$7(t){return t&&t.__esModule?t:{default:t}}(Qn);var ki=xi.DNS="6ba7b810-9dad-11d1-80b4-00c04fd430c8",Pi=xi.URL="6ba7b811-9dad-11d1-80b4-00c04fd430c8";var Ii={};function getOutputLength(t){return 14+(t+64>>>9<<4)+1}function safeAdd(t,n){var i=(65535&t)+(65535&n);return(t>>16)+(n>>16)+(i>>16)<<16|65535&i}function md5cmn(t,n,i,r,o,h){return safeAdd(function bitRotateLeft(t,n){return t<<n|t>>>32-n}(safeAdd(safeAdd(n,t),safeAdd(r,h)),o),i)}function md5ff(t,n,i,r,o,h,c){return md5cmn(n&i|~n&r,t,n,o,h,c)}function md5gg(t,n,i,r,o,h,c){return md5cmn(n&r|i&~r,t,n,o,h,c)}function md5hh(t,n,i,r,o,h,c){return md5cmn(n^i^r,t,n,o,h,c)}function md5ii(t,n,i,r,o,h,c){return md5cmn(i^(n|~r),t,n,o,h,c)}Object.defineProperty(Ii,"__esModule",{value:!0}),Ii.default=void 0,Ii.default=function md5(t){if("string"==typeof t){var n=unescape(encodeURIComponent(t));t=new Uint8Array(n.length);for(var i=0;i<n.length;++i)t[i]=n.charCodeAt(i)}return function md5ToHexEncodedArray(t){for(var n=[],i=32*t.length,r="0123456789abcdef",o=0;o<i;o+=8){var h=t[o>>5]>>>o%32&255,c=parseInt(r.charAt(h>>>4&15)+r.charAt(15&h),16);n.push(c)}return n}(function wordsToMd5(t,n){t[n>>5]|=128<<n%32,t[getOutputLength(n)-1]=n;for(var i=1732584193,r=-271733879,o=-1732584194,h=271733878,c=0;c<t.length;c+=16){var u=i,d=r,p=o,g=h;i=md5ff(i,r,o,h,t[c],7,-680876936),h=md5ff(h,i,r,o,t[c+1],12,-389564586),o=md5ff(o,h,i,r,t[c+2],17,606105819),r=md5ff(r,o,h,i,t[c+3],22,-1044525330),i=md5ff(i,r,o,h,t[c+4],7,-176418897),h=md5ff(h,i,r,o,t[c+5],12,1200080426),o=md5ff(o,h,i,r,t[c+6],17,-1473231341),r=md5ff(r,o,h,i,t[c+7],22,-45705983),i=md5ff(i,r,o,h,t[c+8],7,1770035416),h=md5ff(h,i,r,o,t[c+9],12,-1958414417),o=md5ff(o,h,i,r,t[c+10],17,-42063),r=md5ff(r,o,h,i,t[c+11],22,-1990404162),i=md5ff(i,r,o,h,t[c+12],7,1804603682),h=md5ff(h,i,r,o,t[c+13],12,-40341101),o=md5ff(o,h,i,r,t[c+14],17,-1502002290),i=md5gg(i,r=md5ff(r,o,h,i,t[c+15],22,1236535329),o,h,t[c+1],5,-165796510),h=md5gg(h,i,r,o,t[c+6],9,-1069501632),o=md5gg(o,h,i,r,t[c+11],14,643717713),r=md5gg(r,o,h,i,t[c],20,-373897302),i=md5gg(i,r,o,h,t[c+5],5,-701558691),h=md5gg(h,i,r,o,t[c+10],9,38016083),o=md5gg(o,h,i,r,t[c+15],14,-660478335),r=md5gg(r,o,h,i,t[c+4],20,-405537848),i=md5gg(i,r,o,h,t[c+9],5,568446438),h=md5gg(h,i,r,o,t[c+14],9,-1019803690),o=md5gg(o,h,i,r,t[c+3],14,-187363961),r=md5gg(r,o,h,i,t[c+8],20,1163531501),i=md5gg(i,r,o,h,t[c+13],5,-1444681467),h=md5gg(h,i,r,o,t[c+2],9,-51403784),o=md5gg(o,h,i,r,t[c+7],14,1735328473),i=md5hh(i,r=md5gg(r,o,h,i,t[c+12],20,-1926607734),o,h,t[c+5],4,-378558),h=md5hh(h,i,r,o,t[c+8],11,-2022574463),o=md5hh(o,h,i,r,t[c+11],16,1839030562),r=md5hh(r,o,h,i,t[c+14],23,-35309556),i=md5hh(i,r,o,h,t[c+1],4,-1530992060),h=md5hh(h,i,r,o,t[c+4],11,1272893353),o=md5hh(o,h,i,r,t[c+7],16,-155497632),r=md5hh(r,o,h,i,t[c+10],23,-1094730640),i=md5hh(i,r,o,h,t[c+13],4,681279174),h=md5hh(h,i,r,o,t[c],11,-358537222),o=md5hh(o,h,i,r,t[c+3],16,-722521979),r=md5hh(r,o,h,i,t[c+6],23,76029189),i=md5hh(i,r,o,h,t[c+9],4,-640364487),h=md5hh(h,i,r,o,t[c+12],11,-421815835),o=md5hh(o,h,i,r,t[c+15],16,530742520),i=md5ii(i,r=md5hh(r,o,h,i,t[c+2],23,-995338651),o,h,t[c],6,-198630844),h=md5ii(h,i,r,o,t[c+7],10,1126891415),o=md5ii(o,h,i,r,t[c+14],15,-1416354905),r=md5ii(r,o,h,i,t[c+5],21,-57434055),i=md5ii(i,r,o,h,t[c+12],6,1700485571),h=md5ii(h,i,r,o,t[c+3],10,-1894986606),o=md5ii(o,h,i,r,t[c+10],15,-1051523),r=md5ii(r,o,h,i,t[c+1],21,-2054922799),i=md5ii(i,r,o,h,t[c+8],6,1873313359),h=md5ii(h,i,r,o,t[c+15],10,-30611744),o=md5ii(o,h,i,r,t[c+6],15,-1560198380),r=md5ii(r,o,h,i,t[c+13],21,1309151649),i=md5ii(i,r,o,h,t[c+4],6,-145523070),h=md5ii(h,i,r,o,t[c+11],10,-1120210379),o=md5ii(o,h,i,r,t[c+2],15,718787259),r=md5ii(r,o,h,i,t[c+9],21,-343485551),i=safeAdd(i,u),r=safeAdd(r,d),o=safeAdd(o,p),h=safeAdd(h,g)}return[i,r,o,h]}(function bytesToWords(t){if(0===t.length)return[];for(var n=8*t.length,i=new Uint32Array(getOutputLength(n)),r=0;r<n;r+=8)i[r>>5]|=(255&t[r/8])<<r%32;return i}(t),8*t.length))},Object.defineProperty(bi,"__esModule",{value:!0}),bi.default=void 0;var Mi=_interopRequireDefault$6(xi),Ei=_interopRequireDefault$6(Ii);function _interopRequireDefault$6(t){return t&&t.__esModule?t:{default:t}}var Ai=(0,Mi.default)("v3",48,Ei.default);bi.default=Ai;var Ti={},Oi={};Object.defineProperty(Oi,"__esModule",{value:!0}),Oi.default=void 0;var Li="undefined"!=typeof crypto&&crypto.randomUUID&&crypto.randomUUID.bind(crypto);Oi.default={randomUUID:Li},Object.defineProperty(Ti,"__esModule",{value:!0}),Ti.default=void 0;var Di=_interopRequireDefault$5(Oi),Ni=_interopRequireDefault$5(ci),Ri=ri;function _interopRequireDefault$5(t){return t&&t.__esModule?t:{default:t}}Ti.default=function v4(t,n,i){if(Di.default.randomUUID&&!n&&!t)return Di.default.randomUUID();var r=(t=t||{}).random||(t.rng||Ni.default)();if(r[6]=15&r[6]|64,r[8]=63&r[8]|128,n){i=i||0;for(var o=0;o<16;++o)n[i+o]=r[o];return n}return(0,Ri.unsafeStringify)(r)};var ji={},Vi={};function f(t,n,i,r){switch(t){case 0:return n&i^~n&r;case 1:case 3:return n^i^r;case 2:return n&i^n&r^i&r}}function ROTL(t,n){return t<<n|t>>>32-n}Object.defineProperty(Vi,"__esModule",{value:!0}),Vi.default=void 0,Vi.default=function sha1(t){var n=[1518500249,1859775393,2400959708,3395469782],i=[1732584193,4023233417,2562383102,271733878,3285377520];if("string"==typeof t){var r=unescape(encodeURIComponent(t));t=[];for(var o=0;o<r.length;++o)t.push(r.charCodeAt(o))}else Array.isArray(t)||(t=Array.prototype.slice.call(t));t.push(128);for(var h=t.length/4+2,c=Math.ceil(h/16),u=new Array(c),d=0;d<c;++d){for(var p=new Uint32Array(16),g=0;g<16;++g)p[g]=t[64*d+4*g]<<24|t[64*d+4*g+1]<<16|t[64*d+4*g+2]<<8|t[64*d+4*g+3];u[d]=p}u[c-1][14]=8*(t.length-1)/Math.pow(2,32),u[c-1][14]=Math.floor(u[c-1][14]),u[c-1][15]=8*(t.length-1)&4294967295;for(var m=0;m<c;++m){for(var v=new Uint32Array(80),_=0;_<16;++_)v[_]=u[m][_];for(var y=16;y<80;++y)v[y]=ROTL(v[y-3]^v[y-8]^v[y-14]^v[y-16],1);for(var w=i[0],x=i[1],S=i[2],C=i[3],k=i[4],P=0;P<80;++P){var I=Math.floor(P/20),M=ROTL(w,5)+f(I,x,S,C)+k+n[I]+v[P]>>>0;k=C,C=S,S=ROTL(x,30)>>>0,x=w,w=M}i[0]=i[0]+w>>>0,i[1]=i[1]+x>>>0,i[2]=i[2]+S>>>0,i[3]=i[3]+C>>>0,i[4]=i[4]+k>>>0}return[i[0]>>24&255,i[0]>>16&255,i[0]>>8&255,255&i[0],i[1]>>24&255,i[1]>>16&255,i[1]>>8&255,255&i[1],i[2]>>24&255,i[2]>>16&255,i[2]>>8&255,255&i[2],i[3]>>24&255,i[3]>>16&255,i[3]>>8&255,255&i[3],i[4]>>24&255,i[4]>>16&255,i[4]>>8&255,255&i[4]]},Object.defineProperty(ji,"__esModule",{value:!0}),ji.default=void 0;var Ui=_interopRequireDefault$4(xi),zi=_interopRequireDefault$4(Vi);function _interopRequireDefault$4(t){return t&&t.__esModule?t:{default:t}}var Bi=(0,Ui.default)("v5",80,zi.default);ji.default=Bi;var Fi={};Object.defineProperty(Fi,"__esModule",{value:!0}),Fi.default=function v6(t={},n,i=0){var r=(0,Wi.default)(_objectSpread(_objectSpread({},t),{},{_v6:!0}),new Uint8Array(16));if(r=(0,Yi.default)(r),n){for(var o=0;o<16;o++)n[i+o]=r[o];return n}return(0,qi.unsafeStringify)(r)};var qi=ri,Wi=_interopRequireDefault$3(li),Yi=_interopRequireDefault$3(_i);function _interopRequireDefault$3(t){return t&&t.__esModule?t:{default:t}}function ownKeys(t,n){var i=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);n&&(r=r.filter((function(n){return Object.getOwnPropertyDescriptor(t,n).enumerable}))),i.push.apply(i,r)}return i}function _objectSpread(t){for(var n=1;n<arguments.length;n++){var i=null!=arguments[n]?arguments[n]:{};n%2?ownKeys(Object(i),!0).forEach((function(n){_defineProperty(t,n,i[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(i)):ownKeys(Object(i)).forEach((function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(i,n))}))}return t}function _defineProperty(t,n,i){return(n=function _toPropertyKey(t){var n=function _toPrimitive(t,n){if("object"!=typeof t||!t)return t;var i=t[Symbol.toPrimitive];if(void 0!==i){var r=i.call(t,n||"default");if("object"!=typeof r)return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===n?String:Number)(t)}(t,"string");return"symbol"==typeof n?n:n+""}(n))in t?Object.defineProperty(t,n,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[n]=i,t}var Hi={};Object.defineProperty(Hi,"__esModule",{value:!0}),Hi.default=function v6ToV1(t){var n=function _v6ToV1(t){return Uint8Array.of((15&t[3])<<4|t[4]>>4&15,(15&t[4])<<4|(240&t[5])>>4,(15&t[5])<<4|15&t[6],t[7],(15&t[1])<<4|(240&t[2])>>4,(15&t[2])<<4|(240&t[3])>>4,16|(240&t[0])>>4,(15&t[0])<<4|(240&t[1])>>4,t[8],t[9],t[10],t[11],t[12],t[13],t[14],t[15])}("string"==typeof t?(0,Ki.default)(t):t);return"string"==typeof t?(0,$i.unsafeStringify)(n):n};var Ki=function _interopRequireDefault$2(t){return t&&t.__esModule?t:{default:t}}(Qn),$i=ri;var Gi={};Object.defineProperty(Gi,"__esModule",{value:!0}),Gi.default=void 0;var Xi=function _interopRequireDefault$1(t){return t&&t.__esModule?t:{default:t}}(ci),Ji=ri;var Zi=null,Qi=null,tr=0;Gi.default=function v7(t,n,i){t=t||{};var r=n&&i||0,o=n||new Uint8Array(16),h=t.random||(t.rng||Xi.default)(),c=void 0!==t.msecs?t.msecs:Date.now(),u=void 0!==t.seq?t.seq:null,d=Qi,p=Zi;return c>tr&&void 0===t.msecs&&(tr=c,null!==u&&(d=null,p=null)),null!==u&&(u>2147483647&&(u=2147483647),d=u>>>19&4095,p=524287&u),null!==d&&null!==p||(d=(d=127&h[6])<<8|h[7],p=(p=(p=63&h[8])<<8|h[9])<<5|h[10]>>>3),c+1e4>tr&&null===u?++p>524287&&(p=0,++d>4095&&(d=0,tr++)):tr=c,Qi=d,Zi=p,o[r++]=tr/1099511627776&255,o[r++]=tr/4294967296&255,o[r++]=tr/16777216&255,o[r++]=tr/65536&255,o[r++]=tr/256&255,o[r++]=255&tr,o[r++]=d>>>4&15|112,o[r++]=255&d,o[r++]=p>>>13&63|128,o[r++]=p>>>5&255,o[r++]=p<<3&255|7&h[10],o[r++]=h[11],o[r++]=h[12],o[r++]=h[13],o[r++]=h[14],o[r++]=h[15],n||(0,Ji.unsafeStringify)(o)};var er={};Object.defineProperty(er,"__esModule",{value:!0}),er.default=void 0;var nr=function _interopRequireDefault(t){return t&&t.__esModule?t:{default:t}}(ti);er.default=function version(t){if(!(0,nr.default)(t))throw TypeError("Invalid UUID");return parseInt(t.slice(14,15),16)},function(t){Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"MAX",{enumerable:!0,get:function get(){return n.default}}),Object.defineProperty(t,"NIL",{enumerable:!0,get:function get(){return i.default}}),Object.defineProperty(t,"parse",{enumerable:!0,get:function get(){return r.default}}),Object.defineProperty(t,"stringify",{enumerable:!0,get:function get(){return o.default}}),Object.defineProperty(t,"v1",{enumerable:!0,get:function get(){return h.default}}),Object.defineProperty(t,"v1ToV6",{enumerable:!0,get:function get(){return c.default}}),Object.defineProperty(t,"v3",{enumerable:!0,get:function get(){return u.default}}),Object.defineProperty(t,"v4",{enumerable:!0,get:function get(){return d.default}}),Object.defineProperty(t,"v5",{enumerable:!0,get:function get(){return p.default}}),Object.defineProperty(t,"v6",{enumerable:!0,get:function get(){return g.default}}),Object.defineProperty(t,"v6ToV1",{enumerable:!0,get:function get(){return m.default}}),Object.defineProperty(t,"v7",{enumerable:!0,get:function get(){return v.default}}),Object.defineProperty(t,"validate",{enumerable:!0,get:function get(){return _.default}}),Object.defineProperty(t,"version",{enumerable:!0,get:function get(){return y.default}});var n=_interopRequireDefault2(Jn),i=_interopRequireDefault2(Zn),r=_interopRequireDefault2(Qn),o=_interopRequireDefault2(ri),h=_interopRequireDefault2(li),c=_interopRequireDefault2(_i),u=_interopRequireDefault2(bi),d=_interopRequireDefault2(Ti),p=_interopRequireDefault2(ji),g=_interopRequireDefault2(Fi),m=_interopRequireDefault2(Hi),v=_interopRequireDefault2(Gi),_=_interopRequireDefault2(ti),y=_interopRequireDefault2(er);function _interopRequireDefault2(t){return t&&t.__esModule?t:{default:t}}}(Xn),Object.defineProperty(Gn,"__esModule",{value:!0}),Gn.Bridge=void 0;const ir=Xn,rr=$n;Gn.Bridge=class Bridge{constructor(){this.methods=new Map,this.asyncMethods=new Map,this.queue=new Map,this.verbose=!1,this.isAndroid=()=>/android/i.test(navigator.userAgent)||/android/i.test(`${window.__platform}`),this.listen=t=>{this.recv(t.data)},this.isAndroid()?document.addEventListener("message",this.listen):window.addEventListener("message",this.listen)}enableLog(){this.verbose=!0}destroy(){window.removeEventListener("message",this.listen),document.addEventListener("message",this.listen)}call(t,n,i){return new Promise(((r,o)=>{const h=(0,ir.v4)(),c=(0,rr.bridgeMessageTemplate)(rr.BridgeEventType.evt,h,t,n);this.queue.set(h,{ack:!1,resolve:r,reject:o,method:t,callback:i}),window.ReactNativeWebView.postMessage(c)}))}register(t,n,i=!1){i?this.asyncMethods.set(t,n):this.methods.set(t,n)}registerAsyn(t,n){this.asyncMethods.set(t,n)}recv(t){if("string"==typeof t){const{type:n,actionId:i,method:r,payload:o}=(0,rr.parseBridgeMessage)(t);switch(this.verbose&&console.log({type:n,actionId:i,method:r,payload:o}),n){case rr.BridgeEventType.req:{const t={data:void 0,actionId:i,complete:!0},call=function(n,r){try{t.data=n.apply(r,o);const h=(0,rr.bridgeMessageTemplate)(rr.BridgeEventType.ack,i,rr.ackTypeSuccess,t);window.ReactNativeWebView.postMessage(h)}catch(dr){const n=(0,rr.bridgeMessageTemplate)(rr.BridgeEventType.ack,i,rr.ackTypeError,dr);window.ReactNativeWebView.postMessage(n)}},callWithProgressCallback=function(n,r){o.push((function(n,r){t.data=n,t.complete=!1!==r;let o="",h=!1;if("string"==typeof n)try{const t=JSON.parse(n);h=!(!t.error&&!t.__error)}catch(c){}else h=!(!n||!n.error&&!n.__error);o=h?(0,rr.bridgeMessageTemplate)(rr.BridgeEventType.ack,i,rr.ackTypeError,t.data):(0,rr.bridgeMessageTemplate)(rr.BridgeEventType.ack,i,rr.ackTypeSuccess,t),window.ReactNativeWebView.postMessage(o)}));try{n.apply(r,o)}catch(dr){const n=(0,rr.bridgeMessageTemplate)(rr.BridgeEventType.ack,i,rr.ackTypeError,dr);window.ReactNativeWebView.postMessage(n)}},n=this.methods.get(r),h=this.asyncMethods.get(r);if(n)call(n,this.methods);else if(h)callWithProgressCallback(h,this.asyncMethods);else{const t=r.split(".");if(t.length<2)return;const n=t.pop(),i=t.join("."),o=this.methods.get(i);if(o){const t=o[n];if(t&&"function"==typeof t)return void call(t,o)}const h=this.asyncMethods.get(i);if(h){const t=h[n];if(t&&"function"==typeof t)return void callWithProgressCallback(t,h)}console.log(`method ${r} not found`)}break}case rr.BridgeEventType.ack:{const t=o;if(this.queue.has(i)){const n=this.queue.get(i);n.ack=!0,r===rr.ackTypeError?n.reject(o):(n.resolve(t.data),n.callback&&n.callback(t.data)),t.complete&&this.queue.delete(i)}break}}}}},function(t){var n=kt&&kt.__createBinding||(Object.create?function(t,n,i,r){void 0===r&&(r=i);var o=Object.getOwnPropertyDescriptor(n,i);o&&!("get"in o?!n.__esModule:o.writable||o.configurable)||(o={enumerable:!0,get:function(){return n[i]}}),Object.defineProperty(t,r,o)}:function(t,n,i,r){void 0===r&&(r=i),t[r]=n[i]}),i=kt&&kt.__setModuleDefault||(Object.create?function(t,n){Object.defineProperty(t,"default",{enumerable:!0,value:n})}:function(t,n){t.default=n}),r=kt&&kt.__importStar||function(t){if(t&&t.__esModule)return t;var r={};if(null!=t)for(var o in t)"default"!==o&&Object.prototype.hasOwnProperty.call(t,o)&&n(r,t,o);return i(r,t),r};Object.defineProperty(t,"__esModule",{value:!0}),t.RNBridge=t.RNCommon=void 0,t.RNCommon=r($n);var o=Gn;Object.defineProperty(t,"RNBridge",{enumerable:!0,get:function(){return o.Bridge}})}(Kn);var sr={};Object.defineProperty(sr,"__esModule",{value:!0});var ar={};!function(t){Object.defineProperty(t,"__esModule",{value:!0}),t.bridge=void 0;const n=Xn;const i="_dscbstub",r="_dsb.returnValue";t.bridge=new class WebViewBridge{constructor(){this.registerMap={normal:{},async:{},progress:{}},this.postReady=()=>{window._dsInit||(window._dsInit=!0,setTimeout((function(){t.bridge.call("_dsb.dsinit")}),0))},this.handleMessageFromNative=t=>{const{method:n,data:i,callbackId:o}=t,h=JSON.parse(i),c={id:o,complete:!0,data:void 0},u=this.getFunction(n);if(!u)return;const{type:d,function:p,obj:g}=u;switch(d){case"normal":{const t=p;c.data=t.apply(g,h),this.call(r,c);break}case"async":{const t=p;if(t.then){t.apply(g,h).then((t=>{c.data=t,this.call(r,c)})).catch((t=>{}))}else{const t=p,n=[...h,t=>{c.data=t,this.call(r,c)}];t.apply(g,n)}break}case"progress":{const t=p,n=[...h,(t,n)=>{c.data=t,c.complete=n,this.call(r,c)}];t.apply(g,n);break}}}}call(t,n){const i={data:void 0===n?null:n};window._dsbridge?window._dsbridge.call(t,JSON.stringify(i)):window.webkit&&window.webkit.messageHandlers&&window.webkit.messageHandlers.asyncBridge&&window.webkit.messageHandlers.asyncBridge.postMessage({method:t,arg:JSON.stringify(i)})}asyncCall(t,r){const o={data:void 0===r?null:r};return new Promise((r=>{const h="asyncCall_"+(0,n.v4)().replace(/-/g,"");window[h]=t=>{r(t)},o[i]=h,window._dsbridge?window._dsbridge.call(t,JSON.stringify(o)):window.webkit&&window.webkit.messageHandlers&&window.webkit.messageHandlers.asyncBridge&&window.webkit.messageHandlers.asyncBridge.postMessage({method:t,arg:JSON.stringify(o)})}))}syncCall(t,n){const i={data:void 0===n?null:n};return window._dsbridge?window._dsbridge.call(t,JSON.stringify(n)):prompt("_dsbridge="+t,JSON.stringify(i)),JSON.parse("{}").data}register(t,n){this.postReady(),this.registerMap.normal[t]=n}registerAsync(t,n){this.postReady(),this.registerMap.async[t]=n}registerProgress(t,n){this.postReady(),this.registerMap.progress[t]=n}splitNativeMethod(t){const n=t.split("."),i=n.pop();return[n.join("."),i]}getFunction(t){for(const n in this.registerMap)if(Object.prototype.hasOwnProperty.call(this.registerMap,n)){const i=this.registerMap[n],r=i[t];if(r&&"function"==typeof r)return{type:n,function:r,obj:void 0};const[o,h]=this.splitNativeMethod(t),c=i[o]||{};if("object"==typeof c&&"function"==typeof c[h])return{type:n,function:c[h],obj:c}}}},window._handleMessageFromNative=t.bridge.handleMessageFromNative}(ar),function(t){var n=kt&&kt.__createBinding||(Object.create?function(t,n,i,r){void 0===r&&(r=i);var o=Object.getOwnPropertyDescriptor(n,i);o&&!("get"in o?!n.__esModule:o.writable||o.configurable)||(o={enumerable:!0,get:function(){return n[i]}}),Object.defineProperty(t,r,o)}:function(t,n,i,r){void 0===r&&(r=i),t[r]=n[i]}),i=kt&&kt.__exportStar||function(t,i){for(var r in t)"default"===r||Object.prototype.hasOwnProperty.call(i,r)||n(i,t,r)};Object.defineProperty(t,"__esModule",{value:!0}),i(Kn,t),i(sr,t),i(ar,t)}(Hn);const or=new Doc,hr=or.getMap("@room/users");window.doc=or,window.bridge=Hn.bridge;class WhiteboardEmitterCallbacks{constructor(t){this.elementSelected=(t,n,i,r,o)=>{Hn.bridge.call("whiteboardCallbacks.elementSelected",{userId:t,layerId:n,uuid:i,attributes:r,boundingRect:o})},this.elementDeselected=()=>{Hn.bridge.call("whiteboardCallbacks.elementDeselected")},this.toolInfoChange=t=>{Hn.bridge.call("whiteboardCallbacks.toolInfoChange",t)},this.redoStackLengthUpdate=t=>{Hn.bridge.call("whiteboardCallbacks.redoStackLengthUpdate",t)},this.undoStackLengthUpdate=t=>{Hn.bridge.call("whiteboardCallbacks.undoStackLengthUpdate",t)},this.onError=(t,n)=>{Hn.bridge.call("whiteboardCallbacks.onError",{error:t,errorMsg:n})},this.activePageUpdate=t=>{const n=this.emitter.indexedNavigation.pageCount;Hn.bridge.call("whiteboardCallbacks.pageInfoUpdate",{activePageIndex:t,pageCount:n})},this.pageCountUpdate=t=>{const n=this.emitter.indexedNavigation.currentPageIndex;Hn.bridge.call("whiteboardCallbacks.pageInfoUpdate",{activePageIndex:n,pageCount:t})},this.permissionUpdate=(t,n,i)=>{Hn.bridge.call("whiteboardCallbacks.permissionUpdate",{userId:t,flag:n,value:i})},this.emitter=t}}class WhiteboardBridge{constructor(){this.launched=!1,this.color="#ffffff",this.themeColor="#70abf8",this.setThemeColor=(t,n)=>{this.themeColor=t,this.emitter&&(this.emitter.setThemeColor(t),n())},this.setBackgroundColor=(t,n)=>{this.color=t,this.emitter&&(this.emitter.setCanvasBackgroundColor(t),n())},this.pageCount=t=>{t(this.emitter.indexedNavigation.pageCount)},this.currentPageIndex=t=>{t(this.emitter.indexedNavigation.currentPageIndex)},this.pushPage=(t,n)=>{n(this.emitter.indexedNavigation.pushPage(t))},this.insertPage=(t,n)=>{n(this.emitter.indexedNavigation.insertPage(t))},this.prevPage=t=>{t(this.emitter.indexedNavigation.prevPage())},this.nextPage=t=>{t(this.emitter.indexedNavigation.nextPage())},this.removePage=(t,n)=>{n(this.emitter.indexedNavigation.removePage(t))},this.gotoPage=(t,n)=>{this.emitter.indexedNavigation.gotoPage(t),n()},this.getPermissionValue=(t,n)=>{const i=t||void 0;n(this.emitter.permissions.getPermissionValue(i))},this.addPermission=(t,n)=>{const i=t||void 0;this.emitter.permissions.addPermission(n,i)},this.removePermission=(t,n)=>{const i=t||void 0;this.emitter.permissions.removePermission(n,i)},this.setFreeModeUserPageIndex=(t,n)=>{const i=this.emitter.indexedNavigation.getPageId(t);i&&this.emitter.setFreeModelUserPage(i,n)},this.setFreeModeUserPage=(t,n)=>{this.emitter.setFreeModelUserPage(t,n)},this.setViewModeToFree=t=>{this.emitter.setViewModeToFree(t)},this.setViewModeToFollow=(t,n)=>{this.emitter.setViewModeToFlow(t,n)},this.setViewModeToMain=t=>{this.emitter.setViewModeToMain(t)},this.getViewMode=(t,n)=>{n(this.emitter.getViewModel(t))},this.clean=()=>{this.emitter.clearPage()},this.rasterize=(t,n)=>{this.emitter.rasterize(t).then((t=>{n(t)}))},this.undo=()=>{this.emitter.undo()},this.redo=()=>{this.emitter.redo()},this.setElementAttribute=(t,n,i,r)=>{this.emitter.setElementAttribute(t,n,i,r)},this.getElementAttribute=(t,n,i,r)=>{r(this.emitter.getElementAttribute(t,n,i))},this.launch=(t,n)=>{if(this.launched)return;this.launched=!0;const i=t.userId,r=t.appId,o=new Yn,h=new Wt(i,hr);o.userId=i,o.appId=r,o.userManager=h,o.roomDoc=or,this.emitter=o.emitter;const c=new WhiteboardEmitterCallbacks(this.emitter);this.emitter.on("elementSelected",c.elementSelected),this.emitter.on("elementDeselected",c.elementDeselected),this.emitter.on("toolbarStyleChange",c.toolInfoChange),this.emitter.on("undoStackLength",c.undoStackLengthUpdate),this.emitter.on("redoStackLength",c.redoStackLengthUpdate),this.emitter.on("error",c.onError),window.whiteboard=o.emitter,window.userManager=h,o.initialize(t.option).then((()=>{this.emitter.view.style.height="100%",this.emitter.view.style.width="100%",document.body.appendChild(this.emitter.view),this.emitter.indexedNavigation.on("activePageChange",c.activePageUpdate),this.emitter.indexedNavigation.on("pageCountChange",c.pageCountUpdate),this.emitter.permissions.on("change",c.permissionUpdate),this.setBackgroundColor(this.color,(()=>{})),this.setThemeColor(this.themeColor,(()=>{})),n()}))}}}const lr=new class DocBridge{constructor(){this.update=(t,n,i)=>{if("__local_whiteboard"===n)return void i();const r=new Uint8Array(t);if("__exchangeVector"==n)return applyUpdate(or,r,n),void i();const o=encodeStateVector(or).join("");applyUpdate(or,r,n);const h=encodeStateVector(or).join("");o===h&&(console.warn("doc vector stayed the same after applying update from origin",n),Hn.bridge.call("doc.exchangeVector",{data:Array.from(h)})),i()}}},cr=new WhiteboardBridge;Hn.bridge.registerAsync("doc",lr),Hn.bridge.registerAsync("whiteboard",cr),Hn.bridge.registerAsync("userManager",new class UserManagerBridge{constructor(){this.addSocketUser=t=>{window.userManager.addSocketUserId(t)},this.deleteSocketUser=t=>{window.userManager.deleteSocketUserId(t)}}}),or.on("update",(t=>{Hn.bridge.call("doc.update",{update:Array.from(t),origin:"__local_whiteboard"})}));const ur=/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);window.test=()=>{const t="1";!function mockAddUser(t,n,i){let r=new YMap;r.set("userId",n),r.set("nickName",i),t.getMap("@room/users").set(n,r)}(or,t,t);const n=new WhiteboardBridge;n.launch({userId:t,appId:t,option:{width:1920,height:1080}},(()=>{n.setBackgroundColor("#777777",(()=>{}))}))},ur||window.test();
</script>
</head>
  <body style="margin: 0; width: 100vw; height: 100vh; position: relative;">
    <div id="root"></div>
  </body>
</html>
